/*!
jCanvas v5.2b
Copyright 2012, Caleb Evans
Licensed under the MIT license
*/
(function(v,D,e,s,F,r,o,t,J,u,w){var x,L,C=v.extend,H=s.round,f=s.PI,p=s.sin,d=s.cos,l=v.event.fix,a={},z,A;function B(){}function I(M){if(!M){L=B.prototype=C({},x)}else{C(L,M)}return this}I.version="5.2b";I.events={};v.fn.jCanvas=I;x={align:"center",angle:0,baseline:"middle",ccw:J,closed:J,compositing:"source-over",cornerRadius:0,cropFromCenter:t,each:u,end:360,fillStyle:"transparent",font:"12pt sans-serif",fromCenter:t,height:0,inDegrees:t,load:u,mask:J,opacity:1,projection:0,r1:u,r2:u,radius:0,repeat:"repeat",rounded:J,scaleX:1,scaleY:1,shadowBlur:3,shadowColor:"transparent",shadowX:0,shadowY:0,sHeight:0,sides:3,source:"",start:0,strokeCap:"butt",strokeJoin:"miter",strokeStyle:"transparent",strokeWidth:1,sWidth:0,sx:u,sy:u,text:"",width:0,x:0,x1:0,x2:0,y:0,y1:0,y2:0};I();function c(M,N){M.fillStyle=N.fillStyle;M.strokeStyle=N.strokeStyle;M.lineWidth=N.strokeWidth;if(N.rounded){M.lineCap="round";M.lineJoin="round"}else{M.lineCap=N.strokeCap;M.lineJoin=N.strokeJoin}M.shadowOffsetX=N.shadowX;M.shadowOffsetY=N.shadowY;M.shadowBlur=N.shadowBlur;M.shadowColor=N.shadowColor;M.globalAlpha=N.opacity;M.globalCompositeOperation=N.compositing}function y(M){I.events[M]=function(N){N.unbind(M+".jCanvas").bind(M+".jCanvas",function(O){a.x=O.offsetX;a.y=O.offsetY;a.type=O.type;N.drawLayers()})}}y("click");y("dblclick");y("mousedown");y("mouseup");y("mousemove");function G(M,N){var O=N[a.type];if(a.type&&O&&M.isPointInPath(a.x,a.y)){N.mouseX=a.x;N.mouseY=a.y;a.x=w;a.y=w;O.call(this,N);c(M,N)}}function j(M){return(M.getContext?M.getContext("2d"):u)}function q(M,N){if(N.mask){M.save();M.clip()}if(N.closed){M.closePath();M.fill();M.stroke()}else{M.fill();M.stroke();M.closePath()}}function b(M){return(M.inDegrees?f/180:1)}function h(N,P,O,M){P.toRad=b(P);N.save();if(!P.fromCenter){P.x+=O/2;P.y+=M/2}if(P.angle){N.translate(P.x,P.y);N.rotate(P.angle*P.toRad);N.translate(-P.x,-P.y)}}function n(M){M=M||{};x=C(x,M.props);I();if(M.name){v.fn[M.name]=function(O){var S=this,P,N,Q,R=C(new B(),O);for(Q=0;Q<S.length;Q+=1){P=S[Q];N=j(P);if(!N){continue}c(N,R);R.toRad=b(R);M.fn.call(P,N,R)}return S}}return v.fn[M.name]}v.fn.loadCanvas=function(){return j(this[0])};v.fn.getCanvasImage=function(M){var N=this[0];if(!N||!N.toDataURL){return u}if(M===w){M="image/png"}else{M=M.replace(/^([a-z]+)$/gi,"image/$1").replace(/jpg/gi,"jpeg")}return N.toDataURL(M)};v.fn.draw=function(P){var O=this,M,N;for(N=0;N<O.length;N+=1){M=j(O[N]);if(!M){continue}P.call(O[N],M)}return O};v.fn.gradient=function(N){var T=this,M,S=C(new B(),N),R,Q,P=0,O=1;M=j(T[0]);if(!M){return u}if(S.r1!==u||S.r2!==u){R=M.createRadialGradient(S.x1,S.y1,S.r1,S.x2,S.y2,S.r2)}else{R=M.createLinearGradient(S.x1,S.y1,S.x2,S.y2)}while(S["c"+O]!==w){P+=1;O+=1}for(O=1;O<=P;O+=1){Q=H(100/(P-1)*(O-1))/100;if(S["s"+O]===w){S["s"+O]=Q}R.addColorStop(S["s"+O],S["c"+O])}return R};v.fn.pattern=function(S){var M=this,U,O=C(new B(),S),P,R;U=j(M[0]);if(!U){return u}P=new F();if(O.source.src){P=O.source}else{P.src=O.source}function Q(){var V=J;if(P.complete){R=U.createPattern(P,O.repeat);V=t}return V}function T(){if(O.load){O.load.call(M[0],R)}}function N(){Q();T()}if(!P.complete&&O.load){P.onload=N}else{if(!Q()){P.onload=N}else{T()}}return R};v.fn.clearCanvas=function(N){var Q=this,M,O,P=C(new B(),N);for(O=0;O<Q.length;O+=1){M=j(Q[O]);if(!M){continue}h(M,P,P.width,P.height);if(!P.width&&!P.height){M.clearRect(0,0,Q[O].width,Q[O].height)}else{M.clearRect(P.x-P.width/2,P.y-P.height/2,P.width,P.height)}}return Q};v.fn.saveCanvas=function(){var O=this,M,N;for(N=0;N<O.length;N+=1){M=j(O[N]);if(!M){continue}M.save()}return O};v.fn.restoreCanvas=function(){var O=this,M,N;for(N=0;N<O.length;N+=1){M=j(O[N]);if(!M){continue}M.restore()}return O};v.fn.scaleCanvas=function(N){var Q=this,M,O,P=C(new B(),N);for(O=0;O<Q.length;O+=1){M=j(Q[O]);if(!M){continue}M.save();M.translate(P.x,P.y);M.scale(P.scaleX,P.scaleY);M.translate(-P.x,-P.y)}return Q};v.fn.translateCanvas=function(N){var Q=this,M,O,P=C(new B(),N);for(O=0;O<Q.length;O+=1){M=j(Q[O]);if(!M){continue}M.save();M.translate(P.x,P.y)}return Q};v.fn.rotateCanvas=function(N){var Q=this,M,O,P=C(new B(),N);for(O=0;O<Q.length;O+=1){M=j(Q[O]);if(!M){continue}h(M,P,0,0)}return Q};v.fn.drawRect=function(S){var N=this,V,R,Q=C(new B(),S),P,U,O,T,M;for(R=0;R<N.length;R+=1){V=j(N[R]);if(!V){continue}c(V,Q);h(V,Q,Q.width,Q.height);V.beginPath();if(Q.cornerRadius){Q.closed=t;P=Q.x-Q.width/2;U=Q.y-Q.height/2;O=Q.x+Q.width/2;T=Q.y+Q.height/2;M=Q.cornerRadius;if((O-P)-(2*M)<0){M=(O-P)/2}if((T-U)-(2*M)<0){M=(T-U)/2}V.moveTo(P+M,U);V.lineTo(O-M,U);V.arc(O-M,U+M,M,3*f/2,f*2,J);V.lineTo(O,T-M);V.arc(O-M,T-M,M,0,f/2,J);V.lineTo(P+M,T);V.arc(P+M,T-M,M,f/2,f,J);V.lineTo(P,U+M);V.arc(P+M,U+M,M,f,3*f/2,J)}else{V.rect(Q.x-Q.width/2,Q.y-Q.height/2,Q.width,Q.height)}V.restore();if(Q.event){G.call(N[R],V,S)}q(V,Q)}return N};v.fn.drawArc=function(N){var Q=this,M,O,P=C(new B(),N);if(!P.inDegrees&&P.end===360){P.end=f*2}for(O=0;O<Q.length;O+=1){M=j(Q[O]);if(!M){continue}c(M,P);h(M,P,P.radius*2,P.radius*2);M.beginPath();M.arc(P.x,P.y,P.radius,(P.start*P.toRad)-(f/2),(P.end*P.toRad)-(f/2),P.ccw);M.restore();if(P.event){G.call(Q[O],M,N)}q(M,P)}return Q};v.fn.drawEllipse=function(N){var R=this,M,P,Q=C(new B(),N),O=Q.width*4/3;for(P=0;P<R.length;P+=1){M=j(R[P]);if(!M){continue}c(M,Q);h(M,Q,Q.width,Q.height);M.beginPath();M.moveTo(Q.x,Q.y-Q.height/2);M.bezierCurveTo(Q.x-O/2,Q.y-Q.height/2,Q.x-O/2,Q.y+Q.height/2,Q.x,Q.y+Q.height/2);M.bezierCurveTo(Q.x+O/2,Q.y+Q.height/2,Q.x+O/2,Q.y-Q.height/2,Q.x,Q.y-Q.height/2);M.restore();if(Q.event){G.call(R[P],M,N)}q(M,Q)}return R};v.fn.drawLine=function(O){var T=this,N,R,S=C(new B(),O),M=2,Q=0,P=0;for(R=0;R<T.length;R+=1){N=j(T[R]);if(!N){continue}c(N,S);N.beginPath();N.moveTo(S.x1,S.y1);while(t){Q=S["x"+M];P=S["y"+M];if(Q!==w&&P!==w){N.lineTo(Q,P);M+=1}else{break}}if(S.event){G.call(T[R],N,O)}q(N,S)}return T};v.fn.drawQuad=function(S){var M=this,V,R,Q=C(new B(),S),P=2,O=0,N=0,U=0,T=0;for(R=0;R<M.length;R+=1){V=j(M[R]);if(!V){continue}c(V,Q);V.beginPath();V.moveTo(Q.x1,Q.y1);while(t){O=Q["x"+P];N=Q["y"+P];U=Q["cx"+(P-1)];T=Q["cy"+(P-1)];if(O!==w&&N!==w&&U!==w&&T!==w){V.quadraticCurveTo(U,T,O,N);P+=1}else{break}}if(Q.event){G.call(M[R],V,S)}q(V,Q)}return M};v.fn.drawBezier=function(X){var M=this,Y,W,T=C(new B(),X),S=2,P=1,R=0,Q=0,V=0,O=0,U=0,N=0;for(W=0;W<M.length;W+=1){Y=j(M[W]);if(!Y){continue}c(Y,T);Y.beginPath();Y.moveTo(T.x1,T.y1);while(t){R=T["x"+S];Q=T["y"+S];V=T["cx"+P];O=T["cy"+P];U=T["cx"+(P+1)];N=T["cy"+(P+1)];if(R!==w&&Q!==w&&V!==w&&O!==w&&U!==w&&N!==w){Y.bezierCurveTo(V,O,U,N,R,Q);S+=1;P+=2}else{break}}if(T.event){G.call(M[W],Y,X)}q(Y,T)}return M};v.fn.drawText=function(N){var Q=this,M,O,P=C(new B(),N);for(O=0;O<Q.length;O+=1){M=j(Q[O]);if(!M){continue}c(M,P);M.textBaseline=P.baseline;M.textAlign=P.align;M.font=P.font;M.strokeText(P.text,P.x,P.y);M.fillText(P.text,P.x,P.y)}return Q};v.fn.drawImage=function(T){var M=this,W,O,S,Q=C(new B(),T),R,N;if(Q.source.src){R=Q.source}else{if(Q.source){R=new F();R.src=Q.source}}function U(X){if(R.complete===w||R.complete===t){N=R.width/R.height;Q.sWidth=Q.sWidth||R.width;Q.sHeight=Q.sHeight||R.height;if(Q.sWidth>R.width){Q.sWidth=R.width}if(Q.sHeight>R.height){Q.sHeight=R.height}if(Q.width===0&&Q.sWidth!==R.width){Q.width=Q.sWidth}if(Q.height===0&&Q.sHeight!==R.height){Q.height=Q.sHeight}if(Q.sx===u){if(Q.cropFromCenter){Q.sx=R.width/2}else{Q.sx=0}}if(Q.sy===u){if(Q.cropFromCenter){Q.sy=R.height/2}else{Q.sy=0}}if(!Q.cropFromCenter){Q.sx+=Q.sWidth/2;Q.sy+=Q.sHeight/2}if((Q.sx+Q.sWidth/2)>R.width){Q.sx=R.width-Q.sWidth/2}if((Q.sx-Q.sWidth/2)<0){Q.sx=Q.sWidth/2}if((Q.sy-Q.sHeight/2)<0){Q.sy=Q.sHeight/2}if((Q.sy+Q.sHeight/2)>R.height){Q.sy=R.height-Q.sHeight/2}if(Q.width&&!Q.height){Q.height=Q.width/N}else{if(!Q.width&&Q.height){Q.width=Q.height*N}else{if(!Q.width&&!Q.height){Q.width=R.width;Q.height=R.height}}}h(X,Q,Q.width,Q.height);if(Q.event){X.beginPath();X.rect(Q.x-Q.width/2,Q.y-Q.height/2,Q.width,Q.height);if(Q.event){G.call(M[S],X,T)}X.closePath()}X.drawImage(R,Q.sx-Q.sWidth/2,Q.sy-Q.sHeight/2,Q.sWidth,Q.sHeight,Q.x-Q.width/2,Q.y-Q.height/2,Q.width,Q.height);X.restore();return t}}function V(){if(Q.load){Q.load.call(O)}}function P(){U(W);V()}for(S=0;S<M.length;S+=1){O=M[S];W=j(M[S]);if(!W){continue}c(W,Q);if(!R.complete&&Q.load){R.onload=P}else{if(!U(W)){R.onload=P}else{V()}}}return M};v.fn.drawPolygon=function(T){var M=this,Y,S,Q=C(new B(),T),Z=f/Q.sides,P=(f/2)+Z,X=(f*2)/Q.sides,W=d(X/2)*Q.radius,O,V,N,U,R;Q.closed=t;if(Q.sides>2){for(S=0;S<M.length;S+=1){Y=j(M[S]);if(!Y){continue}c(Y,Q);h(Y,Q,Q.radius,Q.radius);Y.beginPath();for(R=0;R<Q.sides;R+=1){O=Q.x+H(Q.radius*d(P));V=Q.y+H(Q.radius*p(P));if(R===0){Y.moveTo(O,V)}else{Y.lineTo(O,V)}if(Q.projection){N=Q.x+H((W+W*Q.projection)*d(P+Z));U=Q.y+H((W+W*Q.projection)*p(P+Z));Y.lineTo(N,U)}P+=X}Y.restore();if(Q.event){G.call(M[S],Y,T)}q(Y,Q)}}return M};v.fn.setPixels=function(U){var M=this,W,O,T,R,P=C(new B(),U),N,Q,S,V={};for(T=0;T<M.length;T+=1){O=M[T];W=j(M[T]);if(!W){continue}if(!P.x&&!P.y&&!P.width&&!P.height){P.width=O.width;P.height=O.height;P.x=P.width/2;P.y=P.height/2}h(W,P,P.width,P.height);N=W.getImageData(P.x-P.width/2,P.y-P.height/2,P.width,P.height);Q=N.data;S=Q.length;V=[];if(P.each!==u){for(R=0;R<S;R+=4){V.index=R/4;V.r=Q[R];V.g=Q[R+1];V.b=Q[R+2];V.a=Q[R+3];P.each.call(O,V);Q[R]=V.r;Q[R+1]=V.g;Q[R+2]=V.b;Q[R+3]=V.a}}W.putImageData(N,P.x-P.width/2,P.y-P.height/2);W.restore()}return M};function g(N,O){var M;for(M=0;M<N.length;M+=1){O[N[M]]=O["_"+N[M]]}}function i(N,O){var M;for(M=0;M<N.length;M+=1){O["_"+N[M]]=O[N[M]]}}z=["width","height","opacity"];A=["backgroundColor","color","borderColor","borderTopColor","borderRightColor","borderBottomColor","borderLeftColor","fillStyle","strokeStyle","shadowColor"];function k(N){var P,Q,O=[],M=1;if(typeof N==="object"){O=N}else{if(N.match(/^[a-z]+$/gi)){if(N==="transparent"){N="rgba(255,255,255,0)"}Q=e.documentElement;P=Q.style.color;Q.style.color=N;N=v.css(Q,"color");Q.style.color=P}if(N.match(/^\#/gi)){if(N.length===4){N=N.replace(/([0-9a-f])/gi,"$1$1")}O=N.match(/[0-9a-f]{2}/gi);O[0]=o(O[0],16);O[1]=o(O[1],16);O[2]=o(O[2],16)}else{if(N.match(/^rgb/gi)){O=N.match(/[0-9\.]+/gi);if(N.match(/\%/gi)){M=2.55}O[0]=O[0]*M;O[1]=O[1]*M;O[2]=O[2]*M}}if(N.match("rgba")){O[3]=r(O[3])}else{O[3]=1}}return O}function K(N,M){N.now[M]=N.start[M]+(N.end[M]-N.start[M])*N.pos;if(M<3){N.now[M]=H(N.now[M])}}function E(M){if(typeof M.start!=="object"){M.start=k(M.start);M.end=k(M.end)}M.now=[];K(M,0);K(M,1);K(M,2);K(M,3);M.now="rgba("+M.now.join(",")+")";if(M.elem.style){M.elem.style[M.prop]=M.now}else{M.elem[M.prop]=M.now}}function m(M){var N;for(N=0;N<M.length;N+=1){if(!v.fx.step[M[N]]){v.fx.step[M[N]]=E}}}v.fn.getLayers=function(){var M=this[0],N;if(!M||!M.getContext){return u}N=v.data(M,"layers");if(N===w){N=[];v.data(M,"layers",N)}return N};v.fn.getLayer=function(M){var P=this.getLayers(),O,N;if(!P){O=u}else{if(typeof M==="string"){for(N=0;N<P.length;N+=1){if(P[N].name===M){M=N;break}}}}M=M||0;O=P[M];return O};v.fn.addLayer=function(N){var S=this,M,R=C(N,new B(),v.extend({},N)),Q,O,P;R.layer=t;for(P=0;P<S.length;P+=1){M=v(S[P]);if(!j(S[P])){continue}Q=M.getLayers();if(typeof R==="function"){R.method="draw"}Q.push(R);for(O in I.events){if(I.events.hasOwnProperty(O)&&R[O]){I.events[O].call(D,M,R,Q.length-1);R.event=t}}}return S};v.fn.removeLayers=function(){(this.getLayers()||[]).length=0;return this};v.fn.removeLayer=function(M){M=M||0;(this.getLayers()||[]).splice(M,1);return this};v.fn.removeLayer=function(M){var O=typeof M,P=(this.getLayers()||[]),N;if(O==="string"){for(N=0;N<P.length;N+=1){if(P[N].name===M){P.splice(N,1);break}}}else{if(O==="number"){P.splice(M,1)}}return this};v.fn.drawLayers=function(){var S=this,N,M,R,Q,P,O;for(P=0;P<S.length;P+=1){N=v(S[P]);M=j(N[0]);if(!M){continue}Q=N.getLayers();M.clearRect(0,0,N[0].width,N[0].height);for(O=0;O<Q.length;O+=1){R=Q[O];if(R.method==="draw"){R.call(N[0],M)}else{if(v.fn[R.method]){v.fn[R.method].call(N,R)}}}}return S};v.fn.animateLayer=function(){var S=this,O=([]).slice.call(arguments,0),N,P,R;if(typeof O[0]==="object"&&!O[0].layer){O.unshift(0)}if(O[2]===w){O.splice(2,0,u);O.splice(3,0,u);O.splice(4,0,function(){})}else{if(typeof O[2]==="function"){O.splice(2,0,u);O.splice(3,0,u)}}if(O[3]===w){O[3]=u;O.splice(4,0,function(){})}else{if(typeof O[3]==="function"){O.splice(3,0,u)}}if(O[4]===w){O[4]=function(){}}function M(T,U){return function(){g(z,U);T.drawLayers();O[4].call(T[0])}}function Q(T,U){return function(V){g(z,U);T.drawLayers()}}for(R=0;R<S.length;R+=1){N=v(S[R]);if(O[0].layer){P=O[0]}else{P=N.getLayer(O[0])}if(!P||P.method==="draw"){continue}if(P.method==="drawImage"){O[1].width=O[1].width||1e-10;O[1].height=O[1].height||1e-10;P.width=P.width||1e-10;P.height=P.height||1e-10}P=C(P,L,v.extend({},P));i(z,P);i(z,O[1]);v(P).animate(O[1],{duration:O[2],easing:(v.easing[O[3]]?O[3]:u),complete:M(N,P),step:Q(N,P)})}return S};v.event.fix=function(M){var N;M=l.call(v.event,M);if(M.pageX!==w&&M.offsetX===w){N=v(M.target).offset();if(N){M.offsetX=M.pageX-N.left;M.offsetY=M.pageY-N.top}}return M};v.support.canvas=(e.createElement("canvas").getContext!==w);m(A);I.defaults=x;I.prefs=L;I.extend=n;v.jCanvas=I}(jQuery,window,document,Math,Image,parseFloat,parseInt,true,false,null));