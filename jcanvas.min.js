/*!
jCanvas v4.1b
Copyright 2011, Caleb Evans
Licensed under the MIT license
*/
(function(f,l,j,q,h){var k,e,i=f.fn,g=f.extend,r=j.PI,s=j.round,a=j.sin,b=j.cos;function o(t){if(!t){e=g({},k)}else{e=g({},e,t)}return this}k={width:0,height:0,cornerRadius:0,fillStyle:"transparent",strokeStyle:"transparent",strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",rounded:false,shadowX:0,shadowY:0,shadowBlur:3,shadowColor:"transparent",opacity:1,compositing:"source-over",mask:false,x:0,y:0,x1:0,y1:0,radius:0,start:0,end:360,ccw:false,inDegrees:true,fromCenter:true,closed:false,sides:3,angle:0,text:"",font:"normal 12pt sans-serif",align:"center",baseline:"middle",source:"",repeat:"repeat"};e=g({},k);function n(t,u){t.fillStyle=u.fillStyle;t.strokeStyle=u.strokeStyle;t.lineWidth=u.strokeWidth;if(u.rounded){t.lineCap="round";t.lineJoin="round"}else{t.lineCap=u.strokeCap;t.lineJoin=u.strokeJoin}t.shadowOffsetX=u.shadowX;t.shadowOffsetY=u.shadowY;t.shadowBlur=u.shadowBlur;t.shadowColor=u.shadowColor;t.globalAlpha=u.opacity;t.globalCompositeOperation=u.compositing}function d(t,u){if(u.mask){t.save();t.clip()}if(u.closed){t.closePath();t.fill();t.stroke()}else{t.fill();t.stroke();t.closePath()}}function c(t){return t.inDegrees?r/180:1}function m(u,w,v,t){w.toRad=c(w);u.save();if(!w.fromCenter){w.x+=v/2;w.y+=t/2}if(w.angle){u.translate(w.x,w.y);u.rotate(w.angle*w.toRad);u.translate(-w.x,-w.y)}}function p(t){k=g(k,t.props||{});e=g({},k);f.fn[t.name]=function(v){var y=this,u,w,x=g({},e,v);for(w=0;w<y.length;w+=1){if(!this[w].getContext){continue}u=y[w].getContext("2d");n(u,x);x.toRad=c(x);t.fn.call(y[w],u,x)}return this};return f.fn[t.name]}f.fn.jCanvas=o;f.fn.loadCanvas=function(t){if(!this[0].getContext){return null}return this[0].getContext(t||"2d")};f.fn.getCanvasData=function(t){if(!this[0].toDataURL){return null}if(t===h){t="image/png"}else{t=t.replace(/^([a-z]+)$/gi,"image/$1").replace(/jpg/gi,"jpeg")}return this[0].toDataURL(t)};f.fn.draw=function(v){var u=this,t;for(t=0;t<u.length;t+=1){if(!u[t].getContext){continue}v.call(u[t],u[t].getContext("2d"))}return this};f.fn.gradient=function(u){if(!this[0].getContext){return null}var t=this[0].getContext("2d"),z=g({},e,u),y,x,w=0,v=1;if(z.r1!==h||z.r2!==h){y=t.createRadialGradient(z.x1,z.y1,z.r1,z.x2,z.y2,z.r2)}else{y=t.createLinearGradient(z.x1,z.y1,z.x2,z.y2)}while(z["c"+v]!==h){w+=1;v+=1}for(v=1;v<=w;v+=1){x=s(100/(w-1)*(v-1))/100;if(z["s"+v]===h){z["s"+v]=x}y.addColorStop(z["s"+v],z["c"+v])}return y};f.fn.pattern=function(v){if(!this[0].getContext){return null}var t=this[0].getContext("2d"),z=g({},e,v),u=new q(),x;u.src=z.source;function w(){if(u.complete){x=t.createPattern(u,z.repeat);return true}else{return false}}function y(){w();if(z.load){z.load.call(this[0],x)}}if(z.load){u.onload=y}else{if(!w()){u.onload=y}}return x};f.fn.clearCanvas=function(u){var t,v,w=g({},e,u);for(v=0;v<this.length;v+=1){if(!this[v].getContext){continue}t=this[v].getContext("2d");m(t,w,w.width,w.height);if(!w.width&&!w.height){t.clearRect(0,0,this[v].width,this[v].height)}else{t.clearRect(w.x-w.width/2,w.y-w.height/2,w.width,w.height)}}return this};f.fn.saveCanvas=function(){var t;for(t=0;t<this.length;t+=1){if(!this[t].getContext){continue}this[t].getContext("2d").save()}return this};f.fn.restoreCanvas=function(){var t;for(t=0;t<this.length;t+=1){if(!this[t].getContext){continue}this[t].getContext("2d").restore()}return this};f.fn.scaleCanvas=function(u){var t,v,w=g({},e,u);for(v=0;v<this.length;v+=1){if(!this[v].getContext){continue}t=this[v].getContext("2d");t.save();t.translate(w.x,w.y);t.scale(w.width,w.height);t.translate(-w.x,-w.y)}return this};f.fn.translateCanvas=function(u){var t,v,w=g({},e,u);for(v=0;v<this.length;v+=1){if(!this[v].getContext){continue}t=this[v].getContext("2d");t.save();t.translate(w.x,w.y)}return this};f.fn.rotateCanvas=function(u){var t,v,w=g({},e,u);for(v=0;v<this.length;v+=1){if(!this[v].getContext){continue}t=this[v].getContext("2d");m(t,w,0,0)}return this};f.fn.drawRect=function(y){var B,x,w=g({},e,y),v,A,u,z,t;for(x=0;x<this.length;x+=1){if(!this[x].getContext){continue}B=this[x].getContext("2d");n(B,w);m(B,w,w.width,w.height);B.beginPath();if(w.cornerRadius){v=w.x-w.width/2;A=w.y-w.height/2;u=w.x+w.width/2;z=w.y+w.height/2;t=w.cornerRadius;if((u-v)-(2*t)<0){t=(u-v)/2}if((z-A)-(2*t)<0){t=(z-A)/2}B.moveTo(v+t,A);B.lineTo(u-t,A);B.arc(u-t,A+t,t,3*r/2,r*2);B.lineTo(u,z-t);B.arc(u-t,z-t,t,0,r/2);B.lineTo(v+t,z);B.arc(v+t,z-t,t,r/2,r);B.lineTo(v,A+t);B.arc(v+t,A+t,t,r,3*r/2)}else{B.rect(w.x-w.width/2,w.y-w.height/2,w.width,w.height)}B.restore();d(B,w)}return this};f.fn.drawArc=function(u){var t,v,w=g({},e,u);if(!w.inDegrees&&w.end===360){w.end=r*2}for(v=0;v<this.length;v+=1){if(!this[v].getContext){continue}t=this[v].getContext("2d");n(t,w);m(t,w,w.radius*2,w.radius*2);t.beginPath();t.arc(w.x,w.y,w.radius,(w.start*w.toRad)-(r/2),(w.end*w.toRad)-(r/2),w.ccw);t.restore();d(t,w)}return this};f.fn.drawEllipse=function(u){var t,w,x=g({},e,u),v=x.width*4/3;for(w=0;w<this.length;w+=1){if(!this[w].getContext){continue}t=this[w].getContext("2d");n(t,x);m(t,x,x.width,x.height);t.beginPath();t.moveTo(x.x,x.y-x.height/2);t.bezierCurveTo(x.x-v/2,x.y-x.height/2,x.x-v/2,x.y+x.height/2,x.x,x.y+x.height/2);t.bezierCurveTo(x.x+v/2,x.y+x.height/2,x.x+v/2,x.y-x.height/2,x.x,x.y-x.height/2);t.restore();d(t,x)}return this};f.fn.drawLine=function(v){var u,y,z=g({},e,v),t=2,x=0,w=0;for(y=0;y<this.length;y+=1){if(!this[y].getContext){continue}u=this[y].getContext("2d");n(u,z);u.beginPath();u.moveTo(z.x1,z.y1);while(x!==h&&w!==h){x=z["x"+t];w=z["y"+t];u.lineTo(x,w);t+=1}d(u,z)}return this};f.fn.drawQuad=function(y){var B,x,w=g({},e,y),v=2,u=0,t=0,A=0,z=0;for(x=0;x<this.length;x+=1){if(!this[x].getContext){continue}B=this[x].getContext("2d");n(B,w);B.beginPath();B.moveTo(w.x1,w.y1);while(u!==h&&t!==h&&A!==h&&z!==h){u=w["x"+v];t=w["y"+v];A=w["cx"+(v-1)];z=w["cy"+(v-1)];B.quadraticCurveTo(A,z,u,t);v+=1}d(B,w)}return this};f.fn.drawBezier=function(D){var E,C,z=g({},e,D),y=2,v=1,x=0,w=0,B=0,u=0,A=0,t=0;for(C=0;C<this.length;C+=1){if(!this[C].getContext){continue}E=this[C].getContext("2d");n(E,z);E.beginPath();E.moveTo(z.x1,z.y1);while(x!==h&&w!==h&&B!==h&&u!==h&&A!==h&&t!==h){x=z["x"+y];w=z["y"+y];B=z["cx"+v];u=z["cy"+v];A=z["cx"+(v+1)];t=z["cy"+(v+1)];E.bezierCurveTo(B,u,A,t,x,w);y+=1;v+=2}d(E,z)}return this};f.fn.drawText=function(u){var t,v,w=g({},e,u);for(v=0;v<this.length;v+=1){if(!this[v].getContext){continue}t=this[v].getContext("2d");n(t,w);t.textBaseline=w.baseline;t.textAlign=w.align;t.font=w.font;t.strokeText(w.text,w.x,w.y);t.fillText(w.text,w.x,w.y)}return this};f.fn.drawImage=function(z){var B,u,y,w=g({},e,z),x=new q(),t;x.src=w.source;function A(C){if(x.complete){t=x.width/x.height;if(w.sx===h){w.sx=x.width/2}if(w.sy===h){w.sy=x.height/2}w.sWidth=w.sWidth||x.width;w.sHeight=w.sHeight||x.height;if(w.width&&!w.height){w.height=w.width/t}else{if(!w.width&&w.height){w.width=w.height*t}else{if(!w.width&&!w.height){w.width=x.width;w.height=x.height}}}m(C,w,w.width,w.height);C.drawImage(x,w.sx-w.sWidth/2,w.sy-w.sHeight/2,w.sWidth,w.sHeight,w.x-w.width/2,w.y-w.height/2,w.width,w.height);C.restore();return true}else{return false}}function v(){A(B);if(w.load){w.load.call(u)}}for(y=0;y<this.length;y+=1){u=this[y];if(!u.getContext){continue}B=u.getContext("2d");n(B,w);if(w.load){x.onload=v}else{if(!A(B)){x.onload=v}}}return this};f.fn.drawPolygon=function(z){var E,y,w=g({},e,z),F=r/w.sides,v=(r/2)+F,D=(r*2)/w.sides,C=b(D/2)*w.radius,u,B,t,A,x;w.closed=true;if(w.sides>2){for(y=0;y<this.length;y+=1){if(!this[y].getContext){continue}E=this[y].getContext("2d");n(E,w);m(E,w,w.radius,w.radius);E.beginPath();for(x=0;x<w.sides;x+=1){u=w.x+s(w.radius*b(v));B=w.y+s(w.radius*a(v));if(x===0){E.moveTo(u,B)}else{E.lineTo(u,B)}if(w.projection){t=w.x+s((C+C*w.projection)*b(v+F));A=w.y+s((C+C*w.projection)*a(v+F));E.lineTo(t,A)}v+=D}E.restore();d(E,w)}}return this};f.fn.setPixels=function(A){var C,u,z,x,v=g({},e,A),t,w,y,B;for(z=0;z<this.length;z+=1){u=this[z];if(!u.getContext){continue}C=u.getContext("2d");if(!v.x&&!v.y&&!v.width&&!v.height){v.width=u.width;v.height=u.height;v.x=v.width/2;v.y=v.height/2}m(C,v,v.width,v.height);t=C.getImageData(v.x-v.width/2,v.y-v.height/2,v.width,v.height);w=t.data;y=w.length;B=[];if(v.each!==h){for(x=0;x<y;x+=4){B=v.each.call(u,w[x],w[x+1],w[x+2],w[x+3]);w[x]=B[0];w[x+1]=B[1];w[x+2]=B[2];w[x+3]=B[3]}}C.putImageData(t,v.x-v.width/2,v.y-v.height/2);C.restore()}return this};f.fn.getLayers=function(){var t=this.eq(0),u;if(!t[0].getContext){return[]}u=t.data("layers");if(u===h){u=[];t.data("layers",u)}return u};f.fn.addLayer=function(u){var x=this,t,w,v;for(v=0;v<x.length;v+=1){t=x.eq(v);if(!x[v].getContext){continue}w=t.getLayers();w.push(u)}return x};f.fn.drawLayers=function(t){var z=this,u,y,x,w,v;for(w=0;w<z.length;w+=1){if(!z[w].getContext){continue}u=z[w].getContext("2d");x=z.eq(w).data("layers")||[];for(v=0;v<x.length;v+=1){y=x[v];if(y.fn){i[y.fn].call(z.eq(w),y)}}}return z};f.fn.animateLayer=function(t,x,w){var z=this,v,u;if(w===h){w=400}function y(){z.eq(u).clearCanvas().drawLayers()}for(u=0;u<z.length;u+=1){v=z.eq(u).getLayers();f(v[t]).animate(x,{duration:w,step:y})}return z};o.defaults=k;o.prefs=e;o.extend=p;f.jCanvas=o}(jQuery,document,Math,Image));