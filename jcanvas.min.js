/*!
jCanvas v5.3b
Copyright 2012, Caleb Evans
Licensed under the MIT license
*/
(function(z,H,d,v,K,u,p,x,O,y,A){var B,Q,G=z.extend,M=v.round,e=v.PI,q=v.sin,c=v.cos,l=z.event.fix,t={},o={},D,E;function F(){}function N(R){if(R){G(Q,R)}else{Q=F.prototype=G({},B)}return this}N.version="5.3b";N.events={};z.fn.jCanvas=N;B={angle:0,align:"center",autosave:x,baseline:"middle",ccw:O,closed:O,compositing:"source-over",cornerRadius:0,cropFromCenter:x,each:y,end:360,fillStyle:"transparent",font:"12pt sans-serif",fromCenter:x,height:y,inDegrees:x,load:y,mask:O,opacity:1,projection:0,r1:y,r2:y,radius:0,repeat:"repeat",rounded:O,scale:1,scaleX:1,scaleY:1,shadowBlur:3,shadowColor:"transparent",shadowX:0,shadowY:0,sHeight:0,sides:3,source:"",start:0,strokeCap:"butt",strokeJoin:"miter",strokeStyle:"transparent",strokeWidth:1,sWidth:0,sx:y,sy:y,text:"",visible:x,width:y,x:0,x1:0,x2:0,y:0,y1:0,y2:0};N();function b(R,S){R.fillStyle=S.fillStyle;R.strokeStyle=S.strokeStyle;R.lineWidth=S.strokeWidth;if(S.rounded){R.lineCap="round";R.lineJoin="round"}else{R.lineCap=S.strokeCap;R.lineJoin=S.strokeJoin}R.shadowOffsetX=S.shadowX;R.shadowOffsetY=S.shadowY;R.shadowBlur=S.shadowBlur;R.shadowColor=S.shadowColor;R.globalAlpha=S.opacity;R.globalCompositeOperation=S.compositing}t.x=[];t.y=[];function C(R){N.events[R]=function(S){S.unbind(R+".jCanvas").bind(R+".jCanvas",function(T){t.x[0]=T.offsetX;t.y[0]=T.offsetY;t.type=T.type;S.drawLayers()})}}C("click");C("dblclick");C("mousedown");C("mouseup");C("mousemove");N.events.mouseover=N.events.mouseout=function(R){R.unbind("mousemove.jCanvasHover").bind("mousemove.jCanvasHover",function(S){t.x[1]=t.x[0];t.y[1]=t.y[0];t.x[0]=S.offsetX;t.y[0]=S.offsetY;t.type="hover";R.drawLayers()})};function f(R){R.mouseX=t.x[0];R.mouseY=t.y[0];t.x[0]=A;t.y[0]=A}function L(U,R,T){var W=T[t.type],V=R.isPointInPath(t.x[0],t.y[0]),S=R.isPointInPath(t.x[1],t.y[1]);if(t.type==="hover"&&V&&!T.fired){T.fired=x;f(T);if(T.mouseover){T.mouseover.call(U,T);b(R,T)}}else{if(t.type==="hover"&&!V&&S&&T.fired){T.fired=O;f(T);if(T.mouseout){T.mouseout.call(U,T);b(R,T)}}else{if(t.type!=="hover"&&W&&V){f(T);W.call(U,T);b(R,T)}}}}function j(R){return(R.getContext?R.getContext("2d"):y)}function r(R,S){if(S.mask){if(S.autosave){R.save()}R.clip()}if(S.closed){R.closePath();R.fill();R.stroke()}else{R.fill();R.stroke();R.closePath()}}function h(S,U,T,R){U.toRad=(U.inDegrees?e/180:1);S.save();if(!U.fromCenter){U.x+=T/2;U.y+=R/2}if(U.angle){s(S,U)}w(S,U)}function n(R){R=R||{};B=G(B,R.props);N();if(R.name){z.fn[R.name]=function(T){var X=this,U,V,S,W=G(new F(),T);for(V=0;V<X.length;V+=1){U=X[V];S=j(U);if(S){b(S,W);R.fn.call(U,S,W)}}return X}}return z.fn[R.name]}z.fn.loadCanvas=function(){return j(this[0])};z.fn.getCanvasImage=function(R){var S=this[0];if(!S||!S.toDataURL){return y}if(R===A){R="image/png"}else{R=R.replace(/^([a-z]+)$/gi,"image/$1").replace(/jpg/gi,"jpeg")}return S.toDataURL(R)};z.fn.draw=function(U){var T=this,R,S;for(S=0;S<T.length;S+=1){R=j(T[S]);if(R){U.call(T[S],R)}}return T};z.fn.gradient=function(Z){var R=this,ad,W=G(new F(),Z),ab,ac=[],Y,T,V,X,aa,U,S;ad=j(R[0]);if(ad){if(W.c2===A){ab=W.c1}else{if(W.r1!==y||W.r2!==y){ab=ad.createRadialGradient(W.x1,W.y1,W.r1,W.x2,W.y2,W.r2)}else{ab=ad.createLinearGradient(W.x1,W.y1,W.x2,W.y2)}for(X=1;W["c"+X]!==A;X+=1){if(W["s"+X]!==A){ac.push(W["s"+X])}else{ac.push(y)}}Y=ac.length;if(ac[0]===y){ac[0]=0}if(ac[Y-1]===y){ac[Y-1]=1}for(X=0;X<Y;X+=1){if(ac[X]!==y&&ac[X]!==1){aa=X+1;U=1;S=0;T=ac[X];for(aa=(X+1);aa<Y;aa+=1){if(ac[aa]!==y){V=ac[aa];break}else{U+=1}}if(T>V){ac[aa]=ac[X]}}else{if(ac[X]===y){S+=1;ac[X]=T+(S*((V-T)/U))}}ab.addColorStop(ac[X],W["c"+(X+1)])}}}else{ab=y}return ab};z.fn.pattern=function(X){var R=this,Z,T=G(new F(),X),U,W;function V(){var aa=O;if(U.complete){W=Z.createPattern(U,T.repeat);aa=x}return aa}function Y(){if(T.load){T.load.call(R[0],W)}}function S(){V();Y()}Z=j(R[0]);if(Z){U=new K();if(T.source.src){U=T.source}else{U.src=T.source}if(!U.complete&&T.load){U.onload=S}else{if(!V()){U.onload=S}else{Y()}}}else{W=y}return W};z.fn.clearCanvas=function(S){var V=this,T,R,U=G(new F(),S);for(T=0;T<V.length;T+=1){R=j(V[T]);if(R){h(R,U,U.width,U.height);if(!U.width&&!U.height){R.clearRect(0,0,V[T].width,V[T].height)}else{R.clearRect(U.x-U.width/2,U.y-U.height/2,U.width,U.height)}}}return V};z.fn.saveCanvas=function(){var T=this,R,S;for(S=0;S<T.length;S+=1){R=j(T[S]);if(R){R.save()}}return T};z.fn.restoreCanvas=function(){var T=this,R,S;for(S=0;S<T.length;S+=1){R=j(T[S]);if(R){R.restore()}}return T};function w(R,S){if(S.scale!==1){S.scaleX=S.scaleY=S.scale}if(S.scaleX!==1||S.scaleY!==1){R.translate(S.x,S.y);R.scale(S.scaleX,S.scaleY);R.translate(-S.x,-S.y)}}z.fn.scaleCanvas=function(S){var V=this,T,R,U=G(new F(),S);for(T=0;T<V.length;T+=1){R=j(V[T]);if(R){if(U.scale!==1){U.scaleX=U.scaleY=U.scale}if(U.autosave){R.save()}w(R,U)}}return V};z.fn.translateCanvas=function(S){var V=this,T,R,U=G(new F(),S);for(T=0;T<V.length;T+=1){R=j(V[T]);if(R){if(U.autosave){R.save()}R.translate(U.x,U.y)}}return V};function s(R,S){S.toRad=(S.inDegrees?e/180:1);R.translate(S.x,S.y);R.rotate(S.angle*S.toRad);R.translate(-S.x,-S.y)}z.fn.rotateCanvas=function(S){var V=this,T,R,U=G(new F(),S);for(T=0;T<V.length;T+=1){R=j(V[T]);if(R){if(U.autosave){R.save()}s(R,U)}}return V};z.fn.drawRect=function(X){var S=this,W,aa,V=G(new F(),X),U,Z,T,Y,R;for(W=0;W<S.length;W+=1){aa=j(S[W]);if(aa){b(aa,V);h(aa,V,V.width,V.height);aa.beginPath();if(V.cornerRadius){V.closed=x;U=V.x-V.width/2;Z=V.y-V.height/2;T=V.x+V.width/2;Y=V.y+V.height/2;R=V.cornerRadius;if((T-U)-(2*R)<0){R=(T-U)/2}if((Y-Z)-(2*R)<0){R=(Y-Z)/2}aa.moveTo(U+R,Z);aa.lineTo(T-R,Z);aa.arc(T-R,Z+R,R,3*e/2,e*2,O);aa.lineTo(T,Y-R);aa.arc(T-R,Y-R,R,0,e/2,O);aa.lineTo(U+R,Y);aa.arc(U+R,Y-R,R,e/2,e,O);aa.lineTo(U,Z+R);aa.arc(U+R,Z+R,R,e,3*e/2,O)}else{aa.rect(V.x-V.width/2,V.y-V.height/2,V.width,V.height)}aa.restore();if(V.event){L(S[W],aa,X)}r(aa,V)}}return S};z.fn.drawArc=function(S){var V=this,T,R,U=G(new F(),S);if(!U.inDegrees&&U.end===360){U.end=e*2}for(T=0;T<V.length;T+=1){R=j(V[T]);if(R){b(R,U);h(R,U,U.radius*2,U.radius*2);R.beginPath();R.arc(U.x,U.y,U.radius,(U.start*U.toRad)-(e/2),(U.end*U.toRad)-(e/2),U.ccw);R.restore();if(U.event){L(V[T],R,S)}r(R,U)}}return V};z.fn.drawEllipse=function(S){var W=this,U,R,V=G(new F(),S),T=V.width*4/3;for(U=0;U<W.length;U+=1){R=j(W[U]);if(R){b(R,V);h(R,V,V.width,V.height);R.beginPath();R.moveTo(V.x,V.y-V.height/2);R.bezierCurveTo(V.x-T/2,V.y-V.height/2,V.x-T/2,V.y+V.height/2,V.x,V.y+V.height/2);R.bezierCurveTo(V.x+T/2,V.y+V.height/2,V.x+T/2,V.y-V.height/2,V.x,V.y-V.height/2);R.restore();if(V.event){L(W[U],R,S)}r(R,V)}}return W};z.fn.drawLine=function(T){var Y=this,W,S,X=G(new F(),T),R=2,V=0,U=0;for(W=0;W<Y.length;W+=1){S=j(Y[W]);if(S){b(S,X);S.beginPath();S.moveTo(X.x1,X.y1);while(x){V=X["x"+R];U=X["y"+R];if(V!==A&&U!==A){S.lineTo(V,U);R+=1}else{break}}if(X.event){L(Y[W],S,T)}r(S,X)}}return Y};z.fn.drawQuad=function(X){var R=this,W,aa,V=G(new F(),X),U=2,T=0,S=0,Z=0,Y=0;for(W=0;W<R.length;W+=1){aa=j(R[W]);if(aa){b(aa,V);aa.beginPath();aa.moveTo(V.x1,V.y1);while(x){T=V["x"+U];S=V["y"+U];Z=V["cx"+(U-1)];Y=V["cy"+(U-1)];if(T!==A&&S!==A&&Z!==A&&Y!==A){aa.quadraticCurveTo(Z,Y,T,S);U+=1}else{break}}if(V.event){L(R[W],aa,X)}r(aa,V)}}return R};z.fn.drawBezier=function(ac){var R=this,ab,ad,Y=G(new F(),ac),X=2,U=1,W=0,V=0,aa=0,T=0,Z=0,S=0;for(ab=0;ab<R.length;ab+=1){ad=j(R[ab]);if(ad){b(ad,Y);ad.beginPath();ad.moveTo(Y.x1,Y.y1);while(x){W=Y["x"+X];V=Y["y"+X];aa=Y["cx"+U];T=Y["cy"+U];Z=Y["cx"+(U+1)];S=Y["cy"+(U+1)];if(W!==A&&V!==A&&aa!==A&&T!==A&&Z!==A&&S!==A){ad.bezierCurveTo(aa,T,Z,S,W,V);X+=1;U+=2}else{break}}if(Y.event){L(R[ab],ad,ac)}r(ad,Y)}}return R};function I(U,R,V){var S,T;V.width=R.measureText(V.text).width;if(o.font===V.font){V.height=o.height}else{S=U.style.fontSize;T=V.font.match(/\d+/gi);if(T){U.style.fontSize=(V.font.match(/(\d*\.?\d*)\w+/gi)||z.css(U,"fontSize"))[0]}V.height=u(z.css(U,"fontSize"));U.style.fontSize=S}}z.fn.drawText=function(T){var W=this,S,U,R,V=G(new F(),T);for(U=0;U<W.length;U+=1){S=z(W[U]);R=j(S[0]);if(R){b(R,V);R.textBaseline=V.baseline;R.textAlign=V.align;R.font=V.font;I(S[0],R,V);h(R,V,V.width,V.height);R.strokeText(V.text,V.x,V.y);R.fillText(V.text,V.x,V.y);if(V.event){R.beginPath();R.rect(V.x-V.width/2,V.y-V.height/2,V.width,V.height);R.restore();L(W[U],R,T);R.closePath()}else{R.restore()}}}o=V;return W};z.fn.drawImage=function(Y){var R=this,ab,T,X,V=G(new F(),Y),W,S;Y=Y||{};if(V.source.src){W=V.source}else{if(V.source){W=new K();W.src=V.source}}function Z(ac){if(W.complete===A||W.complete===x){S=W.width/W.height;V.sWidth=V.sWidth||W.width;V.sHeight=V.sHeight||W.height;if(V.sWidth>W.width){V.sWidth=W.width}if(V.sHeight>W.height){V.sHeight=W.height}if(V.width===y&&V.sWidth!==W.width){V.width=V.sWidth}if(V.height===y&&V.sHeight!==W.height){V.height=V.sHeight}if(V.sx===y){if(V.cropFromCenter){V.sx=W.width/2}else{V.sx=0}}if(V.sy===y){if(V.cropFromCenter){V.sy=W.height/2}else{V.sy=0}}if(!V.cropFromCenter){V.sx+=V.sWidth/2;V.sy+=V.sHeight/2}if((V.sx+V.sWidth/2)>W.width){V.sx=W.width-V.sWidth/2}if((V.sx-V.sWidth/2)<0){V.sx=V.sWidth/2}if((V.sy-V.sHeight/2)<0){V.sy=V.sHeight/2}if((V.sy+V.sHeight/2)>W.height){V.sy=W.height-V.sHeight/2}if(V.width!==y&&V.height===y){Y.height=V.height=V.width/S}else{if(V.width===y&&V.height!==y){Y.width=V.width=V.height*S}else{if(V.width===y&&V.height===y){Y.width=V.width=W.width;Y.height=V.height=W.height}}}h(ac,V,V.width,V.height);ac.drawImage(W,V.sx-V.sWidth/2,V.sy-V.sHeight/2,V.sWidth,V.sHeight,V.x-V.width/2,V.y-V.height/2,V.width,V.height);if(V.event){ac.fillStyle="#000";ac.beginPath();ac.rect(V.x-V.width/2,V.y-V.height/2,V.width,V.height);ac.restore();L(R[X],ac,Y);ac.closePath()}else{ac.restore()}return x}}function aa(){if(V.load){V.load.call(T)}}function U(){Z(ab);aa()}for(X=0;X<R.length;X+=1){T=R[X];ab=j(R[X]);if(ab){b(ab,V);if(!W.complete&&V.load){W.onload=U}else{if(!Z(ab)){W.onload=U}else{aa()}}}}return R};z.fn.drawPolygon=function(Y){var R=this,X,ad,V=G(new F(),Y),ae=e/V.sides,U=(e/2)+ae,ac=(e*2)/V.sides,ab=c(ac/2)*V.radius,T,aa,S,Z,W;V.closed=x;if(V.sides>2){for(X=0;X<R.length;X+=1){ad=j(R[X]);if(ad){b(ad,V);h(ad,V,V.radius,V.radius);ad.beginPath();for(W=0;W<V.sides;W+=1){T=V.x+M(V.radius*c(U));aa=V.y+M(V.radius*q(U));if(W===0){ad.moveTo(T,aa)}else{ad.lineTo(T,aa)}if(V.projection){S=V.x+M((ab+ab*V.projection)*c(U+ae));Z=V.y+M((ab+ab*V.projection)*q(U+ae));ad.lineTo(S,Z)}U+=ac}ad.restore();if(V.event){L(R[X],ad,Y)}r(ad,V)}}}return R};z.fn.setPixels=function(Z){var R=this,ab,T,Y,W,U=G(new F(),Z),S,V,X,aa={};for(Y=0;Y<R.length;Y+=1){T=R[Y];ab=j(R[Y]);if(ab){if(!U.x&&!U.y&&!U.width&&!U.height){U.width=T.width;U.height=T.height;U.x=U.width/2;U.y=U.height/2}h(ab,U,U.width,U.height);S=ab.getImageData(U.x-U.width/2,U.y-U.height/2,U.width,U.height);V=S.data;X=V.length;aa=[];if(U.each!==y){for(W=0;W<X;W+=4){aa.index=W/4;aa.r=V[W];aa.g=V[W+1];aa.b=V[W+2];aa.a=V[W+3];U.each.call(T,aa);V[W]=aa.r;V[W+1]=aa.g;V[W+2]=aa.b;V[W+3]=aa.a}}ab.putImageData(S,U.x-U.width/2,U.y-U.height/2);ab.restore()}}return R};function g(S,T){var R;for(R=0;R<S.length;R+=1){T[S[R]]=T["_"+S[R]]}}function i(S,T){var R;for(R=0;R<S.length;R+=1){T["_"+S[R]]=T[S[R]]}}D=["width","height","opacity"];E=["backgroundColor","color","borderColor","borderTopColor","borderRightColor","borderBottomColor","borderLeftColor","fillStyle","strokeStyle","shadowColor"];function k(S){var V,U,T=[],R=1;if(typeof S==="object"){T=S}else{if(S.match(/^[a-z]+$/gi)){if(S==="transparent"){S="rgba(255,255,255,0)"}U=d.documentElement;V=U.style.color;U.style.color=S;S=z.css(U,"color");U.style.color=V}if(S.match(/^\#/gi)){if(S.length===4){S=S.replace(/([0-9a-f])/gi,"$1$1")}T=S.match(/[0-9a-f]{2}/gi);T[0]=p(T[0],16);T[1]=p(T[1],16);T[2]=p(T[2],16)}else{if(S.match(/^rgb/gi)){T=S.match(/[0-9\.]+/gi);if(S.match(/\%/gi)){R=2.55}T[0]=T[0]*R;T[1]=T[1]*R;T[2]=T[2]*R}}if(S.match("rgba")){T[3]=u(T[3])}else{T[3]=1}}return T}function P(S,R){S.now[R]=S.start[R]+(S.end[R]-S.start[R])*S.pos;if(R<3){S.now[R]=M(S.now[R])}}function J(R){if(typeof R.start!=="object"){R.start=k(R.start);R.end=k(R.end)}R.now=[];P(R,0);P(R,1);P(R,2);P(R,3);R.now="rgba("+R.now.join(",")+")";if(R.elem.style){R.elem.style[R.prop]=R.now}else{R.elem[R.prop]=R.now}}function m(R){var S;for(S=0;S<R.length;S+=1){if(!z.fx.step[R[S]]){z.fx.step[R[S]]=J}}}z.fn.getLayers=function(){var R=this[0],S;if(!R||!R.getContext){S=y}else{S=z.data(R,"jCanvas-layers");if(!S){S=[];z.data(R,"jCanvas-layers",S)}}return S};z.fn.getLayer=function(R){var U=this.getLayers(),T,S;if(!U){T=y}else{if(typeof R==="string"){for(S=0;S<U.length;S+=1){if(U[S].name===R){R=S;break}}}}R=R||0;T=U[R];return T};function a(S,R,T){if(T.visible){if(T.method==="draw"){T.call(S[0],R)}else{if(z.fn[T.method]){z.fn[T.method].call(S,T)}}}}z.fn.drawLayers=function(){var X=this,S,R,W,U,V,T;for(V=0;V<X.length;V+=1){S=z(X[V]);R=j(S[0]);if(R){W=S.getLayers();R.clearRect(0,0,S[0].width,S[0].height);for(T=0;T<W.length;T+=1){U=W[T];a(S,R,U)}}}return X};z.fn.addLayer=function(T){var Y=this,S,W,R,X=G(T,new F(),G({},T)),V,U;X.layer=x;for(W=0;W<Y.length;W+=1){S=z(Y[W]);R=j(S[0]);if(R){V=S.getLayers();if(typeof X==="function"){X.method="draw"}else{if(X.method!=="drawImage"){X.width=X.width||0;X.height=X.height||0}for(U in N.events){if(N.events.hasOwnProperty(U)&&X[U]){N.events[U].call(H,S);X.event=x}}}V.push(X);a(S,R,X)}}return Y};z.fn.removeLayers=function(){var T=this,S,R;for(R=0;R<T.length;R+=1){S=z(T[R]).getLayers()||[];S.length=0}return this};z.fn.removeLayer=function(R){var W=this,V,T=typeof R,U,S;for(V=0;V<W.length;V+=1){U=z(W[V]).getLayers()||[];if(T==="string"){for(S=0;S<U.length;S+=1){if(U[S].name===R){U.splice(S,1);break}}}else{if(T==="number"){U.splice(R,1)}}}return this};z.fn.animateLayer=function(){var X=this,S,W,T=([]).slice.call(arguments,0),U;if(typeof T[0]==="object"&&!T[0].layer){T.unshift(0)}if(T[2]===A){T.splice(2,0,y);T.splice(3,0,y);T.splice(4,0,function(){})}else{if(typeof T[2]==="function"){T.splice(2,0,y);T.splice(3,0,y)}}if(T[3]===A){T[3]=y;T.splice(4,0,function(){})}else{if(typeof T[3]==="function"){T.splice(3,0,y)}}if(T[4]===A){T[4]=function(){}}function R(Y,Z){return function(){g(D,Z);Y.drawLayers();T[4].call(Y[0])}}function V(Y,Z){return function(){g(D,Z);Y.drawLayers()}}for(W=0;W<X.length;W+=1){S=z(X[W]);if(j(X[W])){if(T[0].layer){U=T[0]}else{U=S.getLayer(T[0])}if(U&&U.method!=="draw"){i(D,U);i(D,T[1]);z(U).animate(T[1],{duration:T[2],easing:(z.easing[T[3]]?T[3]:y),complete:R(S,U),step:V(S,U)})}}}return X};z.event.fix=function(R){var S;R=l.call(z.event,R);if(R.pageX!==A&&R.offsetX===A){S=z(R.target).offset();if(S){R.offsetX=R.pageX-S.left;R.offsetY=R.pageY-S.top}}return R};m(E);z.support.canvas=(d.createElement("canvas").getContext!==A);N.defaults=B;N.prefs=Q;N.extend=n;z.jCanvas=N}(jQuery,window,document,Math,Image,parseFloat,parseInt,true,false,null));