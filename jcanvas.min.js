/*
 jCanvas v5.5b
Copyright 2012, Caleb Evans
Licensed under the MIT license
*/
(function(a,Q,T,P,ca,z,F,b,v){function x(){}function B(h){h?w(R,h):R=w(x.prototype,L);return this}function C(h,c){h.fillStyle=c.fillStyle;h.strokeStyle=c.strokeStyle;h.lineWidth=c.strokeWidth;c.rounded?(h.lineCap="round",h.lineJoin="round"):(h.lineCap=c.strokeCap,h.lineJoin=c.strokeJoin,h.miterLimit=c.miterLimit);h.shadowOffsetX=c.shadowX;h.shadowOffsetY=c.shadowY;h.shadowBlur=c.shadowBlur;h.shadowColor=c.shadowColor;h.globalAlpha=c.opacity;h.globalCompositeOperation=c.compositing}function t(h){return h&&
h.getContext?h.getContext("2d"):b}function I(h,c){c.mask&&(c.autosave&&h.save(),h.clip());c.closed?(h.closePath(),h.fill(),h.stroke()):(h.fill(),h.stroke(),h.closePath())}function U(h,c){if(!c.translateX&&!c.translateY&&(c.x||c.y))c.translateX=c.x,c.translateY=c.y;c.translate&&(c.translateX=c.translateY=c.translate);h.translate(c.translateX,c.translateY)}function V(h,c){1!==c.scale&&(c.scaleX=c.scaleY=c.scale);h.translate(c.x,c.y);h.scale(c.scaleX,c.scaleY);h.translate(-c.x,-c.y)}function W(h,c){c.toRad=
c.inDegrees?A/180:1;c.rotate=c.rotate||c.angle;h.translate(c.x,c.y);h.rotate(c.rotate*c.toRad);h.translate(-c.x,-c.y)}function H(h,c,j,a,b){j.toRad=j.inDegrees?A/180:1;c.save();b=b||a;!h&&!j.fromCenter&&(j.x+=a/2,j.y+=b/2);(j.rotate||j.angle)&&W(c,j);(1!==j.scale||1!==j.scaleX||1!==j.scaleY)&&V(c,j);(j.translate||j.translateX||j.translateY)&&U(c,j)}function X(h,c,j){j&&j.visible&&(j.method===a.fn.draw?j.fn.call(h[0],c):j.method&&j.method.call(h,j))}function D(h,c,j){var M,b,s,q="function"===typeof c,
c=c||{};if(c.layer&&!c._layer){M=a(h);b=M.getLayers();q&&(c={method:a.fn.draw,fn:c,name:c.name,group:c.group,visible:c.visible});c=w(new x,c);if(!q)for(s in c.method=a.fn[c.method]||j,c.method!==a.fn.drawImage&&(c.width=c.width||0,c.height=c.height||0),B.events)B.events.hasOwnProperty(s)&&c[s]&&(a.data(h,"jCanvas-"+s)||B.events[s].call(a,M),c._event=z);c.layer=z;c._layer=z;c.index===v&&(c.index=b.length);b.splice(c.index,0,c)}}function Y(h){var c;for(c=0;c<J.length;c+=1)h[J[c]]=h["_"+J[c]]}function Z(h){var c;
for(c=0;c<J.length;c+=1)h["_"+J[c]]=h[J[c]]}function $(h){var c,j,b=[],E=1;h.match(/^#?[a-z0-9]+$/i)&&(j=Q.head,c=j.style.color,j.style.color=h,h=a.css(j,"color"),j.style.color=c);h.match(/^rgb/i)&&(b=h.match(/[0-9]+/gi),h.match(/%/gi)&&(E=2.55),b[0]*=E,b[1]*=E,b[2]*=E);return b}function da(h){var c;"object"!==typeof h.start&&(h.start=$(h.start),h.end=$(h.end));h.now=[];for(c=0;3>c;c+=1)h.now[c]=N(h.start[c]+(h.end[c]-h.start[c])*h.pos);h.now="rgb("+h.now.join(",")+")";h.elem.style?h.elem.style[h.prop]=
h.now:h.elem[h.prop]=h.now}function aa(h){var c=a.data(h,"eventCache");c||(c=a.data(h,"eventCache",{x:[],y:[]}));return c}function K(h){B.events[h]=function(c){var j="mouseover"===h||"mouseout"===h?"mousemove":h;c.bind(j+".jCanvas",function(h){var a=aa(c[0]);a.x[1]=a.x[0];a.y[1]=a.y[0];a.x[0]=h.offsetX;a.y[0]=h.offsetY;a.type=j;c.drawLayers()});a.data(c[0],"jCanvas-"+h,z)}}function G(h,c,j){var b=a.data(h,"eventCache"),E,s,q;E=j[b.type];s=c.isPointInPath(b.x[0],b.y[0]);q=c.isPointInPath(b.x[1],b.y[1]);
j.mouseX=b.x[0];j.mouseY=b.y[0];if(j.mouseover||j.mouseout)s&&!q&&!j._fired?(j._fired=z,j.mouseover&&(j.mouseover.call(h,j),C(c,j))):!s&&(q&&j._fired)&&(j._fired=F,j.mouseout&&(j.mouseout.call(h,j),C(c,j)));E&&s&&(E.call(h,j),C(c,j))}var L,R,w=a.extend,N=P.round,A=P.PI,ba=P.sin,S=P.cos,ea=a.event.fix,O={},J;a.fn.jCanvas=B;B.version="5.5b";B.events={};L={angle:0,align:"center",autosave:z,baseline:"middle",ccw:F,closed:F,compositing:"source-over",cornerRadius:0,cropFromCenter:z,each:b,end:360,fillStyle:"transparent",
font:"12pt sans-serif",fromCenter:z,height:b,inDegrees:z,load:b,mask:F,miterLimit:10,opacity:1,projection:0,r1:b,r2:b,radius:0,repeat:"repeat",rotate:0,rounded:F,scale:1,scaleX:1,scaleY:1,shadowBlur:0,shadowColor:"transparent",shadowX:0,shadowY:0,sHeight:b,sides:3,source:"",start:0,strokeCap:"butt",strokeJoin:"miter",strokeStyle:"transparent",strokeWidth:1,sWidth:b,sx:b,sy:b,text:"",translate:0,translateX:0,translateY:0,visible:z,width:b,x:0,y:0};B();B.extend=function(h){L=w(L,h.props);B();h.name&&
(a.fn[h.name]=function(c){var j,a,b=w(new x,c);for(j=0;j<this.length;j+=1)if(c=this[j],a=t(c))C(a,b),h.fn.call(c,a,b);return this});return a.fn[h.name]};a.fn.loadCanvas=function(){return t(this[0])};a.fn.draw=function c(j){var a,b;j&&!j.fn&&(j={fn:j});w(new x,j);for(a=0;a<this.length;a+=1)if(b=t(this[a]))D(this[a],j,c),j.fn.call(this[a],b);return this};a.fn.clearCanvas=function(c){for(var j,a=w(new x,c),c=0;c<this.length;c+=1)if(j=t(this[c]))H(c,j,a,a.width,a.height),!a.x&&!a.y&&!a.width&&!a.height?
j.clearRect(0,0,this[c].width,this[c].height):j.clearRect(a.x-a.width/2,a.y-a.height/2,a.width,a.height);return this};a.fn.saveCanvas=function(){var c,a;for(c=0;c<this.length;c+=1)(a=t(this[c]))&&a.save();return this};a.fn.restoreCanvas=function(){var c,a;for(c=0;c<this.length;c+=1)(a=t(this[c]))&&a.restore();return this};a.fn.translateCanvas=function(c){for(var a,b=w(new x,c),c=0;c<this.length;c+=1)if(a=t(this[c]))b.autosave&&a.save(),U(a,b);return this};a.fn.scaleCanvas=function(c){for(var a,b=
w(new x,c),c=0;c<this.length;c+=1)if(a=t(this[c]))b.autosave&&a.save(),V(a,b);return this};a.fn.rotateCanvas=function(c){for(var a,b=w(new x,c),c=0;c<this.length;c+=1)if(a=t(this[c]))b.autosave&&a.save(),W(a,b);return this};a.fn.drawRect=function j(a){var b,s,q=w(new x,a),o,m,n,r,k;for(b=0;b<this.length;b+=1)if(s=t(this[b]))D(this[b],a,j),C(s,q),H(b,s,q,q.width,q.height),s.beginPath(),o=q.x-q.width/2,m=q.y-q.height/2,(k=q.cornerRadius)?(q.closed=z,n=q.x+q.width/2,r=q.y+q.height/2,0>n-o-2*k&&(k=(n-
o)/2),0>r-m-2*k&&(k=(r-m)/2),s.moveTo(o+k,m),s.lineTo(n-k,m),s.arc(n-k,m+k,k,3*A/2,2*A,F),s.lineTo(n,r-k),s.arc(n-k,r-k,k,0,A/2,F),s.lineTo(o+k,r),s.arc(o+k,r-k,k,A/2,A,F),s.lineTo(o,m+k),s.arc(o+k,m+k,k,A,3*A/2,F)):s.rect(o,m,q.width,q.height),s.restore(),q._event&&G(this[b],s,a),I(s,q);return this};a.fn.drawArc=function M(a){var b,q,o=w(new x,a);!o.inDegrees&&360===o.end&&(o.end=2*A);for(b=0;b<this.length;b+=1)if(q=t(this[b]))D(this[b],a,M),C(q,o),H(b,q,o,2*o.radius),q.beginPath(),q.arc(o.x,o.y,
o.radius,o.start*o.toRad-A/2,o.end*o.toRad-A/2,o.ccw),q.restore(),o._event&&G(this[b],q,a),I(q,o);return this};a.fn.drawEllipse=function E(a){var b,o,m=w(new x,a),n=4*m.width/3,r=m.height;for(b=0;b<this.length;b+=1)if(o=t(this[b]))D(this[b],a,E),C(o,m),H(b,o,m,m.width,m.height),o.beginPath(),o.moveTo(m.x,m.y-r/2),o.bezierCurveTo(m.x-n/2,m.y-r/2,m.x-n/2,m.y+r/2,m.x,m.y+r/2),o.bezierCurveTo(m.x+n/2,m.y+r/2,m.x+n/2,m.y-r/2,m.x,m.y-r/2),o.restore(),m._event&&G(this[b],o,a),I(o,m);return this};a.fn.drawPolygon=
function s(a){var b,m,n=w(new x,a),r=2*A/n.sides,k=A/n.sides,e=k+A/2,g=n.radius*S(r/2),i,l,f;n.closed=z;for(b=0;b<this.length;b+=1)if(m=t(this[b])){D(this[b],a,s);C(m,n);H(b,m,n,2*n.radius);m.beginPath();for(f=0;f<n.sides;f+=1)i=n.x+N(n.radius*S(e)),l=n.y+N(n.radius*ba(e)),m.lineTo(i,l),n.projection&&(i=n.x+N((g+g*n.projection)*S(e+k)),l=n.y+N((g+g*n.projection)*ba(e+k)),m.lineTo(i,l)),e+=r;m.restore();n._event&&G(this[b],m,a);I(m,n)}return this};a.fn.drawLine=function q(a){var b,n,r=w(new x,a),k,
e,g;for(b=0;b<this.length;b+=1)if(n=t(this[b])){D(this[b],a,q);C(n,r);k=1;for(n.beginPath();z;)if(e=r["x"+k],g=r["y"+k],e!==v&&g!==v)n.lineTo(e,g),k+=1;else break;r._event&&G(this[b],n,a);I(n,r)}return this};a.fn.drawQuad=function o(a){var b,r,k=w(new x,a),e,g,i,l,f;for(b=0;b<this.length;b+=1)if(r=t(this[b])){D(this[b],a,o);C(r,k);e=2;r.beginPath();for(r.moveTo(k.x1,k.y1);z;)if(g=k["x"+e],i=k["y"+e],l=k["cx"+(e-1)],f=k["cy"+(e-1)],g!==v&&i!==v&&l!==v&&f!==v)r.quadraticCurveTo(l,f,g,i),e+=1;else break;
k._event&&G(this[b],r,a);I(r,k)}return this};a.fn.drawBezier=function m(a){var b,k,e=w(new x,a),g,i,l,f,d,p,u,y;for(b=0;b<this.length;b+=1)if(k=t(this[b])){D(this[b],a,m);C(k,e);g=2;i=1;k.beginPath();for(k.moveTo(e.x1,e.y1);z;)if(l=e["x"+g],f=e["y"+g],d=e["cx"+i],p=e["cy"+i],u=e["cx"+(i+1)],y=e["cy"+(i+1)],l!==v&&f!==v&&d!==v&&p!==v&&u!==v&&y!==v)k.bezierCurveTo(d,p,u,y,l,f),g+=1,i+=2;else break;e._event&&G(this[b],k,a);I(k,e)}return this};a.fn.drawText=function n(b){var k,e,g=w(new x,b);for(k=0;k<
this.length;k+=1)if(a(this[k]),e=t(this[k])){D(this[k],b,n);C(e,g);e.textBaseline=g.baseline;e.textAlign=g.align;e.font=g.font;var i=this[k],l=e,f=g,d=void 0,p=void 0,u=/\b(\d*\.?\d*)\w\w\b/gi;if(O.text===f.text&&O.font===f.font)f.width=O.width,f.height=O.height;else{f.width=l.measureText(f.text).width;d=i.style.fontSize;if(p=f.font.match(u))i.style.fontSize=f.font.match(u)[0];f.height=ca(a.css(i,"fontSize"));i.style.fontSize=d}H(k,e,g,g.width,g.height);e.strokeText(g.text,g.x,g.y);e.fillText(g.text,
g.x,g.y);g._event?(e.beginPath(),e.rect(g.x-g.width/2,g.y-g.height/2,g.width,g.height),e.restore(),G(this[k],e,b),e.closePath()):e.restore()}O=g;return this};a.fn.drawImage=function r(a){function e(e,f,i){return function(){f||((y=p.width/p.height,d.width===b&&d.sWidth===b&&(a.width=d.width=d.sWidth=p.width),d.height===b&&d.sHeight===b&&(a.height=d.height=d.sHeight=p.height),d.width===b&&d.sWidth!==b&&(d.width=d.sWidth),d.height===b&&d.sHeight!==b&&(d.height=d.sHeight),d.sWidth===b&&d.width!==b&&(a.sWidth=
d.sWidth=p.width),d.sHeight===b&&d.height!==b&&(a.sHeight=d.sHeight=p.height),d.sx===b&&(d.sx=d.cropFromCenter?p.width/2:0),d.sy===b&&(d.sy=d.cropFromCenter?p.height/2:0),d.cropFromCenter||(d.sx+=d.sWidth/2,d.sy+=d.sHeight/2),d.sx+d.sWidth/2>p.width&&(d.sx=p.width-d.sWidth/2),0>d.sx-d.sWidth/2&&(d.sx=d.sWidth/2),0>d.sy-d.sHeight/2&&(d.sy=d.sHeight/2),d.sy+d.sHeight/2>p.height&&(d.sy=p.height-d.sHeight/2),d.width!==b&&d.height===b)?a.height=d.height=d.width/y:d.width===b&&d.height!==b?a.width=d.width=
d.height*y:d.width===b&&d.height===b&&(a.width=d.width=p.width,a.height=d.height=p.height));i.drawImage(p,d.sx-d.sWidth/2,d.sy-d.sHeight/2,d.sWidth,d.sHeight,d.x-d.width/2,d.y-d.height/2,d.width,d.height);d._event?(i.beginPath(),i.rect(d.x-d.width/2,d.y-d.height/2,d.width,d.height),i.restore(),G(g[f],i,a),i.closePath()):i.restore();d.load&&d.load.call(e,a)}}var g=this,i,l,f,d=w(new x,a),p,u,y;u=d.source.getContext;d.source.src||u?(p=d.source,d.width=p.width,d.height=p.height):d.source&&(p=new T,p.src=
d.source);for(l=0;l<g.length;l+=1)if(i=g[l],f=t(g[l]))D(g[l],a,r),C(f,d),H(l,f,d,d.width,d.height),p&&(p.complete||u?e(i,l,f)():p.onload=e(i,l,f));return g};a.fn.pattern=function(a){function k(){f=g.createPattern(l,i.repeat);i.load&&i.load.call(e[0],f)}var e=this,g,i=w(new x,a),l,f;(g=t(e[0]))?"function"===typeof i.source?(l=Q.createElement("canvas"),l.width=i.width,l.height=i.height,a=t(l),i.source.call(l,a),k()):(a=i.source.getContext,i.source.src||a?l=i.source:(l=new T,l.src=i.source),l.complete||
a?k():l.onload=k):f=b;return f};a.fn.gradient=function(a){var k,a=w(new x,a),e=[],g,i,l,f,d,p,u;if(k=t(this[0])){k=a.r1!==b||a.r2!==b?k.createRadialGradient(a.x1,a.y1,a.r1,a.x2,a.y2,a.r2):k.createLinearGradient(a.x1,a.y1,a.x2,a.y2);for(f=1;a["c"+f]!==v;f+=1)a["s"+f]!==v?e.push(a["s"+f]):e.push(b);g=e.length;e[0]===b&&(e[0]=0);e[g-1]===b&&(e[g-1]=1);for(f=0;f<g;f+=1){if(e[f]!==b){p=1;u=0;i=e[f];for(d=f+1;d<g;d+=1)if(e[d]!==b){l=e[d];break}else p+=1;i>l&&(e[d]=e[f])}else e[f]===b&&(u+=1,e[f]=i+u*((l-
i)/p));k.addColorStop(e[f],a["c"+(f+1)])}}else k=b;return k};a.fn.setPixels=function k(a){var g,i,l,f=w(new x,a),d={},p,u,y,v;for(i=0;i<this.length;i+=1)if(g=this[i],l=t(g)){D(this[i],a,k);H(i,l,f,f.width,f.height);!f.x&&(!f.y&&!f.width&&!f.height)&&(f.width=g.width,f.height=g.height,f.x=f.width/2,f.y=f.height/2);p=l.getImageData(f.x-f.width/2,f.y-f.height/2,f.width,f.height);u=p.data;v=u.length;d=[];if(f.each!==b)for(y=0;y<v;y+=4)d.r=u[y],d.g=u[y+1],d.b=u[y+2],d.a=u[y+3],f.each.call(g,d),u[y]=d.r,
u[y+1]=d.g,u[y+2]=d.b,u[y+3]=d.a;l.putImageData(p,f.x-f.width/2,f.y-f.height/2);l.restore()}return this};a.fn.getCanvasImage=function(a,e){var g=this[0];return g&&g.toDataURL?g.toDataURL("image/"+a,e):b};a.fn.getLayers=function(){var b=this[0],e;!b||!b.getContext?e=[]:(e=a.data(b,"jCanvas-layers"),e||(e=[],a.data(b,"jCanvas-layers",e)));return e};a.fn.getLayer=function(a){var b=this.getLayers(),g;if(!a||!a.layer){if("string"===typeof a)for(g=0;g<b.length;g+=1)if(b[g].index=g,b[g].name===a){a=g;break}a=
b[a||0]}return a};a.fn.getLayerGroup=function(a){var b=this.getLayers(),g=[],i;for(i=0;i<b.length;i+=1)b[i].group===a&&g.push(b[i]);return g};a.fn.drawLayer=function(b){var e,g,i,l;for(e=0;e<this.length;e+=1)i=a(this[e]),g=t(this[e]),l=i.getLayer(b),X(i,g,l)};a.fn.drawLayers=function(){var b,e,g,i,l,f;for(e=0;e<this.length;e+=1)if(b=a(this[e]),g=t(this[e])){g.clearRect(0,0,this[e].width,this[e].height);i=b.getLayers();for(f=0;f<i.length;f+=1)l=i[f],X(b,g,l)}return this};a.fn.addLayer=function(a){var b,
g,a=a||{};for(b=0;b<this.length;b+=1)if(g=t(this[b]))a.layer=z,D(this[b],a);return this};a.fn.removeLayers=function(){var b,e;for(e=0;e<this.length;e+=1)b=a(this[e]).getLayers(),b.length=0;return this};a.fn.removeLayer=function(b){var e,g,i;for(e=0;e<this.length;e+=1){g=a(this[e]).getLayers();if("string"===typeof b)for(i=0;i<g.length;i+=1)if(g[i].name===b){b=i;break}g.splice(b,1)}return this};J=["width","height","opacity"];a.fn.animateLayer=function(){function k(a,b){return function(){Y(b);a.drawLayers();
f[4]&&f[4].call(a)}}function e(a,b){return function(d,e){Y(b);a.drawLayers();f[5]&&f[5].call(a,d,e)}}var g,i,l,f=[].slice.call(arguments,0),d;"object"===typeof f[0]&&!f[0].layer&&f.unshift(0);"object"===typeof f[2]?(f.splice(2,0,f[2].duration||b),f.splice(3,0,f[3].easing||b),f.splice(4,0,f[4].complete||b),f.splice(5,0,f[5].step||b)):(f[2]===v?(f.splice(2,0,b),f.splice(3,0,b),f.splice(4,0,b)):"function"===typeof f[2]&&(f.splice(2,0,b),f.splice(3,0,b)),f[3]===v)?(f[3]=b,f.splice(4,0,b)):"function"===
typeof f[3]&&f.splice(3,0,b);for(i=0;i<this.length;i+=1)if(g=a(this[i]),l=t(this[i]))if((l=g.getLayer(f[0]))&&l.method!==a.fn.draw)Z(l),Z(f[1]),d=aa(this[i]),d.x=[],d.y=[],a(l).animate(f[1],{duration:f[2],easing:a.easing[f[3]]?f[3]:b,complete:k(g,l),step:e(g,l)});return this};a.fn.delayLayer=function(b,e){var g,i;for(g=0;g<this.length;g+=1)i=a(this[g]).getLayer(b),a(i).delay(e);return this};a.fn.stopLayer=function(b,e){var g,i;for(g=0;g<this.length;g+=1)i=a(this[g]).getLayer(b),a(i).stop(e);return this};
(function(b){var e;for(e=0;e<b.length;e+=1)a.fx.step[b[e]]=da})("color backgroundColor borderColor borderTopColor borderRightColor borderBottomColor borderLeftColor fillStyle outlineColor strokeStyle shadowColor".split(" "));K("click");K("dblclick");K("mousedown");K("mouseup");K("mousemove");K("mouseover");K("mouseout");a.event.fix=function(b){var e,b=ea.call(a.event,b);if(b.pageX!==v&&b.offsetX===v&&(e=a(b.target).offset()))b.offsetX=b.pageX-e.left,b.offsetY=b.pageY-e.top;return b};a.support.canvas=
Q.createElement("canvas").getContext!==v;B.defaults=L;B.prefs=R;a.jCanvas=B})(jQuery,document,Image,Math,parseFloat,!0,!1,null);
