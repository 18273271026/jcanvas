/*
 jCanvas v5.5b
Copyright 2012, Caleb Evans
Licensed under the MIT license
*/
(function(f,D,G,C,Q,r,t,i,j){function p(){}function q(b){b?n(E,b):E=n(p.prototype,z);return this}function s(b,a){b.fillStyle=a.fillStyle;b.strokeStyle=a.strokeStyle;b.lineWidth=a.strokeWidth;a.rounded?(b.lineCap="round",b.lineJoin="round"):(b.lineCap=a.strokeCap,b.lineJoin=a.strokeJoin,b.miterLimit=a.miterLimit);b.shadowOffsetX=a.shadowX;b.shadowOffsetY=a.shadowY;b.shadowBlur=a.shadowBlur;b.shadowColor=a.shadowColor;b.globalAlpha=a.opacity;b.globalCompositeOperation=a.compositing}function l(b){return b&&
b.getContext?b.getContext("2d"):i}function w(b,a){a.mask&&(a.autosave&&b.save(),b.clip());a.closed?(b.closePath(),b.fill(),b.stroke()):(b.fill(),b.stroke(),b.closePath())}function H(b,a){if(!a.translateX&&!a.translateY&&(a.x||a.y))a.translateX=a.x,a.translateY=a.y;a.translate&&(a.translateX=a.translateY=a.translate);b.translate(a.translateX,a.translateY)}function I(b,a){1!==a.scale&&(a.scaleX=a.scaleY=a.scale);b.translate(a.x,a.y);b.scale(a.scaleX,a.scaleY);b.translate(-a.x,-a.y)}function J(b,a){a.toRad=
a.inDegrees?m/180:1;a.rotate=a.rotate||a.angle;b.translate(a.x,a.y);b.rotate(a.rotate*a.toRad);b.translate(-a.x,-a.y)}function v(b,a,c,d,g){c.toRad=c.inDegrees?m/180:1;a.save();g=g||d;!b&&!c.fromCenter&&(c.x+=d/2,c.y+=g/2);(c.rotate||c.angle)&&J(a,c);(1!==c.scale||1!==c.scaleX||1!==c.scaleY)&&I(a,c);(c.translate||c.translateX||c.translateY)&&H(a,c)}function K(b,a,c){c&&c.visible&&(c.method===f.fn.draw?c.fn.call(b[0],a):c.method&&c.method.call(b,c))}function L(b){var a;for(a=0;a<x.length;a+=1)b[x[a]]=
b["_"+x[a]]}function M(b){var a;for(a=0;a<x.length;a+=1)b["_"+x[a]]=b[x[a]]}function N(b){var a,c,d=[],g=1;b.match(/^#?[a-z0-9]+$/i)&&(c=D.head,a=c.style.color,c.style.color=b,b=f.css(c,"color"),c.style.color=a);b.match(/^rgb/i)&&(d=b.match(/[0-9]+/gi),b.match(/%/gi)&&(g=2.55),d[0]*=g,d[1]*=g,d[2]*=g);return d}function R(b){var a;"object"!==typeof b.start&&(b.start=N(b.start),b.end=N(b.end));b.now=[];for(a=0;3>a;a+=1)b.now[a]=A(b.start[a]+(b.end[a]-b.start[a])*b.pos);b.now="rgb("+b.now.join(",")+
")";b.elem.style?b.elem.style[b.prop]=b.now:b.elem[b.prop]=b.now}function O(b){var a=f.data(b,"eventCache");a||(a=f.data(b,"eventCache",{x:[],y:[]}));return a}function y(b){q.events[b]=function(a){var c="mouseover"===b||"mouseout"===b?"mousemove":b;a.bind(c+".jCanvas",function(b){var g=O(a[0]);g.x[1]=g.x[0];g.y[1]=g.y[0];g.x[0]=b.offsetX;g.y[0]=b.offsetY;g.type=c;a.drawLayers()});f.data(a[0],"jCanvas-"+b,r)}}function u(b,a,c){var d=f.data(b,"eventCache"),g,h,e;g=c[d.type];h=a.isPointInPath(d.x[0],
d.y[0]);e=a.isPointInPath(d.x[1],d.y[1]);c.mouseX=d.x[0];c.mouseY=d.y[0];if(c.mouseover||c.mouseout)h&&!e&&!c._fired?(c._fired=r,c.mouseover&&(c.mouseover.call(b,c),s(a,c))):!h&&(e&&c._fired)&&(c._fired=t,c.mouseout&&(c.mouseout.call(b,c),s(a,c)));g&&h&&(g.call(b,c),s(a,c))}var z,E,n=f.extend,A=C.round,m=C.PI,P=C.sin,F=C.cos,S=f.event.fix,B={},x;f.fn.jCanvas=q;q.version="5.5b";q.events={};z={angle:0,align:"center",autosave:r,baseline:"middle",ccw:t,closed:t,compositing:"source-over",cornerRadius:0,
cropFromCenter:r,each:i,end:360,fillStyle:"transparent",font:"12pt sans-serif",fromCenter:r,height:i,inDegrees:r,load:i,mask:t,miterLimit:10,opacity:1,projection:0,r1:i,r2:i,radius:0,repeat:"repeat",rotate:0,rounded:t,scale:1,scaleX:1,scaleY:1,shadowBlur:0,shadowColor:"transparent",shadowX:0,shadowY:0,sHeight:i,sides:3,source:"",start:0,strokeCap:"butt",strokeJoin:"miter",strokeStyle:"transparent",strokeWidth:1,sWidth:i,sx:i,sy:i,text:"",translate:0,translateX:0,translateY:0,visible:r,width:i,x:0,
y:0};q();q.extend=function(b){z=n(z,b.props);q();b.name&&(f.fn[b.name]=function(a){var c,d,g=n(new p,a);for(c=0;c<this.length;c+=1)if(a=this[c],d=l(a))s(d,g),b.fn.call(a,d,g);return this});return f.fn[b.name]};f.fn.loadCanvas=function(){return l(this[0])};f.fn.draw=function(b){var a,c;b&&!b.fn&&(b={fn:b});n(new p,b);for(a=0;a<this.length;a+=1)(c=l(this[a]))&&b.fn.call(this[a],c);return this};f.fn.clearCanvas=function(b){for(var a,c=n(new p,b),b=0;b<this.length;b+=1)if(a=l(this[b]))v(b,a,c,c.width,
c.height),!c.x&&!c.y&&!c.width&&!c.height?a.clearRect(0,0,this[b].width,this[b].height):a.clearRect(c.x-c.width/2,c.y-c.height/2,c.width,c.height);return this};f.fn.saveCanvas=function(){var b,a;for(b=0;b<this.length;b+=1)(a=l(this[b]))&&a.save();return this};f.fn.restoreCanvas=function(){var b,a;for(b=0;b<this.length;b+=1)(a=l(this[b]))&&a.restore();return this};f.fn.translateCanvas=function(b){for(var a,c=n(new p,b),b=0;b<this.length;b+=1)if(a=l(this[b]))c.autosave&&a.save(),H(a,c);return this};
f.fn.scaleCanvas=function(b){for(var a,c=n(new p,b),b=0;b<this.length;b+=1)if(a=l(this[b]))c.autosave&&a.save(),I(a,c);return this};f.fn.rotateCanvas=function(b){for(var a,c=n(new p,b),b=0;b<this.length;b+=1)if(a=l(this[b]))c.autosave&&a.save(),J(a,c);return this};f.fn.drawRect=function(b){var a,c,d=n(new p,b),g,h,e,k,f;for(a=0;a<this.length;a+=1)if(c=l(this[a]))s(c,d),v(a,c,d,d.width,d.height),c.beginPath(),g=d.x-d.width/2,h=d.y-d.height/2,(f=d.cornerRadius)?(d.closed=r,e=d.x+d.width/2,k=d.y+d.height/
2,0>e-g-2*f&&(f=(e-g)/2),0>k-h-2*f&&(f=(k-h)/2),c.moveTo(g+f,h),c.lineTo(e-f,h),c.arc(e-f,h+f,f,3*m/2,2*m,t),c.lineTo(e,k-f),c.arc(e-f,k-f,f,0,m/2,t),c.lineTo(g+f,k),c.arc(g+f,k-f,f,m/2,m,t),c.lineTo(g,h+f),c.arc(g+f,h+f,f,m,3*m/2,t)):c.rect(g,h,d.width,d.height),c.restore(),d._event&&u(this[a],c,b),w(c,d);return this};f.fn.drawArc=function(b){var a,c,d=n(new p,b);!d.inDegrees&&360===d.end&&(d.end=2*m);for(a=0;a<this.length;a+=1)if(c=l(this[a]))s(c,d),v(a,c,d,2*d.radius),c.beginPath(),c.arc(d.x,d.y,
d.radius,d.start*d.toRad-m/2,d.end*d.toRad-m/2,d.ccw),c.restore(),d._event&&u(this[a],c,b),w(c,d);return this};f.fn.drawEllipse=function(b){var a,c,d=n(new p,b),g=4*d.width/3,h=d.height;for(a=0;a<this.length;a+=1)if(c=l(this[a]))s(c,d),v(a,c,d,d.width,d.height),c.beginPath(),c.moveTo(d.x,d.y-h/2),c.bezierCurveTo(d.x-g/2,d.y-h/2,d.x-g/2,d.y+h/2,d.x,d.y+h/2),c.bezierCurveTo(d.x+g/2,d.y+h/2,d.x+g/2,d.y-h/2,d.x,d.y-h/2),c.restore(),d._event&&u(this[a],c,b),w(c,d);return this};f.fn.drawPolygon=function(b){var a,
c,d=n(new p,b),g=2*m/d.sides,h=m/d.sides,e=h+m/2,f=d.radius*F(g/2),i,o,j;d.closed=r;for(a=0;a<this.length;a+=1)if(c=l(this[a])){s(c,d);v(a,c,d,2*d.radius);c.beginPath();for(j=0;j<d.sides;j+=1)i=d.x+A(d.radius*F(e)),o=d.y+A(d.radius*P(e)),c.lineTo(i,o),d.projection&&(i=d.x+A((f+f*d.projection)*F(e+h)),o=d.y+A((f+f*d.projection)*P(e+h)),c.lineTo(i,o)),e+=g;c.restore();d._event&&u(this[a],c,b);w(c,d)}return this};f.fn.drawLine=function(b){var a,c,d=n(new p,b),g,h,e;for(a=0;a<this.length;a+=1)if(c=l(this[a])){s(c,
d);g=1;for(c.beginPath();r;)if(h=d["x"+g],e=d["y"+g],h!==j&&e!==j)c.lineTo(h,e),g+=1;else break;d._event&&u(this[a],c,b);w(c,d)}return this};f.fn.drawQuad=function(b){var a,c,d=n(new p,b),g,h,e,f,i;for(a=0;a<this.length;a+=1)if(c=l(this[a])){s(c,d);g=2;c.beginPath();for(c.moveTo(d.x1,d.y1);r;)if(h=d["x"+g],e=d["y"+g],f=d["cx"+(g-1)],i=d["cy"+(g-1)],h!==j&&e!==j&&f!==j&&i!==j)c.quadraticCurveTo(f,i,h,e),g+=1;else break;d._event&&u(this[a],c,b);w(c,d)}return this};f.fn.drawBezier=function(b){var a,
c,d=n(new p,b),g,h,e,f,i,o,m,q;for(a=0;a<this.length;a+=1)if(c=l(this[a])){s(c,d);g=2;h=1;c.beginPath();for(c.moveTo(d.x1,d.y1);r;)if(e=d["x"+g],f=d["y"+g],i=d["cx"+h],o=d["cy"+h],m=d["cx"+(h+1)],q=d["cy"+(h+1)],e!==j&&f!==j&&i!==j&&o!==j&&m!==j&&q!==j)c.bezierCurveTo(i,o,m,q,e,f),g+=1,h+=2;else break;d._event&&u(this[a],c,b);w(c,d)}return this};f.fn.drawText=function(b){var a,c,d=n(new p,b);for(a=0;a<this.length;a+=1)if(f(this[a]),c=l(this[a])){s(c,d);c.textBaseline=d.baseline;c.textAlign=d.align;
c.font=d.font;var g=this[a],h=c,e=d,i=void 0,j=void 0,o=/\b(\d*\.?\d*)\w\w\b/gi;if(B.text===e.text&&B.font===e.font)e.width=B.width,e.height=B.height;else{e.width=h.measureText(e.text).width;i=g.style.fontSize;if(j=e.font.match(o))g.style.fontSize=e.font.match(o)[0];e.height=Q(f.css(g,"fontSize"));g.style.fontSize=i}v(a,c,d,d.width,d.height);c.strokeText(d.text,d.x,d.y);c.fillText(d.text,d.x,d.y);d._event?(c.beginPath(),c.rect(d.x-d.width/2,d.y-d.height/2,d.width,d.height),c.restore(),u(this[a],c,
b),c.closePath()):c.restore()}B=d;return this};f.fn.drawImage=function(b){function a(a,d,g){return function(){d||((o=f.width/f.height,e.width===i&&e.sWidth===i&&(b.width=e.width=e.sWidth=f.width),e.height===i&&e.sHeight===i&&(b.height=e.height=e.sHeight=f.height),e.width===i&&e.sWidth!==i&&(e.width=e.sWidth),e.height===i&&e.sHeight!==i&&(e.height=e.sHeight),e.sWidth===i&&e.width!==i&&(b.sWidth=e.sWidth=f.width),e.sHeight===i&&e.height!==i&&(b.sHeight=e.sHeight=f.height),e.sx===i&&(e.sx=e.cropFromCenter?
f.width/2:0),e.sy===i&&(e.sy=e.cropFromCenter?f.height/2:0),e.cropFromCenter||(e.sx+=e.sWidth/2,e.sy+=e.sHeight/2),e.sx+e.sWidth/2>f.width&&(e.sx=f.width-e.sWidth/2),0>e.sx-e.sWidth/2&&(e.sx=e.sWidth/2),0>e.sy-e.sHeight/2&&(e.sy=e.sHeight/2),e.sy+e.sHeight/2>f.height&&(e.sy=f.height-e.sHeight/2),e.width!==i&&e.height===i)?b.height=e.height=e.width/o:e.width===i&&e.height!==i?b.width=e.width=e.height*o:e.width===i&&e.height===i&&(b.width=e.width=f.width,b.height=e.height=f.height));g.drawImage(f,e.sx-
e.sWidth/2,e.sy-e.sHeight/2,e.sWidth,e.sHeight,e.x-e.width/2,e.y-e.height/2,e.width,e.height);e._event?(g.beginPath(),g.rect(e.x-e.width/2,e.y-e.height/2,e.width,e.height),g.restore(),u(c[d],g,b),g.closePath()):g.restore();e.load&&e.load.call(a,b)}}var c=this,d,g,h,e=n(new p,b),f,j,o;j=e.source.getContext;e.source.src||j?(f=e.source,e.width=f.width,e.height=f.height):e.source&&(f=new G,f.src=e.source);for(g=0;g<c.length;g+=1)if(d=c[g],h=l(c[g]))s(h,e),v(g,h,e,e.width,e.height),f&&(f.complete||j?a(d,
g,h)():f.onload=a(d,g,h));return c};f.fn.pattern=function(b){function a(){e=d.createPattern(f,g.repeat);g.load&&g.load.call(c[0],e)}var c=this,d,g=n(new p,b),f,e;(d=l(c[0]))?"function"===typeof g.source?(f=D.createElement("canvas"),f.width=g.width,f.height=g.height,b=l(f),g.source.call(f,b),a()):(b=g.source.getContext,g.source.src||b?f=g.source:(f=new G,f.src=g.source),f.complete||b?a():f.onload=a):e=i;return e};f.fn.gradient=function(b){var a,b=n(new p,b),c=[],d,f,h,e,k,m,o;if(a=l(this[0])){a=b.r1!==
i||b.r2!==i?a.createRadialGradient(b.x1,b.y1,b.r1,b.x2,b.y2,b.r2):a.createLinearGradient(b.x1,b.y1,b.x2,b.y2);for(e=1;b["c"+e]!==j;e+=1)b["s"+e]!==j?c.push(b["s"+e]):c.push(i);d=c.length;c[0]===i&&(c[0]=0);c[d-1]===i&&(c[d-1]=1);for(e=0;e<d;e+=1){if(c[e]!==i){m=1;o=0;f=c[e];for(k=e+1;k<d;k+=1)if(c[k]!==i){h=c[k];break}else m+=1;f>h&&(c[k]=c[e])}else c[e]===i&&(o+=1,c[e]=f+o*((h-f)/m));a.addColorStop(c[e],b["c"+(e+1)])}}else a=i;return a};f.fn.setPixels=function(b){var a,c,d=n(new p,b),f={},h,e,k,
j;for(a=0;a<this.length;a+=1)if(b=this[a],c=l(b)){v(a,c,d,d.width,d.height);!d.x&&(!d.y&&!d.width&&!d.height)&&(d.width=b.width,d.height=b.height,d.x=d.width/2,d.y=d.height/2);h=c.getImageData(d.x-d.width/2,d.y-d.height/2,d.width,d.height);e=h.data;j=e.length;f=[];if(d.each!==i)for(k=0;k<j;k+=4)f.r=e[k],f.g=e[k+1],f.b=e[k+2],f.a=e[k+3],d.each.call(b,f),e[k]=f.r,e[k+1]=f.g,e[k+2]=f.b,e[k+3]=f.a;c.putImageData(h,d.x-d.width/2,d.y-d.height/2);c.restore()}return this};f.fn.getCanvasImage=function(b,a){var c=
this[0];return c&&c.toDataURL?c.toDataURL("image/"+b,a):i};f.fn.getLayers=function(){var b=this[0],a;!b||!b.getContext?a=[]:(a=f.data(b,"jCanvas-layers"),a||(a=[],f.data(b,"jCanvas-layers",a)));return a};f.fn.getLayer=function(b){var a=this.getLayers(),c;if(!b||!b.layer){if("string"===typeof b)for(c=0;c<a.length;c+=1)if(a[c].index=c,a[c].name===b){b=c;break}b=a[b||0]}return b};f.fn.getLayerGroup=function(b){var a=this.getLayers(),c=[],d;for(d=0;d<a.length;d+=1)a[d].group===b&&c.push(a[d]);return c};
f.fn.drawLayer=function(b){var a,c,d,g;for(a=0;a<this.length;a+=1)d=f(this[a]),c=l(this[a]),g=d.getLayer(b),K(d,c,g)};f.fn.drawLayers=function(){var b,a,c,d,g,h;for(a=0;a<this.length;a+=1)if(b=f(this[a]),c=l(this[a])){c.clearRect(0,0,this[a].width,this[a].height);d=b.getLayers();for(h=0;h<d.length;h+=1)g=d[h],K(b,c,g)}return this};f.fn.addLayer=function(b){var a,c,b=b||{};for(a=0;a<this.length;a+=1)if(c=l(this[a]))b.layer=r;return this};f.fn.removeLayers=function(){var b,a;for(a=0;a<this.length;a+=
1)b=f(this[a]).getLayers(),b.length=0;return this};f.fn.removeLayer=function(b){var a,c,d;for(a=0;a<this.length;a+=1){c=f(this[a]).getLayers();if("string"===typeof b)for(d=0;d<c.length;d+=1)if(c[d].name===b){b=d;break}c.splice(b,1)}return this};x=["width","height","opacity"];f.fn.animateLayer=function(){function b(a,b){return function(){L(b);a.drawLayers();h[4]&&h[4].call(a)}}function a(a,b){return function(c,d){L(b);a.drawLayers();h[5]&&h[5].call(a,c,d)}}var c,d,g,h=[].slice.call(arguments,0),e;
"object"===typeof h[0]&&!h[0].layer&&h.unshift(0);"object"===typeof h[2]?(h.splice(2,0,h[2].duration||i),h.splice(3,0,h[3].easing||i),h.splice(4,0,h[4].complete||i),h.splice(5,0,h[5].step||i)):(h[2]===j?(h.splice(2,0,i),h.splice(3,0,i),h.splice(4,0,i)):"function"===typeof h[2]&&(h.splice(2,0,i),h.splice(3,0,i)),h[3]===j)?(h[3]=i,h.splice(4,0,i)):"function"===typeof h[3]&&h.splice(3,0,i);for(d=0;d<this.length;d+=1)if(c=f(this[d]),g=l(this[d]))if((g=c.getLayer(h[0]))&&g.method!==f.fn.draw)M(g),M(h[1]),
e=O(this[d]),e.x=[],e.y=[],f(g).animate(h[1],{duration:h[2],easing:f.easing[h[3]]?h[3]:i,complete:b(c,g),step:a(c,g)});return this};f.fn.delayLayer=function(b,a){var c,d;for(c=0;c<this.length;c+=1)d=f(this[c]).getLayer(b),f(d).delay(a);return this};f.fn.stopLayer=function(b,a){var c,d;for(c=0;c<this.length;c+=1)d=f(this[c]).getLayer(b),f(d).stop(a);return this};(function(b){var a;for(a=0;a<b.length;a+=1)f.fx.step[b[a]]=R})("color backgroundColor borderColor borderTopColor borderRightColor borderBottomColor borderLeftColor fillStyle outlineColor strokeStyle shadowColor".split(" "));
y("click");y("dblclick");y("mousedown");y("mouseup");y("mousemove");y("mouseover");y("mouseout");f.event.fix=function(b){var a,b=S.call(f.event,b);if(b.pageX!==j&&b.offsetX===j&&(a=f(b.target).offset()))b.offsetX=b.pageX-a.left,b.offsetY=b.pageY-a.top;return b};f.support.canvas=D.createElement("canvas").getContext!==j;q.defaults=z;q.prefs=E;f.jCanvas=q})(jQuery,document,Image,Math,parseFloat,!0,!1,null);
