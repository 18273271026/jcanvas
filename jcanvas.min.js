/*
jCanvas v4.0b
Copyright 2011, Caleb Evans

Licensed under the MIT license
http://calebevans.me/projects/jcanvas/license.html
*/
(function(d,l,i,q,f){var j,c,g,h=d.fn,p=d.extend,k=d.event.fix;function m(s,t){if(!s){c=p({},j)}else{if(t){j=p({},j,s);c=p({},j)}else{c=p({},c,s)}}return this}j={width:0,height:0,cornerRadius:0,fillStyle:"transparent",strokeStyle:"transparent",strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",rounded:false,shadowX:0,shadowY:0,shadowBlur:3,shadowColor:"transparent",opacity:1,compositing:"source-over",mask:false,x:0,y:0,x1:0,y1:0,x2:0,y2:0,radius:0,start:0,end:360,ccw:false,inDegrees:true,fromCenter:true,closed:false,sides:3,points:5,angle:0,text:"",font:"normal 12pt sans-serif",align:"center",baseline:"middle",source:"",repeat:"repeat"};c=p({},j);m.retro=false;function o(s,t){s.fillStyle=t.fillStyle;s.strokeStyle=t.strokeStyle;s.lineWidth=t.strokeWidth;s.lineCap=t.strokeCap;s.lineJoin=t.strokeJoin;if(t.rounded){s.lineCap="round";s.lineJoin="round"}s.shadowOffsetX=t.shadowX;s.shadowOffsetY=t.shadowY;s.shadowBlur=t.shadowBlur;s.shadowColor=t.shadowColor;s.globalAlpha=t.opacity;s.globalCompositeOperation=t.compositing;if(m.retro){s.fillStyle=t.fillColor;s.strokeStyle=t.strokeColor;s.globalAlpha=t.opacity}}function b(s,t){if(t.mask){s.save();s.clip()}if(t.closed){s.closePath();s.fill();s.stroke()}else{s.fill();s.stroke();s.closePath()}}function a(s){if(s.inDegrees){return i.PI/180}else{return 1}}function n(t,v,u,s){if(!v.fromCenter){v.x+=u/2;v.y+=s/2}v.toRad=v.inDegrees?i.PI/180:1;t.save();t.translate(v.x,v.y);t.rotate(v.angle*v.toRad);t.translate(-v.x,-v.y)}h.jCanvas=m;h.loadCanvas=function(s){return this[0].getContext(s||"2d")};h.draw=function(u){var s,t;for(t=0;t<this.length;t+=1){s=this[t].getContext("2d");u.call(this[t],s)}};h.gradient=function(t){var s=this.loadCanvas(),y=p({},c,t),x,w,v=0,u=1;if(y.r1!==f&&y.r2!==f){x=s.createRadialGradient(y.x1,y.y1,y.r1,y.x2,y.y2,y.r2)}else{x=s.createLinearGradient(y.x1,y.y1,y.x2,y.y2)}while(y["c"+u]!==f){v+=1;u+=1}for(u=1;u<=v;u+=1){w=i.round((100/(v-1))*(u-1))/100;if(y["s"+u]===f){y["s"+u]=w}x.addColorStop(y["s"+u],y["c"+u])}return x};h.pattern=function(u){var s=this.loadCanvas(),y=p({},c,u),t=new q(),w;t.src=y.source;function v(){if(t.complete){w=s.createPattern(t,y.repeat);return true}else{return false}}function x(){v();if(y.load){y.load.call(this[0],w)}}if(y.load){t.onload=x}else{if(!v()){t.onload=x}}return w};h.clearCanvas=function(t){var s,u,v=p({},c,t);for(u=0;u<this.length;u+=1){s=this[u].getContext("2d");n(s,v,v.width,v.height);if(!t){s.clearRect(0,0,this[u].width,this[u].height)}else{s.clearRect(v.x-v.width/2,v.y-v.height/2,v.width,v.height)}}return this};h.saveCanvas=function(){var s,t;for(t=0;t<this.length;t+=1){s=this[t].getContext("2d");s.save()}return this};h.restoreCanvas=function(){var s,t;for(t=0;t<this.length;t+=1){s=this[t].getContext("2d");s.restore()}return this};h.scaleCanvas=function(t){var s,u,v=p({},c,t);for(u=0;u<this.length;u+=1){s=this[u].getContext("2d");s.save();s.translate(v.x,v.y);s.scale(v.width,v.height);s.translate(-v.x,-v.y)}return this};h.translateCanvas=function(t){var s,u,v=p({},c,t);for(u=0;u<this.length;u+=1){s=this[u].getContext("2d");s.save();s.translate(v.x,v.y)}return this};h.rotateCanvas=function(t){var s,u,v=p({},c,t);v.toRad=a(v);for(u=0;u<this.length;u+=1){s=this[u].getContext("2d");s.save();s.translate(v.x,v.y);s.rotate(v.angle*v.toRad);s.translate(-v.x,-v.y)}return this};h.drawRect=function(x){var A,w,v=p({},c,x),u,z,t,y,s;for(w=0;w<this.length;w+=1){A=this[w].getContext("2d");o(A,v);n(A,v,v.width,v.height);if(v.cornerRadius>0){u=v.x-v.width/2;z=v.y-v.height/2;t=v.x+v.width/2;y=v.y+v.height/2;s=v.cornerRadius;if((t-u)-(2*s)<0){s=(t-u)/2}if((y-z)-(2*s)<0){s=(y-z)/2}A.beginPath();A.moveTo(u+s,z);A.lineTo(t-s,z);A.arc(t-s,z+s,s,3*i.PI/2,i.PI*2,false);A.lineTo(t,y-s);A.arc(t-s,y-s,s,0,i.PI/2,false);A.lineTo(u+s,y);A.arc(u+s,y-s,s,i.PI/2,i.PI,false);A.lineTo(u,z+s);A.arc(u+s,z+s,s,i.PI,3*i.PI/2,false);A.fill();A.stroke();A.closePath()}else{A.beginPath();A.rect(v.x-v.width/2,v.y-v.height/2,v.width,v.height);A.restore();b(A,v)}}return this};h.drawArc=function(t){var s,u,v=p({},c,t);if(!v.inDegrees&&v.end===360){v.end=i.PI*2}for(u=0;u<this.length;u+=1){s=this[u].getContext("2d");o(s,v);n(s,v,v.radius,v.radius);s.beginPath();s.arc(v.x,v.y,v.radius,(v.start*v.toRad)-(i.PI/2),(v.end*v.toRad)-(i.PI/2),v.ccw);s.restore();b(s,v)}return this};h.drawEllipse=function(t){var s,v,w=p({},c,t),u=w.width*(4/3);for(v=0;v<this.length;v+=1){s=this[v].getContext("2d");o(s,w);n(s,w,w.width,w.height);s.beginPath();s.moveTo(w.x,w.y-w.height/2);s.bezierCurveTo(w.x-u/2,w.y-w.height/2,w.x-u/2,w.y+w.height/2,w.x,w.y+w.height/2);s.bezierCurveTo(w.x+u/2,w.y+w.height/2,w.x+u/2,w.y-w.height/2,w.x,w.y-w.height/2);s.restore();b(s,w)}return this};h.drawLine=function(u){var t,x,y=p({},c,u),s=2,w=0,v=0;for(x=0;x<this.length;x+=1){t=this[x].getContext("2d");o(t,y);t.beginPath();t.moveTo(y.x1,y.y1);while(1){w=y["x"+s];v=y["y"+s];if(w!==f&&v!==f){t.lineTo(w,v)}else{break}s+=1}b(t,y)}return this};h.drawQuad=function(x){var A,w,v=p({},c,x),u=2,t=0,s=0,z=0,y=0;for(w=0;w<this.length;w+=1){A=this[w].getContext("2d");o(A,v);A.beginPath();A.moveTo(v.x1,v.y1);while(1){t=v["x"+u];s=v["y"+u];z=v["cx"+(u-1)];y=v["cy"+(u-1)];if(t!==f&&s!==f&&z!==f&&y!==f){A.quadraticCurveTo(z,y,t,s)}else{break}u+=1}b(A,v)}return this};h.drawBezier=function(C){var D,B,y=p({},c,C),x=2,u=1,w=0,v=0,A=0,t=0,z=0,s=0;for(B=0;B<this.length;B+=1){D=this[B].getContext("2d");o(D,y);D.beginPath();D.moveTo(y.x1,y.y1);while(1){w=y["x"+x];v=y["y"+x];A=y["cx"+u];t=y["cy"+u];z=y["cx"+(u+1)];s=y["cy"+(u+1)];if(w!==f&&v!==f&&A!==f&&t!==f&&z!==f&&s!==f){D.bezierCurveTo(A,t,z,s,w,v)}else{break}x+=1;u+=2}b(D,y)}return this};h.drawText=function(t){var s,u,v=p({},c,t);for(u=0;u<this.length;u+=1){s=this[u].getContext("2d");o(s,v);s.textBaseline=v.baseline;s.textAlign=v.align;s.font=v.font;s.strokeText(v.text,v.x,v.y);s.fillText(v.text,v.x,v.y);s.restore()}return this};h.drawImage=function(y){var A,t,x,v=p({},c,y),w=new q(),s;w.src=v.source;function z(B){if(w.complete){s=w.width/w.height;if(v.width&&v.height){w.width=v.width;w.height=v.height}else{if(v.width&&!v.height){w.width=v.width;w.height=w.width/s}else{if(!v.width&&v.height){w.height=v.height;w.width=w.height*s}}}n(B,v,w.width,w.height);B.drawImage(w,v.x-w.width/2,v.y-w.height/2,w.width,w.height);B.restore();return true}else{return false}}function u(){z(A);if(v.load){v.load.call(t)}}for(x=0;x<this.length;x+=1){t=this[x];A=t.getContext("2d");o(A,v);if(v.load){w.onload=u}else{if(!z(A)){w.onload=u}}}return this};h.drawImage=function(y){var A,t,x,v=p({},c,y),w=new q(),s;w.src=v.source;function z(B){if(w.complete){s=w.width/w.height;if(v.sx===f){v.sx=w.width/2}if(v.sy===f){v.sy=w.height/2}v.sWidth=v.sWidth||w.width;v.sHeight=v.sHeight||w.height;if(v.width&&v.height){w.width=v.width;w.height=v.height}else{if(v.width&&!v.height){w.width=v.width;w.height=w.width/s}else{if(!v.width&&v.height){w.height=v.height;w.width=w.height*s}}}n(B,v,w.width,w.height);B.drawImage(w,v.sx-v.sWidth/2,v.sy-v.sHeight/2,v.sWidth,v.sHeight,v.x-w.width/2,v.y-w.height/2,w.width,w.height);B.restore();return true}else{return false}}function u(){z(A);if(v.load){v.load.call(t)}}for(x=0;x<this.length;x+=1){t=this[x];A=t.getContext("2d");o(A,v);if(v.load){w.onload=u}else{if(!z(A)){w.onload=u}}}return this};h.drawPolygon=function(y){var C,x,v=p({},c,y),D=i.PI/v.sides,u=(i.PI/2)+D,B=(i.PI*2)/v.sides,t,A,s,z,w;v.apothem=i.cos(B/2)*v.radius;v.closed=true;if(v.sides>=3){for(x=0;x<this.length;x+=1){C=this[x].getContext("2d");o(C,v);n(C,v,v.radius,v.radius);C.beginPath();for(w=0;w<v.sides;w+=1){t=i.round(v.x+(v.radius*i.cos(u)));A=i.round(v.y+(v.radius*i.sin(u)));s=i.round(v.y+((v.apothem+v.apothem*v.projection)*i.cos(u+D)));z=i.round(v.y+((v.apothem+v.apothem*v.projection)*i.sin(u+D)));if(w===0){C.moveTo(t,A)}else{C.lineTo(t,A)}if(v.projection!==f){C.lineTo(s,z)}u+=B}C.restore();b(C,v)}}return this};h.setPixels=function(z){var B,t,y,w,u=p({},c,z),s,v,x,A;for(y=0;y<this.length;y+=1){t=this[y];B=t.getContext("2d");if(!u.x&&!u.y&&!u.width&&!u.height){u.width=t.width;u.height=t.height;u.x=u.width/2;u.y=u.height/2}n(B,u,u.width,u.height);s=B.getImageData(u.x-u.width/2,u.y-u.height/2,u.width,u.height);v=s.data;x=v.length;A=[];if(u.each!==f){for(w=0;w<x;w+=4){A=u.each.call(t,v[w],v[w+1],v[w+2],v[w+3]);v[w]=A[0];v[w+1]=A[1];v[w+2]=A[2];v[w+3]=A[3]}}B.putImageData(s,u.x-u.width/2,u.y-u.height/2);B.restore()}return this};g=[];function r(s){var t=p({},c,s);g.push(t);return t}h.drawLayers=function(s){var t,u=g.length,x,w,v;for(w=0;w<this.length;w+=1){t=this[w].getContext("2d");if(s){t.clearRect(0,0,this[w].width,this[w].height)}for(v=0;v<u;v+=1){x=g[v];if(x.fn){h[x.fn].call(this.eq(w),x)}}}return this};d.event.fix=function(s){s=k.call(d.event,s);if(s.layerX===f&&s.layerY===f){s.layerX=s.offsetX;s.layerY=s.offsetY}return s};function e(){m.retro=true;h.drawQuadCurve=h.drawQuad;h.drawBezierCurve=h.drawBezier;h.canvasDefaults=m;h.canvas=m;queue=g;create=r;h.drawQueue=h.drawLayers;return d}m.defaults=j;m.prefs=c;m.setGlobals=o;m.checkUnits=a;m.rotate=n;m.layers=g;m.addLayer=r;m.retrofit=e;return(d.jCanvas=m)}(jQuery,document,Math,Image));