/*!
jCanvas v4.1b
Copyright 2011, Caleb Evans
Licensed under the MIT license
*/
(function(f,m,k,r,h){var l,e,i,j=f.fn,g=f.extend,s=k.PI,t=k.round,a=k.sin,b=k.cos;function p(v){if(!v){e=g({},l)}else{e=g({},e,v)}return this}l={width:0,height:0,cornerRadius:0,fillStyle:"transparent",strokeStyle:"transparent",strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",rounded:false,shadowX:0,shadowY:0,shadowBlur:3,shadowColor:"transparent",opacity:1,compositing:"source-over",mask:false,x:0,y:0,x1:0,y1:0,radius:0,start:0,end:360,ccw:false,inDegrees:true,fromCenter:true,closed:false,sides:3,angle:0,text:"",font:"normal 12pt sans-serif",align:"center",baseline:"middle",source:"",repeat:"repeat"};e=g({},l);function o(v,w){v.fillStyle=w.fillStyle;v.strokeStyle=w.strokeStyle;v.lineWidth=w.strokeWidth;if(w.rounded){v.lineCap="round";v.lineJoin="round"}else{v.lineCap=w.strokeCap;v.lineJoin=w.strokeJoin}v.shadowOffsetX=w.shadowX;v.shadowOffsetY=w.shadowY;v.shadowBlur=w.shadowBlur;v.shadowColor=w.shadowColor;v.globalAlpha=w.opacity;v.globalCompositeOperation=w.compositing}function d(v,w){if(w.mask){v.save();v.clip()}if(w.closed){v.closePath();v.fill();v.stroke()}else{v.fill();v.stroke();v.closePath()}}function c(v){return v.inDegrees?s/180:1}function n(w,y,x,v){y.toRad=c(y);w.save();if(!y.fromCenter){y.x+=x/2;y.y+=v/2}if(y.angle){w.translate(y.x,y.y);w.rotate(y.angle*y.toRad);w.translate(-y.x,-y.y)}}function q(v){l=g(l,v.props||{});e=g({},l);f.fn[v.name]=function(x){var A=this,w,y,z=g({},e,x);for(y=0;y<A.length;y+=1){if(!this[y].getContext){continue}w=A[y].getContext("2d");o(w,z);z.toRad=c(z);v.fn.call(A[y],w,z)}return this};return f.fn[v.name]}j.jCanvas=p;j.loadCanvas=function(v){if(!this[0].getContext){return null}return this[0].getContext(v||"2d")};j.getCanvasData=function(v){if(!this[0].getContext){return null}if(v===h){v="image/png"}return this[0].toDataURL(v)};j.draw=function(x){var w=this,v;for(v=0;v<w.length;v+=1){if(!w[v].getContext){continue}x.call(w[v],w[v].getContext("2d"))}return this};j.gradient=function(w){if(!this[0].getContext){return null}var v=this[0].getContext("2d"),B=g({},e,w),A,z,y=0,x=1;if(B.r1!==h||B.r2!==h){A=v.createRadialGradient(B.x1,B.y1,B.r1,B.x2,B.y2,B.r2)}else{A=v.createLinearGradient(B.x1,B.y1,B.x2,B.y2)}while(B["c"+x]!==h){y+=1;x+=1}for(x=1;x<=y;x+=1){z=t(100/(y-1)*(x-1))/100;if(B["s"+x]===h){B["s"+x]=z}A.addColorStop(B["s"+x],B["c"+x])}return A};j.pattern=function(x){if(!this[0].getContext){return null}var v=this[0].getContext("2d"),B=g({},e,x),w=new r(),z;w.src=B.source;function y(){if(w.complete){z=v.createPattern(w,B.repeat);return true}else{return false}}function A(){y();if(B.load){B.load.call(this[0],z)}}if(B.load){w.onload=A}else{if(!y()){w.onload=A}}return z};j.clearCanvas=function(w){var v,x,y=g({},e,w);for(x=0;x<this.length;x+=1){if(!this[x].getContext){continue}v=this[x].getContext("2d");n(v,y,y.width,y.height);if(!w){v.clearRect(0,0,this[x].width,this[x].height)}else{v.clearRect(y.x-y.width/2,y.y-y.height/2,y.width,y.height)}}return this};j.saveCanvas=function(){var v;for(v=0;v<this.length;v+=1){if(!this[v].getContext){continue}this[v].getContext("2d").save()}return this};j.restoreCanvas=function(){var v;for(v=0;v<this.length;v+=1){if(!this[v].getContext){continue}this[v].getContext("2d").restore()}return this};j.scaleCanvas=function(w){var v,x,y=g({},e,w);for(x=0;x<this.length;x+=1){if(!this[x].getContext){continue}v=this[x].getContext("2d");v.save();v.translate(y.x,y.y);v.scale(y.width,y.height);v.translate(-y.x,-y.y)}return this};j.translateCanvas=function(w){var v,x,y=g({},e,w);for(x=0;x<this.length;x+=1){if(!this[x].getContext){continue}v=this[x].getContext("2d");v.save();v.translate(y.x,y.y)}return this};j.rotateCanvas=function(w){var v,x,y=g({},e,w);for(x=0;x<this.length;x+=1){if(!this[x].getContext){continue}v=this[x].getContext("2d");n(v,y,0,0)}return this};j.drawRect=function(A){var D,z,y=g({},e,A),x,C,w,B,v;for(z=0;z<this.length;z+=1){if(!this[z].getContext){continue}D=this[z].getContext("2d");o(D,y);n(D,y,y.width,y.height);D.beginPath();if(y.cornerRadius){x=y.x-y.width/2;C=y.y-y.height/2;w=y.x+y.width/2;B=y.y+y.height/2;v=y.cornerRadius;if((w-x)-(2*v)<0){v=(w-x)/2}if((B-C)-(2*v)<0){v=(B-C)/2}D.moveTo(x+v,C);D.lineTo(w-v,C);D.arc(w-v,C+v,v,3*s/2,s*2);D.lineTo(w,B-v);D.arc(w-v,B-v,v,0,s/2);D.lineTo(x+v,B);D.arc(x+v,B-v,v,s/2,s);D.lineTo(x,C+v);D.arc(x+v,C+v,v,s,3*s/2)}else{D.rect(y.x-y.width/2,y.y-y.height/2,y.width,y.height)}D.restore();d(D,y)}return this};j.drawArc=function(w){var v,x,y=g({},e,w);if(!y.inDegrees&&y.end===360){y.end=s*2}for(x=0;x<this.length;x+=1){if(!this[x].getContext){continue}v=this[x].getContext("2d");o(v,y);n(v,y,y.radius*2,y.radius*2);v.beginPath();v.arc(y.x,y.y,y.radius,(y.start*y.toRad)-(s/2),(y.end*y.toRad)-(s/2),y.ccw);v.restore();d(v,y)}return this};j.drawEllipse=function(w){var v,y,z=g({},e,w),x=z.width*4/3;for(y=0;y<this.length;y+=1){if(!this[y].getContext){continue}v=this[y].getContext("2d");o(v,z);n(v,z,z.width,z.height);v.beginPath();v.moveTo(z.x,z.y-z.height/2);v.bezierCurveTo(z.x-x/2,z.y-z.height/2,z.x-x/2,z.y+z.height/2,z.x,z.y+z.height/2);v.bezierCurveTo(z.x+x/2,z.y+z.height/2,z.x+x/2,z.y-z.height/2,z.x,z.y-z.height/2);v.restore();d(v,z)}return this};j.drawLine=function(x){var w,A,B=g({},e,x),v=2,z=0,y=0;for(A=0;A<this.length;A+=1){if(!this[A].getContext){continue}w=this[A].getContext("2d");o(w,B);w.beginPath();w.moveTo(B.x1,B.y1);while(z!==h&&y!==h){z=B["x"+v];y=B["y"+v];w.lineTo(z,y);v+=1}d(w,B)}return this};j.drawQuad=function(A){var D,z,y=g({},e,A),x=2,w=0,v=0,C=0,B=0;for(z=0;z<this.length;z+=1){if(!this[z].getContext){continue}D=this[z].getContext("2d");o(D,y);D.beginPath();D.moveTo(y.x1,y.y1);while(w!==h&&v!==h&&C!==h&&B!==h){w=y["x"+x];v=y["y"+x];C=y["cx"+(x-1)];B=y["cy"+(x-1)];D.quadraticCurveTo(C,B,w,v);x+=1}d(D,y)}return this};j.drawBezier=function(F){var G,E,B=g({},e,F),A=2,x=1,z=0,y=0,D=0,w=0,C=0,v=0;for(E=0;E<this.length;E+=1){if(!this[E].getContext){continue}G=this[E].getContext("2d");o(G,B);G.beginPath();G.moveTo(B.x1,B.y1);while(z!==h&&y!==h&&D!==h&&w!==h&&C!==h&&v!==h){z=B["x"+A];y=B["y"+A];D=B["cx"+x];w=B["cy"+x];C=B["cx"+(x+1)];v=B["cy"+(x+1)];G.bezierCurveTo(D,w,C,v,z,y);A+=1;x+=2}d(G,B)}return this};j.drawText=function(w){var v,x,y=g({},e,w);for(x=0;x<this.length;x+=1){if(!this[x].getContext){continue}v=this[x].getContext("2d");o(v,y);v.textBaseline=y.baseline;v.textAlign=y.align;v.font=y.font;v.strokeText(y.text,y.x,y.y);v.fillText(y.text,y.x,y.y)}return this};j.drawImage=function(B){var D,w,A,y=g({},e,B),z=new r(),v;z.src=y.source;function C(E){if(z.complete){v=z.width/z.height;if(y.sx===h){y.sx=z.width/2}if(y.sy===h){y.sy=z.height/2}y.sWidth=y.sWidth||z.width;y.sHeight=y.sHeight||z.height;if(y.width&&!y.height){y.height=y.width/v}else{if(!y.width&&y.height){y.width=y.height*v}else{if(!y.width&&!y.height){y.width=z.width;y.height=z.height}}}n(E,y,y.width,y.height);E.drawImage(z,y.sx-y.sWidth/2,y.sy-y.sHeight/2,y.sWidth,y.sHeight,y.x-y.width/2,y.y-y.height/2,y.width,y.height);E.restore();return true}else{return false}}function x(){C(D);if(y.load){y.load.call(w)}}for(A=0;A<this.length;A+=1){w=this[A];if(!w.getContext){continue}D=w.getContext("2d");o(D,y);if(y.load){z.onload=x}else{if(!C(D)){z.onload=x}}}return this};j.drawPolygon=function(B){var G,A,y=g({},e,B),H=s/y.sides,x=(s/2)+H,F=(s*2)/y.sides,E=b(F/2)*y.radius,w,D,v,C,z;y.closed=true;if(y.sides>2){for(A=0;A<this.length;A+=1){if(!this[A].getContext){continue}G=this[A].getContext("2d");o(G,y);n(G,y,y.radius,y.radius);G.beginPath();for(z=0;z<y.sides;z+=1){w=y.x+(y.radius*b(x));D=y.y+(y.radius*a(x));v=y.x+((E+E*y.projection)*b(x+H));C=y.y+((E+E*y.projection)*a(x+H));if(z===0){G.moveTo(w,D)}else{G.lineTo(w,D)}if(y.projection){G.lineTo(v,C)}x+=F}G.restore();d(G,y)}}return this};j.setPixels=function(C){var E,w,B,z,x=g({},e,C),v,y,A,D;for(B=0;B<this.length;B+=1){w=this[B];if(!w.getContext){continue}E=w.getContext("2d");if(!x.x&&!x.y&&!x.width&&!x.height){x.width=w.width;x.height=w.height;x.x=x.width/2;x.y=x.height/2}n(E,x,x.width,x.height);v=E.getImageData(x.x-x.width/2,x.y-x.height/2,x.width,x.height);y=v.data;A=y.length;D=[];if(x.each!==h){for(z=0;z<A;z+=4){D=x.each.call(w,y[z],y[z+1],y[z+2],y[z+3]);y[z]=D[0];y[z+1]=D[1];y[z+2]=D[2];y[z+3]=D[3]}}E.putImageData(v,x.x-x.width/2,x.y-x.height/2);E.restore()}return this};i=[];function u(v){i.push(v);return v}j.drawLayers=function(v){var A=this,w,z,y,x;for(y=0;y<A.length;y+=1){if(!A[y].getContext){continue}w=A[y].getContext("2d");if(v){w.clearRect(0,0,A[y].width,A[y].height)}for(x=0;x<i.length;x+=1){z=i[x];if(z.fn){j[z.fn].call(A.eq(y),z)}}}return this};j.animateLayer=function(v,x,w){var y=this;if(v===h){v=0}if(w===h){w=400}f(f.jCanvas.layers[v]).animate(x,{duration:w,step:function(){y.drawLayers(true)}});return this};p.defaults=l;p.prefs=e;p.extend=q;p.layers=i;p.addLayer=u;f.jCanvas=p}(jQuery,document,Math,Image));