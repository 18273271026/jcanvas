/*
 jCanvas v6.0b
Copyright 2012, Caleb Evans
Licensed under the MIT license
*/
(function(c,Q,T,O,U,o,C,f,u){function x(){}function A(b){b?w(V,b):A.prefs=V=x.prototype=w({},L);return this}function E(b,a){b.fillStyle=a.fillStyle;b.strokeStyle=a.strokeStyle;b.lineWidth=a.strokeWidth;a.rounded?(b.lineCap="round",b.lineJoin="round"):(b.lineCap=a.strokeCap,b.lineJoin=a.strokeJoin,b.miterLimit=a.miterLimit);b.shadowOffsetX=a.shadowX;b.shadowOffsetY=a.shadowY;b.shadowBlur=a.shadowBlur;b.shadowColor=a.shadowColor;b.globalAlpha=a.opacity;b.globalCompositeOperation=a.compositing}function v(b){return b&&
b.getContext?b.getContext("2d"):f}function I(b,a){a.closed&&b.closePath();b.fill();"transparent"!==a.fillStyle&&(b.shadowColor="transparent");b.stroke();a.closed||b.closePath();a._toRad&&b.restore();a.mask&&(a.autosave&&b.save(),b.clip())}function W(b,a){if(!a.translateX&&!a.translateY&&(a.x||a.y))a.translateX=a.x,a.translateY=a.y;a.translate&&(a.translateX=a.translateY=a.translate);b.translate(a.translateX,a.translateY)}function X(b,a){1!==a.scale&&(a.scaleX=a.scaleY=a.scale);b.translate(a.x,a.y);
b.scale(a.scaleX,a.scaleY);b.translate(-a.x,-a.y)}function Y(b,a){a._toRad=a.inDegrees?y/180:1;a.rotate=a.rotate||a.angle;b.translate(a.x,a.y);b.rotate(a.rotate*a._toRad);b.translate(-a.x,-a.y)}function H(b,a,d,e,c){d._toRad=d.inDegrees?y/180:1;a.save();c=c||e;!b&&!d.fromCenter&&(d.x+=e/2,d.y+=c/2);(d.rotate||d.angle)&&Y(a,d);(1!==d.scale||1!==d.scaleX||1!==d.scaleY)&&X(a,d);(d.translate||d.translateX||d.translateY)&&W(a,d)}function P(b){var a=c.data(b,"jCanvas");a||(a=c.data(b,"jCanvas",{layers:[],
intersects:[],drag:{},event:{}}));return a}function Z(b,a,d){d&&d.visible&&(d.method===c.fn.draw?d.fn.call(b[0],a):d.method&&d.method.call(b,d))}function D(b,a,d){var e,z,h,B="function"===typeof a,p,a=a||{};if(a.layer&&!a._layer){e=c(b);z=e.getLayers();B&&(a={method:c.fn.draw,fn:a});a=w(new x,a);if(!B){a.method=c.fn[a.method]||d;p=P(b);for(h in A.events)A.events.hasOwnProperty(h)&&a[h]&&(A.events[h](e,p),a._event=o);if(a.draggable){a._event=o;b=["mousedown","mousemove","mouseup"];for(d=0;d<b.length;d+=
1)h=b[d],A.events[h](e,p);p.mouseout||(e.bind("mouseout.jCanvas",function(){p.drag={};e.drawLayers()}),p.mouseout=o)}}a.layer=o;a._layer=o;a.index===u&&(a.index=z.length);z.splice(a.index,0,a)}}function $(b){var a;for(a=0;a<J.length;a+=1)b[J[a]]=b["_"+J[a]]}function aa(b){var a;for(a=0;a<J.length;a+=1)b["_"+J[a]]=b[J[a]]}function ba(b){var a,d,e=[],z=1;b.match(/^#?[a-z0-9]+$/i)&&("transparent"===b&&(b="rgba(255, 255, 255, 0)"),d=Q.head,a=d.style.color,d.style.color=b,b=c.css(d,"color"),d.style.color=
a);b.match(/^rgb/i)&&(e=b.match(/[0-9]+/gi),b.match(/%/gi)&&(z=2.55),e[0]*=z,e[1]*=z,e[2]*=z,e[3]=e[3]!==u?U(e[3]):1);return e}function da(b){var a=3,d;"object"!==typeof b.start&&(b.start=ba(b.start),b.end=ba(b.end));b.now=[];if(1!==b.start[3]||1!==b.end[3])a=4;for(d=0;d<a;d+=1)b.now[d]=b.start[d]+(b.end[d]-b.start[d])*b.pos,3>d&&(b.now[d]=M(b.now[d]));1!==b.start[3]||1!==b.end[3]?b.now="rgba("+b.now.join(",")+")":(b.now.slice(0,3),b.now="rgb("+b.now.join(",")+")");b.elem.style?b.elem.style[b.prop]=
b.now:b.elem[b.prop]=b.now}function K(b){A.events[b]=function(a,d){var e="mouseover"===b||"mouseout"===b?"mousemove":b,c=d.event;d[e]||(a.bind(e+".jCanvas",function(b){c.x=b.offsetX;c.y=b.offsetY;c.type=e;a.drawLayers(o);b.preventDefault()}),d[e]=o)}}function G(b,a,d){var b=P(b),e=b.event,a=a.isPointInPath(e.x,e.y);d.mouseX=e.x;d.mouseY=e.y;!a&&(d._hovered&&!d._fired)&&(d._mousedout=o);a&&b.intersects.push(d)}var L,V,w=c.extend,M=O.round,y=O.PI,ca=O.sin,R=O.cos,ea=c.event.fix,N={},J;c.fn.jCanvas=
A;A.version="6.0b";A.events={};L={angle:0,align:"center",autosave:o,baseline:"middle",bringToFront:C,ccw:C,closed:C,compositing:"source-over",cornerRadius:0,cropFromCenter:o,draggable:!1,each:f,end:360,fillStyle:"transparent",font:"12pt sans-serif",fromCenter:o,height:f,inDegrees:o,load:f,mask:C,method:f,miterLimit:10,opacity:1,projection:0,r1:f,r2:f,radius:0,repeat:"repeat",rotate:0,rounded:C,scale:1,scaleX:1,scaleY:1,shadowBlur:0,shadowColor:"transparent",shadowX:0,shadowY:0,sHeight:f,sides:3,source:"",
start:0,strokeCap:"butt",strokeJoin:"miter",strokeStyle:"transparent",strokeWidth:1,sWidth:f,sx:f,sy:f,text:"",translate:0,translateX:0,translateY:0,visible:o,width:f,x:0,y:0};A();A.extend=function(b){L=w(L,b.props);A();b.name&&(c.fn[b.name]=function(a){var d,e,c=w(new x,a);for(d=0;d<this.length;d+=1)if(a=this[d],e=v(a))E(e,c),b.fn.call(a,e,c);return this});return c.fn[b.name]};c.fn.getLayers=function(){var b=this[0];return!b||!b.getContext?[]:P(b).layers};c.fn.getLayer=function(b){var a=this.getLayers(),
d;if(!b||!b.layer){if("string"===typeof b)for(d=0;d<a.length;d+=1)if(a[d].name===b){b=d;break}b=a[b||0]}return b};c.fn.setLayer=function(b,a){var d,e;b||(a=b,b=0);for(d=0;d<this.length;d+=1)e=c(this[d]).getLayer(b),w(e,a);return this};c.fn.removeLayer=function(b){var a,d,e;for(a=0;a<this.length;a+=1){d=c(this[a]).getLayers();if("string"===typeof b)for(e=0;e<d.length;e+=1)if(d[e].name===b){b=e;break}b=b||0;d.splice(b,1)}return this};c.fn.removeLayers=function(){var b,a;for(a=0;a<this.length;a+=1)b=
c(this[a]).getLayers(),b.length=0;return this};c.fn.getLayerGroup=function(b){var a=this.getLayers(),d=[],e;if(b!==u)for(e=0;e<a.length;e+=1)a[e].group===b&&d.push(a[e]);return d};c.fn.setLayerGroup=function(b,a){var d,e,f;for(d=0;d<this.length;d+=1){e=c(this[d]).getLayers();for(f=0;f<e.length;f+=1)e[f].group===b&&w(e[f],a)}return this};c.fn.removeLayerGroup=function(b){var a,d,e;if(b!==u)for(a=0;a<this.length;a+=1){d=c(this[a]).getLayers();for(e=0;e<d.length;e+=1)d[e].group===b&&(d.splice(e,1),e-=
1)}return this};c.fn.drawLayer=function(b){var a,d,e,f;for(a=0;a<this.length;a+=1)e=c(this[a]),d=v(this[a]),f=e.getLayer(b),Z(e,d,f);return this};c.fn.drawLayers=function(b){var a,d,e,f,h,B,p;for(d=0;d<this.length;d+=1)if(a=c(this[d]),e=v(this[d])){e.clearRect(0,0,this[d].width,this[d].height);p=P(this[d]);f=p.layers;for(B=0;B<f.length;B+=1)if(h=f[B],h.index=B,b&&(h._fired=C),Z(a,e,h),h._mousedout)h._mousedout=C,h._fired=o,h._hovered=C,h.mouseout&&h.mouseout.call(this[d],h);h=p.intersects[p.intersects.length-
1]||{};a=p.event;a=a.type;B=h[a];e=p.drag;if(h._event){if((h.mouseover||h.mouseout)&&!h._hovered&&!h._fired)h._fired=o,h._hovered=o,h.mouseover&&h.mouseover.call(this[d],h);B&&!h._fired&&(h._fired=o,B.call(this[d],h));h.draggable&&"mousedown"===a&&(h.bringToFront&&(f.splice(h.index,1),h.index=h.length-1,f.push(h)),e.layer=h,e.dragging=o,e.startX=h.x,e.startY=h.y,e.endX=h.mouseX,e.endY=h.mouseY,h.dragstart&&h.dragstart.call(this[d],h))}if(e.layer&&(e.dragging&&"mouseup"===a&&(e.layer.dragstop&&e.layer.dragstop.call(this[d],
e.layer),p.drag={}),e.dragging&&"mousemove"===a))e.layer.x=e.layer.mouseX-(e.endX-e.startX),e.layer.y=e.layer.mouseY-(e.endY-e.startY),e.layer.drag&&e.layer.drag.call(this[d],e.layer)}p.intersects=[];return this};c.fn.addLayer=function(b){var a,d,b=b||{};for(a=0;a<this.length;a+=1)if(d=v(this[a]))b.layer=o,D(this[a],b);return this};J=["width","height","opacity"];c.fn.animateLayer=function(){function b(a,b){return function(){$(b);a.drawLayers();h[4]&&h[4].call(a[0])}}function a(a,b){return function(d,
e){$(b);a.drawLayers();h[5]&&h[5].call(a[0],d,e)}}var d,e,z,h=[].slice.call(arguments,0);"object"===typeof h[0]&&!h[0].layer&&h.unshift(0);"object"===typeof h[2]?(h.splice(2,0,h[2].duration||f),h.splice(3,0,h[3].easing||f),h.splice(4,0,h[4].complete||f),h.splice(5,0,h[5].step||f)):(h[2]===u?(h.splice(2,0,f),h.splice(3,0,f),h.splice(4,0,f)):"function"===typeof h[2]&&(h.splice(2,0,f),h.splice(3,0,f)),h[3]===u)?(h[3]=f,h.splice(4,0,f)):"function"===typeof h[3]&&h.splice(3,0,f);for(e=0;e<this.length;e+=
1)if(d=c(this[e]),z=v(this[e]))if((z=d.getLayer(h[0]))&&z.method!==c.fn.draw)aa(z),aa(h[1]),c(z).animate(h[1],{duration:h[2],easing:c.easing[h[3]]?h[3]:f,complete:b(d,z),step:a(d,z)});return this};c.fn.delayLayer=function(b,a){var d,e,a=a||0;for(d=0;d<this.length;d+=1)e=c(this[d]).getLayer(b),c(e).delay(a);return this};c.fn.stopLayer=function(b,a){var d,e;for(d=0;d<this.length;d+=1)e=c(this[d]).getLayer(b),c(e).stop(a);return this};(function(b){var a;for(a=0;a<b.length;a+=1)c.fx.step[b[a]]=da})("color backgroundColor borderColor borderTopColor borderRightColor borderBottomColor borderLeftColor fillStyle outlineColor strokeStyle shadowColor".split(" "));
K("click");K("dblclick");K("mousedown");K("mouseup");K("mousemove");K("mouseover");K("mouseout");c.event.fix=function(b){var a,b=ea.call(c.event,b);if(b.pageX!==u&&b.offsetX===u&&(a=c(b.target).offset()))b.offsetX=b.pageX-a.left,b.offsetY=b.pageY-a.top;return b};c.fn.draw=function a(d){var e,c,d=d||{};"function"===typeof d.fn&&(d={fn:d});for(e=0;e<this.length;e+=1)if((c=v(this[e]))&&d.fn)D(this[e],d,a),d.fn.call(this[e],c);return this};c.fn.clearCanvas=function(a){for(var d,e=w(new x,a),a=0;a<this.length;a+=
1)if(d=v(this[a]))H(a,d,e,e.width,e.height),!e.x||!e.y||!e.width||!e.height?d.clearRect(0,0,this[a].width,this[a].height):d.clearRect(e.x-e.width/2,e.y-e.height/2,e.width,e.height);return this};c.fn.saveCanvas=function(){var a,d;for(a=0;a<this.length;a+=1)(d=v(this[a]))&&d.save();return this};c.fn.restoreCanvas=function(){var a,d;for(a=0;a<this.length;a+=1)(d=v(this[a]))&&d.restore();return this};c.fn.translateCanvas=function(a){for(var d,e=w(new x,a),a=0;a<this.length;a+=1)if(d=v(this[a]))e.autosave&&
d.save(),W(d,e);return this};c.fn.scaleCanvas=function(a){for(var d,e=w(new x,a),a=0;a<this.length;a+=1)if(d=v(this[a]))e.autosave&&d.save(),X(d,e);return this};c.fn.rotateCanvas=function(a){for(var d,e=w(new x,a),a=0;a<this.length;a+=1)if(d=v(this[a]))e.autosave&&d.save(),Y(d,e);return this};c.fn.drawRect=function d(e){var c,h,f=w(new x,e),p,q,s,r,k;for(c=0;c<this.length;c+=1)if(h=v(this[c]))D(this[c],e,d),E(h,f),H(c,h,f,f.width,f.height),h.beginPath(),p=f.x-f.width/2,q=f.y-f.height/2,(k=f.cornerRadius)?
(f.closed=o,s=f.x+f.width/2,r=f.y+f.height/2,0>s-p-2*k&&(k=(s-p)/2),0>r-q-2*k&&(k=(r-q)/2),h.moveTo(p+k,q),h.lineTo(s-k,q),h.arc(s-k,q+k,k,3*y/2,2*y,C),h.lineTo(s,r-k),h.arc(s-k,r-k,k,0,y/2,C),h.lineTo(p+k,r),h.arc(p+k,r-k,k,y/2,y,C),h.lineTo(p,q+k),h.arc(p+k,q+k,k,y,3*y/2,C)):h.rect(p,q,f.width,f.height),f._event&&G(this[c],h,e),I(h,f);return this};c.fn.drawArc=function e(c){var h,f,p=w(new x,c);!p.inDegrees&&360===p.end&&(p.end=2*y);for(h=0;h<this.length;h+=1)if(f=v(this[h]))D(this[h],c,e),E(f,
p),H(h,f,p,2*p.radius),f.beginPath(),f.arc(p.x,p.y,p.radius,p.start*p._toRad-y/2,p.end*p._toRad-y/2,p.ccw),p._event&&G(this[h],f,c),I(f,p);return this};c.fn.drawEllipse=function z(h){var f,c,q=w(new x,h),s=4*q.width/3,r=q.height;q.closed=o;for(f=0;f<this.length;f+=1)if(c=v(this[f]))D(this[f],h,z),E(c,q),H(f,c,q,q.width,q.height),c.beginPath(),c.moveTo(q.x,q.y-r/2),c.bezierCurveTo(q.x-s/2,q.y-r/2,q.x-s/2,q.y+r/2,q.x,q.y+r/2),c.bezierCurveTo(q.x+s/2,q.y+r/2,q.x+s/2,q.y-r/2,q.x,q.y-r/2),q._event&&G(this[f],
c,h),I(c,q);return this};c.fn.drawPolygon=function h(f){var c,q,s=w(new x,f),r=2*y/s.sides,k=y/s.sides,j=k+y/2,l=s.radius*R(r/2),m,n,i;s.closed=o;for(c=0;c<this.length;c+=1)if(q=v(this[c])){D(this[c],f,h);E(q,s);H(c,q,s,2*s.radius);q.beginPath();for(i=0;i<s.sides;i+=1)m=s.x+M(s.radius*R(j)),n=s.y+M(s.radius*ca(j)),q.lineTo(m,n),s.projection&&(m=s.x+M((l+l*s.projection)*R(j+k)),n=s.y+M((l+l*s.projection)*ca(j+k)),q.lineTo(m,n)),j+=r;s._event&&G(this[c],q,f);I(q,s)}return this};c.fn.drawLine=function B(c){var f,
s,r=w(new x,c),k,j,l;for(f=0;f<this.length;f+=1)if(s=v(this[f])){D(this[f],c,B);E(s,r);k=1;for(s.beginPath();o;)if(j=r["x"+k],l=r["y"+k],j!==u&&l!==u)s.lineTo(j,l),k+=1;else break;r._event&&G(this[f],s,c);I(s,r)}return this};c.fn.drawQuad=function p(f){var c,r,k=w(new x,f),j,l,m,n,i;for(c=0;c<this.length;c+=1)if(r=v(this[c])){D(this[c],f,p);E(r,k);j=2;r.beginPath();for(r.moveTo(k.x1,k.y1);o;)if(l=k["x"+j],m=k["y"+j],n=k["cx"+(j-1)],i=k["cy"+(j-1)],l!==u&&m!==u&&n!==u&&i!==u)r.quadraticCurveTo(n,i,
l,m),j+=1;else break;k._event&&G(this[c],r,f);I(r,k)}return this};c.fn.drawBezier=function q(c){var f,k,j=w(new x,c),l,m,n,i,g,t,F,S;for(f=0;f<this.length;f+=1)if(k=v(this[f])){D(this[f],c,q);E(k,j);l=2;m=1;k.beginPath();for(k.moveTo(j.x1,j.y1);o;)if(n=j["x"+l],i=j["y"+l],g=j["cx"+m],t=j["cy"+m],F=j["cx"+(m+1)],S=j["cy"+(m+1)],n!==u&&i!==u&&g!==u&&t!==u&&F!==u&&S!==u)k.bezierCurveTo(g,t,F,S,n,i),l+=1,m+=2;else break;j._event&&G(this[f],k,c);I(k,j)}return this};c.fn.drawText=function s(f){var k,j,
l=w(new x,f);for(k=0;k<this.length;k+=1)if(c(this[k]),j=v(this[k])){D(this[k],f,s);E(j,l);j.textBaseline=l.baseline;j.textAlign=l.align;j.font=l.font;if(l.layer){var m=this[k],n=j,i=l,g=void 0,t=void 0,F=/\b(\d*\.?\d*)\w\w\b/gi;if(N.text===i.text&&N.font===i.font)i.width=N.width,i.height=N.height;else{i.width=n.measureText(i.text).width;g=m.style.fontSize;if(t=i.font.match(F))m.style.fontSize=i.font.match(F)[0];i.height=U(c.css(m,"fontSize"));m.style.fontSize=g}}H(k,j,l,l.width,l.height);j.fillText(l.text,
l.x,l.y);"transparent"!==l.fillStyle&&(j.shadowColor="transparent");j.strokeText(l.text,l.x,l.y);l._event?(j.beginPath(),j.rect(l.x-l.width/2,l.y-l.height/2,l.width,l.height),j.restore(),G(this[k],j,f),j.closePath()):j.restore()}N=l;return this};c.fn.drawImage=function r(c){function j(i,j,r){return function(){j||((o=t.width/t.height,g.width===f&&g.sWidth===f&&(c.width=g.width=g.sWidth=t.width),g.height===f&&g.sHeight===f&&(c.height=g.height=g.sHeight=t.height),g.width===f&&g.sWidth!==f&&(g.width=
g.sWidth),g.height===f&&g.sHeight!==f&&(g.height=g.sHeight),g.sWidth===f&&g.width!==f&&(c.sWidth=g.sWidth=t.width),g.sHeight===f&&g.height!==f&&(c.sHeight=g.sHeight=t.height),g.sx===f&&(g.sx=g.cropFromCenter?t.width/2:0),g.sy===f&&(g.sy=g.cropFromCenter?t.height/2:0),g.cropFromCenter||(g.sx+=g.sWidth/2,g.sy+=g.sHeight/2),g.sx+g.sWidth/2>t.width&&(g.sx=t.width-g.sWidth/2),0>g.sx-g.sWidth/2&&(g.sx=g.sWidth/2),0>g.sy-g.sHeight/2&&(g.sy=g.sHeight/2),g.sy+g.sHeight/2>t.height&&(g.sy=t.height-g.sHeight/
2),g.width!==f&&g.height===f)?c.height=g.height=g.width/o:g.width===f&&g.height!==f?c.width=g.width=g.height*o:g.width===f&&g.height===f&&(c.width=g.width=t.width,c.height=g.height=t.height));H(j,r,g,g.width,g.height);r.drawImage(t,g.sx-g.sWidth/2,g.sy-g.sHeight/2,g.sWidth,g.sHeight,g.x-g.width/2,g.y-g.height/2,g.width,g.height);g._event?(r.beginPath(),r.rect(g.x-g.width/2,g.y-g.height/2,g.width,g.height),r.restore(),G(l[j],r,c),r.closePath()):r.restore();g.load&&g.load.call(i,c)}}var l=this,m,n,
i,g=w(new x,c),t,F,o;F=g.source.getContext;g.source.src||F?(t=g.source,g.width=t.width,g.height=t.height):g.source&&(t=new T,t.src=g.source);for(n=0;n<l.length;n+=1)if(m=l[n],i=v(l[n]))D(l[n],c,r),E(i,g),t&&(t.complete||F?j(m,n,i)():t.onload=j(m,n,i));return l};c.fn.pattern=function(c){function k(){i=l.createPattern(n,m.repeat);m.load&&m.load.call(j[0],i)}var j=this,l,m=w(new x,c),n,i;(l=v(j[0]))?"function"===typeof m.source?(n=Q.createElement("canvas"),n.width=m.width,n.height=m.height,c=v(n),m.source.call(n,
c),k()):(c=m.source.getContext,m.source.src||c?n=m.source:(n=new T,n.src=m.source),n.complete||c?k():n.onload=k):i=f;return i};c.fn.gradient=function(c){var k,c=w(new x,c),j=[],l,m,n,i,g,t,o;if(k=v(this[0])){k=c.r1!==f||c.r2!==f?k.createRadialGradient(c.x1,c.y1,c.r1,c.x2,c.y2,c.r2):k.createLinearGradient(c.x1,c.y1,c.x2,c.y2);for(i=1;c["c"+i]!==u;i+=1)c["s"+i]!==u?j.push(c["s"+i]):j.push(f);l=j.length;j[0]===f&&(j[0]=0);j[l-1]===f&&(j[l-1]=1);for(i=0;i<l;i+=1){if(j[i]!==f){t=1;o=0;m=j[i];for(g=i+1;g<
l;g+=1)if(j[g]!==f){n=j[g];break}else t+=1;m>n&&(j[g]=j[i])}else j[i]===f&&(o+=1,j[i]=m+o*((n-m)/t));k.addColorStop(j[i],c["c"+(i+1)])}}else k=f;return k};c.fn.setPixels=function k(c){var f,m,n,i=w(new x,c),g={},t,o,u,y;for(m=0;m<this.length;m+=1)if(f=this[m],n=v(f)){D(this[m],c,k);H(m,n,i,i.width,i.height);if(!i.x||!i.y||!i.width||!i.height)i.width=f.width,i.height=f.height,i.x=i.width/2,i.y=i.height/2;t=n.getImageData(i.x-i.width/2,i.y-i.height/2,i.width,i.height);o=t.data;y=o.length;g=[];if(i.each)for(u=
0;u<y;u+=4)g.r=o[u],g.g=o[u+1],g.b=o[u+2],g.a=o[u+3],i.each.call(f,g),o[u]=g.r,o[u+1]=g.g,o[u+2]=g.b,o[u+3]=g.a;n.putImageData(t,i.x-i.width/2,i.y-i.height/2);n.restore()}return this};c.fn.getCanvasImage=function(c,j){var l=this[0];return l&&l.toDataURL?l.toDataURL("image/"+c,j):f};c.support.canvas=Q.createElement("canvas").getContext!==u;A.defaults=L;c.jCanvas=A})(jQuery,document,Image,Math,parseFloat,!0,!1,null);
