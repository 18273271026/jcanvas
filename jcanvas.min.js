/*
 jCanvas v6.1b
Copyright 2012, Caleb Evans
Licensed under the MIT license
*/
(function(c,Q,U,O,V,t,D,h,r){function z(){}function E(b){b?y(W,b):E.prefs=W=z.prototype=y({},M);return this}function H(b,a){b.fillStyle=a.fillStyle;b.strokeStyle=a.strokeStyle;b.lineWidth=a.strokeWidth;a.rounded?(b.lineCap="round",b.lineJoin="round"):(b.lineCap=a.strokeCap,b.lineJoin=a.strokeJoin,b.miterLimit=a.miterLimit);b.shadowOffsetX=a.shadowX;b.shadowOffsetY=a.shadowY;b.shadowBlur=a.shadowBlur;b.shadowColor=a.shadowColor;b.globalAlpha=a.opacity;b.globalCompositeOperation=a.compositing}function x(b){return b&&
b.getContext?b.getContext("2d"):h}function K(b,a){a.closed&&b.closePath();b.fill();"transparent"!==a.fillStyle&&(b.shadowColor="transparent");b.stroke();a.closed||b.closePath();a._toRad&&b.restore();a.mask&&(a.autosave&&b.save(),b.clip())}function X(b,a){if(!a.translateX&&!a.translateY&&(a.x||a.y))a.translateX=a.x,a.translateY=a.y;a.translate&&(a.translateX=a.translateY=a.translate);b.translate(a.translateX,a.translateY)}function Y(b,a){1!==a.scale&&(a.scaleX=a.scaleY=a.scale);b.translate(a.x,a.y);
b.scale(a.scaleX,a.scaleY);b.translate(-a.x,-a.y)}function Z(b,a){a._toRad=a.inDegrees?A/180:1;a.rotate=a.rotate||a.angle;b.translate(a.x,a.y);b.rotate(a.rotate*a._toRad);b.translate(-a.x,-a.y)}function G(b,a,d,f,j){d._toRad=d.inDegrees?A/180:1;a.save();j=j||f;!b&&!d.fromCenter&&(d.x+=f/2,d.y+=j/2);(d.rotate||d.angle)&&Z(a,d);(1!==d.scale||1!==d.scaleX||1!==d.scaleY)&&Y(a,d);(d.translate||d.translateX||d.translateY)&&X(a,d)}function P(b){var a;C.elem===b?a=C.data:((a=c.data(b,"jCanvas"))||(a=c.data(b,
"jCanvas",{layers:[],intersects:[],drag:{},event:{}})),C.elem=b,C.data=a);return a}function $(b,a,d){d&&d.visible&&(d.method===c.fn.draw?d.fn.call(b[0],a):d.method&&d.method.call(b,d))}function F(b,a,d){var f,j,g,B="function"===typeof a,p,a=a||{};if(a.layer&&!a._layer){f=c(b);j=f.getLayers();B&&(a={method:c.fn.draw,fn:a});a=y(new z,a);if(!B){a.method=c.fn[a.method]||d;p=P(b);for(g in E.events)E.events.hasOwnProperty(g)&&a[g]&&(E.events[g](f,p),a._event=t);if(a.draggable){a._event=t;b=["mousedown",
"mousemove","mouseup"];for(d=0;d<b.length;d+=1)g=b[d],E.events[g](f,p);p.mouseout||(f.bind("mouseout.jCanvas",function(){p.drag={};f.drawLayers()}),p.mouseout=t)}}a.layer=t;a._layer=t;a.index===r&&(a.index=j.length);j.splice(a.index,0,a)}}function aa(b){var a;for(a=0;a<I.length;a+=1)b[I[a]]=b["_"+I[a]]}function ba(b,a){var d;for(d=0;d<I.length;d+=1)b["_"+I[d]]=b[I[d]],R[I[d]]=1,a&&delete b[I[d]]}function ca(b){var a,d,f=[],j=1;b.match(/^#?\w+$/i)&&("transparent"===b&&(b="rgba(0,0,0,0)"),d=Q.head,
a=d.style.color,d.style.color=b,b=c.css(d,"color"),d.style.color=a);b.match(/^rgb/i)&&(f=b.match(/\d+/gi),b.match(/%/gi)&&(j=2.55),f[0]*=j,f[1]*=j,f[2]*=j,f[3]=f[3]!==r?V(f[3]):1);return f}function fa(b){var a=3,d;"object"!==typeof b.start&&(b.start=ca(b.start),b.end=ca(b.end));b.now=[];if(1!==b.start[3]||1!==b.end[3])a=4;for(d=0;d<a;d+=1)b.now[d]=b.start[d]+(b.end[d]-b.start[d])*b.pos,3>d&&(b.now[d]=N(b.now[d]));1!==b.start[3]||1!==b.end[3]?b.now="rgba("+b.now.join(",")+")":(b.now.slice(0,3),b.now=
"rgb("+b.now.join(",")+")");b.elem.nodeName?b.elem.style[b.prop]=b.now:b.elem[b.prop]=b.now}function L(b){E.events[b]=function(a,d){var f="mouseover"===b||"mouseout"===b?"mousemove":b,j=d.event;d[f]||(a.bind(f+".jCanvas",function(b){j.x=b.offsetX;j.y=b.offsetY;j.type=f;a.drawLayers(t);b.preventDefault()}),d[f]=t)}}function J(b,a,d){var b=P(b),f=b.event,a=a.isPointInPath(f.x,f.y);d.mouseX=f.x;d.mouseY=f.y;!a&&(d._hovered&&!d._fired)&&(d._mousedout=t);a&&b.intersects.push(d)}function da(b,a,d,f,j){var g=
/\b(\d*\.?\d*)\w\w\b/gi,B;if(C.text===f.text&&C.font===f.font&&C.maxWidth===f.maxWidth&&C.lineHeight===f.lineHeight)f.width=C.width,f.height=C.height;else if(!a){f.width=d.measureText(j[0]).width;for(a=1;a<j.length;a+=1)B=d.measureText(j[a]).width,B>f.width&&(f.width=B);d=b.style.fontSize;if(a=f.font.match(g))b.style.fontSize=f.font.match(g)[0];f.height=V(c.css(b,"fontSize"))*j.length*f.lineHeight;b.style.fontSize=d}}var M,W,y=c.extend,N=O.round,A=O.PI,ea=O.sin,S=O.cos,ga=c.event.fix,C={},I,R;c.fn.jCanvas=
E;E.version="6.1b";E.events={};M={angle:0,align:"center",autosave:t,baseline:"middle",bringToFront:D,ccw:D,closed:D,compositing:"source-over",cornerRadius:0,cropFromCenter:t,draggable:D,disableDrag:D,each:h,end:360,fillStyle:"transparent",font:"12pt sans-serif",fromCenter:t,height:h,inDegrees:t,lineHeight:1,load:h,mask:D,maxWidth:h,method:h,miterLimit:10,opacity:1,projection:0,r1:h,r2:h,radius:0,repeat:"repeat",rotate:0,rounded:D,scale:1,scaleX:1,scaleY:1,shadowBlur:0,shadowColor:"transparent",shadowX:0,
shadowY:0,sHeight:h,sides:3,source:"",start:0,strokeCap:"butt",strokeJoin:"miter",strokeStyle:"transparent",strokeWidth:1,sWidth:h,sx:h,sy:h,text:"",translate:0,translateX:0,translateY:0,visible:t,width:h,x:0,y:0};E();E.extend=function(b){M=y(M,b.props);E();b.name&&(c.fn[b.name]=function d(f){var j,g,c,p=y(new z,f);for(g=0;g<this.length;g+=1)if(j=this[g],c=x(j))F(this[g],f,d),H(c,p),b.fn.call(j,c,p);return this});return c.fn[b.name]};c.fn.getLayers=function(){var b=this[0];return!b||!b.getContext?
[]:P(b).layers};c.fn.getLayer=function(b){var a=this.getLayers(),d=c.type(b),f,j;if(b&&b.layer)f=b;else if("number"===d)f=a[b];else for(j=0;j<a.length;j+=1)if(a[j].index=j,a[j].name===b||"regexp"===d&&a[j].name.match(b)){f=a[j];break}return f};c.fn.setLayer=function(b,a){var d,f;b===r&&(a=b,b=0);for(d=0;d<this.length;d+=1)f=c(this[d]).getLayer(b),y(f,a);return this};c.fn.removeLayer=function(b){var a,d,f;for(d=0;d<this.length;d+=1)a=c(this[d]),f=a.getLayers(),(a=a.getLayer(b))&&f.splice(a.index,1);
return this};c.fn.removeLayers=function(){var b,a;for(a=0;a<this.length;a+=1)b=c(this[a]).getLayers(),b.length=0;return this};c.fn.getLayerGroup=function(b){var a=this.getLayers(),d=c.type(b),f=[],j;for(j=0;j<a.length;j+=1)a[j].index=j,(a[j].group===b||"regexp"===d&&a[j].group.match(b))&&f.push(a[j]);return f};c.fn.setLayerGroup=function(b,a){var d,f=c.type(b),j,g;for(d=0;d<this.length;d+=1){j=c(this[d]).getLayers();for(g=0;g<j.length;g+=1)(j[g].group===b||"regexp"===f&&j[g].group.match(b))&&y(j[g],
a)}return this};c.fn.removeLayerGroup=function(b){var a,d=c.type(b),f,j;if(b!==r)for(a=0;a<this.length;a+=1){f=c(this[a]).getLayers();for(j=0;j<f.length;j+=1)if(f[j].group===b||"regexp"===d&&f[j].group.match(b))f.splice(j,1),j-=1}return this};c.fn.drawLayer=function(b){var a,d,f,j;for(a=0;a<this.length;a+=1)f=c(this[a]),d=x(this[a]),j=f.getLayer(b),$(f,d,j);return this};c.fn.drawLayers=function(b){var a,d,f,j,g,B,p;for(d=0;d<this.length;d+=1)if(a=c(this[d]),f=x(this[d])){f.clearRect(0,0,this[d].width,
this[d].height);C.elem===this[d]?p=C.data:(p=P(this[d]),C.elem=this[d],C.data=p);j=p.layers;for(B=0;B<j.length;B+=1)if(g=j[B],g.index=B,b&&(g._fired=D),$(a,f,g),g._mousedout)g._mousedout=D,g._fired=t,g._hovered=D,g.mouseout&&g.mouseout.call(this[d],g);g=p.intersects[p.intersects.length-1]||{};a=p.event;a=a.type;B=g[a];f=p.drag;if(g._event){if((g.mouseover||g.mouseout)&&!g._hovered&&!g._fired)g._fired=t,g._hovered=t,g.mouseover&&g.mouseover.call(this[d],g);B&&!g._fired&&(g._fired=t,B.call(this[d],
g));g.draggable&&(!g.disableDrag&&"mousedown"===a)&&(g.bringToFront&&(j.splice(g.index,1),g.index=j.push(g)),f.layer=g,f.dragging=t,f.startX=g.x,f.startY=g.y,f.endX=g.mouseX,f.endY=g.mouseY,g.dragstart&&g.dragstart.call(this[d],g))}if(f.layer&&(f.dragging&&"mouseup"===a&&(f.layer.dragstop&&f.layer.dragstop.call(this[d],f.layer),p.drag={}),f.dragging&&"mousemove"===a))f.layer.x=f.layer.mouseX-(f.endX-f.startX),f.layer.y=f.layer.mouseY-(f.endY-f.startY),f.layer.drag&&f.layer.drag.call(this[d],f.layer)}p.intersects=
[];return this};c.fn.addLayer=function(b){var a,d,b=b||{};for(a=0;a<this.length;a+=1)if(d=x(this[a]))b.layer=t,F(this[a],b);return this};I=["width","height","opacity","lineHeight"];R={};c.fn.animateLayer=function(){function b(a,b){return function(){aa(b);a.drawLayers();g[4]&&g[4].call(a[0],b)}}function a(a,b){return function(d,f){aa(b);a.drawLayers();g[5]&&g[5].call(a[0],d,f,b)}}var d,f,j,g=[].slice.call(arguments,0);"object"===typeof g[0]&&!g[0].layer&&g.unshift(0);"object"===typeof g[2]?(g.splice(2,
0,g[2].duration||h),g.splice(3,0,g[3].easing||h),g.splice(4,0,g[4].complete||h),g.splice(5,0,g[5].step||h)):(g[2]===r?(g.splice(2,0,h),g.splice(3,0,h),g.splice(4,0,h)):"function"===typeof g[2]&&(g.splice(2,0,h),g.splice(3,0,h)),g[3]===r)?(g[3]=h,g.splice(4,0,h)):"function"===typeof g[3]&&g.splice(3,0,h);g[1]=y({},g[1]);for(f=0;f<this.length;f+=1)if(d=c(this[f]),j=x(this[f]))if((j=d.getLayer(g[0]))&&j.method!==c.fn.draw)ba(j),ba(g[1],t),j.style=R,c(j).animate(g[1],{duration:g[2],easing:c.easing[g[3]]?
g[3]:h,complete:b(d,j),step:a(d,j)});return this};c.fn.animateLayerGroup=function(b){var a,d,f=[].slice.call(arguments,0),j,g;for(d=0;d<this.length;d+=1){a=c(this[d]);j=a.getLayerGroup(b);for(g=0;g<j.length;g+=1)a.animateLayer.apply(a,[j[g]].concat(f.slice(1)))}};c.fn.delayLayer=function(b,a){var d,f,a=a||0;for(d=0;d<this.length;d+=1)f=c(this[d]).getLayer(b),c(f).delay(a);return this};c.fn.delayLayerGroup=function(b,a){var d,f,j,g,a=a||0;for(f=0;f<this.length;f+=1){d=c(this[f]);j=d.getLayerGroup(b);
for(g=0;g<j.length;g+=1)d.delayLayer.call(d,b,a)}};c.fn.stopLayer=function(b,a){var d,f;for(d=0;d<this.length;d+=1)f=c(this[d]).getLayer(b),c(f).stop(a);return this};c.fn.stopLayerGroup=function(b,a){var d,f,j,g;for(f=0;f<this.length;f+=1){d=c(this[f]);j=d.getLayerGroup(b);for(g=0;g<j.length;g+=1)d.stopLayer.call(d,b,a)}};(function(b){var a;for(a=0;a<b.length;a+=1)c.fx.step[b[a]]=fa})("color backgroundColor borderColor borderTopColor borderRightColor borderBottomColor borderLeftColor fillStyle outlineColor strokeStyle shadowColor".split(" "));
L("click");L("dblclick");L("mousedown");L("mouseup");L("mousemove");L("mouseover");L("mouseout");c.event.fix=function(b){var a,b=ga.call(c.event,b);if(b.pageX!==r&&b.offsetX===r&&(a=c(b.target).offset()))b.offsetX=b.pageX-a.left,b.offsetY=b.pageY-a.top;return b};c.fn.draw=function a(d){var f,j,d=d||{};"function"===typeof d&&(d={fn:d});for(f=0;f<this.length;f+=1)if((j=x(this[f]))&&d.fn)F(this[f],d,a),d.fn.call(this[f],j);return this};c.fn.clearCanvas=function(a){for(var d,f=y(new z,a),a=0;a<this.length;a+=
1)if(d=x(this[a]))G(a,d,f,f.width,f.height),!f.x||!f.y||!f.width||!f.height?d.clearRect(0,0,this[a].width,this[a].height):d.clearRect(f.x-f.width/2,f.y-f.height/2,f.width,f.height);return this};c.fn.saveCanvas=function(){var a,d;for(a=0;a<this.length;a+=1)(d=x(this[a]))&&d.save();return this};c.fn.restoreCanvas=function(){var a,d;for(a=0;a<this.length;a+=1)(d=x(this[a]))&&d.restore();return this};c.fn.translateCanvas=function(a){for(var d,f=y(new z,a),a=0;a<this.length;a+=1)if(d=x(this[a]))f.autosave&&
d.save(),X(d,f);return this};c.fn.scaleCanvas=function(a){for(var d,f=y(new z,a),a=0;a<this.length;a+=1)if(d=x(this[a]))f.autosave&&d.save(),Y(d,f);return this};c.fn.rotateCanvas=function(a){for(var d,f=y(new z,a),a=0;a<this.length;a+=1)if(d=x(this[a]))f.autosave&&d.save(),Z(d,f);return this};c.fn.drawRect=function d(f){var j,g,c=y(new z,f),p,h,u,s,l;for(j=0;j<this.length;j+=1)if(g=x(this[j]))F(this[j],f,d),H(g,c),G(j,g,c,c.width,c.height),g.beginPath(),p=c.x-c.width/2,h=c.y-c.height/2,(l=c.cornerRadius)?
(c.closed=t,u=c.x+c.width/2,s=c.y+c.height/2,0>u-p-2*l&&(l=(u-p)/2),0>s-h-2*l&&(l=(s-h)/2),g.moveTo(p+l,h),g.lineTo(u-l,h),g.arc(u-l,h+l,l,3*A/2,2*A,D),g.lineTo(u,s-l),g.arc(u-l,s-l,l,0,A/2,D),g.lineTo(p+l,s),g.arc(p+l,s-l,l,A/2,A,D),g.lineTo(p,h+l),g.arc(p+l,h+l,l,A,3*A/2,D)):g.rect(p,h,c.width,c.height),c._event&&J(this[j],g,f),K(g,c);return this};c.fn.drawArc=function f(j){var g,c,p=y(new z,j),j=j||{};!p.inDegrees&&360===p.end&&(j.end=p.end=2*A);for(g=0;g<this.length;g+=1)if(c=x(this[g]))F(this[g],
j,f),H(c,p),G(g,c,p,2*p.radius),c.beginPath(),c.arc(p.x,p.y,p.radius,p.start*p._toRad-A/2,p.end*p._toRad-A/2,p.ccw),p._event&&J(this[g],c,j),K(c,p);return this};c.fn.drawEllipse=function j(g){var c,p,h=y(new z,g),u=4*h.width/3,s=h.height;h.closed=t;for(c=0;c<this.length;c+=1)if(p=x(this[c]))F(this[c],g,j),H(p,h),G(c,p,h,h.width,h.height),p.beginPath(),p.moveTo(h.x,h.y-s/2),p.bezierCurveTo(h.x-u/2,h.y-s/2,h.x-u/2,h.y+s/2,h.x,h.y+s/2),p.bezierCurveTo(h.x+u/2,h.y+s/2,h.x+u/2,h.y-s/2,h.x,h.y-s/2),h._event&&
J(this[c],p,g),K(p,h);return this};c.fn.drawPolygon=function g(c){var h,r,u=y(new z,c),s=2*A/u.sides,l=A/u.sides,m=l+A/2,n=u.radius*S(s/2),o,q,k;u.closed=t;for(h=0;h<this.length;h+=1)if(r=x(this[h])){F(this[h],c,g);H(r,u);G(h,r,u,2*u.radius);r.beginPath();for(k=0;k<u.sides;k+=1)o=u.x+N(u.radius*S(m)),q=u.y+N(u.radius*ea(m)),r.lineTo(o,q),u.projection&&(o=u.x+N((n+n*u.projection)*S(m+l)),q=u.y+N((n+n*u.projection)*ea(m+l)),r.lineTo(o,q)),m+=s;u._event&&J(this[h],r,c);K(r,u)}return this};c.fn.drawLine=
function B(c){var h,u,s=y(new z,c),l,m,n;for(h=0;h<this.length;h+=1)if(u=x(this[h])){F(this[h],c,B);H(u,s);G(h,u,s,0);l=1;for(u.beginPath();t;)if(m=s["x"+l],n=s["y"+l],m!==r&&n!==r)u.lineTo(m,n),l+=1;else break;s._event&&J(this[h],u,c);K(u,s)}return this};c.fn.drawQuad=function p(c){var h,s,l=y(new z,c),m,n,o,q,k;for(h=0;h<this.length;h+=1)if(s=x(this[h])){F(this[h],c,p);H(s,l);G(h,s,l,0);m=2;s.beginPath();for(s.moveTo(l.x1,l.y1);t;)if(n=l["x"+m],o=l["y"+m],q=l["cx"+(m-1)],k=l["cy"+(m-1)],n!==r&&
o!==r&&q!==r&&k!==r)s.quadraticCurveTo(q,k,n,o),m+=1;else break;l._event&&J(this[h],s,c);K(s,l)}return this};c.fn.drawBezier=function ha(c){var h,l,m=y(new z,c),n,o,q,k,i,v,T,w;for(h=0;h<this.length;h+=1)if(l=x(this[h])){F(this[h],c,ha);H(l,m);G(h,l,m,0);n=2;o=1;l.beginPath();for(l.moveTo(m.x1,m.y1);t;)if(q=m["x"+n],k=m["y"+n],i=m["cx"+o],v=m["cy"+o],T=m["cx"+(o+1)],w=m["cy"+(o+1)],q!==r&&k!==r&&i!==r&&v!==r&&T!==r&&w!==r)l.bezierCurveTo(i,v,T,w,q,k),n+=1,o+=2;else break;m._event&&J(this[h],l,c);
K(l,m)}return this};c.fn.drawText=function u(s){var l,m,n=y(new z,s),o,q,k,i;for(l=0;l<this.length;l+=1)if(c(this[l]),m=x(this[l])){F(this[l],s,u);H(m,n);m.textBaseline=n.baseline;m.textAlign=n.align;m.font=n.font;if(!l&&n.maxWidth!==h){o=m;q=n.text;i=n.maxWidth;var v=n.text.split(" "),r=[],w="";if(o.measureText(q).width<i)r=[q];else for(;0<v.length;)o.measureText(w+v[0]).width<i?w+=v.shift()+" ":(r.push(w),w=""),0===v.length&&r.push(w);o=r;o=o.join("\n").replace(/( (\n))|( $)/gi,"$2").split("\n")}else l||
(o=(""+n.text).split("\n"));da(this[l],l,m,n,o);G(l,m,n,n.width,n.height);l||(k=n.x,"left"===n.align?k-=n.width/2:"right"===n.align&&(k+=n.width/2));for(q=0;q<o.length;q+=1)m.shadowColor=n.shadowColor,i=n.y+q*n.height/o.length-(o.length-1)*n.height/o.length/2,m.fillText(o[q],k,i),"transparent"!==n.fillStyle&&(m.shadowColor="transparent"),m.strokeText(o[q],n.x,i);n._event?(m.beginPath(),m.rect(n.x-n.width/2,n.y-n.height/2,n.width,n.height),m.restore(),J(this[l],m,s),m.closePath()):m.restore()}C=n;
return this};c.fn.measureText=function(c){var h;h=c!==r&&"object"!==typeof c?this.getLayer(c):y(new z,c);(c=x(this[0]))&&h.text!==r&&da(this[0],e,c,h,h.text.split("\n"));return h};c.fn.drawImage=function s(c){function m(m,s,k){return function(){s||((w=v.width/v.height,i.width===h&&i.sWidth===h&&(c.width=i.width=i.sWidth=v.width),i.height===h&&i.sHeight===h&&(c.height=i.height=i.sHeight=v.height),i.width===h&&i.sWidth!==h&&(i.width=i.sWidth),i.height===h&&i.sHeight!==h&&(i.height=i.sHeight),i.sWidth===
h&&i.width!==h&&(c.sWidth=i.sWidth=v.width),i.sHeight===h&&i.height!==h&&(c.sHeight=i.sHeight=v.height),i.sx===h&&(i.sx=i.cropFromCenter?v.width/2:0),i.sy===h&&(i.sy=i.cropFromCenter?v.height/2:0),i.cropFromCenter||(i.sx+=i.sWidth/2,i.sy+=i.sHeight/2),i.sx+i.sWidth/2>v.width&&(i.sx=v.width-i.sWidth/2),0>i.sx-i.sWidth/2&&(i.sx=i.sWidth/2),0>i.sy-i.sHeight/2&&(i.sy=i.sHeight/2),i.sy+i.sHeight/2>v.height&&(i.sy=v.height-i.sHeight/2),i.width!==h&&i.height===h)?c.height=i.height=i.width/w:i.width===h&&
i.height!==h?c.width=i.width=i.height*w:i.width===h&&i.height===h&&(c.width=i.width=v.width,c.height=i.height=v.height));G(s,k,i,i.width,i.height);k.drawImage(v,i.sx-i.sWidth/2,i.sy-i.sHeight/2,i.sWidth,i.sHeight,i.x-i.width/2,i.y-i.height/2,i.width,i.height);i._event?(k.beginPath(),k.rect(i.x-i.width/2,i.y-i.height/2,i.width,i.height),k.restore(),J(n[s],k,c),k.closePath()):k.restore();i.load&&i.load.call(m,c)}}var n=this,o,q,k,i=y(new z,c),v,r,w;r=i.source.getContext;i.source.src||r?(v=i.source,
i.width=v.width,i.height=v.height):i.source&&(v=new U,v.src=i.source);for(q=0;q<n.length;q+=1)if(o=n[q],k=x(n[q]))F(n[q],c,s),H(k,i),v&&(v.complete||r?m(o,q,k)():v.onload=m(o,q,k));return n};c.fn.createPattern=c.fn.pattern=function(c){function l(){k=n.createPattern(q,o.repeat);o.load&&o.load.call(m[0],k)}var m=this,n,o=y(new z,c),q,k;(n=x(m[0]))?"function"===typeof o.source?(q=Q.createElement("canvas"),q.width=o.width,q.height=o.height,c=x(q),o.source.call(q,c),l()):(c=o.source.getContext,o.source.src||
c?q=o.source:(q=new U,q.src=o.source),q.complete||c?l():q.onload=l):k=h;return k};c.fn.createGradient=c.fn.gradient=function(c){var l,c=y(new z,c),m=[],n,o,q,k,i,v,t;if(l=x(this[0])){c.x1=c.x1||0;c.y1=c.y1||0;c.x2=c.x2||0;c.y2=c.y2||0;l=c.r1!==h||c.r2!==h?l.createRadialGradient(c.x1,c.y1,c.r1,c.x2,c.y2,c.r2):l.createLinearGradient(c.x1,c.y1,c.x2,c.y2);for(k=1;c["c"+k]!==r;k+=1)c["s"+k]!==r?m.push(c["s"+k]):m.push(h);n=m.length;m[0]===h&&(m[0]=0);m[n-1]===h&&(m[n-1]=1);for(k=0;k<n;k+=1){if(m[k]!==
h){v=1;t=0;o=m[k];for(i=k+1;i<n;i+=1)if(m[i]!==h){q=m[i];break}else v+=1;o>q&&(m[i]=m[k])}else m[k]===h&&(t+=1,m[k]=o+t*((q-o)/v));l.addColorStop(m[k],c["c"+(k+1)])}}else l=h;return l};c.fn.setPixels=function l(c){var h,o,q,k=y(new z,c),i={},r,t,w,A;for(o=0;o<this.length;o+=1)if(h=this[o],q=x(h)){F(this[o],c,l);G(o,q,k,k.width,k.height);if(!k.x||!k.y||!k.width||!k.height)k.width=h.width,k.height=h.height,k.x=k.width/2,k.y=k.height/2;r=q.getImageData(k.x-k.width/2,k.y-k.height/2,k.width,k.height);
t=r.data;A=t.length;i=[];if(k.each)for(w=0;w<A;w+=4)i.r=t[w],i.g=t[w+1],i.b=t[w+2],i.a=t[w+3],k.each.call(h,i),t[w]=i.r,t[w+1]=i.g,t[w+2]=i.b,t[w+3]=i.a;q.putImageData(r,k.x-k.width/2,k.y-k.height/2);q.restore()}return this};c.fn.getCanvasImage=function(c,m){var n=this[0];return n&&n.toDataURL?n.toDataURL("image/"+c,m):h};c.support.canvas=Q.createElement("canvas").getContext!==r;E.defaults=M;c.jCanvas=E})(jQuery,document,Image,Math,parseFloat,!0,!1,null);
