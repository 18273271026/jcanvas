/*!
jCanvas v5.3b
Copyright 2012, Caleb Evans
Licensed under the MIT license
*/
(function(w,E,c,t,H,s,o,u,L,v,x){var y,N,D=w.extend,J=t.round,d=t.PI,p=t.sin,b=t.cos,k=w.event.fix,r={},n={},A,B;function C(){}function K(O){if(O){D(N,O)}else{N=C.prototype=D({},y)}return this}K.version="5.3b";K.events={};w.fn.jCanvas=K;y={angle:0,align:"center",baseline:"middle",ccw:L,closed:L,compositing:"source-over",cornerRadius:0,cropFromCenter:u,each:v,end:360,fillStyle:"transparent",font:"12pt sans-serif",fromCenter:u,height:v,inDegrees:u,load:v,mask:L,opacity:1,projection:0,r1:v,r2:v,radius:0,repeat:"repeat",rounded:L,scaleX:1,scaleY:1,shadowBlur:3,shadowColor:"transparent",shadowX:0,shadowY:0,sHeight:0,sides:3,source:"",start:0,strokeCap:"butt",strokeJoin:"miter",strokeStyle:"transparent",strokeWidth:1,sWidth:0,sx:v,sy:v,text:"",visible:u,width:v,x:0,x1:0,x2:0,y:0,y1:0,y2:0};K();function a(O,P){O.fillStyle=P.fillStyle;O.strokeStyle=P.strokeStyle;O.lineWidth=P.strokeWidth;if(P.rounded){O.lineCap="round";O.lineJoin="round"}else{O.lineCap=P.strokeCap;O.lineJoin=P.strokeJoin}O.shadowOffsetX=P.shadowX;O.shadowOffsetY=P.shadowY;O.shadowBlur=P.shadowBlur;O.shadowColor=P.shadowColor;O.globalAlpha=P.opacity;O.globalCompositeOperation=P.compositing}r.x=[];r.y=[];function z(O){K.events[O]=function(P){P.unbind(O+".jCanvas").bind(O+".jCanvas",function(Q){r.x[0]=Q.offsetX;r.y[0]=Q.offsetY;r.type=Q.type;P.drawLayers()})}}z("click");z("dblclick");z("mousedown");z("mouseup");z("mousemove");K.events.mouseover=K.events.mouseout=function(O){O.unbind("mousemove.jCanvasHover").bind("mousemove.jCanvasHover",function(P){r.x[1]=r.x[0];r.y[1]=r.y[0];r.x[0]=P.offsetX;r.y[0]=P.offsetY;r.type="hover";O.drawLayers()})};function e(O){O.mouseX=r.x[0];O.mouseY=r.y[0];r.x[0]=x;r.y[0]=x}function I(R,O,Q){var T=Q[r.type],S=O.isPointInPath(r.x[0],r.y[0]),P=O.isPointInPath(r.x[1],r.y[1]);if(r.type==="hover"&&S&&!Q.fired){Q.fired=u;e(Q);if(Q.mouseover){Q.mouseover.call(R,Q);a(O,Q)}}else{if(r.type==="hover"&&!S&&P&&Q.fired){Q.fired=L;e(Q);if(Q.mouseout){Q.mouseout.call(R,Q);a(O,Q)}}else{if(r.type!=="hover"&&T&&S){e(Q);T.call(R,Q);a(O,Q)}}}}function i(O){return(O.getContext?O.getContext("2d"):v)}function q(O,P){if(P.mask){O.save();O.clip()}if(P.closed){O.closePath();O.fill();O.stroke()}else{O.fill();O.stroke();O.closePath()}}function g(P,R,Q,O){R.toRad=(R.inDegrees?d/180:1);P.save();if(!R.fromCenter){R.x+=Q/2;R.y+=O/2}if(R.angle){P.translate(R.x,R.y);P.rotate(R.angle*R.toRad);P.translate(-R.x,-R.y)}}function m(O){O=O||{};y=D(y,O.props);K();if(O.name){w.fn[O.name]=function(Q){var U=this,R,S,P,T=D(new C(),Q);for(S=0;S<U.length;S+=1){R=U[S];P=i(R);if(P){a(P,T);O.fn.call(R,P,T)}}return U}}return w.fn[O.name]}w.fn.loadCanvas=function(){return i(this[0])};w.fn.getCanvasImage=function(O){var P=this[0];if(!P||!P.toDataURL){return v}if(O===x){O="image/png"}else{O=O.replace(/^([a-z]+)$/gi,"image/$1").replace(/jpg/gi,"jpeg")}return P.toDataURL(O)};w.fn.draw=function(R){var Q=this,O,P;for(P=0;P<Q.length;P+=1){O=i(Q[P]);if(O){R.call(Q[P],O)}}return Q};w.fn.gradient=function(W){var O=this,aa,T=D(new C(),W),Y,Z=[],V,Q,S,U,X,R,P;aa=i(O[0]);if(aa){if(T.c2===x){Y=T.c1}else{if(T.r1!==v||T.r2!==v){Y=aa.createRadialGradient(T.x1,T.y1,T.r1,T.x2,T.y2,T.r2)}else{Y=aa.createLinearGradient(T.x1,T.y1,T.x2,T.y2)}for(U=1;T["c"+U]!==x;U+=1){if(T["s"+U]!==x){Z.push(T["s"+U])}else{Z.push(v)}}V=Z.length;if(Z[0]===v){Z[0]=0}if(Z[V-1]===v){Z[V-1]=1}for(U=0;U<V;U+=1){if(Z[U]!==v&&Z[U]!==1){X=U+1;R=1;P=0;Q=Z[U];for(X=(U+1);X<V;X+=1){if(Z[X]!==v){S=Z[X];break}else{R+=1}}if(Q>S){Z[X]=Z[U]}}else{if(Z[U]===v){P+=1;Z[U]=Q+(P*((S-Q)/R))}}Y.addColorStop(Z[U],T["c"+(U+1)])}}}else{Y=v}return Y};w.fn.pattern=function(U){var O=this,W,Q=D(new C(),U),R,T;function S(){var X=L;if(R.complete){T=W.createPattern(R,Q.repeat);X=u}return X}function V(){if(Q.load){Q.load.call(O[0],T)}}function P(){S();V()}W=i(O[0]);if(W){R=new H();if(Q.source.src){R=Q.source}else{R.src=Q.source}if(!R.complete&&Q.load){R.onload=P}else{if(!S()){R.onload=P}else{V()}}}else{T=v}return T};w.fn.clearCanvas=function(P){var S=this,Q,O,R=D(new C(),P);for(Q=0;Q<S.length;Q+=1){O=i(S[Q]);if(O){g(O,R,R.width,R.height);if(!R.width&&!R.height){O.clearRect(0,0,S[Q].width,S[Q].height)}else{O.clearRect(R.x-R.width/2,R.y-R.height/2,R.width,R.height)}}}return S};w.fn.saveCanvas=function(){var Q=this,O,P;for(P=0;P<Q.length;P+=1){O=i(Q[P]);if(O){O.save()}}return Q};w.fn.restoreCanvas=function(){var Q=this,O,P;for(P=0;P<Q.length;P+=1){O=i(Q[P]);if(O){O.restore()}}return Q};w.fn.scaleCanvas=function(P){var S=this,Q,O,R=D(new C(),P);for(Q=0;Q<S.length;Q+=1){O=i(S[Q]);if(O){O.save();O.translate(R.x,R.y);O.scale(R.scaleX,R.scaleY);O.translate(-R.x,-R.y)}}return S};w.fn.translateCanvas=function(P){var S=this,Q,O,R=D(new C(),P);for(Q=0;Q<S.length;Q+=1){O=i(S[Q]);if(O){O.save();O.translate(R.x,R.y)}}return S};w.fn.rotateCanvas=function(P){var S=this,Q,O,R=D(new C(),P);for(Q=0;Q<S.length;Q+=1){O=i(S[Q]);if(O){g(O,R,0,0)}}return S};w.fn.drawRect=function(U){var P=this,T,X,S=D(new C(),U),R,W,Q,V,O;for(T=0;T<P.length;T+=1){X=i(P[T]);if(X){a(X,S);g(X,S,S.width,S.height);X.beginPath();if(S.cornerRadius){S.closed=u;R=S.x-S.width/2;W=S.y-S.height/2;Q=S.x+S.width/2;V=S.y+S.height/2;O=S.cornerRadius;if((Q-R)-(2*O)<0){O=(Q-R)/2}if((V-W)-(2*O)<0){O=(V-W)/2}X.moveTo(R+O,W);X.lineTo(Q-O,W);X.arc(Q-O,W+O,O,3*d/2,d*2,L);X.lineTo(Q,V-O);X.arc(Q-O,V-O,O,0,d/2,L);X.lineTo(R+O,V);X.arc(R+O,V-O,O,d/2,d,L);X.lineTo(R,W+O);X.arc(R+O,W+O,O,d,3*d/2,L)}else{X.rect(S.x-S.width/2,S.y-S.height/2,S.width,S.height)}X.restore();if(S.event){I(P[T],X,U)}q(X,S)}}return P};w.fn.drawArc=function(P){var S=this,Q,O,R=D(new C(),P);if(!R.inDegrees&&R.end===360){R.end=d*2}for(Q=0;Q<S.length;Q+=1){O=i(S[Q]);if(O){a(O,R);g(O,R,R.radius*2,R.radius*2);O.beginPath();O.arc(R.x,R.y,R.radius,(R.start*R.toRad)-(d/2),(R.end*R.toRad)-(d/2),R.ccw);O.restore();if(R.event){I(S[Q],O,P)}q(O,R)}}return S};w.fn.drawEllipse=function(P){var T=this,R,O,S=D(new C(),P),Q=S.width*4/3;for(R=0;R<T.length;R+=1){O=i(T[R]);if(O){a(O,S);g(O,S,S.width,S.height);O.beginPath();O.moveTo(S.x,S.y-S.height/2);O.bezierCurveTo(S.x-Q/2,S.y-S.height/2,S.x-Q/2,S.y+S.height/2,S.x,S.y+S.height/2);O.bezierCurveTo(S.x+Q/2,S.y+S.height/2,S.x+Q/2,S.y-S.height/2,S.x,S.y-S.height/2);O.restore();if(S.event){I(T[R],O,P)}q(O,S)}}return T};w.fn.drawLine=function(Q){var V=this,T,P,U=D(new C(),Q),O=2,S=0,R=0;for(T=0;T<V.length;T+=1){P=i(V[T]);if(P){a(P,U);P.beginPath();P.moveTo(U.x1,U.y1);while(u){S=U["x"+O];R=U["y"+O];if(S!==x&&R!==x){P.lineTo(S,R);O+=1}else{break}}if(U.event){I(V[T],P,Q)}q(P,U)}}return V};w.fn.drawQuad=function(U){var O=this,T,X,S=D(new C(),U),R=2,Q=0,P=0,W=0,V=0;for(T=0;T<O.length;T+=1){X=i(O[T]);if(X){a(X,S);X.beginPath();X.moveTo(S.x1,S.y1);while(u){Q=S["x"+R];P=S["y"+R];W=S["cx"+(R-1)];V=S["cy"+(R-1)];if(Q!==x&&P!==x&&W!==x&&V!==x){X.quadraticCurveTo(W,V,Q,P);R+=1}else{break}}if(S.event){I(O[T],X,U)}q(X,S)}}return O};w.fn.drawBezier=function(Z){var O=this,Y,aa,V=D(new C(),Z),U=2,R=1,T=0,S=0,X=0,Q=0,W=0,P=0;for(Y=0;Y<O.length;Y+=1){aa=i(O[Y]);if(aa){a(aa,V);aa.beginPath();aa.moveTo(V.x1,V.y1);while(u){T=V["x"+U];S=V["y"+U];X=V["cx"+R];Q=V["cy"+R];W=V["cx"+(R+1)];P=V["cy"+(R+1)];if(T!==x&&S!==x&&X!==x&&Q!==x&&W!==x&&P!==x){aa.bezierCurveTo(X,Q,W,P,T,S);U+=1;R+=2}else{break}}if(V.event){I(O[Y],aa,Z)}q(aa,V)}}return O};function F(R,O,S){var P,Q;S.width=O.measureText(S.text).width;if(n.font===S.font){S.height=n.height}else{P=R.style.fontSize;Q=S.font.match(/\d+/gi);if(Q){R.style.fontSize=(S.font.match(/(\d*\.?\d*)\w+/gi)||w.css(R,"fontSize"))[0]}S.height=s(w.css(R,"fontSize"));R.style.fontSize=P}}w.fn.drawText=function(Q){var T=this,P,R,O,S=D(new C(),Q);for(R=0;R<T.length;R+=1){P=w(T[R]);O=i(P[0]);if(O){a(O,S);O.textBaseline=S.baseline;O.textAlign=S.align;O.font=S.font;F(P[0],O,S);g(O,S,S.width,S.height);O.strokeText(S.text,S.x,S.y);O.fillText(S.text,S.x,S.y);if(S.event){O.beginPath();O.rect(S.x-S.width/2,S.y-S.height/2,S.width,S.height);O.restore();I(T[R],O,Q);O.closePath()}else{O.restore()}}}n=S;return T};w.fn.drawImage=function(V){var O=this,Y,Q,U,S=D(new C(),V),T,P;V=V||{};if(S.source.src){T=S.source}else{if(S.source){T=new H();T.src=S.source}}function W(Z){if(T.complete===x||T.complete===u){P=T.width/T.height;S.sWidth=S.sWidth||T.width;S.sHeight=S.sHeight||T.height;if(S.sWidth>T.width){S.sWidth=T.width}if(S.sHeight>T.height){S.sHeight=T.height}if(S.width===v&&S.sWidth!==T.width){S.width=S.sWidth}if(S.height===v&&S.sHeight!==T.height){S.height=S.sHeight}if(S.sx===v){if(S.cropFromCenter){S.sx=T.width/2}else{S.sx=0}}if(S.sy===v){if(S.cropFromCenter){S.sy=T.height/2}else{S.sy=0}}if(!S.cropFromCenter){S.sx+=S.sWidth/2;S.sy+=S.sHeight/2}if((S.sx+S.sWidth/2)>T.width){S.sx=T.width-S.sWidth/2}if((S.sx-S.sWidth/2)<0){S.sx=S.sWidth/2}if((S.sy-S.sHeight/2)<0){S.sy=S.sHeight/2}if((S.sy+S.sHeight/2)>T.height){S.sy=T.height-S.sHeight/2}if(S.width!==v&&S.height===v){V.height=S.height=S.width/P}else{if(S.width===v&&S.height!==v){V.width=S.width=S.height*P}else{if(S.width===v&&S.height===v){V.width=S.width=T.width;V.height=S.height=T.height}}}g(Z,S,S.width,S.height);Z.drawImage(T,S.sx-S.sWidth/2,S.sy-S.sHeight/2,S.sWidth,S.sHeight,S.x-S.width/2,S.y-S.height/2,S.width,S.height);if(S.event){Z.fillStyle="#000";Z.beginPath();Z.rect(S.x-S.width/2,S.y-S.height/2,S.width,S.height);Z.restore();I(O[U],Z,V);Z.closePath()}else{Z.restore()}return u}}function X(){if(S.load){S.load.call(Q)}}function R(){W(Y);X()}for(U=0;U<O.length;U+=1){Q=O[U];Y=i(O[U]);if(Y){a(Y,S);if(!T.complete&&S.load){T.onload=R}else{if(!W(Y)){T.onload=R}else{X()}}}}return O};w.fn.drawPolygon=function(V){var O=this,U,aa,S=D(new C(),V),ab=d/S.sides,R=(d/2)+ab,Z=(d*2)/S.sides,Y=b(Z/2)*S.radius,Q,X,P,W,T;S.closed=u;if(S.sides>2){for(U=0;U<O.length;U+=1){aa=i(O[U]);if(aa){a(aa,S);g(aa,S,S.radius,S.radius);aa.beginPath();for(T=0;T<S.sides;T+=1){Q=S.x+J(S.radius*b(R));X=S.y+J(S.radius*p(R));if(T===0){aa.moveTo(Q,X)}else{aa.lineTo(Q,X)}if(S.projection){P=S.x+J((Y+Y*S.projection)*b(R+ab));W=S.y+J((Y+Y*S.projection)*p(R+ab));aa.lineTo(P,W)}R+=Z}aa.restore();if(S.event){I(O[U],aa,V)}q(aa,S)}}}return O};w.fn.setPixels=function(W){var O=this,Y,Q,V,T,R=D(new C(),W),P,S,U,X={};for(V=0;V<O.length;V+=1){Q=O[V];Y=i(O[V]);if(Y){if(!R.x&&!R.y&&!R.width&&!R.height){R.width=Q.width;R.height=Q.height;R.x=R.width/2;R.y=R.height/2}g(Y,R,R.width,R.height);P=Y.getImageData(R.x-R.width/2,R.y-R.height/2,R.width,R.height);S=P.data;U=S.length;X=[];if(R.each!==v){for(T=0;T<U;T+=4){X.index=T/4;X.r=S[T];X.g=S[T+1];X.b=S[T+2];X.a=S[T+3];R.each.call(Q,X);S[T]=X.r;S[T+1]=X.g;S[T+2]=X.b;S[T+3]=X.a}}Y.putImageData(P,R.x-R.width/2,R.y-R.height/2);Y.restore()}}return O};function f(P,Q){var O;for(O=0;O<P.length;O+=1){Q[P[O]]=Q["_"+P[O]]}}function h(P,Q){var O;for(O=0;O<P.length;O+=1){Q["_"+P[O]]=Q[P[O]]}}A=["width","height","opacity"];B=["backgroundColor","color","borderColor","borderTopColor","borderRightColor","borderBottomColor","borderLeftColor","fillStyle","strokeStyle","shadowColor"];function j(P){var S,R,Q=[],O=1;if(typeof P==="object"){Q=P}else{if(P.match(/^[a-z]+$/gi)){if(P==="transparent"){P="rgba(255,255,255,0)"}R=c.documentElement;S=R.style.color;R.style.color=P;P=w.css(R,"color");R.style.color=S}if(P.match(/^\#/gi)){if(P.length===4){P=P.replace(/([0-9a-f])/gi,"$1$1")}Q=P.match(/[0-9a-f]{2}/gi);Q[0]=o(Q[0],16);Q[1]=o(Q[1],16);Q[2]=o(Q[2],16)}else{if(P.match(/^rgb/gi)){Q=P.match(/[0-9\.]+/gi);if(P.match(/\%/gi)){O=2.55}Q[0]=Q[0]*O;Q[1]=Q[1]*O;Q[2]=Q[2]*O}}if(P.match("rgba")){Q[3]=s(Q[3])}else{Q[3]=1}}return Q}function M(P,O){P.now[O]=P.start[O]+(P.end[O]-P.start[O])*P.pos;if(O<3){P.now[O]=J(P.now[O])}}function G(O){if(typeof O.start!=="object"){O.start=j(O.start);O.end=j(O.end)}O.now=[];M(O,0);M(O,1);M(O,2);M(O,3);O.now="rgba("+O.now.join(",")+")";if(O.elem.style){O.elem.style[O.prop]=O.now}else{O.elem[O.prop]=O.now}}function l(O){var P;for(P=0;P<O.length;P+=1){if(!w.fx.step[O[P]]){w.fx.step[O[P]]=G}}}w.fn.getLayers=function(){var O=this[0],P;if(!O||!O.getContext){P=v}else{P=w.data(O,"jCanvas-layers");if(!P){P=[];w.data(O,"jCanvas-layers",P)}}return P};w.fn.getLayer=function(O){var R=this.getLayers(),Q,P;if(!R){Q=v}else{if(typeof O==="string"){for(P=0;P<R.length;P+=1){if(R[P].name===O){O=P;break}}}}O=O||0;Q=R[O];return Q};w.fn.addLayer=function(P){var U=this,O,T=D(P,new C(),D({},P)),S,Q,R;T.layer=u;for(R=0;R<U.length;R+=1){O=w(U[R]);if(i(U[R])){S=O.getLayers();if(typeof T==="function"){T.method="draw"}else{if(T.method!=="drawImage"){T.width=T.width||0;T.height=T.height||0}for(Q in K.events){if(K.events.hasOwnProperty(Q)&&T[Q]){K.events[Q].call(E,O);T.event=u}}}S.push(T)}}U.drawLayers();return U};w.fn.removeLayers=function(){var Q=this,P,O;for(O=0;O<Q.length;O+=1){P=w(Q[O]).getLayers()||[];P.length=0}return this};w.fn.removeLayer=function(O){var T=this,S,Q=typeof O,R,P;for(S=0;S<T.length;S+=1){R=w(T[S]).getLayers()||[];if(Q==="string"){for(P=0;P<R.length;P+=1){if(R[P].name===O){R.splice(P,1);break}}}else{if(Q==="number"){R.splice(O,1)}}}return this};w.fn.drawLayers=function(){var U=this,P,O,T,S,R,Q;for(R=0;R<U.length;R+=1){P=w(U[R]);O=i(P[0]);if(O){S=P.getLayers();O.clearRect(0,0,P[0].width,P[0].height);for(Q=0;Q<S.length;Q+=1){T=S[Q];if(T.visible){if(T.method==="draw"){T.call(P[0],O)}else{if(w.fn[T.method]){w.fn[T.method].call(P,T)}}}}}}return U};w.fn.animateLayer=function(){var U=this,P,T,Q=([]).slice.call(arguments,0),R;if(typeof Q[0]==="object"&&!Q[0].layer){Q.unshift(0)}if(Q[2]===x){Q.splice(2,0,v);Q.splice(3,0,v);Q.splice(4,0,function(){})}else{if(typeof Q[2]==="function"){Q.splice(2,0,v);Q.splice(3,0,v)}}if(Q[3]===x){Q[3]=v;Q.splice(4,0,function(){})}else{if(typeof Q[3]==="function"){Q.splice(3,0,v)}}if(Q[4]===x){Q[4]=function(){}}function O(V,W){return function(){f(A,W);V.drawLayers();Q[4].call(V[0])}}function S(V,W){return function(){f(A,W);V.drawLayers()}}for(T=0;T<U.length;T+=1){P=w(U[T]);if(i(U[T])){if(Q[0].layer){R=Q[0]}else{R=P.getLayer(Q[0])}if(R&&R.method!=="draw"){h(A,R);h(A,Q[1]);w(R).animate(Q[1],{duration:Q[2],easing:(w.easing[Q[3]]?Q[3]:v),complete:O(P,R),step:S(P,R)})}}}return U};w.event.fix=function(O){var P;O=k.call(w.event,O);if(O.pageX!==x&&O.offsetX===x){P=w(O.target).offset();if(P){O.offsetX=O.pageX-P.left;O.offsetY=O.pageY-P.top}}return O};l(B);w.support.canvas=(c.createElement("canvas").getContext!==x);K.defaults=y;K.prefs=N;K.extend=m;w.jCanvas=K}(jQuery,window,document,Math,Image,parseFloat,parseInt,true,false,null));