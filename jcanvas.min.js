/*!
jCanvas v5.2b
Copyright 2012, Caleb Evans
Licensed under the MIT license
*/
(function(x,e,t,F,s,n,u,J,w,p){var y,L,v=x.fn,D=x.extend,H=t.round,r=t.PI,o=t.sin,d=t.cos,k=x.event.fix,a={},A,B;function I(M){if(!M){L=C.prototype=D({},y)}else{D(L,M)}return this}I.version="5.2b";y={align:"center",angle:0,baseline:"middle",ccw:J,closed:J,compositing:"source-over",cornerRadius:0,cropFromCenter:u,end:360,fillStyle:"transparent",font:"12pt sans-serif",fromCenter:u,height:0,inDegrees:u,load:w,mask:J,opacity:1,projection:0,r1:w,r2:w,radius:0,repeat:"repeat",rounded:J,scaleX:1,scaleY:1,shadowBlur:3,shadowColor:"transparent",shadowX:0,shadowY:0,sHeight:0,sides:3,source:"",start:0,strokeCap:"butt",strokeJoin:"miter",strokeStyle:"transparent",strokeWidth:1,sWidth:0,sx:w,sy:w,text:"",width:0,x:0,x1:0,x2:0,y:0,y1:0,y2:0};function C(){}L=C.prototype;I();I.events={};function z(M){I.events[M]=function(N){N.off(M+".jcanvas").on(M+".jcanvas",function(O){a.x=O.offsetX;a.y=O.offsetY;a.type=O.type;N.drawLayers()})}}z("click");z("dblclick");z("mousedown");z("mouseup");z("mousemove");function G(M,N){var O=N[a.type];if(O&&M.isPointInPath(a.x,a.y)===true){N.mouseX=a.x;N.mouseY=a.y;O.call(this,N);c(M,N)}}function i(M){return M.getContext?M.getContext("2d"):w}function c(M,N){M.fillStyle=N.fillStyle;M.strokeStyle=N.strokeStyle;M.lineWidth=N.strokeWidth;if(N.rounded){M.lineCap="round";M.lineJoin="round"}else{M.lineCap=N.strokeCap;M.lineJoin=N.strokeJoin}M.shadowOffsetX=N.shadowX;M.shadowOffsetY=N.shadowY;M.shadowBlur=N.shadowBlur;M.shadowColor=N.shadowColor;M.globalAlpha=N.opacity;M.globalCompositeOperation=N.compositing}function q(M,N){if(N.mask){M.save();M.clip()}if(N.closed){M.closePath();M.fill();M.stroke()}else{M.fill();M.stroke();M.closePath()}}function b(M){return M.inDegrees?r/180:1}function g(N,P,O,M){P.toRad=b(P);N.save();if(!P.fromCenter){P.x+=O/2;P.y+=M/2}if(P.angle){N.translate(P.x,P.y);N.rotate(P.angle*P.toRad);N.translate(-P.x,-P.y)}}function m(M){M=M||{};y=D(y,M.props||{});x.jCanvas();if(M.name){x.fn[M.name]=function(O){var S=this,P,N,Q,R=D(new C(),O);for(Q=0;Q<S.length;Q+=1){P=S[Q];if(!P.getContext){continue}N=P.getContext("2d");c(N,R);R.toRad=b(R);M.fn.call(P,N,R)}return S}}return x.fn[M.name]}x.fn.jCanvas=I;x.fn.loadCanvas=function(){return i(this[0])};x.fn.getCanvasImage=function(M){var N=this;if(!N[0].toDataURL){return w}if(M===p){M="image/png"}else{M=M.replace(/^([a-z]+)$/gi,"image/$1").replace(/jpg/gi,"jpeg")}return N[0].toDataURL(M)};x.fn.draw=function(P){var O=this,M,N;for(N=0;N<O.length;N+=1){if(!(M=i(O[N]))){continue}P.call(O[N],M)}return O};x.fn.gradient=function(N){var T=this,M,S=D(new C(),N),R,Q,P=0,O=1;if(!(M=i(T[0]))){return w}if(S.r1!=w||S.r2!=w){R=M.createRadialGradient(S.x1,S.y1,S.r1,S.x2,S.y2,S.r2)}else{R=M.createLinearGradient(S.x1,S.y1,S.x2,S.y2)}while(S["c"+O]!==p){P+=1;O+=1}for(O=1;O<=P;O+=1){Q=H(100/(P-1)*(O-1))/100;if(S["s"+O]===p){S["s"+O]=Q}R.addColorStop(S["s"+O],S["c"+O])}return R};x.fn.pattern=function(S){var M=this,U,O,P,R;if(!M[0].getContext){return w}U=M[0].getContext("2d");O=D(new C(),S);P=new F();if(O.source.src){P=O.source}else{P.src=O.source}function Q(){if(P.complete){R=U.createPattern(P,O.repeat);return u}else{return J}}function T(){if(O.load){O.load.call(M[0],R)}}function N(){Q();T()}if(!P.complete&&O.load){P.onload=N}else{if(!Q()){P.onload=N}else{T()}}return R};x.fn.clearCanvas=function(N){var Q=this,M,O,P=D(new C(),N);for(O=0;O<Q.length;O+=1){if(!(M=i(Q[O]))){continue}g(M,P,P.width,P.height);if(!P.width&&!P.height){M.clearRect(0,0,Q[O].width,Q[O].height)}else{M.clearRect(P.x-P.width/2,P.y-P.height/2,P.width,P.height)}}return Q};x.fn.saveCanvas=function(){var O=this,M,N;for(N=0;N<O.length;N+=1){if(!(M=i(O[N]))){continue}M.save()}return O};x.fn.restoreCanvas=function(){var O=this,M,N;for(N=0;N<O.length;N+=1){if(!(M=i(O[N]))){continue}M.restore()}return O};x.fn.scaleCanvas=function(N){var Q=this,M,O,P=D(new C(),N);for(O=0;O<Q.length;O+=1){if(!(M=i(Q[O]))){continue}M.save();M.translate(P.x,P.y);M.scale(P.scaleX,P.scaleY);M.translate(-P.x,-P.y)}return Q};x.fn.translateCanvas=function(N){var Q=this,M,O,P=D(new C(),N);for(O=0;O<Q.length;O+=1){if(!(M=i(Q[O]))){continue}M.save();M.translate(P.x,P.y)}return Q};x.fn.rotateCanvas=function(N){var Q=this,M,O,P=D(new C(),N);for(O=0;O<Q.length;O+=1){if(!(M=i(Q[O]))){continue}g(M,P,0,0)}return Q};x.fn.drawRect=function(S){var N=this,V,R,Q=D(new C(),S),P,U,O,T,M;for(R=0;R<N.length;R+=1){if(!(V=i(N[R]))){continue}c(V,Q);g(V,Q,Q.width,Q.height);V.beginPath();if(Q.cornerRadius){Q.closed=u;P=Q.x-Q.width/2;U=Q.y-Q.height/2;O=Q.x+Q.width/2;T=Q.y+Q.height/2;M=Q.cornerRadius;if((O-P)-(2*M)<0){M=(O-P)/2}if((T-U)-(2*M)<0){M=(T-U)/2}V.moveTo(P+M,U);V.lineTo(O-M,U);V.arc(O-M,U+M,M,3*r/2,r*2,J);V.lineTo(O,T-M);V.arc(O-M,T-M,M,0,r/2,J);V.lineTo(P+M,T);V.arc(P+M,T-M,M,r/2,r,J);V.lineTo(P,U+M);V.arc(P+M,U+M,M,r,3*r/2,J)}else{V.rect(Q.x-Q.width/2,Q.y-Q.height/2,Q.width,Q.height)}V.restore();if(Q.event){G.call(N[R],V,S)}q(V,Q)}return N};x.fn.drawArc=function(N){var Q=this,M,O,P=D(new C(),N);if(!P.inDegrees&&P.end===360){P.end=r*2}for(O=0;O<Q.length;O+=1){if(!(M=i(Q[O]))){continue}c(M,P);g(M,P,P.radius*2,P.radius*2);M.beginPath();M.arc(P.x,P.y,P.radius,(P.start*P.toRad)-(r/2),(P.end*P.toRad)-(r/2),P.ccw);M.restore();if(P.event){G.call(Q[O],M,N)}q(M,P)}return Q};x.fn.drawEllipse=function(N){var R=this,M,P,Q=D(new C(),N),O=Q.width*4/3;for(P=0;P<R.length;P+=1){if(!(M=i(R[P]))){continue}c(M,Q);g(M,Q,Q.width,Q.height);M.beginPath();M.moveTo(Q.x,Q.y-Q.height/2);M.bezierCurveTo(Q.x-O/2,Q.y-Q.height/2,Q.x-O/2,Q.y+Q.height/2,Q.x,Q.y+Q.height/2);M.bezierCurveTo(Q.x+O/2,Q.y+Q.height/2,Q.x+O/2,Q.y-Q.height/2,Q.x,Q.y-Q.height/2);M.restore();if(Q.event){G.call(R[P],M,N)}q(M,Q)}return R};x.fn.drawLine=function(O){var T=this,N,R,S=D(new C(),O),M=2,Q=0,P=0;for(R=0;R<T.length;R+=1){if(!(N=i(T[R]))){continue}c(N,S);N.beginPath();N.moveTo(S.x1,S.y1);while(u){Q=S["x"+M];P=S["y"+M];if(Q!==p&&P!==p){N.lineTo(Q,P);M+=1}else{break}}if(S.event){G.call(T[R],N,O)}q(N,S)}return T};x.fn.drawQuad=function(S){var M=this,V,R,Q=D(new C(),S),P=2,O=0,N=0,U=0,T=0;for(R=0;R<M.length;R+=1){if(!(V=i(M[R]))){continue}c(V,Q);V.beginPath();V.moveTo(Q.x1,Q.y1);while(u){O=Q["x"+P];N=Q["y"+P];U=Q["cx"+(P-1)];T=Q["cy"+(P-1)];if(O!==p&&N!==p&&U!==p&&T!==p){V.quadraticCurveTo(U,T,O,N);P+=1}else{break}}if(Q.event){G.call(M[R],V,S)}q(V,Q)}return M};x.fn.drawBezier=function(X){var M=this,Y,W,T=D(new C(),X),S=2,P=1,R=0,Q=0,V=0,O=0,U=0,N=0;for(W=0;W<M.length;W+=1){if(!(Y=i(M[W]))){continue}c(Y,T);Y.beginPath();Y.moveTo(T.x1,T.y1);while(u){R=T["x"+S];Q=T["y"+S];V=T["cx"+P];O=T["cy"+P];U=T["cx"+(P+1)];N=T["cy"+(P+1)];if(R!==p&&Q!==p&&V!==p&&O!==p&&U!==p&&N!==p){Y.bezierCurveTo(V,O,U,N,R,Q);S+=1;P+=2}else{break}}if(T.event){G.call(M[W],Y,X)}q(Y,T)}return M};x.fn.drawText=function(N){var Q=this,M,O,P=D(new C(),N);for(O=0;O<Q.length;O+=1){if(!(M=i(Q[O]))){continue}c(M,P);M.textBaseline=P.baseline;M.textAlign=P.align;M.font=P.font;M.strokeText(P.text,P.x,P.y);M.fillText(P.text,P.x,P.y)}return Q};x.fn.drawImage=function(T){var M=this,W,O,S,Q=D(new C(),T),R=new F(),N;if(Q.source.src){R=Q.source}else{if(Q.source){R.src=Q.source}}function U(X){if(R.complete){N=(R.width/R.height);Q.sWidth=Q.sWidth||R.width;Q.sHeight=Q.sHeight||R.height;if(Q.sWidth>R.width){Q.sWidth=R.width}if(Q.sHeight>R.height){Q.sHeight=R.height}if(Q.width===0&&Q.sWidth!==R.width){Q.width=Q.sWidth}if(Q.height===0&&Q.sHeight!==R.height){Q.height=Q.sHeight}if(Q.sx==w){if(Q.cropFromCenter){Q.sx=R.width/2}else{Q.sx=0}}if(Q.sy==w){if(Q.cropFromCenter){Q.sy=R.height/2}else{Q.sy=0}}if(!Q.cropFromCenter){Q.sx+=Q.sWidth/2;Q.sy+=Q.sHeight/2}if((Q.sx+Q.sWidth/2)>R.width){Q.sx=R.width-Q.sWidth/2}if((Q.sx-Q.sWidth/2)<0){Q.sx=Q.sWidth/2}if((Q.sy-Q.sHeight/2)<0){Q.sy=Q.sHeight/2}if((Q.sy+Q.sHeight/2)>R.height){Q.sy=R.height-Q.sHeight/2}if(Q.width&&!Q.height){Q.height=Q.width/N}else{if(!Q.width&&Q.height){Q.width=Q.height*N}else{if(!Q.width&&!Q.height){Q.width=R.width;Q.height=R.height}}}g(X,Q,Q.width,Q.height);if(Q.event){X.beginPath();X.rect(Q.x-Q.width/2,Q.y-Q.height/2,Q.width,Q.height);if(Q.event){G.call(M[S],X,T)}X.closePath()}X.drawImage(R,Q.sx-Q.sWidth/2,Q.sy-Q.sHeight/2,Q.sWidth,Q.sHeight,Q.x-Q.width/2,Q.y-Q.height/2,Q.width,Q.height);X.restore();return u}else{return J}}function V(){if(Q.load){Q.load.call(O)}}function P(){U(W);V()}for(S=0;S<M.length;S+=1){O=M[S];if(!(W=i(M[S]))){continue}c(W,Q);if(!R.complete&&Q.load){R.onload=P}else{if(!U(W)){R.onload=P}else{V()}}}return M};x.fn.drawPolygon=function(T){var M=this,Y,S,Q=D(new C(),T),Z=r/Q.sides,P=(r/2)+Z,X=(r*2)/Q.sides,W=d(X/2)*Q.radius,O,V,N,U,R;Q.closed=u;if(Q.sides>2){for(S=0;S<M.length;S+=1){if(!(Y=i(M[S]))){continue}c(Y,Q);g(Y,Q,Q.radius,Q.radius);Y.beginPath();for(R=0;R<Q.sides;R+=1){O=Q.x+H(Q.radius*d(P));V=Q.y+H(Q.radius*o(P));if(R===0){Y.moveTo(O,V)}else{Y.lineTo(O,V)}if(Q.projection){N=Q.x+H((W+W*Q.projection)*d(P+Z));U=Q.y+H((W+W*Q.projection)*o(P+Z));Y.lineTo(N,U)}P+=X}Y.restore();if(Q.event){G.call(M[S],Y,T)}q(Y,Q)}}return M};x.fn.setPixels=function(U){var M=this,W,O,T,R,P=D(new C(),U),N,Q,S,V={};for(T=0;T<M.length;T+=1){O=M[T];if(!(W=i(M[T]))){continue}if(!P.x&&!P.y&&!P.width&&!P.height){P.width=O.width;P.height=O.height;P.x=P.width/2;P.y=P.height/2}g(W,P,P.width,P.height);N=W.getImageData(P.x-P.width/2,P.y-P.height/2,P.width,P.height);Q=N.data;S=Q.length;V=[];if(P.each!==p){for(R=0;R<S;R+=4){V.index=R/4;V.r=Q[R];V.g=Q[R+1];V.b=Q[R+2];V.a=Q[R+3];P.each.call(O,V);Q[R]=V.r;Q[R+1]=V.g;Q[R+2]=V.b;Q[R+3]=V.a}}W.putImageData(N,P.x-P.width/2,P.y-P.height/2);W.restore()}return M};function f(N,O){var M;for(M=0;M<N.length;M+=1){O[N[M]]=O["_"+N[M]]}}function h(N,O){var M;for(M=0;M<N.length;M+=1){O["_"+N[M]]=O[N[M]]}}A=["width","height","opacity"];B=["backgroundColor","color","borderColor","borderTopColor","borderRightColor","borderBottomColor","borderLeftColor","fillStyle","strokeStyle","shadowColor"];function j(N){var P,Q,O=[],M=1;if(typeof N==="object"){O=N}else{if(N.match(/^[a-z]+$/gi)){if(N==="transparent"){N="rgba(255,255,255,0)"}Q=e.documentElement;P=Q.style.color;Q.style.color=N;N=x.css(Q,"color");Q.style.color=P}if(N.match(/^\#/gi)){if(N.length===4){N=N.replace(/([0-9a-f])/gi,"$1$1")}O=N.match(/[0-9a-f]{2}/gi);O[0]=n(O[0],16);O[1]=n(O[1],16);O[2]=n(O[2],16)}else{if(N.match(/^rgb/gi)){O=N.match(/[0-9\.]+/gi);if(N.match(/\%/gi)){M=2.55}O[0]=O[0]*M;O[1]=O[1]*M;O[2]=O[2]*M}}if(N.match("rgba")){O[3]=s(O[3])}else{O[3]=1}}return O}function K(N,M){N.now[M]=N.start[M]+(N.end[M]-N.start[M])*N.pos;if(M<3){N.now[M]=H(N.now[M])}}function E(M){if(typeof M.start!=="object"){M.start=j(M.start);M.end=j(M.end)}M.now=[];K(M,0);K(M,1);K(M,2);K(M,3);M.now="rgba("+M.now.join(",")+")";if(M.elem.style){M.elem.style[M.prop]=M.now}else{M.elem[M.prop]=M.now}}function l(M){var N;for(N=0;N<M.length;N+=1){if(!x.fx.step[M[N]]){x.fx.step[M[N]]=E}}}x.fn.getLayers=function(){var M=this[0],N;if(!M||!M.getContext){return w}N=x.data(M,"layers");if(N===p){N=[];x.data(M,"layers",N)}return N};x.fn.getLayer=function(M){M=M||0;return this.getLayers()[M]};x.fn.addLayer=function(N){var R=this,M,P,O,Q=D(N,new C(),x.extend({},N));Q.layer=u;for(O=0;O<R.length;O+=1){M=x(R[O]);if(!i(R[O])){continue}P=M.getLayers();if(typeof Q==="function"){Q.method="draw"}P.push(Q);for(event in I.events){if(Q[event]){I.events[event].call(window,M,Q,P.length-1);Q.event=u}}}return R};x.fn.removeLayer=function(M){M=M||0;(this.getLayers()||[]).splice(M,1);return this};x.fn.drawLayers=function(){var S=this,N,M,R,Q,P,O;for(P=0;P<S.length;P+=1){N=x(S[P]);if(!(M=i(N[0]))){continue}Q=N.getLayers();M.clearRect(0,0,N[0].width,N[0].height);for(O=0;O<Q.length;O+=1){R=Q[O];if(R.method==="draw"){R.call(N[0],M)}else{if(v[R.method]){v[R.method].call(N,R)}}}}return S};x.fn.animateLayer=function(){var R=this,N=([]).slice.call(arguments,0),M,Q,O,P;if(typeof N[0]==="object"&&!N[0].method){N.unshift(0)}if(N[2]===p){N.splice(2,0,w);N.splice(3,0,w);N.splice(4,0,function(){})}else{if(typeof N[2]==="function"){N.splice(2,0,w);N.splice(3,0,w)}}if(N[3]===p){N[3]=w;N.splice(4,0,function(){})}else{if(typeof N[3]==="function"){N.splice(3,0,w)}}if(N[4]===p){N[4]=function(){}}for(P=0;P<R.length;P+=1){M=x(R[P]);if(N[0].layer){O=N[0]}else{O=M.getLayers()[N[0]]}if(!O||O.method==="draw"){continue}if(O.method==="drawImage"){N[1].width=N[1].width||1e-10;N[1].height=N[1].height||1e-10;O.width=O.width||1e-10;O.height=O.height||1e-10}O=D(O,L,x.extend({},O));h(A,O);h(A,N[1]);x(O).animate(N[1],{duration:N[2],easing:(x.easing[N[3]]?N[3]:w),complete:(function(S){return function(){f(A,O);S.drawLayers(u);N[4].call(S[0])}}(M)),step:(function(S,T){return function(){f(A,T);S.drawLayers(u)}}(M,O))})}return R};x.event.fix=function(M){M=k.call(x.event,M);if(M.pageX!=w&&M.offsetX==w){var N=x(M.target).offset();if(N){M.offsetX=M.pageX-N.left;M.offsetY=M.pageY-N.top}}return M};x.support.canvas=(e.createElement("canvas").getContext!=w);l(B);I.defaults=y;I.prefs=L;I.extend=m;x.jCanvas=I}(jQuery,document,Math,Image,parseFloat,parseInt,true,false,null));