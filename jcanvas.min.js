/*
 jCanvas
Copyright 2012, Caleb Evans
Licensed under the MIT license
*/
(function(d,R,W,P,X,q,z,h,u){function y(){}function B(c){c?w(Y,c):B.prefs=Y=y.prototype=w({},M);return this}function H(c,a){c.fillStyle=a.fillStyle;c.strokeStyle=a.strokeStyle;c.lineWidth=a.strokeWidth;a.rounded?(c.lineCap="round",c.lineJoin="round"):(c.lineCap=a.strokeCap,c.lineJoin=a.strokeJoin,c.miterLimit=a.miterLimit);c.shadowOffsetX=a.shadowX;c.shadowOffsetY=a.shadowY;c.shadowBlur=a.shadowBlur;c.shadowColor=a.shadowColor;c.globalAlpha=a.opacity;c.globalCompositeOperation=a.compositing}function x(c){return c&&
c.getContext?c.getContext("2d"):h}function I(c,a,b){b._event&&S(c,a,b);b.closed&&a.closePath();a.fill();"transparent"!==b.fillStyle&&(a.shadowColor="transparent");0!==b.strokeWidth&&a.stroke();b.closed||a.closePath();a.restore();b.mask&&(b.autosave&&(a.save(),c=F(c),c.transforms.mask=q,c.savedTransforms=w({},c.transforms)),a.clip())}function Z(c,a,b){a._toRad=a.inDegrees?C/180:1;c.translate(a.x,a.y);c.rotate(a.rotate*a._toRad);c.translate(-a.x,-a.y);b.rotate+=a.rotate*a._toRad}function $(c,a,b){1!==
a.scale&&(a.scaleX=a.scaleY=a.scale);c.translate(a.x,a.y);c.scale(a.scaleX,a.scaleY);c.translate(-a.x,-a.y);b.scaleX*=a.scaleX;b.scaleY*=a.scaleY}function aa(c,a,b){a.translate&&(a.translateX=a.translateY=a.translate);c.translate(a.translateX,a.translateY);b.translateX+=a.translateX;b.translateY+=a.translateY}function G(c,a,b,e,g,f){b._toRad=b.inDegrees?C/180:1;a.save();f===u&&(f=g);!c&&!b.fromCenter&&(b.x+=g/2,b.y+=f/2);b.rotate&&Z(a,b,{});(1!==b.scale||1!==b.scaleX||1!==b.scaleY)&&$(a,b,{});(b.translate||
b.translateX||b.translateY)&&aa(a,b,{})}function T(c){c.draggable&&(c.translateX+=c.x,c.translateY+=c.y)}function F(c){var a;D.elem===c?a=D.data:(a=d.data(c,"jCanvas"),a||(a={layers:[],intersects:[],drag:{},event:{},transforms:{rotate:0,scaleX:1,scaleY:1,translateX:0,translateY:0,mask:z}},a.savedTransforms=w({},a.transforms),d.data(c,"jCanvas",a)),D.elem=c,D.data=a);return a}function ba(c,a,b){b&&b.visible&&(b.method===d.fn.draw?b.fn.call(c[0],a):b.method&&b.method.call(c,b))}function E(c,a,b){var e,
g,f,n="function"===typeof a,A,a=a||{};if(a.layer&&!a._layer){e=d(c);g=e.getLayers();n&&(a={method:d.fn.draw,fn:a});a=w(new y,a);if(!n){a.method=d.fn[a.method]||b;A=F(c);for(f in B.events)B.events.hasOwnProperty(f)&&a[f]&&(B.events[f](e,A),a._event=q);if(a.draggable||a.cursor){a._event=q;c=["mousedown","mousemove","mouseup"];for(b=0;b<c.length;b+=1)f=c[b],B.events[f](e,A);A.mouseout||(e.bind("mouseout.jCanvas",function(){A.drag={};e.drawLayers()}),A.mouseout=q)}}a.layer=q;a._layer=q;a.index===u&&(a.index=
g.length);g.splice(a.index,0,a)}return a}function ca(c){var a;for(a=0;a<J.length;a+=1)c[J[a]]=c["_"+J[a]]}function da(c,a){var b;for(b=0;b<J.length;b+=1)c["_"+J[b]]=c[J[b]],U[J[b]]=1,a&&delete c[J[b]]}function ea(c){var a,b,e=[],g=1;c.match(/^#?\w+$/i)&&("transparent"===c&&(c="rgba(0,0,0,0)"),b=R.head,a=b.style.color,b.style.color=c,c=d.css(b,"color"),b.style.color=a);c.match(/^rgb/i)&&(e=c.match(/\d+/gi),c.match(/%/gi)&&(g=2.55),e[0]*=g,e[1]*=g,e[2]*=g,e[3]=e[3]!==u?X(e[3]):1);return e}function ga(c){var a=
3,b;"object"!==typeof c.start&&(c.start=ea(c.start),c.end=ea(c.end));c.now=[];if(1!==c.start[3]||1!==c.end[3])a=4;for(b=0;b<a;b+=1)c.now[b]=c.start[b]+(c.end[b]-c.start[b])*c.pos,3>b&&(c.now[b]=N(c.now[b]));1!==c.start[3]||1!==c.end[3]?c.now="rgba("+c.now.join(",")+")":(c.now.slice(0,3),c.now="rgb("+c.now.join(",")+")");c.elem.nodeName?c.elem.style[c.prop]=c.now:c.elem[c.prop]=c.now}function L(c){B.events[c]=function(a,b){var e="mouseover"===c||"mouseout"===c?"mousemove":c,g=b.event;b[e]||(a.bind(e+
".jCanvas",function(b){g.x=b.offsetX;g.y=b.offsetY;g.type=e;a.drawLayers(q);b.preventDefault()}),b[e]=q)}}function S(c,a,b){var c=F(c),e=c.event,a=a.isPointInPath(e.x,e.y),g=c.transforms,f,n;b.mouseX=e.x;b.mouseY=e.y;n=c.transforms.rotate;e=b.mouseX;f=b.mouseY;b._mouseX=e*O(-n)-f*Q(-n);b._mouseY=f*O(-n)+e*Q(-n);b._mouseX/=g.scaleX;b._mouseY/=g.scaleY;!a&&(b._hovered&&!b._fired)&&(b._mousedout=q);a&&c.intersects.push(b)}function fa(c,a,b,e,g){var f=/\b(\d*\.?\d*)\w\w\b/gi,n;if(D.text===e.text&&D.font===
e.font&&D.maxWidth===e.maxWidth&&D.lineHeight===e.lineHeight)e.width=D.width,e.height=D.height;else if(!a){e.width=b.measureText(g[0]).width;for(a=1;a<g.length;a+=1)n=b.measureText(g[a]).width,n>e.width&&(e.width=n);b=c.style.fontSize;if(a=e.font.match(f))c.style.fontSize=e.font.match(f)[0];e.height=X(d.css(c,"fontSize"))*g.length*e.lineHeight;c.style.fontSize=b}}var M,Y,w=d.extend,N=P.round,C=P.PI,Q=P.sin,O=P.cos,ha=d.event.fix,D={},J,U;d.fn.jCanvas=B;B.events={};M={align:"center",autosave:q,baseline:"middle",
bringToFront:z,ccw:z,closed:z,compositing:"source-over",cornerRadius:0,cropFromCenter:q,draggable:z,disableDrag:z,disableEvents:z,each:h,end:360,fillStyle:"transparent",font:"12pt sans-serif",fromCenter:q,height:h,inDegrees:q,lineHeight:1,load:h,mask:z,maxWidth:h,method:h,miterLimit:10,opacity:1,projection:0,r1:h,r2:h,radius:0,repeat:"repeat",rotate:0,rounded:z,scale:1,scaleX:1,scaleY:1,shadowBlur:0,shadowColor:"transparent",shadowX:0,shadowY:0,sHeight:h,sides:3,source:"",start:0,strokeCap:"butt",
strokeJoin:"miter",strokeStyle:"transparent",strokeWidth:1,sWidth:h,sx:h,sy:h,text:"",translate:0,translateX:0,translateY:0,visible:q,width:h,x:0,y:0};B();B.extend=function(c){B.defaults=M=w(M,c.props);B();c.name&&(d.fn[c.name]=function b(e){var g,f,n,d=w(new y,e);for(f=0;f<this.length;f+=1)if(g=this[f],n=x(g))e=E(g,e,b),H(n,d),c.fn.call(g,n,e);return this});return d.fn[c.name]};d.fn.getLayers=function(){var c=this[0];return!c||!c.getContext?[]:F(c).layers};d.fn.getLayer=function(c){var a=this.getLayers(),
b=d.type(c),e,g;if(c&&c.layer)e=c;else if("number"===b)e=a[c];else for(g=0;g<a.length;g+=1)if(a[g].index=g,a[g].name===c||"regexp"===b&&a[g].name.match(c)){e=a[g];break}return e};d.fn.setLayer=function(c,a){var b,e;for(b=0;b<this.length;b+=1)(e=d(this[b]).getLayer(c))&&w(e,a);return this};d.fn.moveLayer=function(c,a){var b,e,g;for(e=0;e<this.length;e+=1)if(b=d(this[e]),g=b.getLayers(),b=b.getLayer(c))g.splice(b.index,1),g.splice(a,0,b),b.index=a;return this};d.fn.removeLayer=function(c){var a,b,e;
for(b=0;b<this.length;b+=1)a=d(this[b]),e=a.getLayers(),(a=a.getLayer(c))&&e.splice(a.index,1);return this};d.fn.removeLayers=function(){var c,a;for(c=0;c<this.length;c+=1)a=d(this[c]).getLayers(),a.length=0;return this};d.fn.getLayerGroup=function(c){var a=this.getLayers(),b=d.type(c),e=[],g;if("array"===b)return c;for(g=0;g<a.length;g+=1)a[g].index=g,(a[g].group===c||"regexp"===b&&a[g].group.match(c))&&e.push(a[g]);return e};d.fn.setLayerGroup=function(c,a){var b,e,g;for(e=0;e<this.length;e+=1){b=
d(this[e]);b=b.getLayerGroup(c);for(g=0;g<b.length;g+=1)w(b[g],a)}return this};d.fn.removeLayerGroup=function(c){var a,b,e=d.type(c),g;if(c!==u)for(b=0;b<this.length;b+=1){a=d(this[b]);a=a.getLayers();for(g=0;g<a.length;g+=1)if(a[g].index=g,a[g].group===c||"regexp"===e&&a[g].group.match(c))a.splice(g,1),g-=1}return this};d.fn.drawLayer=function(c){var a,b,e,g;for(a=0;a<this.length;a+=1)e=d(this[a]),b=x(this[a]),g=e.getLayer(c),ba(e,b,g);return this};d.fn.drawLayers=function(c){var a,b,e,g,f,n,A,s;
for(b=0;b<this.length;b+=1)if(a=d(this[b]),e=x(this[b])){F(this[b]);a.clearCanvas();D.elem===this[b]?A=D.data:(A=F(this[b]),D.elem=this[b],D.data=A);g=A.layers;for(n=0;n<g.length;n+=1)if(f=g[n],f.index=n,c&&(f._fired=z),f._event=!f.disableEvents,ba(a,e,f),f._mousedout)f._mousedout=z,f._fired=q,f._hovered=z,f.mouseout&&f.mouseout.call(this[b],f),f.cursor&&f._cursor&&a.css({cursor:f._cursor});f=A.intersects[A.intersects.length-1]||{};e=A.event;e=e.type;s=f[e];n=A.drag;if(f._event){if((f.mouseover||
f.mouseout||f.cursor)&&!f._hovered&&!f._fired)f._fired=q,f._hovered=q,f.mouseover&&f.mouseover.call(this[b],f),f.cursor&&(f._cursor=a.css("cursor"),a.css({cursor:f.cursor}));s&&!f._fired&&(f._fired=q,s.call(this[b],f));f.draggable&&(!f.disableDrag&&"mousedown"===e)&&(f.bringToFront&&(g.splice(f.index,1),f.index=g.push(f)),n.layer=f,n.dragging=q,n.startX=f.x,n.startY=f.y,n.endX=f._mouseX,n.endY=f._mouseY,f.dragstart&&f.dragstart.call(this[b],f))}if(n.layer&&(n.dragging&&"mouseup"===e&&(n.layer.dragstop&&
n.layer.dragstop.call(this[b],n.layer),A.drag={}),n.dragging&&"mousemove"===e))n.layer.x=n.layer._mouseX-(n.endX-n.startX),n.layer.y=n.layer._mouseY-(n.endY-n.startY),n.layer.drag&&n.layer.drag.call(this[b],n.layer)}A.intersects=[];return this};d.fn.addLayer=function(c){var a,b,c=c||{};for(a=0;a<this.length;a+=1)if(b=x(this[a]))c.layer=q,c=E(this[a],c);return this};J=["width","height","opacity","lineHeight"];U={};d.fn.animateLayer=function(){function c(a,b){return function(){ca(b);a.drawLayers();
f[4]&&f[4].call(a[0],b)}}function a(a,b){return function(c,e){ca(b);a.drawLayers();f[5]&&f[5].call(a[0],c,e,b)}}var b,e,g,f=[].slice.call(arguments,0);"object"===typeof f[0]&&!f[0].layer&&f.unshift(0);"object"===typeof f[2]?(f.splice(2,0,f[2].duration||h),f.splice(3,0,f[3].easing||h),f.splice(4,0,f[4].complete||h),f.splice(5,0,f[5].step||h)):(f[2]===u?(f.splice(2,0,h),f.splice(3,0,h),f.splice(4,0,h)):"function"===typeof f[2]&&(f.splice(2,0,h),f.splice(3,0,h)),f[3]===u)?(f[3]=h,f.splice(4,0,h)):"function"===
typeof f[3]&&f.splice(3,0,h);f[1]=w({},f[1]);for(e=0;e<this.length;e+=1)if(b=d(this[e]),g=x(this[e]))if(F(this[e]),(g=b.getLayer(f[0]))&&g.method!==d.fn.draw)da(g),da(f[1],q),g.style=U,d(g).animate(f[1],{duration:f[2],easing:d.easing[f[3]]?f[3]:h,complete:c(b,g),step:a(b,g)});return this};d.fn.animateLayerGroup=function(c){var a,b,e=[].slice.call(arguments,0),g,f;for(b=0;b<this.length;b+=1){a=d(this[b]);g=a.getLayerGroup(c);for(f=0;f<g.length;f+=1)a.animateLayer.apply(a,[g[f]].concat(e.slice(1)))}};
d.fn.delayLayer=function(c,a){var b,e,a=a||0;for(b=0;b<this.length;b+=1)e=d(this[b]).getLayer(c),d(e).delay(a);return this};d.fn.delayLayerGroup=function(c,a){var b,e,g,f,a=a||0;for(e=0;e<this.length;e+=1){b=d(this[e]);g=b.getLayerGroup(c);for(f=0;f<g.length;f+=1)b.delayLayer.call(b,g[f],a)}};d.fn.stopLayer=function(c,a){var b,e;for(b=0;b<this.length;b+=1)e=d(this[b]).getLayer(c),d(e).stop(a);return this};d.fn.stopLayerGroup=function(c,a){var b,e,g,f;for(e=0;e<this.length;e+=1){b=d(this[e]);g=b.getLayerGroup(c);
for(f=0;f<g.length;f+=1)b.stopLayer.call(b,g[f],a)}};(function(c){var a;for(a=0;a<c.length;a+=1)d.fx.step[c[a]]=ga})("color backgroundColor borderColor borderTopColor borderRightColor borderBottomColor borderLeftColor fillStyle outlineColor strokeStyle shadowColor".split(" "));L("click");L("dblclick");L("mousedown");L("mouseup");L("mousemove");L("mouseover");L("mouseout");d.event.fix=function(c){var a,c=ha.call(d.event,c);if(c.pageX!==u&&c.offsetX===u&&(a=d(c.target).offset()))c.offsetX=c.pageX-a.left,
c.offsetY=c.pageY-a.top;return c};d.fn.draw=function a(b){var e,g,b=b||{};"function"===typeof b&&(b={fn:b});for(e=0;e<this.length;e+=1)if((g=x(this[e]))&&b.fn)b=E(this[e],b,a),b.fn.call(this[e],g);return this};d.fn.clearCanvas=function(a){var b,e,g=w(new y,a);for(b=0;b<this.length;b+=1)if(e=x(this[b]))G(b,e,g,a,g.width,g.height),e.setTransform(1,0,0,1,0,0),!g.x||!g.y||!g.width||!g.height?e.clearRect(0,0,this[b].width,this[b].height):e.clearRect(g.x-g.width/2,g.y-g.height/2,g.width,g.height),e.restore();
return this};d.fn.saveCanvas=function(){var a,b,e;for(a=0;a<this.length;a+=1)if(b=x(this[a]))e=F(this[a]),b.save(),e.savedTransforms=w({},e.transforms);return this};d.fn.restoreCanvas=function(){var a,b,e;for(a=0;a<this.length;a+=1)if(b=x(this[a]))e=F(this[a]),b.restore(),e.transforms=w({},e.savedTransforms);return this};d.fn.translateCanvas=function(a){for(var b,e=w(new y,a),g,a=0;a<this.length;a+=1)if(b=x(this[a]))g=F(this[a]),e.autosave&&b.save(),aa(b,e,g.transforms);return this};d.fn.scaleCanvas=
function(a){for(var b,e=w(new y,a),g,a=0;a<this.length;a+=1)if(b=x(this[a]))g=F(this[a]),e.autosave&&b.save(),$(b,e,g.transforms);return this};d.fn.rotateCanvas=function(a){for(var b,e=w(new y,a),g,a=0;a<this.length;a+=1)if(b=x(this[a]))g=F(this[a]),e.autosave&&b.save(),Z(b,e,g.transforms);return this};d.fn.drawRect=function b(e){var g,f,n=w(new y,e),d,s,v,r,j;for(g=0;g<this.length;g+=1)if(f=x(this[g]))e=E(this[g],e,b),H(f,n),G(g,f,n,e,n.width,n.height),f.beginPath(),d=n.x-n.width/2,s=n.y-n.height/
2,(j=n.cornerRadius)?(n.closed=q,v=n.x+n.width/2,r=n.y+n.height/2,0>v-d-2*j&&(j=(v-d)/2),0>r-s-2*j&&(j=(r-s)/2),f.moveTo(d+j,s),f.lineTo(v-j,s),f.arc(v-j,s+j,j,3*C/2,2*C,z),f.lineTo(v,r-j),f.arc(v-j,r-j,j,0,C/2,z),f.lineTo(d+j,r),f.arc(d+j,r-j,j,C/2,C,z),f.lineTo(d,s+j),f.arc(d+j,s+j,j,C,3*C/2,z)):f.rect(d,s,n.width,n.height),I(this[g],f,e);return this};d.fn.drawArc=function e(g){var f,d,h=w(new y,g),g=g||{};!h.inDegrees&&360===h.end&&(g.end=h.end=2*C);for(f=0;f<this.length;f+=1)if(d=x(this[f]))g=
E(this[f],g,e),H(d,h),G(f,d,h,g,2*h.radius),d.beginPath(),d.arc(h.x,h.y,h.radius,h.start*h._toRad-C/2,h.end*h._toRad-C/2,h.ccw),I(this[f],d,g);return this};d.fn.drawEllipse=function g(f){var d,h,s=w(new y,f),v=4*s.width/3,r=s.height;s.closed=q;for(d=0;d<this.length;d+=1)if(h=x(this[d]))f=E(this[d],f,g),H(h,s),G(d,h,s,f,s.width,s.height),h.beginPath(),h.moveTo(s.x,s.y-r/2),h.bezierCurveTo(s.x-v/2,s.y-r/2,s.x-v/2,s.y+r/2,s.x,s.y+r/2),h.bezierCurveTo(s.x+v/2,s.y+r/2,s.x+v/2,s.y-r/2,s.x,s.y-r/2),I(this[d],
h,f);return this};d.fn.drawPolygon=function f(d){var h,s,v=w(new y,d),r=2*C/v.sides,j=C/v.sides,l=j+C/2,m=v.radius*O(r/2),o,p,k;d.closed=v.closed=q;for(h=0;h<this.length;h+=1)if(s=x(this[h])){d=E(this[h],d,f);H(s,v);G(h,s,v,d,2*v.radius);s.beginPath();for(k=0;k<v.sides;k+=1)o=v.x+N(v.radius*O(l)),p=v.y+N(v.radius*Q(l)),s.lineTo(o,p),v.projection&&(o=v.x+N((m+m*v.projection)*O(l+j)),p=v.y+N((m+m*v.projection)*Q(l+j)),s.lineTo(o,p)),l+=r;I(this[h],s,d)}return this};d.fn.drawLine=function n(d){var h,
v,r=w(new y,d),j,l,m;for(h=0;h<this.length;h+=1)if(v=x(this[h])){d=E(this[h],d,n);H(v,r);T(r);G(h,v,r,d,0);j=1;for(v.beginPath();q;)if(l=r["x"+j],m=r["y"+j],l!==u&&m!==u)v.lineTo(l,m),j+=1;else break;I(this[h],v,d)}return this};d.fn.drawQuad=function A(d){var h,r,j=w(new y,d),l,m,o,p,k;for(h=0;h<this.length;h+=1)if(r=x(this[h])){d=E(this[h],d,A);H(r,j);T(j);G(h,r,j,d,0);l=2;r.beginPath();for(r.moveTo(j.x1,j.y1);q;)if(m=j["x"+l],o=j["y"+l],p=j["cx"+(l-1)],k=j["cy"+(l-1)],m!==u&&o!==u&&p!==u&&k!==u)r.quadraticCurveTo(p,
k,m,o),l+=1;else break;I(this[h],r,d)}return this};d.fn.drawBezier=function s(d){var h,j,l=w(new y,d),m,o,p,k,i,t,K,V;for(h=0;h<this.length;h+=1)if(j=x(this[h])){d=E(this[h],d,s);H(j,l);T(l);G(h,j,l,d,0);m=2;o=1;j.beginPath();for(j.moveTo(l.x1,l.y1);q;)if(p=l["x"+m],k=l["y"+m],i=l["cx"+o],t=l["cy"+o],K=l["cx"+(o+1)],V=l["cy"+(o+1)],p!==u&&k!==u&&i!==u&&t!==u&&K!==u&&V!==u)j.bezierCurveTo(i,t,K,V,p,k),m+=1,o+=2;else break;I(this[h],j,d)}return this};d.fn.drawText=function v(r){var j,l,m=w(new y,r),
o,p,k,i;for(j=0;j<this.length;j+=1)if(d(this[j]),l=x(this[j])){r=E(this[j],r,v);H(l,m);l.textBaseline=m.baseline;l.textAlign=m.align;l.font=m.font;if(!j&&m.maxWidth!==h){o=l;p=m.text;i=m.maxWidth;var t=m.text.split(" "),K=[],q="";if(o.measureText(p).width<i||1===t.length)K=[p];else for(;0<t.length;)o.measureText(t[0]).width>i||o.measureText(q+t[0]).width<i?q+=t.shift()+" ":(K.push(q),q=""),0===t.length&&K.push(q);o=K;o=o.join("\n").replace(/( (\n))|( $)/gi,"$2").split("\n")}else j||(o=(""+m.text).split("\n"));
fa(this[j],j,l,m,o);G(j,l,m,r,m.width,m.height);j||(k=m.x,"left"===m.align?k-=m.width/2:"right"===m.align&&(k+=m.width/2));for(p=0;p<o.length;p+=1)l.shadowColor=m.shadowColor,i=m.y+p*m.height/o.length-(o.length-1)*m.height/o.length/2,l.fillText(o[p],k,i),"transparent"!==m.fillStyle&&(l.shadowColor="transparent"),l.strokeText(o[p],k,i);m._event?(l.beginPath(),l.rect(m.x-m.width/2,m.y-m.height/2,m.width,m.height),l.restore(),S(this[j],l,r),l.closePath()):l.restore()}D=m;return this};d.fn.measureText=
function(d){var h;h=d!==u&&"object"!==typeof d?this.getLayer(d):w(new y,d);(d=x(this[0]))&&h.text!==u&&fa(this[0],0,d,h,h.text.split("\n"));return h};d.fn.drawImage=function r(d){function l(l,k,r){return function(){k||((u=t.width/t.height,i.width===h&&i.sWidth===h&&(d.width=i.width=i.sWidth=t.width),i.height===h&&i.sHeight===h&&(d.height=i.height=i.sHeight=t.height),i.width===h&&i.sWidth!==h&&(i.width=i.sWidth),i.height===h&&i.sHeight!==h&&(i.height=i.sHeight),i.sWidth===h&&i.width!==h&&(d.sWidth=
i.sWidth=t.width),i.sHeight===h&&i.height!==h&&(d.sHeight=i.sHeight=t.height),i.sx===h&&(i.sx=i.cropFromCenter?t.width/2:0),i.sy===h&&(i.sy=i.cropFromCenter?t.height/2:0),i.cropFromCenter||(i.sx+=i.sWidth/2,i.sy+=i.sHeight/2),i.sx+i.sWidth/2>t.width&&(i.sx=t.width-i.sWidth/2),0>i.sx-i.sWidth/2&&(i.sx=i.sWidth/2),0>i.sy-i.sHeight/2&&(i.sy=i.sHeight/2),i.sy+i.sHeight/2>t.height&&(i.sy=t.height-i.sHeight/2),i.width!==h&&i.height===h)?d.height=i.height=i.width/u:i.width===h&&i.height!==h?d.width=i.width=
i.height*u:i.width===h&&i.height===h&&(d.width=i.width=t.width,d.height=i.height=t.height));G(k,r,i,d,i.width,i.height);r.drawImage(t,i.sx-i.sWidth/2,i.sy-i.sHeight/2,i.sWidth,i.sHeight,i.x-i.width/2,i.y-i.height/2,i.width,i.height);r.fillStyle=r.strokeStyle="transparent";r.beginPath();r.rect(i.x-i.width/2,i.y-i.height/2,i.width,i.height);I(m[k],r,d);i.load&&i.load.call(l,d)}}var m=this,o,p,k,i=w(new y,d),t,q,u;q=i.source.getContext;i.source.src||q?(t=i.source,i.width=t.width,i.height=t.height):i.source&&
(t=new W,t.src=i.source);for(p=0;p<m.length;p+=1)if(o=m[p],k=x(m[p]))d=E(m[p],d,r),H(k,i),t&&(t.complete||q?l(o,p,k)():(t.onload=l(o,p,k),t.src=t.src));return m};d.fn.createPattern=d.fn.pattern=function(d){function j(){k=m.createPattern(p,o.repeat);o.load&&o.load.call(l[0],k)}var l=this,m,o=w(new y,d),p,k;(m=x(l[0]))?"function"===typeof o.source?(p=R.createElement("canvas"),p.width=o.width,p.height=o.height,d=x(p),o.source.call(p,d),j()):(d=o.source.getContext,o.source.src||d?p=o.source:(p=new W,
p.src=o.source),p.complete||d?j():p.onload=j):k=h;return k};d.fn.createGradient=d.fn.gradient=function(d){var j,d=w(new y,d),l=[],m,o,p,k,i,t,q;if(j=x(this[0])){d.x1=d.x1||0;d.y1=d.y1||0;d.x2=d.x2||0;d.y2=d.y2||0;j=d.r1!==h||d.r2!==h?j.createRadialGradient(d.x1,d.y1,d.r1,d.x2,d.y2,d.r2):j.createLinearGradient(d.x1,d.y1,d.x2,d.y2);for(k=1;d["c"+k]!==u;k+=1)d["s"+k]!==u?l.push(d["s"+k]):l.push(h);m=l.length;l[0]===h&&(l[0]=0);l[m-1]===h&&(l[m-1]=1);for(k=0;k<m;k+=1){if(l[k]!==h){t=1;q=0;o=l[k];for(i=
k+1;i<m;i+=1)if(l[i]!==h){p=l[i];break}else t+=1;o>p&&(l[i]=l[k])}else l[k]===h&&(q+=1,l[k]=o+q*((p-o)/t));j.addColorStop(l[k],d["c"+(k+1)])}}else j=h;return j};d.fn.setPixels=function j(d){var h,o,p,k=w(new y,d),i={},t,q,u,z;for(o=0;o<this.length;o+=1)if(h=this[o],p=x(h)){d=E(this[o],d,j);G(o,p,k,d,k.width,k.height);if(!k.x||!k.y||!k.width||!k.height)k.width=h.width,k.height=h.height,k.x=k.width/2,k.y=k.height/2;t=p.getImageData(k.x-k.width/2,k.y-k.height/2,k.width,k.height);q=t.data;z=q.length;
i=[];if(k.each)for(u=0;u<z;u+=4)i.r=q[u],i.g=q[u+1],i.b=q[u+2],i.a=q[u+3],k.each.call(h,i),q[u]=i.r,q[u+1]=i.g,q[u+2]=i.b,q[u+3]=i.a;p.putImageData(t,k.x-k.width/2,k.y-k.height/2);p.restore()}return this};d.fn.getCanvasImage=function(d,l){var m=this[0];return m&&m.toDataURL?m.toDataURL("image/"+d,l):h};d.support.canvas=R.createElement("canvas").getContext!==u;B.defaults=M;B.detectEvents=S;B.closePath=I;d.jCanvas=B})(jQuery,document,Image,Math,parseFloat,!0,!1,null);
