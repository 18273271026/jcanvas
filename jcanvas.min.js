/*
jCanvas v4.0b
Copyright 2011, Caleb Evans

Licensed under the MIT license
http://calebevans.me/projects/jcanvas/license.html
*/
(function(d,l,i,q,f){var j,c,g,h=d.fn,p=d.extend,k=d.event.fix,r=i.PI;function m(t,u){if(!t){c=p({},j)}else{if(u){j=p({},j,t);c=p({},j)}else{c=p({},c,t)}}return this}j={width:0,height:0,cornerRadius:0,fillStyle:"transparent",strokeStyle:"transparent",strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",rounded:false,shadowX:0,shadowY:0,shadowBlur:3,shadowColor:"transparent",opacity:1,compositing:"source-over",mask:false,x:0,y:0,x1:0,y1:0,x2:0,y2:0,radius:0,start:0,end:360,ccw:false,inDegrees:true,fromCenter:true,closed:false,sides:3,points:5,angle:0,text:"",font:"normal 12pt sans-serif",align:"center",baseline:"middle",source:"",repeat:"repeat"};c=p({},j);function o(t,u){t.fillStyle=u.fillStyle;t.strokeStyle=u.strokeStyle;t.lineWidth=u.strokeWidth;t.lineCap=u.strokeCap;t.lineJoin=u.strokeJoin;if(u.rounded){t.lineCap="round";t.lineJoin="round"}t.shadowOffsetX=u.shadowX;t.shadowOffsetY=u.shadowY;t.shadowBlur=u.shadowBlur;t.shadowColor=u.shadowColor;t.globalAlpha=u.opacity;t.globalCompositeOperation=u.compositing}function b(t,u){if(u.mask){t.save();t.clip()}if(u.closed){t.closePath();t.fill();t.stroke()}else{t.fill();t.stroke();t.closePath()}}function a(t){if(t.inDegrees){return r/180}else{return 1}}function n(u,w,v,t){if(!w.fromCenter){w.x+=v/2;w.y+=t/2}w.toRad=w.inDegrees?r/180:1;u.save();u.translate(w.x,w.y);u.rotate(w.angle*w.toRad);u.translate(-w.x,-w.y)}h.jCanvas=m;h.loadCanvas=function(t){return this[0].getContext(t||"2d")};h.draw=function(v){var t,u;for(u=0;u<this.length;u+=1){t=this[u].getContext("2d");v.call(this[u],t)}};h.gradient=function(u){var t=this[0].getContext("2d"),z=p({},c,u),y,x,w=0,v=1;if(z.r1!==f&&z.r2!==f){y=t.createRadialGradient(z.x1,z.y1,z.r1,z.x2,z.y2,z.r2)}else{y=t.createLinearGradient(z.x1,z.y1,z.x2,z.y2)}while(z["c"+v]!==f){w+=1;v+=1}for(v=1;v<=w;v+=1){x=i.round((100/(w-1))*(v-1))/100;if(z["s"+v]===f){z["s"+v]=x}y.addColorStop(z["s"+v],z["c"+v])}return y};h.pattern=function(v){var t=this[0].getContext("2d"),z=p({},c,v),u=new q(),x;u.src=z.source;function w(){if(u.complete){x=t.createPattern(u,z.repeat);return true}else{return false}}function y(){w();if(z.load){z.load.call(this[0],x)}}if(z.load){u.onload=y}else{if(!w()){u.onload=y}}return x};h.clearCanvas=function(u){var t,v,w=p({},c,u);for(v=0;v<this.length;v+=1){t=this[v].getContext("2d");n(t,w,w.width,w.height);if(!u){t.clearRect(0,0,this[v].width,this[v].height)}else{t.clearRect(w.x-w.width/2,w.y-w.height/2,w.width,w.height)}}return this};h.saveCanvas=function(){var t,u;for(u=0;u<this.length;u+=1){t=this[u].getContext("2d");t.save()}return this};h.restoreCanvas=function(){var t,u;for(u=0;u<this.length;u+=1){t=this[u].getContext("2d");t.restore()}return this};h.scaleCanvas=function(u){var t,v,w=p({},c,u);for(v=0;v<this.length;v+=1){t=this[v].getContext("2d");t.save();t.translate(w.x,w.y);t.scale(w.width,w.height);t.translate(-w.x,-w.y)}return this};h.translateCanvas=function(u){var t,v,w=p({},c,u);for(v=0;v<this.length;v+=1){t=this[v].getContext("2d");t.save();t.translate(w.x,w.y)}return this};h.rotateCanvas=function(u){var t,v,w=p({},c,u);w.toRad=a(w);for(v=0;v<this.length;v+=1){t=this[v].getContext("2d");t.save();t.translate(w.x,w.y);t.rotate(w.angle*w.toRad);t.translate(-w.x,-w.y)}return this};h.drawRect=function(y){var B,x,w=p({},c,y),v,A,u,z,t;for(x=0;x<this.length;x+=1){B=this[x].getContext("2d");o(B,w);n(B,w,w.width,w.height);if(w.cornerRadius>0){v=w.x-w.width/2;A=w.y-w.height/2;u=w.x+w.width/2;z=w.y+w.height/2;t=w.cornerRadius;if((u-v)-(2*t)<0){t=(u-v)/2}if((z-A)-(2*t)<0){t=(z-A)/2}B.beginPath();B.moveTo(v+t,A);B.lineTo(u-t,A);B.arc(u-t,A+t,t,3*r/2,r*2,false);B.lineTo(u,z-t);B.arc(u-t,z-t,t,0,r/2,false);B.lineTo(v+t,z);B.arc(v+t,z-t,t,r/2,r,false);B.lineTo(v,A+t);B.arc(v+t,A+t,t,r,3*r/2,false);B.fill();B.stroke();B.closePath()}else{B.beginPath();B.rect(w.x-w.width/2,w.y-w.height/2,w.width,w.height);B.restore();b(B,w)}}return this};h.drawArc=function(u){var t,v,w=p({},c,u);if(!w.inDegrees&&w.end===360){w.end=r*2}for(v=0;v<this.length;v+=1){t=this[v].getContext("2d");o(t,w);n(t,w,w.radius,w.radius);t.beginPath();t.arc(w.x,w.y,w.radius,(w.start*w.toRad)-(r/2),(w.end*w.toRad)-(r/2),w.ccw);t.restore();b(t,w)}return this};h.drawEllipse=function(u){var t,w,x=p({},c,u),v=x.width*(4/3);for(w=0;w<this.length;w+=1){t=this[w].getContext("2d");o(t,x);n(t,x,x.width,x.height);t.beginPath();t.moveTo(x.x,x.y-x.height/2);t.bezierCurveTo(x.x-v/2,x.y-x.height/2,x.x-v/2,x.y+x.height/2,x.x,x.y+x.height/2);t.bezierCurveTo(x.x+v/2,x.y+x.height/2,x.x+v/2,x.y-x.height/2,x.x,x.y-x.height/2);t.restore();b(t,x)}return this};h.drawLine=function(v){var u,y,z=p({},c,v),t=2,x=0,w=0;for(y=0;y<this.length;y+=1){u=this[y].getContext("2d");o(u,z);u.beginPath();u.moveTo(z.x1,z.y1);while(1){x=z["x"+t];w=z["y"+t];if(x!==f&&w!==f){u.lineTo(x,w)}else{break}t+=1}b(u,z)}return this};h.drawQuad=function(y){var B,x,w=p({},c,y),v=2,u=0,t=0,A=0,z=0;for(x=0;x<this.length;x+=1){B=this[x].getContext("2d");o(B,w);B.beginPath();B.moveTo(w.x1,w.y1);while(1){u=w["x"+v];t=w["y"+v];A=w["cx"+(v-1)];z=w["cy"+(v-1)];if(u!==f&&t!==f&&A!==f&&z!==f){B.quadraticCurveTo(A,z,u,t)}else{break}v+=1}b(B,w)}return this};h.drawBezier=function(D){var E,C,z=p({},c,D),y=2,v=1,x=0,w=0,B=0,u=0,A=0,t=0;for(C=0;C<this.length;C+=1){E=this[C].getContext("2d");o(E,z);E.beginPath();E.moveTo(z.x1,z.y1);while(1){x=z["x"+y];w=z["y"+y];B=z["cx"+v];u=z["cy"+v];A=z["cx"+(v+1)];t=z["cy"+(v+1)];if(x!==f&&w!==f&&B!==f&&u!==f&&A!==f&&t!==f){E.bezierCurveTo(B,u,A,t,x,w)}else{break}y+=1;v+=2}b(E,z)}return this};h.drawText=function(u){var t,v,w=p({},c,u);for(v=0;v<this.length;v+=1){t=this[v].getContext("2d");o(t,w);t.textBaseline=w.baseline;t.textAlign=w.align;t.font=w.font;t.strokeText(w.text,w.x,w.y);t.fillText(w.text,w.x,w.y)}return this};h.drawImage=function(z){var B,u,y,w=p({},c,z),x=new q(),t;x.src=w.source;function A(C){if(x.complete){t=x.width/x.height;if(w.sx===f){w.sx=x.width/2}if(w.sy===f){w.sy=x.height/2}w.sWidth=w.sWidth||x.width;w.sHeight=w.sHeight||x.height;if(w.width&&w.height){x.width=w.width;x.height=w.height}else{if(w.width&&!w.height){x.width=w.width;x.height=x.width/t}else{if(!w.width&&w.height){x.height=w.height;x.width=x.height*t}}}n(C,w,x.width,x.height);C.drawImage(x,w.sx-w.sWidth/2,w.sy-w.sHeight/2,w.sWidth,w.sHeight,w.x-x.width/2,w.y-x.height/2,x.width,x.height);C.restore();return true}else{return false}}function v(){A(B);if(w.load){w.load.call(u)}}for(y=0;y<this.length;y+=1){u=this[y];B=u.getContext("2d");o(B,w);if(w.load){x.onload=v}else{if(!A(B)){x.onload=v}}}return this};h.drawPolygon=function(z){var D,y,w=p({},c,z),E=r/w.sides,v=(r/2)+E,C=(r*2)/w.sides,u,B,t,A,x;w.apothem=i.cos(C/2)*w.radius;w.closed=true;if(w.sides>=3){for(y=0;y<this.length;y+=1){D=this[y].getContext("2d");o(D,w);n(D,w,w.radius,w.radius);D.beginPath();for(x=0;x<w.sides;x+=1){u=i.round(w.x+(w.radius*i.cos(v)));B=i.round(w.y+(w.radius*i.sin(v)));t=i.round(w.y+((w.apothem+w.apothem*w.projection)*i.cos(v+E)));A=i.round(w.y+((w.apothem+w.apothem*w.projection)*i.sin(v+E)));if(x===0){D.moveTo(u,B)}else{D.lineTo(u,B)}if(w.projection!==f){D.lineTo(t,A)}v+=C}D.restore();b(D,w)}}return this};h.setPixels=function(A){var C,u,z,x,v=p({},c,A),t,w,y,B;for(z=0;z<this.length;z+=1){u=this[z];C=u.getContext("2d");if(!v.x&&!v.y&&!v.width&&!v.height){v.width=u.width;v.height=u.height;v.x=v.width/2;v.y=v.height/2}n(C,v,v.width,v.height);t=C.getImageData(v.x-v.width/2,v.y-v.height/2,v.width,v.height);w=t.data;y=w.length;B=[];if(v.each!==f){for(x=0;x<y;x+=4){B=v.each.call(u,w[x],w[x+1],w[x+2],w[x+3]);w[x]=B[0];w[x+1]=B[1];w[x+2]=B[2];w[x+3]=B[3]}}C.putImageData(t,v.x-v.width/2,v.y-v.height/2);C.restore()}return this};g=[];function s(t){var u=p({},c,t);g.push(u);return u}h.drawLayers=function(t){var u,v=g.length,y,x,w;for(x=0;x<this.length;x+=1){u=this[x].getContext("2d");if(t){u.clearRect(0,0,this[x].width,this[x].height)}for(w=0;w<v;w+=1){y=g[w];if(y.fn){h[y.fn].call(this.eq(x),y)}}}return this};d.event.fix=function(t){t=k.call(d.event,t);if(t.layerX===f&&t.layerY===f){t.layerX=t.offsetX;t.layerY=t.offsetY}return t};function e(){m.retro=true;m.queue=g;m.create=s;h.drawQueue=h.drawLayers;return d}m.defaults=j;m.prefs=c;m.setGlobals=o;m.checkUnits=a;m.rotate=n;m.layers=g;m.addLayer=s;m.retrofit=e;m.retro=false;d.jCanvas=m}(jQuery,document,Math,Image));