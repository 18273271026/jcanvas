/*
 jCanvas v6.0b
Copyright 2012, Caleb Evans
Licensed under the MIT license
*/
(function(a,O,R,N,aa,q,C,b,v){function x(){}function z(d){d?w(S,d):z.prefs=S=x.prototype=w({},K);return this}function D(d,c){d.fillStyle=c.fillStyle;d.strokeStyle=c.strokeStyle;d.lineWidth=c.strokeWidth;c.rounded?(d.lineCap="round",d.lineJoin="round"):(d.lineCap=c.strokeCap,d.lineJoin=c.strokeJoin,d.miterLimit=c.miterLimit);d.shadowOffsetX=c.shadowX;d.shadowOffsetY=c.shadowY;d.shadowBlur=c.shadowBlur;d.shadowColor=c.shadowColor;d.globalAlpha=c.opacity;d.globalCompositeOperation=c.compositing}function t(d){return d&&
d.getContext?d.getContext("2d"):b}function G(d,c){c.mask&&(c.autosave&&d.save(),d.clip());c.closed&&d.closePath();d.fill();"transparent"!==c.fillStyle&&(d.shadowColor="transparent");d.stroke();c.closed||d.closePath()}function T(d,c){if(!c.translateX&&!c.translateY&&(c.x||c.y))c.translateX=c.x,c.translateY=c.y;c.translate&&(c.translateX=c.translateY=c.translate);d.translate(c.translateX,c.translateY)}function U(d,c){1!==c.scale&&(c.scaleX=c.scaleY=c.scale);d.translate(c.x,c.y);d.scale(c.scaleX,c.scaleY);
d.translate(-c.x,-c.y)}function V(d,c){c.toRad=c.inDegrees?y/180:1;c.rotate=c.rotate||c.angle;d.translate(c.x,c.y);d.rotate(c.rotate*c.toRad);d.translate(-c.x,-c.y)}function F(d,c,k,a,A){k.toRad=k.inDegrees?y/180:1;c.save();A=A||a;!d&&!k.fromCenter&&(k.x+=a/2,k.y+=A/2);(k.rotate||k.angle)&&V(c,k);(1!==k.scale||1!==k.scaleX||1!==k.scaleY)&&U(c,k);(k.translate||k.translateX||k.translateY)&&T(c,k)}function W(d,c,k){k&&k.visible&&(k.method===a.fn.draw?k.fn.call(d[0],c):k.method&&k.method.call(d,k))}function B(d,
c,k){var b,A,r,n="function"===typeof c,c=c||{};if(c.layer&&!c._layer){b=a(d);A=b.getLayers();n&&(c={method:a.fn.draw,fn:c});c=w(new x,c);if(!n){c.method=a.fn[c.method]||k;d=J(d);for(r in z.events)if(z.events.hasOwnProperty(r)&&c[r]){if(!d[r])z.events[r](b);c._event=q}if(c.draggable){c._event=q;k=["mousedown","mousemove","mouseup"];for(n=0;n<k.length;n+=1)if(r=k[n],!d[r])z.events[r](b)}}c.layer=q;c._layer=q;c.index===v&&(c.index=A.length);A.splice(c.index,0,c)}}function X(d){var c;for(c=0;c<H.length;c+=
1)d[H[c]]=d["_"+H[c]]}function Y(d){var c;for(c=0;c<H.length;c+=1)d["_"+H[c]]=d[H[c]]}function Z(d){var c,k,b=[],A=1;d.match(/^#?[a-z0-9]+$/i)&&(k=O.head,c=k.style.color,k.style.color=d,d=a.css(k,"color"),k.style.color=c);d.match(/^rgb/i)&&(b=d.match(/[0-9]+/gi),d.match(/%/gi)&&(A=2.55),b[0]*=A,b[1]*=A,b[2]*=A);return b}function ca(d){var c;"object"!==typeof d.start&&(d.start=Z(d.start),d.end=Z(d.end));d.now=[];for(c=0;3>c;c+=1)d.now[c]=L(d.start[c]+(d.end[c]-d.start[c])*d.pos);d.now="rgb("+d.now.join(",")+
")";d.elem.style?d.elem.style[d.prop]=d.now:d.elem[d.prop]=d.now}function J(d){var c=a.data(d,"jCanvas");c||(c=a.data(d,"jCanvas",{layers:[],intersects:[],drag:{},event:{}}));return c}function I(d){z.events[d]=function(c){var k="mouseover"===d||"mouseout"===d?"mousemove":d,a=J(c[0]),b=a.event;c.bind(k+".jCanvas",function(d){b.x=d.offsetX;b.y=d.offsetY;b.type=k;c.drawLayers(q);d.preventDefault()});a[d]=q}}function E(d,c,k){var a=J(d),b=a.event,c=c.isPointInPath(b.x,b.y);k.mouseX=b.x;k.mouseY=b.y;!c&&
(k._hovered&&!k._fired)&&(k._fired=q,k._hovered=C,k.mouseout&&k.mouseout.call(d,k));c&&a.intersects.push(k)}var K,S,w=a.extend,L=N.round,y=N.PI,$=N.sin,P=N.cos,da=a.event.fix,M={},H;a.fn.jCanvas=z;z.version="5.6b";z.events={};K={angle:0,align:"center",autosave:q,baseline:"middle",bringToFront:q,ccw:C,closed:C,compositing:"source-over",cornerRadius:0,cropFromCenter:q,draggable:!1,each:b,end:360,fillStyle:"transparent",font:"12pt sans-serif",fromCenter:q,height:b,inDegrees:q,load:b,mask:C,miterLimit:10,
opacity:1,projection:0,r1:b,r2:b,radius:0,repeat:"repeat",rotate:0,rounded:C,scale:1,scaleX:1,scaleY:1,shadowBlur:0,shadowColor:"transparent",shadowX:0,shadowY:0,sHeight:b,sides:3,source:"",start:0,strokeCap:"butt",strokeJoin:"miter",strokeStyle:"transparent",strokeWidth:1,sWidth:b,sx:b,sy:b,text:"",translate:0,translateX:0,translateY:0,visible:q,width:b,x:0,y:0};z();z.extend=function(d){K=w(K,d.props);z();d.name&&(a.fn[d.name]=function(c){var k,a,b=w(new x,c);for(k=0;k<this.length;k+=1)if(c=this[k],
a=t(c))D(a,b),d.fn.call(c,a,b);return this});return a.fn[d.name]};a.fn.loadCanvas=function(){return t(this[0])};a.fn.draw=function(d){var c,k;d&&!d.fn&&(d={fn:d});w(new x,d);for(c=0;c<this.length;c+=1)(k=t(this[c]))&&d.fn.call(this[c],k);return this};a.fn.clearCanvas=function(d){for(var c,k=w(new x,d),d=0;d<this.length;d+=1)if(c=t(this[d]))F(d,c,k,k.width,k.height),!k.x||!k.y||!k.width||!k.height?c.clearRect(0,0,this[d].width,this[d].height):c.clearRect(k.x-k.width/2,k.y-k.height/2,k.width,k.height);
return this};a.fn.saveCanvas=function(){var d,c;for(d=0;d<this.length;d+=1)(c=t(this[d]))&&c.save();return this};a.fn.restoreCanvas=function(){var d,c;for(d=0;d<this.length;d+=1)(c=t(this[d]))&&c.restore();return this};a.fn.translateCanvas=function(d){for(var c,k=w(new x,d),d=0;d<this.length;d+=1)if(c=t(this[d]))k.autosave&&c.save(),T(c,k);return this};a.fn.scaleCanvas=function(d){for(var c,k=w(new x,d),d=0;d<this.length;d+=1)if(c=t(this[d]))k.autosave&&c.save(),U(c,k);return this};a.fn.rotateCanvas=
function(d){for(var c,k=w(new x,d),d=0;d<this.length;d+=1)if(c=t(this[d]))k.autosave&&c.save(),V(c,k);return this};a.fn.drawRect=function c(k){var a,b,r=w(new x,k),n,o,p,s,j;for(a=0;a<this.length;a+=1)if(b=t(this[a]))B(this[a],k,c),D(b,r),F(a,b,r,r.width,r.height),b.beginPath(),n=r.x-r.width/2,o=r.y-r.height/2,(j=r.cornerRadius)?(r.closed=q,p=r.x+r.width/2,s=r.y+r.height/2,0>p-n-2*j&&(j=(p-n)/2),0>s-o-2*j&&(j=(s-o)/2),b.moveTo(n+j,o),b.lineTo(p-j,o),b.arc(p-j,o+j,j,3*y/2,2*y,C),b.lineTo(p,s-j),b.arc(p-
j,s-j,j,0,y/2,C),b.lineTo(n+j,s),b.arc(n+j,s-j,j,y/2,y,C),b.lineTo(n,o+j),b.arc(n+j,o+j,j,y,3*y/2,C)):b.rect(n,o,r.width,r.height),r._event&&E(this[a],b,k),G(b,r),b.restore();return this};a.fn.drawArc=function k(b){var a,r,n=w(new x,b);!n.inDegrees&&360===n.end&&(n.end=2*y);for(a=0;a<this.length;a+=1)if(r=t(this[a]))B(this[a],b,k),D(r,n),F(a,r,n,2*n.radius),r.beginPath(),r.arc(n.x,n.y,n.radius,n.start*n.toRad-y/2,n.end*n.toRad-y/2,n.ccw),n._event&&E(this[a],r,b),G(r,n),r.restore();return this};a.fn.drawEllipse=
function ba(b){var a,n,o=w(new x,b),p=4*o.width/3,s=o.height;for(a=0;a<this.length;a+=1)if(n=t(this[a]))B(this[a],b,ba),D(n,o),F(a,n,o,o.width,o.height),n.beginPath(),n.moveTo(o.x,o.y-s/2),n.bezierCurveTo(o.x-p/2,o.y-s/2,o.x-p/2,o.y+s/2,o.x,o.y+s/2),n.bezierCurveTo(o.x+p/2,o.y+s/2,o.x+p/2,o.y-s/2,o.x,o.y-s/2),o._event&&E(this[a],n,b),G(n,o),n.restore();return this};a.fn.drawPolygon=function A(a){var b,o,p=w(new x,a),s=2*y/p.sides,j=y/p.sides,f=j+y/2,g=p.radius*P(s/2),i,l,e;p.closed=q;for(b=0;b<this.length;b+=
1)if(o=t(this[b])){B(this[b],a,A);D(o,p);F(b,o,p,2*p.radius);o.beginPath();for(e=0;e<p.sides;e+=1)i=p.x+L(p.radius*P(f)),l=p.y+L(p.radius*$(f)),o.lineTo(i,l),p.projection&&(i=p.x+L((g+g*p.projection)*P(f+j)),l=p.y+L((g+g*p.projection)*$(f+j)),o.lineTo(i,l)),f+=s;p._event&&E(this[b],o,a);G(o,p);o.restore()}return this};a.fn.drawLine=function r(b){var a,p,s=w(new x,b),j,f,g;for(a=0;a<this.length;a+=1)if(p=t(this[a])){B(this[a],b,r);D(p,s);j=1;for(p.beginPath();q;)if(f=s["x"+j],g=s["y"+j],f!==v&&g!==
v)p.lineTo(f,g),j+=1;else break;s._event&&E(this[a],p,b);G(p,s)}return this};a.fn.drawQuad=function n(a){var b,s,j=w(new x,a),f,g,i,l,e;for(b=0;b<this.length;b+=1)if(s=t(this[b])){B(this[b],a,n);D(s,j);f=2;s.beginPath();for(s.moveTo(j.x1,j.y1);q;)if(g=j["x"+f],i=j["y"+f],l=j["cx"+(f-1)],e=j["cy"+(f-1)],g!==v&&i!==v&&l!==v&&e!==v)s.quadraticCurveTo(l,e,g,i),f+=1;else break;j._event&&E(this[b],s,a);G(s,j)}return this};a.fn.drawBezier=function o(b){var a,j,f=w(new x,b),g,i,l,e,h,m,u,Q;for(a=0;a<this.length;a+=
1)if(j=t(this[a])){B(this[a],b,o);D(j,f);g=2;i=1;j.beginPath();for(j.moveTo(f.x1,f.y1);q;)if(l=f["x"+g],e=f["y"+g],h=f["cx"+i],m=f["cy"+i],u=f["cx"+(i+1)],Q=f["cy"+(i+1)],l!==v&&e!==v&&h!==v&&m!==v&&u!==v&&Q!==v)j.bezierCurveTo(h,m,u,Q,l,e),g+=1,i+=2;else break;f._event&&E(this[a],j,b);G(j,f)}return this};a.fn.drawText=function p(b){var j,f,g=w(new x,b);for(j=0;j<this.length;j+=1)if(a(this[j]),f=t(this[j])){B(this[j],b,p);D(f,g);f.textBaseline=g.baseline;f.textAlign=g.align;f.font=g.font;if(g.layer){var i=
this[j],l=f,e=g,h=void 0,m=void 0,u=/\b(\d*\.?\d*)\w\w\b/gi;if(M.text===e.text&&M.font===e.font)e.width=M.width,e.height=M.height;else{e.width=l.measureText(e.text).width;h=i.style.fontSize;if(m=e.font.match(u))i.style.fontSize=e.font.match(u)[0];e.height=aa(a.css(i,"fontSize"));i.style.fontSize=h}}F(j,f,g,g.width,g.height);f.fillText(g.text,g.x,g.y);"transparent"!==g.fillStyle&&(f.shadowColor="transparent");f.strokeText(g.text,g.x,g.y);g._event?(f.beginPath(),f.rect(g.x-g.width/2,g.y-g.height/2,
g.width,g.height),f.restore(),E(this[j],f,b),f.closePath()):f.restore()}M=g;return this};a.fn.drawImage=function s(j){function f(f,e,a){return function(){e||((q=m.width/m.height,h.width===b&&h.sWidth===b&&(j.width=h.width=h.sWidth=m.width),h.height===b&&h.sHeight===b&&(j.height=h.height=h.sHeight=m.height),h.width===b&&h.sWidth!==b&&(h.width=h.sWidth),h.height===b&&h.sHeight!==b&&(h.height=h.sHeight),h.sWidth===b&&h.width!==b&&(j.sWidth=h.sWidth=m.width),h.sHeight===b&&h.height!==b&&(j.sHeight=h.sHeight=
m.height),h.sx===b&&(h.sx=h.cropFromCenter?m.width/2:0),h.sy===b&&(h.sy=h.cropFromCenter?m.height/2:0),h.cropFromCenter||(h.sx+=h.sWidth/2,h.sy+=h.sHeight/2),h.sx+h.sWidth/2>m.width&&(h.sx=m.width-h.sWidth/2),0>h.sx-h.sWidth/2&&(h.sx=h.sWidth/2),0>h.sy-h.sHeight/2&&(h.sy=h.sHeight/2),h.sy+h.sHeight/2>m.height&&(h.sy=m.height-h.sHeight/2),h.width!==b&&h.height===b)?j.height=h.height=h.width/q:h.width===b&&h.height!==b?j.width=h.width=h.height*q:h.width===b&&h.height===b&&(j.width=h.width=m.width,j.height=
h.height=m.height));F(e,a,h,h.width,h.height);a.drawImage(m,h.sx-h.sWidth/2,h.sy-h.sHeight/2,h.sWidth,h.sHeight,h.x-h.width/2,h.y-h.height/2,h.width,h.height);h._event?(a.beginPath(),a.rect(h.x-h.width/2,h.y-h.height/2,h.width,h.height),a.restore(),E(g[e],a,j),a.closePath()):a.restore();h.load&&h.load.call(f,j)}}var g=this,a,l,e,h=w(new x,j),m,u,q;u=h.source.getContext;h.source.src||u?(m=h.source,h.width=m.width,h.height=m.height):h.source&&(m=new R,m.src=h.source);for(l=0;l<g.length;l+=1)if(a=g[l],
e=t(g[l]))B(g[l],j,s),D(e,h),m&&(m.complete||u?f(a,l,e)():(m.onload=f(a,l,e),m.src=m.src));return g};a.fn.pattern=function(a){function j(){e=g.createPattern(l,i.repeat);i.load&&i.load.call(f[0],e)}var f=this,g,i=w(new x,a),l,e;(g=t(f[0]))?"function"===typeof i.source?(l=O.createElement("canvas"),l.width=i.width,l.height=i.height,a=t(l),i.source.call(l,a),j()):(a=i.source.getContext,i.source.src||a?l=i.source:(l=new R,l.src=i.source),l.complete||a)?j():(l.onload=j,l.src=l.src):e=b;return e};a.fn.gradient=
function(a){var j,a=w(new x,a),f=[],g,i,l,e,h,m,u;if(j=t(this[0])){j=a.r1!==b||a.r2!==b?j.createRadialGradient(a.x1,a.y1,a.r1,a.x2,a.y2,a.r2):j.createLinearGradient(a.x1,a.y1,a.x2,a.y2);for(e=1;a["c"+e]!==v;e+=1)a["s"+e]!==v?f.push(a["s"+e]):f.push(b);g=f.length;f[0]===b&&(f[0]=0);f[g-1]===b&&(f[g-1]=1);for(e=0;e<g;e+=1){if(f[e]!==b){m=1;u=0;i=f[e];for(h=e+1;h<g;h+=1)if(f[h]!==b){l=f[h];break}else m+=1;i>l&&(f[h]=f[e])}else f[e]===b&&(u+=1,f[e]=i+u*((l-i)/m));j.addColorStop(f[e],a["c"+(e+1)])}}else j=
b;return j};a.fn.setPixels=function j(a){var g,i,l,e=w(new x,a),h={},m,u,q,v;for(i=0;i<this.length;i+=1)if(g=this[i],l=t(g)){B(this[i],a,j);F(i,l,e,e.width,e.height);if(!e.x||!e.y||!e.width||!e.height)e.width=g.width,e.height=g.height,e.x=e.width/2,e.y=e.height/2;m=l.getImageData(e.x-e.width/2,e.y-e.height/2,e.width,e.height);u=m.data;v=u.length;h=[];if(e.each!==b)for(q=0;q<v;q+=4)h.r=u[q],h.g=u[q+1],h.b=u[q+2],h.a=u[q+3],e.each.call(g,h),u[q]=h.r,u[q+1]=h.g,u[q+2]=h.b,u[q+3]=h.a;l.putImageData(m,
e.x-e.width/2,e.y-e.height/2);l.restore()}return this};a.fn.getCanvasImage=function(a,f){var g=this[0];return g&&g.toDataURL?g.toDataURL("image/"+a,f):b};a.fn.getLayers=function(){var a=this[0];return!a||!a.getContext?[]:J(a).layers};a.fn.getLayer=function(a){var f=this.getLayers(),g;if(!a||!a.layer){if("string"===typeof a)for(g=0;g<f.length;g+=1)if(f[g].name===a){a=g;break}a=f[a||0]}return a};a.fn.setLayer=function(b,f){var g,i;b||(f=b,b=0);for(g=0;g<this.length;g+=1)i=a(this[g]).getLayer(b),w(i,
f);return this};a.fn.getLayerGroup=function(a){var f=this.getLayers(),b=[],i;for(i=0;i<f.length;i+=1)f[i].group===a&&b.push(f[i]);return b};a.fn.setLayerGroup=function(b,f){var g,i,l;for(g=0;g<this.length;g+=1){i=a(this[g]).getLayers();for(l=0;l<i.length;l+=1)i[l].group===b&&w(i[l],f)}return this};a.fn.removeLayerGroup=function(b){var f,g,i;for(f=0;f<this.length;f+=1){g=a(this[f]).getLayers();for(i=0;i<g.length;i+=1)g[i].group===b&&(g.splice(i,1),i-=1)}return this};a.fn.drawLayer=function(b){var f,
g,i,l;for(f=0;f<this.length;f+=1)i=a(this[f]),g=t(this[f]),l=i.getLayer(b),W(i,g,l);return this};a.fn.drawLayers=function(b){var f,g,i,l,e,h,m;for(g=0;g<this.length;g+=1)if(f=a(this[g]),i=t(this[g])){i.clearRect(0,0,this[g].width,this[g].height);m=J(this[g]);l=m.layers;for(h=0;h<l.length;h+=1)e=l[h],e.index=h,b&&(e._fired=C),console.log(e),W(f,i,e);e=m.intersects[m.intersects.length-1]||{};f=m.event;f=f.type;h=e[f];i=m.drag;if(e._event){if((e.mouseover||e.mouseout)&&!e._hovered&&!e._fired)e._fired=
q,e._hovered=q,e.mouseover&&e.mouseover.call(this[g],e);h&&!e._fired&&(e._fired=q,h.call(this[g],e));e.draggable&&"mousedown"===f&&(e.bringToFront&&(l.splice(e.index,1),e.index=0,l.push(e)),i.layer=e,console.log(i.layer),i.dragging=q,i.startX=e.x,i.startY=e.y,i.endX=e.mouseX,i.endY=e.mouseY,e.dragstart&&e.dragstart.call(this[g],e))}if(i.layer&&(e.draggable&&"mouseup"===f&&(m.drag={},i.layer.dragstop&&i.layer.dragstop.call(this[g],i.layer)),i.dragging&&"mousemove"===f))i.layer.x=i.layer.mouseX-(i.endX-
i.startX),i.layer.y=i.layer.mouseY-(i.endY-i.startY),i.layer.drag&&i.layer.drag.call(this[g],i.layer)}m.intersects=[];return this};a.fn.addLayer=function(a){var b,g,a=a||{};for(b=0;b<this.length;b+=1)if(g=t(this[b]))a.layer=q,B(this[b],a);return this};a.fn.removeLayers=function(){var b,f;for(f=0;f<this.length;f+=1)b=a(this[f]).getLayers(),b.length=0;return this};a.fn.removeLayer=function(b){var f,g,i;for(f=0;f<this.length;f+=1){g=a(this[f]).getLayers();if("string"===typeof b)for(i=0;i<g.length;i+=
1)if(g[i].name===b){b=i;break}g.splice(b,1)}return this};H=["width","height","opacity"];a.fn.animateLayer=function(){function j(a,b){return function(){X(b);a.drawLayers();e[4]&&e[4].call(a[0])}}function f(a,b){return function(f,g){X(b);a.drawLayers();e[5]&&e[5].call(a[0],f,g)}}var g,i,l,e=[].slice.call(arguments,0);"object"===typeof e[0]&&!e[0].layer&&e.unshift(0);"object"===typeof e[2]?(e.splice(2,0,e[2].duration||b),e.splice(3,0,e[3].easing||b),e.splice(4,0,e[4].complete||b),e.splice(5,0,e[5].step||
b)):(e[2]===v?(e.splice(2,0,b),e.splice(3,0,b),e.splice(4,0,b)):"function"===typeof e[2]&&(e.splice(2,0,b),e.splice(3,0,b)),e[3]===v)?(e[3]=b,e.splice(4,0,b)):"function"===typeof e[3]&&e.splice(3,0,b);for(i=0;i<this.length;i+=1)if(g=a(this[i]),l=t(this[i]))if((l=g.getLayer(e[0]))&&l.method!==a.fn.draw){Y(l);Y(e[1]);var h=J(this[i]).event;h.x=v;h.y=v;a(l).animate(e[1],{duration:e[2],easing:a.easing[e[3]]?e[3]:b,complete:j(g,l),step:f(g,l)})}return this};a.fn.delayLayer=function(b,f){var g,i,f=f||0;
for(g=0;g<this.length;g+=1)i=a(this[g]).getLayer(b),a(i).delay(f);return this};a.fn.stopLayer=function(b,f){var g,i;for(g=0;g<this.length;g+=1)i=a(this[g]).getLayer(b),a(i).stop(f);return this};(function(b){var f;for(f=0;f<b.length;f+=1)a.fx.step[b[f]]=ca})("color backgroundColor borderColor borderTopColor borderRightColor borderBottomColor borderLeftColor fillStyle outlineColor strokeStyle shadowColor".split(" "));I("click");I("dblclick");I("mousedown");I("mouseup");I("mousemove");I("mouseover");
I("mouseout");a.event.fix=function(b){var f,b=da.call(a.event,b);if(b.pageX!==v&&b.offsetX===v&&(f=a(b.target).offset()))b.offsetX=b.pageX-f.left,b.offsetY=b.pageY-f.top;return b};a.support.canvas=O.createElement("canvas").getContext!==v;z.defaults=K;a.jCanvas=z})(jQuery,document,Image,Math,parseFloat,!0,!1,null);
