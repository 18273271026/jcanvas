/**
 * @license jCanvas Handles v14.08.20
 * Copyright 2013 Caleb Evans
 * Released under the MIT license
 */
!function($){function e(e){var n=e._method;return n===$.fn.drawRect||n===$.fn.drawEllipse||n===$.fn.drawImage}function n(e){var n=e._method;return n===$.fn.drawLine||n===$.fn.drawQuadratic||n===$.fn.drawBezier}function t(e,n,t,a){var r=$.extend({cursors:{mouseover:"grab",mousedown:"grabbing",mouseup:"grab"}},n.handle,{layer:!0,draggable:!0,x:n[t],y:n[a],_parent:n,_xProp:t,_yProp:a,fromCenter:!0,dragstart:function(e){$(this).triggerLayerEvent(e._parent,"handlestart")},drag:function(e){var n=e._parent;n[e._xProp]=e.x-n.x,n[e._yProp]=e.y-n.y,h(n),$(this).triggerLayerEvent(n,"handlemove")},dragstop:function(e){$(this).triggerLayerEvent(e._parent,"handlestop")},dragcancel:function(e){$(this).triggerLayerEvent(e._parent,"handlecancel")}});e.draw(r),n._handles.push(e.getLayer(-1))}function a(e,n,t,a){var r,i;-1===t&&-1===a||1===t&&1===a?i="nwse-resize":0!==t||-1!==a&&1!==a?-1!==t&&1!==t||0!==a?(1===t&&-1===a||-1===t&&1===a)&&(i="nesw-resize"):i="ew-resize":i="ns-resize",r=$.extend({cursors:{mouseover:i}},n.handle,{layer:!0,draggable:!0,x:n.x+t*n.width/2,y:n.y+a*n.height/2,_parent:n,_px:t,_py:a,fromCenter:!0,dragstart:function(e){$(this).triggerLayerEvent(e._parent,"handlestart")},drag:function(e){var n=e._parent;n.resizeFromCenter?(n.width+=e.dx*e._px*2,n.height+=e.dy*e._py*2,n.constrainProportions&&(0===e._py?n.height=n.width/n.aspectRatio:n.width=n.height*n.aspectRatio)):(n.width+=e.dx*e._px,n.height+=e.dy*e._py,n.constrainProportions&&(0===e._py?n.height=n.width/n.aspectRatio:(n.width=n.height*n.aspectRatio,e.dx=e.dy*n.aspectRatio*e._py*e._px)),0!==e._px&&(n.x+=e.dx/2),0!==e._py&&(n.y+=e.dy/2)),l(n),$(this).triggerLayerEvent(n,"handlemove")},dragstop:function(e){var n=e._parent;$(this).triggerLayerEvent(n,"handlestop")},dragcancel:function(e){var n=e._parent;$(this).triggerLayerEvent(n,"handlecancel")}}),e.draw(r),n._handles.push(e.getLayer(-1))}function r(e,n){var t=n.handlePlacement;null===n.aspectRatio&&0!==n.height&&(n.aspectRatio=n.width/n.height),("corners"===t||"both"===t)&&(a(e,n,-1,-1),a(e,n,1,-1),a(e,n,1,1),a(e,n,-1,1)),("sides"===t||"both"===t)&&(a(e,n,0,-1),a(e,n,1,0),a(e,n,0,1),a(e,n,-1,0)),n.guide&&d(e,n)}function i(e){var n=e._guide;n&&(n.x=e.x,n.y=e.y,n.width=e.width,n.height=e.height,n.fromCenter=e.fromCenter)}function d(e,n){var t,a;t=$.extend({},n.guide,{layer:!0,draggable:!1,type:"rectangle",handle:null}),e.addLayer(t),a=e.getLayer(-1),n._guide=a,e.moveLayer(a,-n._handles.length-1),i(n)}function o(e,n){var a,r,i,d;for(a in n)n.hasOwnProperty(a)&&(r=n[a],null!==a.match(/c?x(\d+)/gi)&&(i=a,d=a.replace("x","y"),t(e,n,i,d)));n.guide&&s(e,n)}function h(e){var n=e._handles,t=e._guides,a,r,i,d;if(e._method===$.fn.drawQuadratic){if(n&&(i=e._guide))for(r=0;r<n.length;r+=1)a=e._handles[r],i["x"+(r+1)]=a.x,i["y"+(r+1)]=a.y}else if(e._method===$.fn.drawBezier&&t)for(d=0;d<t.length;d+=1)if(i=t[d],n=i._handles,i&&n)for(r=0;r<n.length;r+=1)a=n[r],i["x"+(r+1)]=a.x,i["y"+(r+1)]=a.y}function s(e,n){var t=n._handles,a,r,i,d,o,s,l;if(l=$.extend({},n.guide,{layer:!0,draggable:!1,type:"line"}),n._method===$.fn.drawQuadratic)e.addLayer(l),n._guide=e.getLayer(-1),e.moveLayer(n._guide,-t.length-1);else if(n._method===$.fn.drawBezier)for(n._guides=[],o=0;o<t.length;o+=1)d=t[o],r=t[o+1],a=t[o-1],i=null,void 0!==r?0===d._xProp.indexOf("x")&&0===r._xProp.indexOf("cx")&&(i=r):void 0!==a&&0===a._xProp.indexOf("cx")&&0===d._xProp.indexOf("x")&&(i=a),null!==i&&(e.addLayer(l),s=e.getLayer(-1),s._handles=[d,i],n._guides.push(s),e.moveLayer(s,-t.length-1));h(n)}function l(e){var n,t;if(e._handles)for(t=0;t<e._handles.length;t+=1)n=e._handles[t],n.x=e.x+e.width/2*n._px,n.y=e.y+e.height/2*n._py;i(e)}function g(e){var n=e._handles,t,a;if(n)for(a=0;a<n.length;a+=1)t=n[a],t.x=e[t._xProp]+e.x,t.y=e[t._yProp]+e.y;h(e)}function p(t){var a=$(t.canvas);void 0===t._handles&&(t._handles=[]),e(t)?(r(a,t),$.jCanvas.eventHooks.drag=function(n){e(n)&&l(n)}):n(t)&&(o(a,t),$.jCanvas.eventHooks.drag=function(e){n(e)&&g(e)})}$.extend($.jCanvas.defaults,{handle:null,guide:null,aspectRatio:null,resizeFromCenter:!0,constrainProportions:!1,handlePlacement:"corners",minWidth:0,minHeight:0}),$.extend($.jCanvas.eventHooks,{add:function(e){e.handle&&p(e)},change:function(t,a){var r,i,d;if(a.handle)p(t);else if(null===a.handle&&(r=$(this),t._handles)){for(d=0;d<t._handles.length;d+=1)i=t._handles[d],r.removeLayer(i);t._handles.length=0}e(t)?(void 0!==a.width||void 0!==a.height)&&l(t):n(t)&&g(t)},animate:function(t,a){e(t)?("width"===a.prop||"height"===a.prop||"x"===a.prop||"y"===a.prop)&&l(t):n(t)&&null!==a.prop.match(/^c?(x|y)(\d+)/gi)&&g(t)}})}(jQuery);