/*
 jCanvas v5.5b
Copyright 2012, Caleb Evans
Licensed under the MIT license
*/
(function(b,O,R,N,aa,z,E,a,u){function w(){}function B(d){d?v(P,d):P=v(w.prototype,K);return this}function C(d,c){d.fillStyle=c.fillStyle;d.strokeStyle=c.strokeStyle;d.lineWidth=c.strokeWidth;c.rounded?(d.lineCap="round",d.lineJoin="round"):(d.lineCap=c.strokeCap,d.lineJoin=c.strokeJoin,d.miterLimit=c.miterLimit);d.shadowOffsetX=c.shadowX;d.shadowOffsetY=c.shadowY;d.shadowBlur=c.shadowBlur;d.shadowColor=c.shadowColor;d.globalAlpha=c.opacity;d.globalCompositeOperation=c.compositing}function s(d){return d&&
d.getContext?d.getContext("2d"):a}function H(d,c){c.mask&&(c.autosave&&d.save(),d.clip());c.closed?(d.closePath(),d.fill(),d.stroke()):(d.fill(),d.stroke(),d.closePath())}function S(d,c){if(!c.translateX&&!c.translateY&&(c.x||c.y))c.translateX=c.x,c.translateY=c.y;c.translate&&(c.translateX=c.translateY=c.translate);d.translate(c.translateX,c.translateY)}function T(d,c){1!==c.scale&&(c.scaleX=c.scaleY=c.scale);d.translate(c.x,c.y);d.scale(c.scaleX,c.scaleY);d.translate(-c.x,-c.y)}function U(d,c){c.toRad=
c.inDegrees?A/180:1;c.rotate=c.rotate||c.angle;d.translate(c.x,c.y);d.rotate(c.rotate*c.toRad);d.translate(-c.x,-c.y)}function G(d,c,i,b,y){i.toRad=i.inDegrees?A/180:1;c.save();y=y||b;!d&&!i.fromCenter&&(i.x+=b/2,i.y+=y/2);(i.rotate||i.angle)&&U(c,i);(1!==i.scale||1!==i.scaleX||1!==i.scaleY)&&T(c,i);(i.translate||i.translateX||i.translateY)&&S(c,i)}function V(d,c,i){i&&i.visible&&(i.method===b.fn.draw?i.fn.call(d[0],c):i.method&&i.method.call(d,i))}function D(d,c,i){var a,y,q,m="function"===typeof c,
c=c||{};if(c.layer&&!c._layer){a=b(d);y=a.getLayers();m&&(c={method:b.fn.draw,fn:c,name:c.name,group:c.group,visible:c.visible});c=v(new w,c);if(!m)for(q in c.method=b.fn[c.method]||i,c.method!==b.fn.drawImage&&(c.width=c.width||0,c.height=c.height||0),B.events)B.events.hasOwnProperty(q)&&c[q]&&(b.data(d,"jCanvas-"+q)||B.events[q].call(b,a),c._event=z);c.layer=z;c._layer=z;c.index===u&&(c.index=y.length);y.splice(c.index,0,c)}}function W(d){var c;for(c=0;c<I.length;c+=1)d[I[c]]=d["_"+I[c]]}function X(d){var c;
for(c=0;c<I.length;c+=1)d["_"+I[c]]=d[I[c]]}function Y(d){var c,i,a=[],y=1;d.match(/^#?[a-z0-9]+$/i)&&(i=O.head,c=i.style.color,i.style.color=d,d=b.css(i,"color"),i.style.color=c);d.match(/^rgb/i)&&(a=d.match(/[0-9]+/gi),d.match(/%/gi)&&(y=2.55),a[0]*=y,a[1]*=y,a[2]*=y);return a}function ca(d){var c;"object"!==typeof d.start&&(d.start=Y(d.start),d.end=Y(d.end));d.now=[];for(c=0;3>c;c+=1)d.now[c]=L(d.start[c]+(d.end[c]-d.start[c])*d.pos);d.now="rgb("+d.now.join(",")+")";d.elem.style?d.elem.style[d.prop]=
d.now:d.elem[d.prop]=d.now}function Z(d){var c=b.data(d,"eventCache");c||(c=b.data(d,"eventCache",{x:[],y:[]}));return c}function J(d){B.events[d]=function(c){var i="mouseover"===d||"mouseout"===d?"mousemove":d;c.bind(i+".jCanvas",function(d){var b=Z(c[0]);b.x[1]=b.x[0];b.y[1]=b.y[0];b.x[0]=d.offsetX;b.y[0]=d.offsetY;b.type=i;c.drawLayers()});b.data(c[0],"jCanvas-"+d,z)}}function F(d,c,i){var a=b.data(d,"eventCache"),y,q,m;y=i[a.type];q=c.isPointInPath(a.x[0],a.y[0]);m=c.isPointInPath(a.x[1],a.y[1]);
i.mouseX=a.x[0];i.mouseY=a.y[0];if(i.mouseover||i.mouseout)q&&!m&&!i._fired?(i._fired=z,i.mouseover&&(i.mouseover.call(d,i),C(c,i))):!q&&(m&&i._fired)&&(i._fired=E,i.mouseout&&(i.mouseout.call(d,i),C(c,i)));y&&q&&(y.call(d,i),C(c,i))}var K,P,v=b.extend,L=N.round,A=N.PI,$=N.sin,Q=N.cos,da=b.event.fix,M={},I;b.fn.jCanvas=B;B.version="5.5b";B.events={};K={angle:0,align:"center",autosave:z,baseline:"middle",ccw:E,closed:E,compositing:"source-over",cornerRadius:0,cropFromCenter:z,each:a,end:360,fillStyle:"transparent",
font:"12pt sans-serif",fromCenter:z,height:a,inDegrees:z,load:a,mask:E,miterLimit:10,opacity:1,projection:0,r1:a,r2:a,radius:0,repeat:"repeat",rotate:0,rounded:E,scale:1,scaleX:1,scaleY:1,shadowBlur:0,shadowColor:"transparent",shadowX:0,shadowY:0,sHeight:a,sides:3,source:"",start:0,strokeCap:"butt",strokeJoin:"miter",strokeStyle:"transparent",strokeWidth:1,sWidth:a,sx:a,sy:a,text:"",translate:0,translateX:0,translateY:0,visible:z,width:a,x:0,y:0};B();B.extend=function(d){K=v(K,d.props);B();d.name&&
(b.fn[d.name]=function(c){var i,b,a=v(new w,c);for(i=0;i<this.length;i+=1)if(c=this[i],b=s(c))C(b,a),d.fn.call(c,b,a);return this});return b.fn[d.name]};b.fn.loadCanvas=function(){return s(this[0])};b.fn.draw=function(d){var c,i;d&&!d.fn&&(d={fn:d});v(new w,d);for(c=0;c<this.length;c+=1)(i=s(this[c]))&&d.fn.call(this[c],i);return this};b.fn.clearCanvas=function(d){for(var c,i=v(new w,d),d=0;d<this.length;d+=1)if(c=s(this[d]))G(d,c,i,i.width,i.height),!i.x&&!i.y&&!i.width&&!i.height?c.clearRect(0,
0,this[d].width,this[d].height):c.clearRect(i.x-i.width/2,i.y-i.height/2,i.width,i.height);return this};b.fn.saveCanvas=function(){var d,c;for(d=0;d<this.length;d+=1)(c=s(this[d]))&&c.save();return this};b.fn.restoreCanvas=function(){var d,c;for(d=0;d<this.length;d+=1)(c=s(this[d]))&&c.restore();return this};b.fn.translateCanvas=function(d){for(var c,i=v(new w,d),d=0;d<this.length;d+=1)if(c=s(this[d]))i.autosave&&c.save(),S(c,i);return this};b.fn.scaleCanvas=function(d){for(var c,i=v(new w,d),d=0;d<
this.length;d+=1)if(c=s(this[d]))i.autosave&&c.save(),T(c,i);return this};b.fn.rotateCanvas=function(d){for(var c,i=v(new w,d),d=0;d<this.length;d+=1)if(c=s(this[d]))i.autosave&&c.save(),U(c,i);return this};b.fn.drawRect=function c(i){var b,a,q=v(new w,i),m,n,p,r,j;for(b=0;b<this.length;b+=1)if(a=s(this[b]))D(this[b],i,c),C(a,q),G(b,a,q,q.width,q.height),a.beginPath(),m=q.x-q.width/2,n=q.y-q.height/2,(j=q.cornerRadius)?(q.closed=z,p=q.x+q.width/2,r=q.y+q.height/2,0>p-m-2*j&&(j=(p-m)/2),0>r-n-2*j&&
(j=(r-n)/2),a.moveTo(m+j,n),a.lineTo(p-j,n),a.arc(p-j,n+j,j,3*A/2,2*A,E),a.lineTo(p,r-j),a.arc(p-j,r-j,j,0,A/2,E),a.lineTo(m+j,r),a.arc(m+j,r-j,j,A/2,A,E),a.lineTo(m,n+j),a.arc(m+j,n+j,j,A,3*A/2,E)):a.rect(m,n,q.width,q.height),a.restore(),q._event&&F(this[b],a,i),H(a,q);return this};b.fn.drawArc=function i(a){var b,q,m=v(new w,a);!m.inDegrees&&360===m.end&&(m.end=2*A);for(b=0;b<this.length;b+=1)if(q=s(this[b]))D(this[b],a,i),C(q,m),G(b,q,m,2*m.radius),q.beginPath(),q.arc(m.x,m.y,m.radius,m.start*
m.toRad-A/2,m.end*m.toRad-A/2,m.ccw),q.restore(),m._event&&F(this[b],q,a),H(q,m);return this};b.fn.drawEllipse=function ba(b){var a,m,n=v(new w,b),p=4*n.width/3,r=n.height;for(a=0;a<this.length;a+=1)if(m=s(this[a]))D(this[a],b,ba),C(m,n),G(a,m,n,n.width,n.height),m.beginPath(),m.moveTo(n.x,n.y-r/2),m.bezierCurveTo(n.x-p/2,n.y-r/2,n.x-p/2,n.y+r/2,n.x,n.y+r/2),m.bezierCurveTo(n.x+p/2,n.y+r/2,n.x+p/2,n.y-r/2,n.x,n.y-r/2),m.restore(),n._event&&F(this[a],m,b),H(m,n);return this};b.fn.drawPolygon=function y(a){var b,
n,p=v(new w,a),r=2*A/p.sides,j=A/p.sides,e=j+A/2,h=p.radius*Q(r/2),k,l,g;p.closed=z;for(b=0;b<this.length;b+=1)if(n=s(this[b])){D(this[b],a,y);C(n,p);G(b,n,p,2*p.radius);n.beginPath();for(g=0;g<p.sides;g+=1)k=p.x+L(p.radius*Q(e)),l=p.y+L(p.radius*$(e)),n.lineTo(k,l),p.projection&&(k=p.x+L((h+h*p.projection)*Q(e+j)),l=p.y+L((h+h*p.projection)*$(e+j)),n.lineTo(k,l)),e+=r;n.restore();p._event&&F(this[b],n,a);H(n,p)}return this};b.fn.drawLine=function q(b){var a,p,r=v(new w,b),j,e,h;for(a=0;a<this.length;a+=
1)if(p=s(this[a])){D(this[a],b,q);C(p,r);j=1;for(p.beginPath();z;)if(e=r["x"+j],h=r["y"+j],e!==u&&h!==u)p.lineTo(e,h),j+=1;else break;r._event&&F(this[a],p,b);H(p,r)}return this};b.fn.drawQuad=function m(b){var a,r,j=v(new w,b),e,h,k,l,g;for(a=0;a<this.length;a+=1)if(r=s(this[a])){D(this[a],b,m);C(r,j);e=2;r.beginPath();for(r.moveTo(j.x1,j.y1);z;)if(h=j["x"+e],k=j["y"+e],l=j["cx"+(e-1)],g=j["cy"+(e-1)],h!==u&&k!==u&&l!==u&&g!==u)r.quadraticCurveTo(l,g,h,k),e+=1;else break;j._event&&F(this[a],r,b);
H(r,j)}return this};b.fn.drawBezier=function n(a){var b,j,e=v(new w,a),h,k,l,g,f,o,t,x;for(b=0;b<this.length;b+=1)if(j=s(this[b])){D(this[b],a,n);C(j,e);h=2;k=1;j.beginPath();for(j.moveTo(e.x1,e.y1);z;)if(l=e["x"+h],g=e["y"+h],f=e["cx"+k],o=e["cy"+k],t=e["cx"+(k+1)],x=e["cy"+(k+1)],l!==u&&g!==u&&f!==u&&o!==u&&t!==u&&x!==u)j.bezierCurveTo(f,o,t,x,l,g),h+=1,k+=2;else break;e._event&&F(this[b],j,a);H(j,e)}return this};b.fn.drawText=function p(a){var j,e,h=v(new w,a);for(j=0;j<this.length;j+=1)if(b(this[j]),
e=s(this[j])){D(this[j],a,p);C(e,h);e.textBaseline=h.baseline;e.textAlign=h.align;e.font=h.font;var k=this[j],l=e,g=h,f=void 0,o=void 0,t=/\b(\d*\.?\d*)\w\w\b/gi;if(M.text===g.text&&M.font===g.font)g.width=M.width,g.height=M.height;else{g.width=l.measureText(g.text).width;f=k.style.fontSize;if(o=g.font.match(t))k.style.fontSize=g.font.match(t)[0];g.height=aa(b.css(k,"fontSize"));k.style.fontSize=f}G(j,e,h,h.width,h.height);e.strokeText(h.text,h.x,h.y);e.fillText(h.text,h.x,h.y);h._event?(e.beginPath(),
e.rect(h.x-h.width/2,h.y-h.height/2,h.width,h.height),e.restore(),F(this[j],e,a),e.closePath()):e.restore()}M=h;return this};b.fn.drawImage=function r(j){function e(e,g,k){return function(){o.width||b.css(o,"width");o.height||b.css(o,"height");g||((x=o.width/o.height,f.width===a&&f.sWidth===a&&(j.width=f.width=f.sWidth=o.width),f.height===a&&f.sHeight===a&&(j.height=f.height=f.sHeight=o.height),f.width===a&&f.sWidth!==a&&(f.width=f.sWidth),f.height===a&&f.sHeight!==a&&(f.height=f.sHeight),f.sWidth===
a&&f.width!==a&&(j.sWidth=f.sWidth=o.width),f.sHeight===a&&f.height!==a&&(j.sHeight=f.sHeight=o.height),f.sx===a&&(f.sx=f.cropFromCenter?o.width/2:0),f.sy===a&&(f.sy=f.cropFromCenter?o.height/2:0),f.cropFromCenter||(f.sx+=f.sWidth/2,f.sy+=f.sHeight/2),f.sx+f.sWidth/2>o.width&&(f.sx=o.width-f.sWidth/2),0>f.sx-f.sWidth/2&&(f.sx=f.sWidth/2),0>f.sy-f.sHeight/2&&(f.sy=f.sHeight/2),f.sy+f.sHeight/2>o.height&&(f.sy=o.height-f.sHeight/2),f.width!==a&&f.height===a)?j.height=f.height=f.width/x:f.width===a&&
f.height!==a?j.width=f.width=f.height*x:f.width===a&&f.height===a&&(j.width=f.width=o.width,j.height=f.height=o.height));k.drawImage(o,f.sx-f.sWidth/2,f.sy-f.sHeight/2,f.sWidth,f.sHeight,f.x-f.width/2,f.y-f.height/2,f.width,f.height);f._event?(k.beginPath(),k.rect(f.x-f.width/2,f.y-f.height/2,f.width,f.height),k.restore(),F(h[g],k,j),k.closePath()):k.restore();f.load&&f.load.call(e,j)}}var h=this,k,l,g,f=v(new w,j),o,t,x;t=f.source.getContext;f.source.src||t?(o=f.source,f.width=o.width,f.height=o.height):
f.source&&(o=new R,o.src=f.source);for(l=0;l<h.length;l+=1)if(k=h[l],g=s(h[l]))D(h[l],j,r),C(g,f),G(l,g,f,f.width,f.height),o&&(o.complete||t?e(k,l,g)():o.onload=e(k,l,g));return h};b.fn.pattern=function(b){function j(){g=h.createPattern(l,k.repeat);k.load&&k.load.call(e[0],g)}var e=this,h,k=v(new w,b),l,g;(h=s(e[0]))?"function"===typeof k.source?(l=O.createElement("canvas"),l.width=k.width,l.height=k.height,b=s(l),k.source.call(l,b),j()):(b=k.source.getContext,k.source.src||b?l=k.source:(l=new R,
l.src=k.source),l.complete||b?j():l.onload=j):g=a;return g};b.fn.gradient=function(b){var j,b=v(new w,b),e=[],h,k,l,g,f,o,t;if(j=s(this[0])){j=b.r1!==a||b.r2!==a?j.createRadialGradient(b.x1,b.y1,b.r1,b.x2,b.y2,b.r2):j.createLinearGradient(b.x1,b.y1,b.x2,b.y2);for(g=1;b["c"+g]!==u;g+=1)b["s"+g]!==u?e.push(b["s"+g]):e.push(a);h=e.length;e[0]===a&&(e[0]=0);e[h-1]===a&&(e[h-1]=1);for(g=0;g<h;g+=1){if(e[g]!==a){o=1;t=0;k=e[g];for(f=g+1;f<h;f+=1)if(e[f]!==a){l=e[f];break}else o+=1;k>l&&(e[f]=e[g])}else e[g]===
a&&(t+=1,e[g]=k+t*((l-k)/o));j.addColorStop(e[g],b["c"+(g+1)])}}else j=a;return j};b.fn.setPixels=function j(b){var h,k,l,g=v(new w,b),f={},o,t,x,u;for(k=0;k<this.length;k+=1)if(h=this[k],l=s(h)){D(this[k],b,j);G(k,l,g,g.width,g.height);!g.x&&(!g.y&&!g.width&&!g.height)&&(g.width=h.width,g.height=h.height,g.x=g.width/2,g.y=g.height/2);o=l.getImageData(g.x-g.width/2,g.y-g.height/2,g.width,g.height);t=o.data;u=t.length;f=[];if(g.each!==a)for(x=0;x<u;x+=4)f.r=t[x],f.g=t[x+1],f.b=t[x+2],f.a=t[x+3],g.each.call(h,
f),t[x]=f.r,t[x+1]=f.g,t[x+2]=f.b,t[x+3]=f.a;l.putImageData(o,g.x-g.width/2,g.y-g.height/2);l.restore()}return this};b.fn.getCanvasImage=function(b,e){var h=this[0];return h&&h.toDataURL?h.toDataURL("image/"+b,e):a};b.fn.getLayers=function(){var j=this[0],e;!j||!j.getContext?e=[]:(e=b.data(j,"jCanvas-layers"),e||(e=[],b.data(j,"jCanvas-layers",e)));return e};b.fn.getLayer=function(b){var e=this.getLayers(),a;if(!b||!b.layer){if("string"===typeof b)for(a=0;a<e.length;a+=1)if(e[a].index=a,e[a].name===
b){b=a;break}b=e[b||0]}return b};b.fn.getLayerGroup=function(b){var a=this.getLayers(),h=[],k;for(k=0;k<a.length;k+=1)a[k].group===b&&h.push(a[k]);return h};b.fn.drawLayer=function(a){var e,h,k,l;for(e=0;e<this.length;e+=1)k=b(this[e]),h=s(this[e]),l=k.getLayer(a),V(k,h,l)};b.fn.drawLayers=function(){var a,e,h,k,l,g;for(e=0;e<this.length;e+=1)if(a=b(this[e]),h=s(this[e])){h.clearRect(0,0,this[e].width,this[e].height);k=a.getLayers();for(g=0;g<k.length;g+=1)l=k[g],V(a,h,l)}return this};b.fn.addLayer=
function(b){var a,h,b=b||{};for(a=0;a<this.length;a+=1)if(h=s(this[a]))b.layer=z,D(this[a],b);return this};b.fn.removeLayers=function(){var a,e;for(e=0;e<this.length;e+=1)a=b(this[e]).getLayers(),a.length=0;return this};b.fn.removeLayer=function(a){var e,h,k;for(e=0;e<this.length;e+=1){h=b(this[e]).getLayers();if("string"===typeof a)for(k=0;k<h.length;k+=1)if(h[k].name===a){a=k;break}h.splice(a,1)}return this};I=["width","height","opacity"];b.fn.animateLayer=function(){function j(b,a){return function(){W(a);
b.drawLayers();g[4]&&g[4].call(b)}}function e(b,a){return function(e,f){W(a);b.drawLayers();g[5]&&g[5].call(b,e,f)}}var h,k,l,g=[].slice.call(arguments,0),f;"object"===typeof g[0]&&!g[0].layer&&g.unshift(0);"object"===typeof g[2]?(g.splice(2,0,g[2].duration||a),g.splice(3,0,g[3].easing||a),g.splice(4,0,g[4].complete||a),g.splice(5,0,g[5].step||a)):(g[2]===u?(g.splice(2,0,a),g.splice(3,0,a),g.splice(4,0,a)):"function"===typeof g[2]&&(g.splice(2,0,a),g.splice(3,0,a)),g[3]===u)?(g[3]=a,g.splice(4,0,
a)):"function"===typeof g[3]&&g.splice(3,0,a);for(k=0;k<this.length;k+=1)if(h=b(this[k]),l=s(this[k]))if((l=h.getLayer(g[0]))&&l.method!==b.fn.draw)X(l),X(g[1]),f=Z(this[k]),f.x=[],f.y=[],b(l).animate(g[1],{duration:g[2],easing:b.easing[g[3]]?g[3]:a,complete:j(h,l),step:e(h,l)});return this};b.fn.delayLayer=function(a,e){var h,k;for(h=0;h<this.length;h+=1)k=b(this[h]).getLayer(a),b(k).delay(e);return this};b.fn.stopLayer=function(a,e){var h,k;for(h=0;h<this.length;h+=1)k=b(this[h]).getLayer(a),b(k).stop(e);
return this};(function(a){var e;for(e=0;e<a.length;e+=1)b.fx.step[a[e]]=ca})("color backgroundColor borderColor borderTopColor borderRightColor borderBottomColor borderLeftColor fillStyle outlineColor strokeStyle shadowColor".split(" "));J("click");J("dblclick");J("mousedown");J("mouseup");J("mousemove");J("mouseover");J("mouseout");b.event.fix=function(a){var e,a=da.call(b.event,a);if(a.pageX!==u&&a.offsetX===u&&(e=b(a.target).offset()))a.offsetX=a.pageX-e.left,a.offsetY=a.pageY-e.top;return a};
b.support.canvas=O.createElement("canvas").getContext!==u;B.defaults=K;B.prefs=P;b.jCanvas=B})(jQuery,document,Image,Math,parseFloat,!0,!1,null);
