/*
 jCanvas v6.0b
Copyright 2012, Caleb Evans
Licensed under the MIT license
*/
(function(a,O,R,N,aa,r,C,b,w){function x(){}function z(d){d?v(S,d):z.prefs=S=x.prototype=v({},J);return this}function D(d,c){d.fillStyle=c.fillStyle;d.strokeStyle=c.strokeStyle;d.lineWidth=c.strokeWidth;c.rounded?(d.lineCap="round",d.lineJoin="round"):(d.lineCap=c.strokeCap,d.lineJoin=c.strokeJoin,d.miterLimit=c.miterLimit);d.shadowOffsetX=c.shadowX;d.shadowOffsetY=c.shadowY;d.shadowBlur=c.shadowBlur;d.shadowColor=c.shadowColor;d.globalAlpha=c.opacity;d.globalCompositeOperation=c.compositing}function t(d){return d&&
d.getContext?d.getContext("2d"):b}function G(d,c){c.mask&&(c.autosave&&d.save(),d.clip());c.closed&&d.closePath();d.fill();"transparent"!==c.fillStyle&&(d.shadowColor="transparent");d.stroke();c.closed||d.closePath()}function T(d,c){if(!c.translateX&&!c.translateY&&(c.x||c.y))c.translateX=c.x,c.translateY=c.y;c.translate&&(c.translateX=c.translateY=c.translate);d.translate(c.translateX,c.translateY)}function U(d,c){1!==c.scale&&(c.scaleX=c.scaleY=c.scale);d.translate(c.x,c.y);d.scale(c.scaleX,c.scaleY);
d.translate(-c.x,-c.y)}function V(d,c){c.toRad=c.inDegrees?y/180:1;c.rotate=c.rotate||c.angle;d.translate(c.x,c.y);d.rotate(c.rotate*c.toRad);d.translate(-c.x,-c.y)}function F(d,c,j,a,A){j.toRad=j.inDegrees?y/180:1;c.save();A=A||a;!d&&!j.fromCenter&&(j.x+=a/2,j.y+=A/2);(j.rotate||j.angle)&&V(c,j);(1!==j.scale||1!==j.scaleX||1!==j.scaleY)&&U(c,j);(j.translate||j.translateX||j.translateY)&&T(c,j)}function W(d,c,j){j&&j.visible&&(j.method===a.fn.draw?j.fn.call(d[0],c):j.method&&j.method.call(d,j))}function B(d,
c,j){var b,A,o,p=("function"===typeof c).data,c=c||{};if(c.layer&&!c._layer){b=a(d);A=b.getLayers();p&&(c={method:a.fn.draw,fn:c});c=v(new x,c);c.method=a.fn[c.method]||j;data=K(d);for(o in z.events)if(z.events.hasOwnProperty(o)&&c[o]){if(!data[o])z.events[o](b);c._event=r}if(c.draggable){c._event=r;d=["mousedown","mousemove","mouseup"];for(j=0;j<d.length;j+=1)if(o=d[j],!data[o])z.events[o](b)}c.layer=r;c._layer=r;c.index===w&&(c.index=A.length);A.splice(c.index,0,c)}}function X(d){var c;for(c=0;c<
H.length;c+=1)d[H[c]]=d["_"+H[c]]}function Y(d){var c;for(c=0;c<H.length;c+=1)d["_"+H[c]]=d[H[c]]}function Z(d){var c,j,b=[],A=1;d.match(/^#?[a-z0-9]+$/i)&&(j=O.head,c=j.style.color,j.style.color=d,d=a.css(j,"color"),j.style.color=c);d.match(/^rgb/i)&&(b=d.match(/[0-9]+/gi),d.match(/%/gi)&&(A=2.55),b[0]*=A,b[1]*=A,b[2]*=A);return b}function ca(d){var c;"object"!==typeof d.start&&(d.start=Z(d.start),d.end=Z(d.end));d.now=[];for(c=0;3>c;c+=1)d.now[c]=L(d.start[c]+(d.end[c]-d.start[c])*d.pos);d.now=
"rgb("+d.now.join(",")+")";d.elem.style?d.elem.style[d.prop]=d.now:d.elem[d.prop]=d.now}function K(d){var c=a.data(d,"jCanvas");c||(c=a.data(d,"jCanvas",{layers:[],intersects:[],drag:{},events:{x:[],y:[]}}));return c}function I(d){z.events[d]=function(c){var j="mouseover"===d||"mouseout"===d?"mousemove":d,a=K(c[0]),b=a.events;c.bind(j+".jCanvas",function(d){b.x[1]=b.x[0];b.y[1]=b.y[0];b.x[0]=d.offsetX;b.y[0]=d.offsetY;b.type=j;c.drawLayers(r);d.preventDefault()});a[d]=r}}function E(d,c,j){var b=K(d),
a=b.events,o=c.isPointInPath(a.x[0],a.y[0]);c.isPointInPath(a.x[1],a.y[1]);j.mouseX=a.x[0];j.mouseY=a.y[0];!o&&(j._hovered&&!j._fired)&&(j._fired=r,j._hovered=C,j.mouseout&&j.mouseout.call(d,j));o&&b.intersects.push(j);j.over=o}var J,S,v=a.extend,L=N.round,y=N.PI,$=N.sin,P=N.cos,da=a.event.fix,M={},H;a.fn.jCanvas=z;z.version="5.6b";z.events={};J={angle:0,align:"center",autosave:r,baseline:"middle",bringToFront:r,ccw:C,closed:C,compositing:"source-over",cornerRadius:0,cropFromCenter:r,draggable:!1,
each:b,end:360,fillStyle:"transparent",font:"12pt sans-serif",fromCenter:r,height:b,inDegrees:r,load:b,mask:C,miterLimit:10,opacity:1,projection:0,r1:b,r2:b,radius:0,repeat:"repeat",rotate:0,rounded:C,scale:1,scaleX:1,scaleY:1,shadowBlur:0,shadowColor:"transparent",shadowX:0,shadowY:0,sHeight:b,sides:3,source:"",start:0,strokeCap:"butt",strokeJoin:"miter",strokeStyle:"transparent",strokeWidth:1,sWidth:b,sx:b,sy:b,text:"",translate:0,translateX:0,translateY:0,visible:r,width:b,x:0,y:0};z();z.extend=
function(d){J=v(J,d.props);z();d.name&&(a.fn[d.name]=function(c){var j,a,b=v(new x,c);for(j=0;j<this.length;j+=1)if(c=this[j],a=t(c))D(a,b),d.fn.call(c,a,b);return this});return a.fn[d.name]};a.fn.loadCanvas=function(){return t(this[0])};a.fn.draw=function(d){var c,j;d&&!d.fn&&(d={fn:d});v(new x,d);for(c=0;c<this.length;c+=1)(j=t(this[c]))&&d.fn.call(this[c],j);return this};a.fn.clearCanvas=function(d){for(var c,j=v(new x,d),d=0;d<this.length;d+=1)if(c=t(this[d]))F(d,c,j,j.width,j.height),!j.x||!j.y||
!j.width||!j.height?c.clearRect(0,0,this[d].width,this[d].height):c.clearRect(j.x-j.width/2,j.y-j.height/2,j.width,j.height);return this};a.fn.saveCanvas=function(){var d,c;for(d=0;d<this.length;d+=1)(c=t(this[d]))&&c.save();return this};a.fn.restoreCanvas=function(){var d,c;for(d=0;d<this.length;d+=1)(c=t(this[d]))&&c.restore();return this};a.fn.translateCanvas=function(d){for(var c,j=v(new x,d),d=0;d<this.length;d+=1)if(c=t(this[d]))j.autosave&&c.save(),T(c,j);return this};a.fn.scaleCanvas=function(d){for(var c,
j=v(new x,d),d=0;d<this.length;d+=1)if(c=t(this[d]))j.autosave&&c.save(),U(c,j);return this};a.fn.rotateCanvas=function(d){for(var c,j=v(new x,d),d=0;d<this.length;d+=1)if(c=t(this[d]))j.autosave&&c.save(),V(c,j);return this};a.fn.drawRect=function c(j){var a,b,o=v(new x,j),p,n,q,s,k;for(a=0;a<this.length;a+=1)if(b=t(this[a]))B(this[a],j,c),D(b,o),F(a,b,o,o.width,o.height),b.beginPath(),p=o.x-o.width/2,n=o.y-o.height/2,(k=o.cornerRadius)?(o.closed=r,q=o.x+o.width/2,s=o.y+o.height/2,0>q-p-2*k&&(k=
(q-p)/2),0>s-n-2*k&&(k=(s-n)/2),b.moveTo(p+k,n),b.lineTo(q-k,n),b.arc(q-k,n+k,k,3*y/2,2*y,C),b.lineTo(q,s-k),b.arc(q-k,s-k,k,0,y/2,C),b.lineTo(p+k,s),b.arc(p+k,s-k,k,y/2,y,C),b.lineTo(p,n+k),b.arc(p+k,n+k,k,y,3*y/2,C)):b.rect(p,n,o.width,o.height),o._event&&E(this[a],b,j),G(b,o),b.restore();return this};a.fn.drawArc=function j(b){var a,o,p=v(new x,b);!p.inDegrees&&360===p.end&&(p.end=2*y);for(a=0;a<this.length;a+=1)if(o=t(this[a]))B(this[a],b,j),D(o,p),F(a,o,p,2*p.radius),o.beginPath(),o.arc(p.x,
p.y,p.radius,p.start*p.toRad-y/2,p.end*p.toRad-y/2,p.ccw),p._event&&E(this[a],o,b),G(o,p),o.restore();return this};a.fn.drawEllipse=function ba(b){var a,p,n=v(new x,b),q=4*n.width/3,s=n.height;for(a=0;a<this.length;a+=1)if(p=t(this[a]))B(this[a],b,ba),D(p,n),F(a,p,n,n.width,n.height),p.beginPath(),p.moveTo(n.x,n.y-s/2),p.bezierCurveTo(n.x-q/2,n.y-s/2,n.x-q/2,n.y+s/2,n.x,n.y+s/2),p.bezierCurveTo(n.x+q/2,n.y+s/2,n.x+q/2,n.y-s/2,n.x,n.y-s/2),n._event&&E(this[a],p,b),G(p,n),p.restore();return this};a.fn.drawPolygon=
function A(a){var b,n,q=v(new x,a),s=2*y/q.sides,k=y/q.sides,f=k+y/2,i=q.radius*P(s/2),g,l,e;q.closed=r;for(b=0;b<this.length;b+=1)if(n=t(this[b])){B(this[b],a,A);D(n,q);F(b,n,q,2*q.radius);n.beginPath();for(e=0;e<q.sides;e+=1)g=q.x+L(q.radius*P(f)),l=q.y+L(q.radius*$(f)),n.lineTo(g,l),q.projection&&(g=q.x+L((i+i*q.projection)*P(f+k)),l=q.y+L((i+i*q.projection)*$(f+k)),n.lineTo(g,l)),f+=s;q._event&&E(this[b],n,a);G(n,q);n.restore()}return this};a.fn.drawLine=function o(b){var a,q,s=v(new x,b),k,f,
i;for(a=0;a<this.length;a+=1)if(q=t(this[a])){B(this[a],b,o);D(q,s);k=1;for(q.beginPath();r;)if(f=s["x"+k],i=s["y"+k],f!==w&&i!==w)q.lineTo(f,i),k+=1;else break;s._event&&E(this[a],q,b);G(q,s)}return this};a.fn.drawQuad=function p(a){var b,s,k=v(new x,a),f,i,g,l,e;for(b=0;b<this.length;b+=1)if(s=t(this[b])){B(this[b],a,p);D(s,k);f=2;s.beginPath();for(s.moveTo(k.x1,k.y1);r;)if(i=k["x"+f],g=k["y"+f],l=k["cx"+(f-1)],e=k["cy"+(f-1)],i!==w&&g!==w&&l!==w&&e!==w)s.quadraticCurveTo(l,e,i,g),f+=1;else break;
k._event&&E(this[b],s,a);G(s,k)}return this};a.fn.drawBezier=function n(b){var a,k,f=v(new x,b),i,g,l,e,h,m,u,Q;for(a=0;a<this.length;a+=1)if(k=t(this[a])){B(this[a],b,n);D(k,f);i=2;g=1;k.beginPath();for(k.moveTo(f.x1,f.y1);r;)if(l=f["x"+i],e=f["y"+i],h=f["cx"+g],m=f["cy"+g],u=f["cx"+(g+1)],Q=f["cy"+(g+1)],l!==w&&e!==w&&h!==w&&m!==w&&u!==w&&Q!==w)k.bezierCurveTo(h,m,u,Q,l,e),i+=1,g+=2;else break;f._event&&E(this[a],k,b);G(k,f)}return this};a.fn.drawText=function q(b){var k,f,i=v(new x,b);for(k=0;k<
this.length;k+=1)if(a(this[k]),f=t(this[k])){B(this[k],b,q);D(f,i);f.textBaseline=i.baseline;f.textAlign=i.align;f.font=i.font;if(i.layer){var g=this[k],l=f,e=i,h=void 0,m=void 0,u=/\b(\d*\.?\d*)\w\w\b/gi;if(M.text===e.text&&M.font===e.font)e.width=M.width,e.height=M.height;else{e.width=l.measureText(e.text).width;h=g.style.fontSize;if(m=e.font.match(u))g.style.fontSize=e.font.match(u)[0];e.height=aa(a.css(g,"fontSize"));g.style.fontSize=h}}F(k,f,i,i.width,i.height);f.fillText(i.text,i.x,i.y);"transparent"!==
i.fillStyle&&(f.shadowColor="transparent");f.strokeText(i.text,i.x,i.y);i._event?(f.beginPath(),f.rect(i.x-i.width/2,i.y-i.height/2,i.width,i.height),f.restore(),E(this[k],f,b),f.closePath()):f.restore()}M=i;return this};a.fn.drawImage=function s(k){function f(f,e,g){return function(){e||((r=m.width/m.height,h.width===b&&h.sWidth===b&&(k.width=h.width=h.sWidth=m.width),h.height===b&&h.sHeight===b&&(k.height=h.height=h.sHeight=m.height),h.width===b&&h.sWidth!==b&&(h.width=h.sWidth),h.height===b&&h.sHeight!==
b&&(h.height=h.sHeight),h.sWidth===b&&h.width!==b&&(k.sWidth=h.sWidth=m.width),h.sHeight===b&&h.height!==b&&(k.sHeight=h.sHeight=m.height),h.sx===b&&(h.sx=h.cropFromCenter?m.width/2:0),h.sy===b&&(h.sy=h.cropFromCenter?m.height/2:0),h.cropFromCenter||(h.sx+=h.sWidth/2,h.sy+=h.sHeight/2),h.sx+h.sWidth/2>m.width&&(h.sx=m.width-h.sWidth/2),0>h.sx-h.sWidth/2&&(h.sx=h.sWidth/2),0>h.sy-h.sHeight/2&&(h.sy=h.sHeight/2),h.sy+h.sHeight/2>m.height&&(h.sy=m.height-h.sHeight/2),h.width!==b&&h.height===b)?k.height=
h.height=h.width/r:h.width===b&&h.height!==b?k.width=h.width=h.height*r:h.width===b&&h.height===b&&(k.width=h.width=m.width,k.height=h.height=m.height));F(e,g,h,h.width,h.height);g.drawImage(m,h.sx-h.sWidth/2,h.sy-h.sHeight/2,h.sWidth,h.sHeight,h.x-h.width/2,h.y-h.height/2,h.width,h.height);h._event?(g.beginPath(),g.rect(h.x-h.width/2,h.y-h.height/2,h.width,h.height),g.restore(),E(a[e],g,k),g.closePath()):g.restore();h.load&&h.load.call(f,k)}}var a=this,g,l,e,h=v(new x,k),m,u,r;u=h.source.getContext;
h.source.src||u?(m=h.source,h.width=m.width,h.height=m.height):h.source&&(m=new R,m.src=h.source);for(l=0;l<a.length;l+=1)if(g=a[l],e=t(a[l]))B(a[l],k,s),D(e,h),m&&(m.complete||u?f(g,l,e)():(m.onload=f(g,l,e),m.src=m.src));return a};a.fn.pattern=function(a){function k(){e=i.createPattern(l,g.repeat);g.load&&g.load.call(f[0],e)}var f=this,i,g=v(new x,a),l,e;(i=t(f[0]))?"function"===typeof g.source?(l=O.createElement("canvas"),l.width=g.width,l.height=g.height,a=t(l),g.source.call(l,a),k()):(a=g.source.getContext,
g.source.src||a?l=g.source:(l=new R,l.src=g.source),l.complete||a)?k():(l.onload=k,l.src=l.src):e=b;return e};a.fn.gradient=function(a){var k,a=v(new x,a),f=[],i,g,l,e,h,m,u;if(k=t(this[0])){k=a.r1!==b||a.r2!==b?k.createRadialGradient(a.x1,a.y1,a.r1,a.x2,a.y2,a.r2):k.createLinearGradient(a.x1,a.y1,a.x2,a.y2);for(e=1;a["c"+e]!==w;e+=1)a["s"+e]!==w?f.push(a["s"+e]):f.push(b);i=f.length;f[0]===b&&(f[0]=0);f[i-1]===b&&(f[i-1]=1);for(e=0;e<i;e+=1){if(f[e]!==b){m=1;u=0;g=f[e];for(h=e+1;h<i;h+=1)if(f[h]!==
b){l=f[h];break}else m+=1;g>l&&(f[h]=f[e])}else f[e]===b&&(u+=1,f[e]=g+u*((l-g)/m));k.addColorStop(f[e],a["c"+(e+1)])}}else k=b;return k};a.fn.setPixels=function k(a){var i,g,l,e=v(new x,a),h={},m,u,r,w;for(g=0;g<this.length;g+=1)if(i=this[g],l=t(i)){B(this[g],a,k);F(g,l,e,e.width,e.height);if(!e.x||!e.y||!e.width||!e.height)e.width=i.width,e.height=i.height,e.x=e.width/2,e.y=e.height/2;m=l.getImageData(e.x-e.width/2,e.y-e.height/2,e.width,e.height);u=m.data;w=u.length;h=[];if(e.each!==b)for(r=0;r<
w;r+=4)h.r=u[r],h.g=u[r+1],h.b=u[r+2],h.a=u[r+3],e.each.call(i,h),u[r]=h.r,u[r+1]=h.g,u[r+2]=h.b,u[r+3]=h.a;l.putImageData(m,e.x-e.width/2,e.y-e.height/2);l.restore()}return this};a.fn.getCanvasImage=function(a,f){var i=this[0];return i&&i.toDataURL?i.toDataURL("image/"+a,f):b};a.fn.getLayers=function(){var a=this[0];return!a||!a.getContext?[]:K(a).layers};a.fn.getLayer=function(a){var f=this.getLayers(),b;if(!a||!a.layer){if("string"===typeof a)for(b=0;b<f.length;b+=1)if(f[b].name===a){a=b;break}a=
f[a||0]}return a};a.fn.setLayer=function(b,f){var i,g;b||(f=b,b=0);for(i=0;i<this.length;i+=1)g=a(this[i]).getLayer(b),v(g,f);return this};a.fn.getLayerGroup=function(a){var b=this.getLayers(),i=[],g;for(g=0;g<b.length;g+=1)b[g].group===a&&i.push(b[g]);return i};a.fn.setLayerGroup=function(b,f){var i,g,l;for(i=0;i<this.length;i+=1){g=a(this[i]).getLayers();for(l=0;l<g.length;l+=1)g[l].group===b&&v(g[l],f)}return this};a.fn.removeLayerGroup=function(b){var f,i,g;for(f=0;f<this.length;f+=1){i=a(this[f]).getLayers();
for(g=0;g<i.length;g+=1)i[g].group===b&&(i.splice(g,1),g-=1)}return this};a.fn.drawLayer=function(b){var f,i,g,l;for(f=0;f<this.length;f+=1)g=a(this[f]),i=t(this[f]),l=g.getLayer(b),W(g,i,l);return this};a.fn.drawLayers=function(b){var f,i,g,l,e,h,m;for(i=0;i<this.length;i+=1)if(f=a(this[i]),g=t(this[i])){g.clearRect(0,0,this[i].width,this[i].height);m=K(this[i]);l=m.layers;for(h=0;h<l.length;h+=1)e=l[h],e.index=h,b&&(e._fired=C),W(f,g,e);e=m.intersects[m.intersects.length-1]||{};f=m.events;f=f.type;
h=e[f];g=m.drag;if(e._event){if((e.mouseover||e.mouseout)&&!e._hovered&&!e._fired)e._fired=r,e._hovered=r,e.mouseover&&e.mouseover.call(this[i],e);h&&!e._fired&&(h.call(this[i],e),e._fired=r);e.draggable&&"mousedown"===f&&(e.bringToFront&&(l.splice(e.index,1),e.index=0,l.push(e)),g.layer=e,console.log(g.layer),g.dragging=r,g.startX=e.x,g.startY=e.y,g.endX=e.mouseX,g.endY=e.mouseY,e.dragstart&&e.dragstart.call(this[i],e))}if(g.layer&&(e.draggable&&"mouseup"===f&&(m.drag={},g.layer.dragstop&&g.layer.dragstop.call(this[i],
g.layer)),g.dragging&&"mousemove"===f))g.layer.x=g.layer.mouseX-(g.endX-g.startX),g.layer.y=g.layer.mouseY-(g.endY-g.startY),g.layer.drag&&g.layer.drag.call(this[i],g.layer)}m.intersects=[];return this};a.fn.addLayer=function(a){var b,i,a=a||{};for(b=0;b<this.length;b+=1)if(i=t(this[b]))a.layer=r,B(this[b],a);return this};a.fn.removeLayers=function(){var b,f;for(f=0;f<this.length;f+=1)b=a(this[f]).getLayers(),b.length=0;return this};a.fn.removeLayer=function(b){var f,i,g;for(f=0;f<this.length;f+=
1){i=a(this[f]).getLayers();if("string"===typeof b)for(g=0;g<i.length;g+=1)if(i[g].name===b){b=g;break}i.splice(b,1)}return this};H=["width","height","opacity"];a.fn.animateLayer=function(){function k(a,b){return function(){X(b);a.drawLayers();e[4]&&e[4].call(a[0])}}function f(a,b){return function(f,g){X(b);a.drawLayers();e[5]&&e[5].call(a[0],f,g)}}var i,g,l,e=[].slice.call(arguments,0);"object"===typeof e[0]&&!e[0].layer&&e.unshift(0);"object"===typeof e[2]?(e.splice(2,0,e[2].duration||b),e.splice(3,
0,e[3].easing||b),e.splice(4,0,e[4].complete||b),e.splice(5,0,e[5].step||b)):(e[2]===w?(e.splice(2,0,b),e.splice(3,0,b),e.splice(4,0,b)):"function"===typeof e[2]&&(e.splice(2,0,b),e.splice(3,0,b)),e[3]===w)?(e[3]=b,e.splice(4,0,b)):"function"===typeof e[3]&&e.splice(3,0,b);for(g=0;g<this.length;g+=1)if(i=a(this[g]),l=t(this[g]))if((l=i.getLayer(e[0]))&&l.method!==a.fn.draw)Y(l),Y(e[1]),a(l).animate(e[1],{duration:e[2],easing:a.easing[e[3]]?e[3]:b,complete:k(i,l),step:f(i,l)});return this};a.fn.delayLayer=
function(b,f){var i,g,f=f||0;for(i=0;i<this.length;i+=1)g=a(this[i]).getLayer(b),a(g).delay(f);return this};a.fn.stopLayer=function(b,f){var i,g;for(i=0;i<this.length;i+=1)g=a(this[i]).getLayer(b),a(g).stop(f);return this};(function(b){var f;for(f=0;f<b.length;f+=1)a.fx.step[b[f]]=ca})("color backgroundColor borderColor borderTopColor borderRightColor borderBottomColor borderLeftColor fillStyle outlineColor strokeStyle shadowColor".split(" "));I("click");I("dblclick");I("mousedown");I("mouseup");
I("mousemove");I("mouseover");I("mouseout");a.event.fix=function(b){var f,b=da.call(a.event,b);if(b.pageX!==w&&b.offsetX===w&&(f=a(b.target).offset()))b.offsetX=b.pageX-f.left,b.offsetY=b.pageY-f.top;return b};a.support.canvas=O.createElement("canvas").getContext!==w;z.defaults=J;a.jCanvas=z})(jQuery,document,Image,Math,parseFloat,!0,!1,null);
