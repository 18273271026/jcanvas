/**
 * @license jCanvas Handles v14.01.01
 * Copyright 2013 Caleb Evans
 * Released under the MIT license
 */(function(e){function M(t){var n=t[u];return n===e.fn.drawRect||n===e.fn.drawEllipse||n===e.fn.drawImage}function _(t){var n=t[u];return n===e.fn.drawLine||n===e.fn[a]||n===e.fn[f]}function D(n,r,s,o){var u=e[t]({cursors:{mouseover:l,mousedown:"grabbing",mouseup:l}},r[c],{layer:i,type:"arc",draggable:i,x:r[s],y:r[o],_parent:r,_xProp:s,_yProp:o,fromCenter:i,drag:function(e){var t=e[h];t[e[p]]=e.x-t.x;t[e._yProp]=e.y-t.y;I(t)}});n.draw(u);r[d].push(n[v](-1))}function P(n,r,s,o){var u,a;if(s===-1&&o===-1||s===1&&o===1)a="nwse-resize";else if(s!==0||o!==-1&&o!==1)if(s!==-1&&s!==1||o!==0){if(s===1&&o===-1||s===-1&&o===1)a="nesw-resize"}else a="ew-resize";else a="ns-resize";u=e[t]({cursors:{mouseover:a}},r[c],{type:"arc",layer:i,draggable:i,x:r.x+s*r[m]/2,y:r.y+o*r[g]/2,_parent:r,_px:s,_py:o,fromCenter:i,dragstart:function(t){e(this)[y](t[h],"resizestart")},drag:function(t){var n=t[h];if(!n.resizeFromCenter){n[m]+=t.dx*t._px;n[g]+=t.dy*t._py;if(n[b])if(t._py===0)n[g]=n[m]/n[w];else{n[m]=n[g]*n[w];t.dx=t.dy*n[w]*t._py*t._px}t._px!==0&&(n.x+=t.dx/2);t._py!==0&&(n.y+=t.dy/2)}else{n[m]+=t.dx*t._px*2;n[g]+=t.dy*t._py*2;n[b]&&(t._py===0?n[g]=n[m]/n[w]:n[m]=n[g]*n[w])}R(n);e(this)[y](n,"resize")},dragstop:function(t){var n=t[h];e(this)[y](n,"resizestop")},dragcancel:function(t){var n=t[h];e(this)[y](n,"resizecancel")}});n.draw(u);r[d].push(n[v](-1))}function H(e,t){var n=t.handlePlacement;t[w]===r&&t[g]!==0&&(t[w]=t[m]/t[g]);if(n===o||n===E){P(e,t,-1,-1);P(e,t,1,-1);P(e,t,1,1);P(e,t,-1,1)}if(n==="sides"||n===E){P(e,t,0,-1);P(e,t,1,0);P(e,t,0,1);P(e,t,-1,0)}t[S]&&j(e,t)}function B(e){var t=e[x];if(t){t.x=e.x;t.y=e.y;t[m]=e[m];t[g]=e[g];t[T]=e[T]}}function j(n,o){var u,a;u=e[t]({},o[S],{layer:i,draggable:s,type:"rectangle",handle:r});n[N](u);a=n[v](-1);o[x]=a;n[C](a,-o[d][k]-1);B(o)}function F(e,t){var n,i,s,o;for(n in t)if(t.hasOwnProperty(n)){i=t[n];if(n.match(/c?x(\d+)/gi)!==r){s=n;o=n.replace("x","y");D(e,t,s,o)}}t[S]&&q(e,t)}function I(t){var n=t[d],r=t[L],i,s,o,l;if(t[u]===e.fn[a]){if(n){o=t[x];for(s=0;s<n[k];s+=1){i=t[d][s];o["x"+(s+1)]=i.x;o["y"+(s+1)]=i.y}}}else if(t[u]===e.fn[f]&&r)for(l=0;l<r[k];l+=1){o=r[l];n=o[d];for(s=0;s<n[k];s+=1){i=n[s];o["x"+(s+1)]=i.x;o["y"+(s+1)]=i.y}}}function q(n,o){var l=o[d],c,h,m,g,y,b,w;w=e[t]({},o[S],{layer:i,draggable:s,type:"line"});if(o[u]===e.fn[a]){n[N](w);o[x]=n[v](-1);n[C](o[x],-l[k]-1)}else if(o[u]===e.fn[f]){o[L]=[];for(y=0;y<l[k];y+=1){g=l[y];h=l[y+1];c=l[y-1];m=r;h!==undefined?g[p][A]("x")===0&&h[p][A]("cx")===0&&(m=h):c!==undefined&&c[p][A]("cx")===0&&g[p][A]("x")===0&&(m=c);if(m!==r){n[N](w);b=n[v](-1);b[d]=[g,m];o[L].push(b);n[C](b,-l[k]-1)}}}I(o)}function R(e){var t,n;if(e[d])for(n=0;n<e[d][k];n+=1){t=e[d][n];t.x=e.x+e[m]/2*t._px;t.y=e.y+e[g]/2*t._py}B(e)}function U(e){var t=e[d],n,r;if(t)for(r=0;r<t[k];r+=1){n=t[r];n.x=e[n[p]]+e.x;n.y=e[n._yProp]+e.y}I(e)}function z(t){var n=e(t.canvas);t[d]===undefined&&(t[d]=[]);if(M(t)){H(n,t);t.drag=R}else if(_(t)){F(n,t);t.drag=U}}var t="extend",n="jCanvas",r=null,i=!0,s=!1,o="corners",u="_method",a="drawQuadratic",f="drawBezier",l="grab",c="handle",h="_parent",p="_xProp",d="_handles",v="getLayer",m="width",g="height",y="triggerLayerEvent",b="constrainProportions",w="aspectRatio",E="both",S="guide",x="_guide",T="fromCenter",N="addLayer",C="moveLayer",k="length",L="_guides",A="indexOf",O="prop";e[t](e[n].defaults,{handle:r,guide:r,aspectRatio:r,resizeFromCenter:i,constrainProportions:s,handlePlacement:o,minWidth:0,minHeight:0});e[n]();e[t](e[n].eventHooks,{add:function(e){e[c]&&z(e)},change:function(t,n){var i,s,o;if(n[c])z(t);else if(n[c]===r){i=e(this);if(t[d]){for(o=0;o<t[d][k];o+=1){s=t[d][o];i.removeLayer(s)}t[d][k]=0}}M(t)?(n[m]!==undefined||n[g]!==undefined)&&R(t):_(t)&&U(t)},animate:function(e,t){var n=t.elem[u];M(e)?(t[O]===m||t[O]===g||t[O]==="x"||t[O]==="y")&&R(e):_(e)&&t[O].match(/^c?(x|y)(\d+)/gi)!==r&&U(e)}})})(jQuery);