/*!
jCanvas v4.5b
Copyright 2011, Caleb Evans
Licensed under the MIT license
*/
(function(j,v,n,t,B,c,s,l){var o,i,q,m=j.fn,k=j.extend,C=n.PI,D=n.round,a=n.sin,e=n.cos,b=["width","height","opacity"],d=["backgroundColor","color","borderColor","borderTopColor","borderRightColor","borderBottomColor","borderLeftColor","fillStyle","strokeStyle","shadowColor"];function z(F){if(!F){i=k({},o)}else{i=k({},i,F)}return this}o={width:0,height:0,cornerRadius:0,fillStyle:"transparent",strokeStyle:"transparent",strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",rounded:false,shadowX:0,shadowY:0,shadowBlur:3,shadowColor:"transparent",opacity:1,compositing:"source-over",x:0,y:0,x1:0,y1:0,start:0,end:360,ccw:false,inDegrees:true,fromCenter:true,closed:false,sides:3,angle:0,text:"",font:"normal 12pt sans-serif",align:"center",baseline:"middle",source:"",repeat:"repeat"};i=k({},o);function y(F,G){F.fillStyle=G.fillStyle;F.strokeStyle=G.strokeStyle;F.lineWidth=G.strokeWidth;if(G.rounded){F.lineCap="round";F.lineJoin="round"}else{F.lineCap=G.strokeCap;F.lineJoin=G.strokeJoin}F.shadowOffsetX=G.shadowX;F.shadowOffsetY=G.shadowY;F.shadowBlur=G.shadowBlur;F.shadowColor=G.shadowColor;F.globalAlpha=G.opacity;F.globalCompositeOperation=G.compositing}function g(F,G){if(G.mask){F.save();F.clip()}if(G.closed){F.closePath();F.fill();F.stroke()}else{F.fill();F.stroke();F.closePath()}}function f(F){return F.inDegrees?C/180:1}function x(G,I,H,F){I.toRad=f(I);G.save();if(!I.fromCenter){I.x+=H/2;I.y+=F/2}if(I.angle){G.translate(I.x,I.y);G.rotate(I.angle*I.toRad);G.translate(-I.x,-I.y)}}function A(F){F=F||{};o=k(o,F.props||{});i=k({},o);if(F.name){j.fn[F.name]=function(H){var K=this,G,I,J=k({},i,H);for(I=0;I<K.length;I+=1){if(!K[I].getContext){continue}G=K[I].getContext("2d");y(G,J);J.toRad=f(J);F.fn.call(K[I],G,J)}return K}}return this}j.fn.jCanvas=z;j.fn.loadCanvas=function(F){if(!this[0].getContext){return null}return this[0].getContext(F||"2d")};j.fn.getCanvasData=function(F){if(!this[0].toDataURL){return null}if(F===l){F="image/png"}else{F=F.replace(/^([a-z]+)$/gi,"image/$1").replace(/jpg/gi,"jpeg")}return this[0].toDataURL(F)};j.fn.draw=function(H){var G=this,F;for(F=0;F<G.length;F+=1){if(!G[F].getContext){continue}H.call(G[F],G[F].getContext("2d"))}return this};j.fn.gradient=function(G){if(!this[0].getContext){return null}var F=this[0].getContext("2d"),L=k({},i,G),K,J,I=0,H=1;if(L.r1!==l||L.r2!==l){K=F.createRadialGradient(L.x1,L.y1,L.r1,L.x2,L.y2,L.r2)}else{K=F.createLinearGradient(L.x1,L.y1,L.x2,L.y2)}while(L["c"+H]!==l){I+=1;H+=1}for(H=1;H<=I;H+=1){J=D(100/(I-1)*(H-1))/100;if(L["s"+H]===l){L["s"+H]=J}K.addColorStop(L["s"+H],L["c"+H])}return K};j.fn.pattern=function(H){if(!this[0].getContext){return null}var F=this[0].getContext("2d"),L=k({},i,H),G=new B(),J;G.src=L.source;function I(){if(G.complete){J=F.createPattern(G,L.repeat);return true}else{return false}}function K(){I();if(L.load){L.load.call(this[0],J)}}if(L.load){G.onload=K}else{if(!I()){G.onload=K}}return J};j.fn.clearCanvas=function(G){var F,H,I=k({},i,G);for(H=0;H<this.length;H+=1){if(!this[H].getContext){continue}F=this[H].getContext("2d");x(F,I,I.width,I.height);if(!I.width&&!I.height){F.clearRect(0,0,this[H].width,this[H].height)}else{F.clearRect(I.x-I.width/2,I.y-I.height/2,I.width,I.height)}}return this};j.fn.saveCanvas=function(){var F;for(F=0;F<this.length;F+=1){if(!this[F].getContext){continue}this[F].getContext("2d").save()}return this};j.fn.restoreCanvas=function(){var F;for(F=0;F<this.length;F+=1){if(!this[F].getContext){continue}this[F].getContext("2d").restore()}return this};j.fn.scaleCanvas=function(G){var F,H,I=k({},i,G);for(H=0;H<this.length;H+=1){if(!this[H].getContext){continue}F=this[H].getContext("2d");F.save();F.translate(I.x,I.y);F.scale(I.width,I.height);F.translate(-I.x,-I.y)}return this};j.fn.translateCanvas=function(G){var F,H,I=k({},i,G);for(H=0;H<this.length;H+=1){if(!this[H].getContext){continue}F=this[H].getContext("2d");F.save();F.translate(I.x,I.y)}return this};j.fn.rotateCanvas=function(G){var F,H,I=k({},i,G);for(H=0;H<this.length;H+=1){if(!this[H].getContext){continue}F=this[H].getContext("2d");x(F,I,0,0)}return this};j.fn.drawRect=function(K){var N,J,I=k({},i,K),H,M,G,L,F;for(J=0;J<this.length;J+=1){if(!this[J].getContext){continue}N=this[J].getContext("2d");y(N,I);x(N,I,I.width,I.height);N.beginPath();if(I.cornerRadius){H=I.x-I.width/2;M=I.y-I.height/2;G=I.x+I.width/2;L=I.y+I.height/2;F=I.cornerRadius;if((G-H)-(2*F)<0){F=(G-H)/2}if((L-M)-(2*F)<0){F=(L-M)/2}N.moveTo(H+F,M);N.lineTo(G-F,M);N.arc(G-F,M+F,F,3*C/2,C*2,false);N.lineTo(G,L-F);N.arc(G-F,L-F,F,0,C/2,false);N.lineTo(H+F,L);N.arc(H+F,L-F,F,C/2,C,false);N.lineTo(H,M+F);N.arc(H+F,M+F,F,C,3*C/2,false);I.closed=true}else{N.rect(I.x-I.width/2,I.y-I.height/2,I.width,I.height)}N.restore();g(N,I)}return this};j.fn.drawArc=function(G){var F,H,I=k({},i,G);if(!I.inDegrees&&I.end===360){I.end=C*2}for(H=0;H<this.length;H+=1){if(!this[H].getContext){continue}F=this[H].getContext("2d");y(F,I);x(F,I,I.radius*2,I.radius*2);F.beginPath();F.arc(I.x,I.y,I.radius,(I.start*I.toRad)-(C/2),(I.end*I.toRad)-(C/2),I.ccw);F.restore();g(F,I)}return this};j.fn.drawEllipse=function(G){var F,I,J=k({},i,G),H=J.width*4/3;for(I=0;I<this.length;I+=1){if(!this[I].getContext){continue}F=this[I].getContext("2d");y(F,J);x(F,J,J.width,J.height);F.beginPath();F.moveTo(J.x,J.y-J.height/2);F.bezierCurveTo(J.x-H/2,J.y-J.height/2,J.x-H/2,J.y+J.height/2,J.x,J.y+J.height/2);F.bezierCurveTo(J.x+H/2,J.y+J.height/2,J.x+H/2,J.y-J.height/2,J.x,J.y-J.height/2);F.restore();g(F,J)}return this};j.fn.drawLine=function(H){var G,K,L=k({},i,H),F=2,J=0,I=0;for(K=0;K<this.length;K+=1){if(!this[K].getContext){continue}G=this[K].getContext("2d");y(G,L);G.beginPath();G.moveTo(L.x1,L.y1);while(J!==l&&I!==l){J=L["x"+F];I=L["y"+F];G.lineTo(J,I);F+=1}g(G,L)}return this};j.fn.drawQuad=function(K){var N,J,I=k({},i,K),H=2,G=0,F=0,M=0,L=0;for(J=0;J<this.length;J+=1){if(!this[J].getContext){continue}N=this[J].getContext("2d");y(N,I);N.beginPath();N.moveTo(I.x1,I.y1);while(G!==l&&F!==l&&M!==l&&L!==l){G=I["x"+H];F=I["y"+H];M=I["cx"+(H-1)];L=I["cy"+(H-1)];N.quadraticCurveTo(M,L,G,F);H+=1}g(N,I)}return this};j.fn.drawBezier=function(P){var Q,O,L=k({},i,P),K=2,H=1,J=0,I=0,N=0,G=0,M=0,F=0;for(O=0;O<this.length;O+=1){if(!this[O].getContext){continue}Q=this[O].getContext("2d");y(Q,L);Q.beginPath();Q.moveTo(L.x1,L.y1);while(J!==l&&I!==l&&N!==l&&G!==l&&M!==l&&F!==l){J=L["x"+K];I=L["y"+K];N=L["cx"+H];G=L["cy"+H];M=L["cx"+(H+1)];F=L["cy"+(H+1)];Q.bezierCurveTo(N,G,M,F,J,I);K+=1;H+=2}g(Q,L)}return this};j.fn.drawText=function(G){var F,H,I=k({},i,G);for(H=0;H<this.length;H+=1){if(!this[H].getContext){continue}F=this[H].getContext("2d");y(F,I);F.textBaseline=I.baseline;F.textAlign=I.align;F.font=I.font;F.strokeText(I.text,I.x,I.y);F.fillText(I.text,I.x,I.y)}return this};j.fn.drawImage=function(L){var N,G,K,I=k({},i,L),J=new B(),F;J.src=I.source;function M(O){if(J.complete){F=J.width/J.height;if(I.sx===l){I.sx=J.width/2}if(I.sy===l){I.sy=J.height/2}I.sWidth=I.sWidth||J.width;I.sHeight=I.sHeight||J.height;if(I.width&&!I.height){I.height=I.width/F}else{if(!I.width&&I.height){I.width=I.height*F}else{if(!I.width&&!I.height){I.width=J.width;I.height=J.height}}}x(O,I,I.width,I.height);O.drawImage(J,I.sx-I.sWidth/2,I.sy-I.sHeight/2,I.sWidth,I.sHeight,I.x-I.width/2,I.y-I.height/2,I.width,I.height);O.restore();return true}else{return false}}function H(){M(N);if(I.load){I.load.call(G)}}for(K=0;K<this.length;K+=1){G=this[K];if(!G.getContext){continue}N=G.getContext("2d");y(N,I);if(I.load){J.onload=H}else{if(!M(N)){J.onload=H}}}return this};j.fn.drawPolygon=function(L){var Q,K,I=k({},i,L),R=C/I.sides,H=(C/2)+R,P=(C*2)/I.sides,O=e(P/2)*I.radius,G,N,F,M,J;I.closed=true;if(I.sides>2){for(K=0;K<this.length;K+=1){if(!this[K].getContext){continue}Q=this[K].getContext("2d");y(Q,I);x(Q,I,I.radius,I.radius);Q.beginPath();for(J=0;J<I.sides;J+=1){G=I.x+D(I.radius*e(H));N=I.y+D(I.radius*a(H));if(J===0){Q.moveTo(G,N)}else{Q.lineTo(G,N)}if(I.projection){F=I.x+D((O+O*I.projection)*e(H+R));M=I.y+D((O+O*I.projection)*a(H+R));Q.lineTo(F,M)}H+=P}Q.restore();g(Q,I)}}return this};j.fn.setPixels=function(M){var O,G,L,J,H=k({},i,M),F,I,K,N;for(L=0;L<this.length;L+=1){G=this[L];if(!G.getContext){continue}O=G.getContext("2d");if(!H.x&&!H.y&&!H.width&&!H.height){H.width=G.width;H.height=G.height;H.x=H.width/2;H.y=H.height/2}x(O,H,H.width,H.height);F=O.getImageData(H.x-H.width/2,H.y-H.height/2,H.width,H.height);I=F.data;K=I.length;N=[];if(H.each!==l){for(J=0;J<K;J+=4){N=H.each.call(G,I[J],I[J+1],I[J+2],I[J+3]);I[J]=N[0];I[J+1]=N[1];I[J+2]=N[2];I[J+3]=N[3]}}O.putImageData(F,H.x-H.width/2,H.y-H.height/2);O.restore()}return this};function u(G,H){var F;for(F=0;F<G.length;F+=1){H[G[F]]=H["_"+G[F]]}}function w(G,H){var F;for(F=0;F<G.length;F+=1){H["_"+G[F]]=H[G[F]]}}q={aqua:"#0ff",black:"#000",blue:"#00f",fuchsia:"#f0f",gray:"#808080",green:"#008000",lime:"#0f0",maroon:"#800000",navy:"#000080",olive:"808000",purple:"#800080",red:"#f00",silver:"#c0c0c0",teal:"#008080",white:"#fff",yellow:"#ff0"};function h(G){var H=[],F=1,I;if(G.match(/^[a-z]+$/gi)){I=v.createElement("div");I.style.color=G;G=q[G]||j.css(I,"color")}if(G.match(/^\#/gi)){if(G.length===4){G=G.replace(/(\w)/gi,"$1$1")}H=G.match(/[0-9a-f]{2}/gi);H[0]=s(H[0],16);H[1]=s(H[1],16);H[2]=s(H[2],16)}else{if(G.match(/^rgb/gi)){H=G.match(/[0-9\.]+/gi);if(G.match(/\%/gi)){F=2.55}H[0]=c(H[0])*F;H[1]=c(H[1])*F;H[2]=c(H[2])*F}}if(G.indexOf("rgba")!==-1){H[3]=c(H[3])}else{H[3]=1}return H}function E(H,I,F,G){H.now[G]=I[G]+(F[G]-I[G])*H.pos;if(G<3){H.now[G]=D(H.now[G])}}function p(G){var H=h(G.start),F=h(G.end);if(!H||!F){G.now=G.end}else{G.now=[];E(G,H,F,0);E(G,H,F,1);E(G,H,F,2);E(G,H,F,3);G.now="rgba("+G.now.join(",")+")"}if(G.elem.style){G.elem.style[G.prop]=G.now}else{G.elem[G.prop]=G.now}}function r(F){var G;for(G=0;G<F.length;G+=1){if(!j.fx.step[F[G]]){j.fx.step[F[G]]=p}}}j.fn.getLayers=function(){var F=this[0],G;if(!F||!F.getContext){return[]}G=j.data(F,"layers");if(G===l){G=[];j.data(F,"layers",G)}return G};j.fn.addLayer=function(G){var J=this,F,I,H;for(H=0;H<J.length;H+=1){F=j(J[H]);if(!J[H].getContext){continue}I=F.getLayers();if(typeof G==="function"){G.fn="draw"}I.push(G)}return J};j.fn.drawLayers=function(){var L=this,G,F,K,J,I,H;for(I=0;I<L.length;I+=1){G=j(L[I]);if(!G[0].getContext){continue}F=G[0].getContext("2d");J=G.getLayers();for(H=0;H<J.length;H+=1){K=J[H];if(K.fn==="draw"){K.call(G[0],F)}else{if(m[K.fn]){m[K.fn].call(G,K)}}}}return L};j.fn.animateLayer=function(){var K=this,G=t.prototype.slice.call(arguments,0),F,J,H,I;if(typeof G[0]==="object"){G.unshift(0)}if(G[2]===l){G.splice(2,0,null);G.splice(3,0,null);G.splice(4,0,function(){})}else{if(typeof G[2]==="function"){G.splice(2,0,null);G.splice(3,0,null)}}if(G[3]===l){G[3]=null;G.splice(4,0,function(){})}else{if(typeof G[3]==="function"){G.splice(3,0,null)}}if(G[4]===l){G[4]=function(){}}for(I=0;I<K.length;I+=1){F=j(K[I]);J=F.getLayers();H=J[G[0]];if(H===l||typeof H==="function"){continue}H=k({},i,H);J[G[0]]=H;w(b,H);w(b,G[1]);j(H).animate(G[1],{queue:false,duration:G[2],easing:G[3],complete:(function(L){return function(){L.clearCanvas().drawLayers();G[4].call(L[0])}}(F)),step:(function(L,M){return function(){u(b,M);L.clearCanvas().drawLayers()}}(F,H))})}return K};r(d);z.defaults=o;z.prefs=i;z.extend=A;j.jCanvas=z}(jQuery,document,Math,Array,Image,parseFloat,parseInt));