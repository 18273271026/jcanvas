/*!
jCanvas v5.3b
Copyright 2012, Caleb Evans
Licensed under the MIT license
*/
(function(v,D,c,s,F,r,n,t,J,u,w){var x,L,C=v.extend,H=s.round,d=s.PI,o=s.sin,b=s.cos,k=v.event.fix,q={},z,A;function B(){}function I(M){if(M){C(L,M)}else{L=B.prototype=C({},x)}return this}I.version="5.3b";I.events={};v.fn.jCanvas=I;x={align:"center",angle:0,baseline:"middle",ccw:J,closed:J,compositing:"source-over",cornerRadius:0,cropFromCenter:t,each:u,end:360,fillStyle:"transparent",font:"12pt sans-serif",fromCenter:t,height:u,inDegrees:t,load:u,mask:J,opacity:1,projection:0,r1:u,r2:u,radius:0,repeat:"repeat",rounded:J,scaleX:1,scaleY:1,shadowBlur:3,shadowColor:"transparent",shadowX:0,shadowY:0,sHeight:0,sides:3,source:"",start:0,strokeCap:"butt",strokeJoin:"miter",strokeStyle:"transparent",strokeWidth:1,sWidth:0,sx:u,sy:u,text:"",visible:t,width:u,x:0,x1:0,x2:0,y:0,y1:0,y2:0};I();function a(M,N){M.fillStyle=N.fillStyle;M.strokeStyle=N.strokeStyle;M.lineWidth=N.strokeWidth;if(N.rounded){M.lineCap="round";M.lineJoin="round"}else{M.lineCap=N.strokeCap;M.lineJoin=N.strokeJoin}M.shadowOffsetX=N.shadowX;M.shadowOffsetY=N.shadowY;M.shadowBlur=N.shadowBlur;M.shadowColor=N.shadowColor;M.globalAlpha=N.opacity;M.globalCompositeOperation=N.compositing}q.fired=J;q.x=[];q.y=[];function y(M){I.events[M]=function(N){N.unbind(M+".jCanvas").bind(M+".jCanvas",function(O){q.x[0]=O.offsetX;q.y[0]=O.offsetY;q.type=O.type;N.drawLayers()})}}y("click");y("dblclick");y("mousedown");y("mouseup");y("mousemove");I.events.mouseover=I.events.mouseout=function(M){M.unbind("mousemove.hover").bind("mousemove.hover",function(){q.x[1]=q.x[0];q.y[1]=q.y[0];q.x[0]=event.offsetX;q.y[0]=event.offsetY;q.type="hover";M.drawLayers()})};function e(M){M.mouseX=q.x[0];M.mouseY=q.y[0];q.x[0]=w;q.y[0]=w}function G(O,M,Q){var R=Q[q.type],P=M.isPointInPath(q.x[0],q.y[0]),N=M.isPointInPath(q.x[1],q.y[1]);if(q.type==="hover"&&N&&!q.fired){q.fired=t;e(Q);if(Q.mouseover){Q.mouseover.call(O,Q);a(M,Q)}}else{if(q.type==="hover"&&!P&&N){q.fired=J;e(Q);if(Q.mouseout){Q.mouseout.call(O,Q);a(M,Q)}}else{if(R&&q.type!=="hover"&&P){e(Q);R.call(O,Q);a(M,Q)}}}}function i(M){return(M.getContext?M.getContext("2d"):u)}function p(M,N){if(N.mask){M.save();M.clip()}if(N.closed){M.closePath();M.fill();M.stroke()}else{M.fill();M.stroke();M.closePath()}}function g(N,P,O,M){P.toRad=(P.inDegrees?d/180:1);N.save();if(!P.fromCenter){P.x+=O/2;P.y+=M/2}if(P.angle){N.translate(P.x,P.y);N.rotate(P.angle*P.toRad);N.translate(-P.x,-P.y)}}function m(M){M=M||{};x=C(x,M.props);I();if(M.name){v.fn[M.name]=function(O){var S=this,P,Q,N,R=C(new B(),O);for(Q=0;Q<S.length;Q+=1){P=S[Q];N=i(P);if(N){a(N,R);M.fn.call(P,N,R)}}return S}}return v.fn[M.name]}v.fn.loadCanvas=function(){return i(this[0])};v.fn.getCanvasImage=function(M){var N=this[0];if(!N||!N.toDataURL){return u}if(M===w){M="image/png"}else{M=M.replace(/^([a-z]+)$/gi,"image/$1").replace(/jpg/gi,"jpeg")}return N.toDataURL(M)};v.fn.draw=function(P){var O=this,M,N;for(N=0;N<O.length;N+=1){M=i(O[N]);if(M){P.call(O[N],M)}}return O};v.fn.gradient=function(U){var M=this,Y,R=C(new B(),U),W,X=[],T,O,Q,S,V,P,N;Y=i(M[0]);if(Y){if(R.c2===w){W=R.c1}else{if(R.r1!==u||R.r2!==u){W=Y.createRadialGradient(R.x1,R.y1,R.r1,R.x2,R.y2,R.r2)}else{W=Y.createLinearGradient(R.x1,R.y1,R.x2,R.y2)}for(S=1;R["c"+S]!==w;S+=1){if(R["s"+S]!==w){X.push(R["s"+S])}else{X.push(u)}}T=X.length;if(X[0]===u){X[0]=0}if(X[T-1]===u){X[T-1]=1}for(S=0;S<T;S+=1){if(X[S]!==u&&X[S]!==1){V=S+1;P=1;N=0;O=X[S];for(V=(S+1);V<T;V+=1){if(X[V]!==u){Q=X[V];break}else{P+=1}}if(O>Q){X[V]=X[S]}}else{if(X[S]===u){N+=1;X[S]=O+(N*((Q-O)/P))}}W.addColorStop(X[S],R["c"+(S+1)])}}}else{W=u}return W};v.fn.pattern=function(S){var M=this,U,O=C(new B(),S),P,R;function Q(){var V=J;if(P.complete){R=U.createPattern(P,O.repeat);V=t}return V}function T(){if(O.load){O.load.call(M[0],R)}}function N(){Q();T()}U=i(M[0]);if(U){P=new F();if(O.source.src){P=O.source}else{P.src=O.source}if(!P.complete&&O.load){P.onload=N}else{if(!Q()){P.onload=N}else{T()}}}else{R=u}return R};v.fn.clearCanvas=function(N){var Q=this,O,M,P=C(new B(),N);for(O=0;O<Q.length;O+=1){M=i(Q[O]);if(M){g(M,P,P.width,P.height);if(!P.width&&!P.height){M.clearRect(0,0,Q[O].width,Q[O].height)}else{M.clearRect(P.x-P.width/2,P.y-P.height/2,P.width,P.height)}}}return Q};v.fn.saveCanvas=function(){var O=this,M,N;for(N=0;N<O.length;N+=1){M=i(O[N]);if(M){M.save()}}return O};v.fn.restoreCanvas=function(){var O=this,M,N;for(N=0;N<O.length;N+=1){M=i(O[N]);if(M){M.restore()}}return O};v.fn.scaleCanvas=function(N){var Q=this,O,M,P=C(new B(),N);for(O=0;O<Q.length;O+=1){M=i(Q[O]);if(M){M.save();M.translate(P.x,P.y);M.scale(P.scaleX,P.scaleY);M.translate(-P.x,-P.y)}}return Q};v.fn.translateCanvas=function(N){var Q=this,O,M,P=C(new B(),N);for(O=0;O<Q.length;O+=1){M=i(Q[O]);if(M){M.save();M.translate(P.x,P.y)}}return Q};v.fn.rotateCanvas=function(N){var Q=this,O,M,P=C(new B(),N);for(O=0;O<Q.length;O+=1){M=i(Q[O]);if(M){g(M,P,0,0)}}return Q};v.fn.drawRect=function(S){var N=this,R,V,Q=C(new B(),S),P,U,O,T,M;for(R=0;R<N.length;R+=1){V=i(N[R]);if(V){a(V,Q);g(V,Q,Q.width,Q.height);V.beginPath();if(Q.cornerRadius){Q.closed=t;P=Q.x-Q.width/2;U=Q.y-Q.height/2;O=Q.x+Q.width/2;T=Q.y+Q.height/2;M=Q.cornerRadius;if((O-P)-(2*M)<0){M=(O-P)/2}if((T-U)-(2*M)<0){M=(T-U)/2}V.moveTo(P+M,U);V.lineTo(O-M,U);V.arc(O-M,U+M,M,3*d/2,d*2,J);V.lineTo(O,T-M);V.arc(O-M,T-M,M,0,d/2,J);V.lineTo(P+M,T);V.arc(P+M,T-M,M,d/2,d,J);V.lineTo(P,U+M);V.arc(P+M,U+M,M,d,3*d/2,J)}else{V.rect(Q.x-Q.width/2,Q.y-Q.height/2,Q.width,Q.height)}V.restore();if(Q.event){G(N[R],V,S)}p(V,Q)}}return N};v.fn.drawArc=function(N){var Q=this,O,M,P=C(new B(),N);if(!P.inDegrees&&P.end===360){P.end=d*2}for(O=0;O<Q.length;O+=1){M=i(Q[O]);if(M){a(M,P);g(M,P,P.radius*2,P.radius*2);M.beginPath();M.arc(P.x,P.y,P.radius,(P.start*P.toRad)-(d/2),(P.end*P.toRad)-(d/2),P.ccw);M.restore();if(P.event){G(Q[O],M,N)}p(M,P)}}return Q};v.fn.drawEllipse=function(N){var R=this,P,M,Q=C(new B(),N),O=Q.width*4/3;for(P=0;P<R.length;P+=1){M=i(R[P]);if(M){a(M,Q);g(M,Q,Q.width,Q.height);M.beginPath();M.moveTo(Q.x,Q.y-Q.height/2);M.bezierCurveTo(Q.x-O/2,Q.y-Q.height/2,Q.x-O/2,Q.y+Q.height/2,Q.x,Q.y+Q.height/2);M.bezierCurveTo(Q.x+O/2,Q.y+Q.height/2,Q.x+O/2,Q.y-Q.height/2,Q.x,Q.y-Q.height/2);M.restore();if(Q.event){G(R[P],M,N)}p(M,Q)}}return R};v.fn.drawLine=function(O){var T=this,R,N,S=C(new B(),O),M=2,Q=0,P=0;for(R=0;R<T.length;R+=1){N=i(T[R]);if(N){a(N,S);N.beginPath();N.moveTo(S.x1,S.y1);while(t){Q=S["x"+M];P=S["y"+M];if(Q!==w&&P!==w){N.lineTo(Q,P);M+=1}else{break}}if(S.event){G(T[R],N,O)}p(N,S)}}return T};v.fn.drawQuad=function(S){var M=this,R,V,Q=C(new B(),S),P=2,O=0,N=0,U=0,T=0;for(R=0;R<M.length;R+=1){V=i(M[R]);if(V){a(V,Q);V.beginPath();V.moveTo(Q.x1,Q.y1);while(t){O=Q["x"+P];N=Q["y"+P];U=Q["cx"+(P-1)];T=Q["cy"+(P-1)];if(O!==w&&N!==w&&U!==w&&T!==w){V.quadraticCurveTo(U,T,O,N);P+=1}else{break}}if(Q.event){G(M[R],V,S)}p(V,Q)}}return M};v.fn.drawBezier=function(X){var M=this,W,Y,T=C(new B(),X),S=2,P=1,R=0,Q=0,V=0,O=0,U=0,N=0;for(W=0;W<M.length;W+=1){Y=i(M[W]);if(Y){a(Y,T);Y.beginPath();Y.moveTo(T.x1,T.y1);while(t){R=T["x"+S];Q=T["y"+S];V=T["cx"+P];O=T["cy"+P];U=T["cx"+(P+1)];N=T["cy"+(P+1)];if(R!==w&&Q!==w&&V!==w&&O!==w&&U!==w&&N!==w){Y.bezierCurveTo(V,O,U,N,R,Q);S+=1;P+=2}else{break}}if(T.event){G(M[W],Y,X)}p(Y,T)}}return M};v.fn.drawText=function(O){var R=this,N,P,M,Q=C(new B(),O);for(P=0;P<R.length;P+=1){N=v(R[P]);M=i(N[0]);if(M){a(M,Q);M.textBaseline=Q.baseline;M.textAlign=Q.align;M.font=Q.font;M.strokeText(Q.text,Q.x,Q.y);M.fillText(Q.text,Q.x,Q.y)}}return R};v.fn.drawImage=function(T){var M=this,W,O,S,Q=C(new B(),T),R,N;if(Q.source.src){R=Q.source}else{if(Q.source){R=new F();R.src=Q.source}}function U(X){if(R.complete===w||R.complete===t){N=R.width/R.height;Q.sWidth=Q.sWidth||R.width;Q.sHeight=Q.sHeight||R.height;if(Q.sWidth>R.width){Q.sWidth=R.width}if(Q.sHeight>R.height){Q.sHeight=R.height}if(Q.width===u&&Q.sWidth!==R.width){Q.width=Q.sWidth}if(Q.height===u&&Q.sHeight!==R.height){Q.height=Q.sHeight}if(Q.sx===u){if(Q.cropFromCenter){Q.sx=R.width/2}else{Q.sx=0}}if(Q.sy===u){if(Q.cropFromCenter){Q.sy=R.height/2}else{Q.sy=0}}if(!Q.cropFromCenter){Q.sx+=Q.sWidth/2;Q.sy+=Q.sHeight/2}if((Q.sx+Q.sWidth/2)>R.width){Q.sx=R.width-Q.sWidth/2}if((Q.sx-Q.sWidth/2)<0){Q.sx=Q.sWidth/2}if((Q.sy-Q.sHeight/2)<0){Q.sy=Q.sHeight/2}if((Q.sy+Q.sHeight/2)>R.height){Q.sy=R.height-Q.sHeight/2}if(Q.width!==u&&Q.height===u){T.height=Q.height=Q.width/N}else{if(Q.width===u&&Q.height!==u){T.width=Q.width=Q.height*N}else{if(Q.width===u&&Q.height===u){T.width=Q.width=R.width;T.height=Q.height=R.height}}}g(X,Q,Q.width,Q.height);X.drawImage(R,Q.sx-Q.sWidth/2,Q.sy-Q.sHeight/2,Q.sWidth,Q.sHeight,Q.x-Q.width/2,Q.y-Q.height/2,Q.width,Q.height);if(Q.event){X.fillStyle="#000";X.beginPath();X.rect(Q.x-Q.width/2,Q.y-Q.height/2,Q.width,Q.height);X.restore();G(M[S],X,T);X.closePath()}else{X.restore()}return t}}function V(){if(Q.load){Q.load.call(O)}}function P(){U(W);V()}for(S=0;S<M.length;S+=1){O=M[S];W=i(M[S]);if(W){a(W,Q);if(!R.complete&&Q.load){R.onload=P}else{if(!U(W)){R.onload=P}else{V()}}}}return M};v.fn.drawPolygon=function(T){var M=this,S,Y,Q=C(new B(),T),Z=d/Q.sides,P=(d/2)+Z,X=(d*2)/Q.sides,W=b(X/2)*Q.radius,O,V,N,U,R;Q.closed=t;if(Q.sides>2){for(S=0;S<M.length;S+=1){Y=i(M[S]);if(Y){a(Y,Q);g(Y,Q,Q.radius,Q.radius);Y.beginPath();for(R=0;R<Q.sides;R+=1){O=Q.x+H(Q.radius*b(P));V=Q.y+H(Q.radius*o(P));if(R===0){Y.moveTo(O,V)}else{Y.lineTo(O,V)}if(Q.projection){N=Q.x+H((W+W*Q.projection)*b(P+Z));U=Q.y+H((W+W*Q.projection)*o(P+Z));Y.lineTo(N,U)}P+=X}Y.restore();if(Q.event){G(M[S],Y,T)}p(Y,Q)}}}return M};v.fn.setPixels=function(U){var M=this,W,O,T,R,P=C(new B(),U),N,Q,S,V={};for(T=0;T<M.length;T+=1){O=M[T];W=i(M[T]);if(W){if(!P.x&&!P.y&&!P.width&&!P.height){P.width=O.width;P.height=O.height;P.x=P.width/2;P.y=P.height/2}g(W,P,P.width,P.height);N=W.getImageData(P.x-P.width/2,P.y-P.height/2,P.width,P.height);Q=N.data;S=Q.length;V=[];if(P.each!==u){for(R=0;R<S;R+=4){V.index=R/4;V.r=Q[R];V.g=Q[R+1];V.b=Q[R+2];V.a=Q[R+3];P.each.call(O,V);Q[R]=V.r;Q[R+1]=V.g;Q[R+2]=V.b;Q[R+3]=V.a}}W.putImageData(N,P.x-P.width/2,P.y-P.height/2);W.restore()}}return M};function f(N,O){var M;for(M=0;M<N.length;M+=1){O[N[M]]=O["_"+N[M]]}}function h(N,O){var M;for(M=0;M<N.length;M+=1){O["_"+N[M]]=O[N[M]]}}z=["width","height","opacity"];A=["backgroundColor","color","borderColor","borderTopColor","borderRightColor","borderBottomColor","borderLeftColor","fillStyle","strokeStyle","shadowColor"];function j(N){var Q,P,O=[],M=1;if(typeof N==="object"){O=N}else{if(N.match(/^[a-z]+$/gi)){if(N==="transparent"){N="rgba(255,255,255,0)"}P=c.documentElement;Q=P.style.color;P.style.color=N;N=v.css(P,"color");P.style.color=Q}if(N.match(/^\#/gi)){if(N.length===4){N=N.replace(/([0-9a-f])/gi,"$1$1")}O=N.match(/[0-9a-f]{2}/gi);O[0]=n(O[0],16);O[1]=n(O[1],16);O[2]=n(O[2],16)}else{if(N.match(/^rgb/gi)){O=N.match(/[0-9\.]+/gi);if(N.match(/\%/gi)){M=2.55}O[0]=O[0]*M;O[1]=O[1]*M;O[2]=O[2]*M}}if(N.match("rgba")){O[3]=r(O[3])}else{O[3]=1}}return O}function K(N,M){N.now[M]=N.start[M]+(N.end[M]-N.start[M])*N.pos;if(M<3){N.now[M]=H(N.now[M])}}function E(M){if(typeof M.start!=="object"){M.start=j(M.start);M.end=j(M.end)}M.now=[];K(M,0);K(M,1);K(M,2);K(M,3);M.now="rgba("+M.now.join(",")+")";if(M.elem.style){M.elem.style[M.prop]=M.now}else{M.elem[M.prop]=M.now}}function l(M){var N;for(N=0;N<M.length;N+=1){if(!v.fx.step[M[N]]){v.fx.step[M[N]]=E}}}v.fn.getLayers=function(){var M=this[0],N;if(!M||!M.getContext){return u}N=v.data(M,"jCanvas-layers");if(!N){N=[];v.data(M,"jCanvas-layers",N)}return N};v.fn.getLayer=function(M){var P=this.getLayers(),O,N;if(!P){O=u}else{if(typeof M==="string"){for(N=0;N<P.length;N+=1){if(P[N].name===M){M=N;break}}}}M=M||0;O=P[M];return O};v.fn.addLayer=function(N){var S=this,M,R=C(N,new B(),v.extend({},N)),Q,O,P;R.layer=t;for(P=0;P<S.length;P+=1){M=v(S[P]);if(i(S[P])){Q=M.getLayers();if(typeof R==="function"){R.method="draw"}else{if(R.method!=="drawImage"){R.width=R.width||0;R.height=R.height||0}for(O in I.events){if(I.events.hasOwnProperty(O)&&R[O]){I.events[O].call(D,M);R.event=t}}}Q.push(R)}}S.drawLayers();return S};v.fn.removeLayers=function(){var O=this,N,M;for(M=0;M<O.length;M+=1){N=v(O[M]).getLayers()||[];N.length=0}return this};v.fn.removeLayer=function(M){var R=this,Q,O=typeof M,P,N;for(Q=0;Q<R.length;Q+=1){P=v(R[Q]).getLayers()||[];if(O==="string"){for(N=0;N<P.length;N+=1){if(P[N].name===M){P.splice(N,1);break}}}else{if(O==="number"){P.splice(M,1)}}}return this};v.fn.drawLayers=function(){var S=this,N,M,R,Q,P,O;for(P=0;P<S.length;P+=1){N=v(S[P]);M=i(N[0]);if(M){Q=N.getLayers();M.clearRect(0,0,N[0].width,N[0].height);for(O=0;O<Q.length;O+=1){R=Q[O];if(R.visible){if(R.method==="draw"){R.call(N[0],M)}else{if(v.fn[R.method]){v.fn[R.method].call(N,R)}}}}}}return S};v.fn.animateLayer=function(){var S=this,N,R,O=([]).slice.call(arguments,0),P;if(typeof O[0]==="object"&&!O[0].layer){O.unshift(0)}if(O[2]===w){O.splice(2,0,u);O.splice(3,0,u);O.splice(4,0,function(){})}else{if(typeof O[2]==="function"){O.splice(2,0,u);O.splice(3,0,u)}}if(O[3]===w){O[3]=u;O.splice(4,0,function(){})}else{if(typeof O[3]==="function"){O.splice(3,0,u)}}if(O[4]===w){O[4]=function(){}}function M(T,U){return function(){f(z,U);T.drawLayers();O[4].call(T[0])}}function Q(T,U){return function(){f(z,U);T.drawLayers()}}for(R=0;R<S.length;R+=1){N=v(S[R]);if(i(S[R])){if(O[0].layer){P=O[0]}else{P=N.getLayer(O[0])}if(P&&P.method!=="draw"){q.x=[];q.y=[];h(z,P);h(z,O[1]);v(P).animate(O[1],{duration:O[2],easing:(v.easing[O[3]]?O[3]:u),complete:M(N,P),step:Q(N,P)})}}}return S};v.event.fix=function(M){var N;M=k.call(v.event,M);if(M.pageX!==w&&M.offsetX===w){N=v(M.target).offset();if(N){M.offsetX=M.pageX-N.left;M.offsetY=M.pageY-N.top}}return M};l(A);v.support.canvas=(c.createElement("canvas").getContext!==w);I.defaults=x;I.prefs=L;I.extend=m;v.jCanvas=I}(jQuery,window,document,Math,Image,parseFloat,parseInt,true,false,null));