/*
 jCanvas
Copyright 2012, Caleb Evans
Licensed under the MIT license
*/
(function(d,S,X,Q,Y,s,A,i,r){function z(){}function C(c){c?x(Z,c):C.prefs=Z=z.prototype=x({},N);return this}function J(c,a){c.fillStyle=a.fillStyle;c.strokeStyle=a.strokeStyle;c.lineWidth=a.strokeWidth;a.rounded?(c.lineCap="round",c.lineJoin="round"):(c.lineCap=a.strokeCap,c.lineJoin=a.strokeJoin,c.miterLimit=a.miterLimit);c.shadowOffsetX=a.shadowX;c.shadowOffsetY=a.shadowY;c.shadowBlur=a.shadowBlur;c.shadowColor=a.shadowColor;c.globalAlpha=a.opacity;c.globalCompositeOperation=a.compositing}function y(c){return c&&
c.getContext?c.getContext("2d"):i}function L(c,a){a._event&&T($elems[e],c,args);a.closed&&c.closePath();c.fill();"transparent"!==a.fillStyle&&(c.shadowColor="transparent");c.stroke();a.closed||c.closePath();a._toRad&&c.restore();a.mask&&(a.autosave&&c.save(),c.clip())}function $(c,a,b){a._toRad=a.inDegrees?D/180:1;c.translate(a.x,a.y);c.rotate(a.rotate*a._toRad);c.translate(-a.x,-a.y);b.rotate+=a.rotate*a._toRad}function aa(c,a,b){1!==a.scale&&(a.scaleX=a.scaleY=a.scale);c.translate(a.x,a.y);c.scale(a.scaleX,
a.scaleY);c.translate(-a.x,-a.y);b.scaleX*=a.scaleX;b.scaleY*=a.scaleY}function ba(c,a,b){a.translate&&(a.translateX=a.translateY=a.translate);c.translate(a.translateX,a.translateY);b.translateX+=a.translateX;b.translateY+=a.translateY}function H(c,a,b,f,j){b._toRad=b.inDegrees?D/180:1;a.save();j===r&&(j=f);!c&&!b.fromCenter&&(b.x+=f/2,b.y+=j/2);b.rotate&&$(a,b,{});(1!==b.scale||1!==b.scaleX||1!==b.scaleY)&&aa(a,b,{});(b.translate||b.translateX||b.translateY)&&ba(a,b,{})}function U(c){c.draggable&&
(c.translateX+=c.x,c.translateY+=c.y)}function I(c){var a;E.elem===c?a=E.data:(a=d.data(c,"jCanvas"),a||(a={layers:[],intersects:[],drag:{},event:{},transforms:{rotate:0,scaleX:1,scaleY:1,translateX:0,translateY:0}},a.savedTransforms=x({},a.transforms),d.data(c,"jCanvas",a)),E.elem=c,E.data=a);return a}function ca(c,a,b){b&&b.visible&&(b.method===d.fn.draw?b.fn.call(c[0],a):b.method&&b.method.call(c,b))}function F(c,a,b){var f,j,h,q="function"===typeof a,w,a=a||{};if(a.layer&&!a._layer){f=d(c);j=
f.getLayers();q&&(a={method:d.fn.draw,fn:a});a=x(new z,a);if(!q){a.method=d.fn[a.method]||b;w=I(c);for(h in C.events)C.events.hasOwnProperty(h)&&a[h]&&(C.events[h](f,w),a._event=s);if(a.draggable||a.cursor){a._event=s;c=["mousedown","mousemove","mouseup"];for(b=0;b<c.length;b+=1)h=c[b],C.events[h](f,w);w.mouseout||(f.bind("mouseout.jCanvas",function(){w.drag={};f.drawLayers()}),w.mouseout=s)}}a.layer=s;a._layer=s;a.index===r&&(a.index=j.length);j.splice(a.index,0,a)}}function da(c){var a;for(a=0;a<
K.length;a+=1)c[K[a]]=c["_"+K[a]]}function ea(c,a){var b;for(b=0;b<K.length;b+=1)c["_"+K[b]]=c[K[b]],V[K[b]]=1,a&&delete c[K[b]]}function fa(c){var a,b,f=[],j=1;c.match(/^#?\w+$/i)&&("transparent"===c&&(c="rgba(0,0,0,0)"),b=S.head,a=b.style.color,b.style.color=c,c=d.css(b,"color"),b.style.color=a);c.match(/^rgb/i)&&(f=c.match(/\d+/gi),c.match(/%/gi)&&(j=2.55),f[0]*=j,f[1]*=j,f[2]*=j,f[3]=f[3]!==r?Y(f[3]):1);return f}function ha(c){var a=3,b;"object"!==typeof c.start&&(c.start=fa(c.start),c.end=fa(c.end));
c.now=[];if(1!==c.start[3]||1!==c.end[3])a=4;for(b=0;b<a;b+=1)c.now[b]=c.start[b]+(c.end[b]-c.start[b])*c.pos,3>b&&(c.now[b]=O(c.now[b]));1!==c.start[3]||1!==c.end[3]?c.now="rgba("+c.now.join(",")+")":(c.now.slice(0,3),c.now="rgb("+c.now.join(",")+")");c.elem.nodeName?c.elem.style[c.prop]=c.now:c.elem[c.prop]=c.now}function M(c){C.events[c]=function(a,b){var f="mouseover"===c||"mouseout"===c?"mousemove":c,j=b.event;b[f]||(a.bind(f+".jCanvas",function(b){j.x=b.offsetX;j.y=b.offsetY;j.type=f;a.drawLayers(s);
b.preventDefault()}),b[f]=s)}}function T(c,a,b){var c=I(c),f=c.event,a=a.isPointInPath(f.x,f.y),j=c.transforms,h,q;b.mouseX=f.x;b.mouseY=f.y;q=c.transforms.rotate;f=b.mouseX;h=b.mouseY;b._mouseX=f*P(-q)-h*R(-q);b._mouseY=h*P(-q)+f*R(-q);b._mouseX/=j.scaleX;b._mouseY/=j.scaleY;!a&&(b._hovered&&!b._fired)&&(b._mousedout=s);a&&c.intersects.push(b)}function ga(c,a,b,f,j){var h=/\b(\d*\.?\d*)\w\w\b/gi,q;if(E.text===f.text&&E.font===f.font&&E.maxWidth===f.maxWidth&&E.lineHeight===f.lineHeight)f.width=E.width,
f.height=E.height;else if(!a){f.width=b.measureText(j[0]).width;for(a=1;a<j.length;a+=1)q=b.measureText(j[a]).width,q>f.width&&(f.width=q);b=c.style.fontSize;if(a=f.font.match(h))c.style.fontSize=f.font.match(h)[0];f.height=Y(d.css(c,"fontSize"))*j.length*f.lineHeight;c.style.fontSize=b}}var N,Z,x=d.extend,O=Q.round,D=Q.PI,R=Q.sin,P=Q.cos,ia=d.event.fix,E={},K,V;d.fn.jCanvas=C;C.events={};N={align:"center",autosave:s,baseline:"middle",bringToFront:A,ccw:A,closed:A,compositing:"source-over",cornerRadius:0,
cropFromCenter:s,draggable:A,disableDrag:A,disableEvents:A,each:i,end:360,fillStyle:"transparent",font:"12pt sans-serif",fromCenter:s,height:i,inDegrees:s,lineHeight:1,load:i,mask:A,maxWidth:i,method:i,miterLimit:10,opacity:1,projection:0,r1:i,r2:i,radius:0,repeat:"repeat",rotate:0,rounded:A,scale:1,scaleX:1,scaleY:1,shadowBlur:0,shadowColor:"transparent",shadowX:0,shadowY:0,sHeight:i,sides:3,source:"",start:0,strokeCap:"butt",strokeJoin:"miter",strokeStyle:"transparent",strokeWidth:1,sWidth:i,sx:i,
sy:i,text:"",translate:0,translateX:0,translateY:0,visible:s,width:i,x:0,y:0};C();C.extend=function(c){C.defaults=N=x(N,c.props);C();c.name&&(d.fn[c.name]=function b(f){var j,h,q,d=x(new z,f);d.args=f;for(h=0;h<this.length;h+=1)if(j=this[h],q=y(j))F(j,f,b),J(q,d),c.fn.call(j,q,d);return this});return d.fn[c.name]};d.fn.getLayers=function(){var c=this[0];return!c||!c.getContext?[]:I(c).layers};d.fn.getLayer=function(c){var a=this.getLayers(),b=d.type(c),f,j;if(c&&c.layer)f=c;else if("number"===b)f=
a[c];else for(j=0;j<a.length;j+=1)if(a[j].index=j,a[j].name===c||"regexp"===b&&a[j].name.match(c)){f=a[j];break}return f};d.fn.setLayer=function(c,a){var b,f;for(b=0;b<this.length;b+=1)(f=d(this[b]).getLayer(c))&&x(f,a);return this};d.fn.moveLayer=function(c,a){var b,f,j;for(f=0;f<this.length;f+=1)if(b=d(this[f]),j=b.getLayers(),b=b.getLayer(c))j.splice(b.index,1),j.splice(a,0,b),b.index=a;return this};d.fn.removeLayer=function(c){var a,b,f;for(b=0;b<this.length;b+=1)a=d(this[b]),f=a.getLayers(),
(a=a.getLayer(c))&&f.splice(a.index,1);return this};d.fn.removeLayers=function(){var c,a;for(c=0;c<this.length;c+=1)a=d(this[c]).getLayers(),a.length=0;return this};d.fn.getLayerGroup=function(c){var a=this.getLayers(),b=d.type(c),f=[],j;if("array"===b)return c;for(j=0;j<a.length;j+=1)a[j].index=j,(a[j].group===c||"regexp"===b&&a[j].group.match(c))&&f.push(a[j]);return f};d.fn.setLayerGroup=function(c,a){var b,f,j;for(f=0;f<this.length;f+=1){b=d(this[f]);b=b.getLayerGroup(c);for(j=0;j<b.length;j+=
1)x(b[j],a)}return this};d.fn.removeLayerGroup=function(c){var a,b,f=d.type(c),j;if(c!==r)for(b=0;b<this.length;b+=1){a=d(this[b]);a=a.getLayers();for(j=0;j<a.length;j+=1)if(a[j].index=j,a[j].group===c||"regexp"===f&&a[j].group.match(c))a.splice(j,1),j-=1}return this};d.fn.drawLayer=function(c){var a,b,f,j;for(a=0;a<this.length;a+=1)f=d(this[a]),b=y(this[a]),j=f.getLayer(c),ca(f,b,j);return this};d.fn.drawLayers=function(c){var a,b,f,j,h,q,w,v;for(b=0;b<this.length;b+=1)if(a=d(this[b]),f=y(this[b])){I(this[b]);
a.clearCanvas();E.elem===this[b]?w=E.data:(w=I(this[b]),E.elem=this[b],E.data=w);j=w.layers;for(q=0;q<j.length;q+=1)if(h=j[q],h.index=q,c&&(h._fired=A),h._event=!h.disableEvents,ca(a,f,h),h._mousedout)h._mousedout=A,h._fired=s,h._hovered=A,h.mouseout&&h.mouseout.call(this[b],h),h.cursor&&h._cursor&&a.css({cursor:h._cursor});h=w.intersects[w.intersects.length-1]||{};f=w.event;f=f.type;v=h[f];q=w.drag;if(h._event){if((h.mouseover||h.mouseout||h.cursor)&&!h._hovered&&!h._fired)h._fired=s,h._hovered=
s,h.mouseover&&h.mouseover.call(this[b],h),h.cursor&&(h._cursor=a.css("cursor"),a.css({cursor:h.cursor}));v&&!h._fired&&(h._fired=s,v.call(this[b],h));h.draggable&&(!h.disableDrag&&"mousedown"===f)&&(h.bringToFront&&(j.splice(h.index,1),h.index=j.push(h)),q.layer=h,q.dragging=s,q.startX=h.x,q.startY=h.y,q.endX=h._mouseX,q.endY=h._mouseY,h.dragstart&&h.dragstart.call(this[b],h))}if(q.layer&&(q.dragging&&"mouseup"===f&&(q.layer.dragstop&&q.layer.dragstop.call(this[b],q.layer),w.drag={}),q.dragging&&
"mousemove"===f))q.layer.x=q.layer._mouseX-(q.endX-q.startX),q.layer.y=q.layer._mouseY-(q.endY-q.startY),q.layer.drag&&q.layer.drag.call(this[b],q.layer)}w.intersects=[];return this};d.fn.addLayer=function(c){var a,b,c=c||{};for(a=0;a<this.length;a+=1)if(b=y(this[a]))c.layer=s,F(this[a],c);return this};K=["width","height","opacity","lineHeight"];V={};d.fn.animateLayer=function(){function c(a,b){return function(){da(b);a.drawLayers();h[4]&&h[4].call(a[0],b)}}function a(a,b){return function(c,f){da(b);
a.drawLayers();h[5]&&h[5].call(a[0],c,f,b)}}var b,f,j,h=[].slice.call(arguments,0);"object"===typeof h[0]&&!h[0].layer&&h.unshift(0);"object"===typeof h[2]?(h.splice(2,0,h[2].duration||i),h.splice(3,0,h[3].easing||i),h.splice(4,0,h[4].complete||i),h.splice(5,0,h[5].step||i)):(h[2]===r?(h.splice(2,0,i),h.splice(3,0,i),h.splice(4,0,i)):"function"===typeof h[2]&&(h.splice(2,0,i),h.splice(3,0,i)),h[3]===r)?(h[3]=i,h.splice(4,0,i)):"function"===typeof h[3]&&h.splice(3,0,i);h[1]=x({},h[1]);for(f=0;f<this.length;f+=
1)if(b=d(this[f]),j=y(this[f]))if(I(this[f]),(j=b.getLayer(h[0]))&&j.method!==d.fn.draw)ea(j),ea(h[1],s),j.style=V,d(j).animate(h[1],{duration:h[2],easing:d.easing[h[3]]?h[3]:i,complete:c(b,j),step:a(b,j)});return this};d.fn.animateLayerGroup=function(c){var a,b,f=[].slice.call(arguments,0),j,h;for(b=0;b<this.length;b+=1){a=d(this[b]);j=a.getLayerGroup(c);for(h=0;h<j.length;h+=1)a.animateLayer.apply(a,[j[h]].concat(f.slice(1)))}};d.fn.delayLayer=function(c,a){var b,f,a=a||0;for(b=0;b<this.length;b+=
1)f=d(this[b]).getLayer(c),d(f).delay(a);return this};d.fn.delayLayerGroup=function(c,a){var b,f,j,h,a=a||0;for(f=0;f<this.length;f+=1){b=d(this[f]);j=b.getLayerGroup(c);for(h=0;h<j.length;h+=1)b.delayLayer.call(b,j[h],a)}};d.fn.stopLayer=function(c,a){var b,f;for(b=0;b<this.length;b+=1)f=d(this[b]).getLayer(c),d(f).stop(a);return this};d.fn.stopLayerGroup=function(c,a){var b,f,j,h;for(f=0;f<this.length;f+=1){b=d(this[f]);j=b.getLayerGroup(c);for(h=0;h<j.length;h+=1)b.stopLayer.call(b,j[h],a)}};(function(c){var a;
for(a=0;a<c.length;a+=1)d.fx.step[c[a]]=ha})("color backgroundColor borderColor borderTopColor borderRightColor borderBottomColor borderLeftColor fillStyle outlineColor strokeStyle shadowColor".split(" "));M("click");M("dblclick");M("mousedown");M("mouseup");M("mousemove");M("mouseover");M("mouseout");d.event.fix=function(c){var a,c=ia.call(d.event,c);if(c.pageX!==r&&c.offsetX===r&&(a=d(c.target).offset()))c.offsetX=c.pageX-a.left,c.offsetY=c.pageY-a.top;return c};d.fn.draw=function a(b){var f,j,
b=b||{};"function"===typeof b&&(b={fn:b});for(f=0;f<this.length;f+=1)if((j=y(this[f]))&&b.fn)F(this[f],b,a),b.fn.call(this[f],j);return this};d.fn.clearCanvas=function(a){for(var b,f=x(new z,a),a=0;a<this.length;a+=1)if(b=y(this[a]))H(a,b,f,f.width,f.height),b.setTransform(1,0,0,1,0,0),!f.x||!f.y||!f.width||!f.height?b.clearRect(0,0,this[a].width,this[a].height):b.clearRect(f.x-f.width/2,f.y-f.height/2,f.width,f.height),b.restore();return this};d.fn.saveCanvas=function(){var a,b,f;for(a=0;a<this.length;a+=
1)if(b=y(this[a]))f=I(this[a]),b.save(),f.savedTransforms=x({},f.transforms);return this};d.fn.restoreCanvas=function(){var a,b,f;for(a=0;a<this.length;a+=1)if(b=y(this[a]))f=I(this[a]),b.restore(),f.transforms=f.savedTransforms;return this};d.fn.translateCanvas=function(a){for(var b,f=x(new z,a),j,a=0;a<this.length;a+=1)if(b=y(this[a]))j=I(this[a]),f.autosave&&b.save(),ba(b,f,j.transforms);return this};d.fn.scaleCanvas=function(a){for(var b,f=x(new z,a),j,a=0;a<this.length;a+=1)if(b=y(this[a]))j=
I(this[a]),f.autosave&&b.save(),aa(b,f,j.transforms);return this};d.fn.rotateCanvas=function(a){for(var b,f=x(new z,a),j,a=0;a<this.length;a+=1)if(b=y(this[a]))j=I(this[a]),f.autosave&&b.save(),$(b,f,j.transforms);return this};d.fn.drawRect=function b(f){var j,h,d=x(new z,f),w,i,u,t,k;for(j=0;j<this.length;j+=1)if(h=y(this[j]))F(this[j],f,b),J(h,d),H(j,h,d,d.width,d.height),h.beginPath(),w=d.x-d.width/2,i=d.y-d.height/2,(k=d.cornerRadius)?(d.closed=s,u=d.x+d.width/2,t=d.y+d.height/2,0>u-w-2*k&&(k=
(u-w)/2),0>t-i-2*k&&(k=(t-i)/2),h.moveTo(w+k,i),h.lineTo(u-k,i),h.arc(u-k,i+k,k,3*D/2,2*D,A),h.lineTo(u,t-k),h.arc(u-k,t-k,k,0,D/2,A),h.lineTo(w+k,t),h.arc(w+k,t-k,k,D/2,D,A),h.lineTo(w,i+k),h.arc(w+k,i+k,k,D,3*D/2,A)):h.rect(w,i,d.width,d.height),L(h,d);return this};d.fn.drawArc=function f(j){var h,d,i=x(new z,j),j=j||{};!i.inDegrees&&360===i.end&&(j.end=i.end=2*D);for(h=0;h<this.length;h+=1)if(d=y(this[h]))F(this[h],j,f),J(d,i),H(h,d,i,2*i.radius),d.beginPath(),d.arc(i.x,i.y,i.radius,i.start*i._toRad-
D/2,i.end*i._toRad-D/2,i.ccw),L(d,i);return this};d.fn.drawEllipse=function j(h){var d,i,v=x(new z,h),u=4*v.width/3,t=v.height;v.closed=s;for(d=0;d<this.length;d+=1)if(i=y(this[d]))F(this[d],h,j),J(i,v),H(d,i,v,v.width,v.height),i.beginPath(),i.moveTo(v.x,v.y-t/2),i.bezierCurveTo(v.x-u/2,v.y-t/2,v.x-u/2,v.y+t/2,v.x,v.y+t/2),i.bezierCurveTo(v.x+u/2,v.y+t/2,v.x+u/2,v.y-t/2,v.x,v.y-t/2),L(i,v);return this};d.fn.drawPolygon=function h(d){var i,v,u=x(new z,d),t=2*D/u.sides,k=D/u.sides,l=k+D/2,m=u.radius*
P(t/2),n,p,g;u.closed=s;for(i=0;i<this.length;i+=1)if(v=y(this[i])){F(this[i],d,h);J(v,u);H(i,v,u,2*u.radius);v.beginPath();for(g=0;g<u.sides;g+=1)n=u.x+O(u.radius*P(l)),p=u.y+O(u.radius*R(l)),v.lineTo(n,p),u.projection&&(n=u.x+O((m+m*u.projection)*P(l+k)),p=u.y+O((m+m*u.projection)*R(l+k)),v.lineTo(n,p)),l+=t;L(v,u)}return this};d.fn.drawLine=function q(d){var i,u,t=x(new z,d),k,l,m;for(i=0;i<this.length;i+=1)if(u=y(this[i])){F(this[i],d,q);J(u,t);U(t);H(i,u,t,0);k=1;for(u.beginPath();s;)if(l=t["x"+
k],m=t["y"+k],l!==r&&m!==r)u.lineTo(l,m),k+=1;else break;L(u,t)}return this};d.fn.drawQuad=function w(d){var i,t,k=x(new z,d),l,m,n,p,g;for(i=0;i<this.length;i+=1)if(t=y(this[i])){F(this[i],d,w);J(t,k);U(k);H(i,t,k,0);l=2;t.beginPath();for(t.moveTo(k.x1,k.y1);s;)if(m=k["x"+l],n=k["y"+l],p=k["cx"+(l-1)],g=k["cy"+(l-1)],m!==r&&n!==r&&p!==r&&g!==r)t.quadraticCurveTo(p,g,m,n),l+=1;else break;L(t,k)}return this};d.fn.drawBezier=function v(d){var i,k,l=x(new z,d),m,n,p,g,o,W,G,B;for(i=0;i<this.length;i+=
1)if(k=y(this[i])){F(this[i],d,v);J(k,l);U(l);H(i,k,l,0);m=2;n=1;k.beginPath();for(k.moveTo(l.x1,l.y1);s;)if(p=l["x"+m],g=l["y"+m],o=l["cx"+n],W=l["cy"+n],G=l["cx"+(n+1)],B=l["cy"+(n+1)],p!==r&&g!==r&&o!==r&&W!==r&&G!==r&&B!==r)k.bezierCurveTo(o,W,G,B,p,g),m+=1,n+=2;else break;L(k,l)}return this};d.fn.drawText=function u(t){var k,l,m=x(new z,t),n,p,g,o;for(k=0;k<this.length;k+=1)if(d(this[k]),l=y(this[k])){F(this[k],t,u);J(l,m);l.textBaseline=m.baseline;l.textAlign=m.align;l.font=m.font;if(!k&&m.maxWidth!==
i){n=l;p=m.text;o=m.maxWidth;var s=m.text.split(" "),G=[],r="";if(n.measureText(p).width<o||1===s.length)G=[p];else for(;0<s.length;)n.measureText(s[0]).width>o||n.measureText(r+s[0]).width<o?r+=s.shift()+" ":(G.push(r),r=""),0===s.length&&G.push(r);n=G;n=n.join("\n").replace(/( (\n))|( $)/gi,"$2").split("\n")}else k||(n=(""+m.text).split("\n"));ga(this[k],k,l,m,n);H(k,l,m,m.width,m.height);k||(g=m.x,"left"===m.align?g-=m.width/2:"right"===m.align&&(g+=m.width/2));for(p=0;p<n.length;p+=1)l.shadowColor=
m.shadowColor,o=m.y+p*m.height/n.length-(n.length-1)*m.height/n.length/2,l.fillText(n[p],g,o),"transparent"!==m.fillStyle&&(l.shadowColor="transparent"),l.strokeText(n[p],g,o);m._event?(l.beginPath(),l.rect(m.x-m.width/2,m.y-m.height/2,m.width,m.height),l.restore(),T(this[k],l,t),l.closePath()):l.restore()}E=m;return this};d.fn.measureText=function(d){var i;i=d!==r&&"object"!==typeof d?this.getLayer(d):x(new z,d);(d=y(this[0]))&&i.text!==r&&ga(this[0],0,d,i,i.text.split("\n"));return i};d.fn.drawImage=
function t(d){function l(l,t,m){return function(){t||((r=o.width/o.height,g.width===i&&g.sWidth===i&&(d.width=g.width=g.sWidth=o.width),g.height===i&&g.sHeight===i&&(d.height=g.height=g.sHeight=o.height),g.width===i&&g.sWidth!==i&&(g.width=g.sWidth),g.height===i&&g.sHeight!==i&&(g.height=g.sHeight),g.sWidth===i&&g.width!==i&&(d.sWidth=g.sWidth=o.width),g.sHeight===i&&g.height!==i&&(d.sHeight=g.sHeight=o.height),g.sx===i&&(g.sx=g.cropFromCenter?o.width/2:0),g.sy===i&&(g.sy=g.cropFromCenter?o.height/
2:0),g.cropFromCenter||(g.sx+=g.sWidth/2,g.sy+=g.sHeight/2),g.sx+g.sWidth/2>o.width&&(g.sx=o.width-g.sWidth/2),0>g.sx-g.sWidth/2&&(g.sx=g.sWidth/2),0>g.sy-g.sHeight/2&&(g.sy=g.sHeight/2),g.sy+g.sHeight/2>o.height&&(g.sy=o.height-g.sHeight/2),g.width!==i&&g.height===i)?d.height=g.height=g.width/r:g.width===i&&g.height!==i?d.width=g.width=g.height*r:g.width===i&&g.height===i&&(d.width=g.width=o.width,d.height=g.height=o.height));H(t,m,g,g.width,g.height);m.drawImage(o,g.sx-g.sWidth/2,g.sy-g.sHeight/
2,g.sWidth,g.sHeight,g.x-g.width/2,g.y-g.height/2,g.width,g.height);m.fillStyle=m.strokeStyle="transparent";m.beginPath();m.rect(g.x-g.width/2,g.y-g.height/2,g.width,g.height);L(m,g);g.load&&g.load.call(l,d)}}var m,n,p,g=x(new z,d),o,s,r;s=g.source.getContext;g.source.src||s?(o=g.source,g.width=o.width,g.height=o.height):g.source&&(o=new X,o.src=g.source);for(n=0;n<this.length;n+=1)if(m=this[n],p=y(this[n]))F(this[n],d,t),J(p,g),o&&(o.complete||s?l(m,n,p)():(o.onload=l(m,n,p),o.src=o.src));return this};
d.fn.createPattern=d.fn.pattern=function(d){function k(){g=m.createPattern(p,n.repeat);n.load&&n.load.call(l[0],g)}var l=this,m,n=x(new z,d),p,g;(m=y(l[0]))?"function"===typeof n.source?(p=S.createElement("canvas"),p.width=n.width,p.height=n.height,d=y(p),n.source.call(p,d),k()):(d=n.source.getContext,n.source.src||d?p=n.source:(p=new X,p.src=n.source),p.complete||d?k():p.onload=k):g=i;return g};d.fn.createGradient=d.fn.gradient=function(d){var k,d=x(new z,d),l=[],m,n,p,g,o,s,G;if(k=y(this[0])){d.x1=
d.x1||0;d.y1=d.y1||0;d.x2=d.x2||0;d.y2=d.y2||0;k=d.r1!==i||d.r2!==i?k.createRadialGradient(d.x1,d.y1,d.r1,d.x2,d.y2,d.r2):k.createLinearGradient(d.x1,d.y1,d.x2,d.y2);for(g=1;d["c"+g]!==r;g+=1)d["s"+g]!==r?l.push(d["s"+g]):l.push(i);m=l.length;l[0]===i&&(l[0]=0);l[m-1]===i&&(l[m-1]=1);for(g=0;g<m;g+=1){if(l[g]!==i){s=1;G=0;n=l[g];for(o=g+1;o<m;o+=1)if(l[o]!==i){p=l[o];break}else s+=1;n>p&&(l[o]=l[g])}else l[g]===i&&(G+=1,l[g]=n+G*((p-n)/s));k.addColorStop(l[g],d["c"+(g+1)])}}else k=i;return k};d.fn.setPixels=
function k(d){var i,n,p,g=x(new z,d),o={},s,r,B,A;for(n=0;n<this.length;n+=1)if(i=this[n],p=y(i)){F(this[n],d,k);H(n,p,g,g.width,g.height);if(!g.x||!g.y||!g.width||!g.height)g.width=i.width,g.height=i.height,g.x=g.width/2,g.y=g.height/2;s=p.getImageData(g.x-g.width/2,g.y-g.height/2,g.width,g.height);r=s.data;A=r.length;o=[];if(g.each)for(B=0;B<A;B+=4)o.r=r[B],o.g=r[B+1],o.b=r[B+2],o.a=r[B+3],g.each.call(i,o),r[B]=o.r,r[B+1]=o.g,r[B+2]=o.b,r[B+3]=o.a;p.putImageData(s,g.x-g.width/2,g.y-g.height/2);
p.restore()}return this};d.fn.getCanvasImage=function(d,l){var m=this[0];return m&&m.toDataURL?m.toDataURL("image/"+d,l):i};d.support.canvas=S.createElement("canvas").getContext!==r;C.defaults=N;C.detectEvents=T;d.jCanvas=C})(jQuery,document,Image,Math,parseFloat,!0,!1,null);
