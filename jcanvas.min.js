/*
 jCanvas v13.11.08
 Copyright 2013 Caleb Evans
 Released under the MIT license
*/
(function(d,Ga,qa,fa,ra,y,E,g,D){function K(c){V(this,c);return this}function N(c){c?V(K.prototype,c):N.prefs=K.prototype=V({},ga);return this}function J(c){return c&&c.getContext?c.getContext("2d"):g}function ha(c){c=V({},c);c.masks=c.masks.slice(0);return c}function ca(c,b){var a;c.save();a=ha(b.transforms);b.savedTransforms.push(a)}function S(c,b,a){Y(a.fillStyle)?b.fillStyle=a.fillStyle.call(c,a):b.fillStyle=a.fillStyle;Y(a.strokeStyle)?b.strokeStyle=a.strokeStyle.call(c,a):b.strokeStyle=a.strokeStyle;
b.lineWidth=a.strokeWidth;a.rounded?b.lineCap=b.lineJoin="round":(b.lineCap=a.strokeCap,b.lineJoin=a.strokeJoin,b.miterLimit=a.miterLimit);b.shadowOffsetX=a.shadowX;b.shadowOffsetY=a.shadowY;b.shadowBlur=a.shadowBlur;b.shadowColor=a.shadowColor;b.globalAlpha=a.opacity;b.globalCompositeOperation=a.compositing;a.imageSmoothing&&(b.webkitImageSmoothingEnabled=b.mozImageSmoothingEnabled=a.imageSmoothing)}function sa(c,b,a){a.mask&&(a.autosave&&ca(c,b),c.clip(),b.transforms.masks.push(a._args))}function P(c,
b,a){a.closed&&b.closePath();a.shadowStroke&&0!==a.strokeWidth?(b.stroke(),b.fill(),b.shadowColor="transparent",b.shadowBlur=0,b.stroke()):(b.fill(),"transparent"!==a.fillStyle&&(b.shadowColor="transparent"),0!==a.strokeWidth&&b.stroke());a.closed||b.closePath();a._transformed&&b.restore();a.mask&&(c=Q(c),sa(b,c,a))}function ta(c,b,a){b._toRad=b.inDegrees?L/180:1;c.translate(b.x,b.y);c.rotate(b.rotate*b._toRad);c.translate(-b.x,-b.y);a&&(a.rotate+=b.rotate*b._toRad)}function ua(c,b,a){1!==b.scale&&
(b.scaleX=b.scaleY=b.scale);c.translate(b.x,b.y);c.scale(b.scaleX,b.scaleY);c.translate(-b.x,-b.y);a&&(a.scaleX*=b.scaleX,a.scaleY*=b.scaleY)}function va(c,b,a){b.translate&&(b.translateX=b.translateY=b.translate);c.translate(b.translateX,b.translateY);a&&(a.translateX+=b.translateX,a.translateY+=b.translateY)}function R(c,b,a,e,h){a._toRad=a.inDegrees?L/180:1;a._transformed=y;b.save();h===D&&(h=e);a.fromCenter||a._centered||(a.x+=e/2,a.y+=h/2,a._centered=y);a.rotate&&ta(b,a,{});1===a.scale&&1===
a.scaleX&&1===a.scaleY||ua(b,a,{});(a.translate||a.translateX||a.translateY)&&va(b,a,{})}function Q(c){var b;da._canvas===c&&da._data?b=da._data:(b=d.data(c,"jCanvas"),b||(b={canvas:c,layers:[],layer:{names:{},groups:{}},intersecting:[],lastIntersected:g,cursor:d(c).css("cursor"),drag:{},event:{type:g,x:g,y:g},events:{},transforms:ha(ka),savedTransforms:[],animating:E,animated:g,pos:0,pixelRatio:1,scaled:!1},d.data(c,"jCanvas",b)),da._canvas=c,da._data=b);return b}function wa(c,b,a){for(var e in N.events)N.events.hasOwnProperty(e)&&
(a[e]||a.cursors&&a.cursors[e])&&xa(c,b,a,e)}function xa(c,b,a,e){e=ya(e);N.events[e](c,b);a._event=y}function za(c,b,a){var e,h,f;if(a.draggable||a.cursor||a.cursors){e=["mousedown","mousemove","mouseup"];for(f=0;f<e.length;f+=1)h=e[f],xa(c,b,a,h);b.events.mouseoutdrag||(c.bind("mouseout.jCanvas",function(){var a=b.drag.layer;a&&(b.drag={},a.dragcancel&&a.dragcancel.call(c[0],a),c.drawLayers())}),b.events.mouseoutdrag=y);a._event=y}}function ia(c,b,a,e){c=b.layer.names;e?e.name!==D&&"string"===X(a.name)&&
a.name!==e.name&&delete c[a.name]:e=a;"string"===X(e.name)&&(c[e.name]=a)}function la(c,b,a,e){c=b.layer.groups;var h,f,d,G;a.group!==g&&(a.groups=[a.group],a.dragGroupWithLayer&&(a.dragGroups=[a.group]));e&&e.group!==D&&(e.group===g?e.groups=g:(e.groups=[e.group],e.dragGroupWithLayer&&(e.dragGroups=[e.group])));if(!e)e=a;else if(e.groups!==D&&a.groups!==g)for(f=0;f<a.groups.length;f+=1)if(h=a.groups[f],b=c[h]){for(G=0;G<b.length;G+=1)if(b[G]===a){d=G;b.splice(G,1);break}0===b.length&&delete c[h]}if(e.groups!==
D&&e.groups!==g)for(f=0;f<e.groups.length;f+=1)h=e.groups[f],b=c[h],b||(b=c[h]=[],b.name=h),d===D&&(d=b.length),b.splice(d,0,a)}function aa(c,b,a,e){e||(e=b.cursors?b.cursors[a]:b.cursor);e&&c.css({cursor:e});b[a]&&b[a].call(c[0],b)}function O(c,b,a,e){var h=b;b._args=a;b.canvas=c;if(b.draggable||b.dragGroups)b.layer=y,b.draggable=y;b._method=e?e:b.method?d.fn[b.method]:b.type?d.fn[ja[b.type]]:function(){};b.layer&&!b._layer&&(a=d(c),e=a.getLayers(),c=Q(c),h=new K(b),h.layer=y,h._layer=y,ia(a,c,h),
la(a,c,h),wa(a,c,h),za(a,c,h),b._event=h._event,h.index===g&&(h.index=e.length),e.splice(h.index,0,h));return h}function Aa(c){var b,a;for(a=0;a<ea.length;a+=1)b=ea[a],c[b]=c["_"+b]}function Ba(c,b){var a,e;for(e=0;e<ea.length;e+=1)a=ea[e],c["_"+a]=c[a],ma[a]=y,b&&delete c[a]}function Ha(c,b,a){for(var e in a)a.hasOwnProperty(e)&&Y(a[e])&&(a[e]=a[e].call(c,b,e));return a}function Ca(c){var b,a,e=[],h=1;c.match(/^#?\w+$/gi)&&("transparent"===c&&(c="rgba(0,0,0,0)"),a=Ga.head,b=a.style.color,a.style.color=
c,c=d.css(a,"color"),a.style.color=b);c.match(/^rgb/gi)&&(e=c.match(/\d+/gi),c.match(/%/gi)&&(h=2.55),e[0]*=h,e[1]*=h,e[2]*=h,e[3]=e[3]!==D?ra(e[3]):1);return e}function Ia(c){var b=3,a;"array"!==X(c.start)&&(c.start=Ca(c.start),c.end=Ca(c.end));c.now=[];if(1!==c.start[3]||1!==c.end[3])b=4;for(a=0;a<b;a+=1)c.now[a]=c.start[a]+(c.end[a]-c.start[a])*c.pos,3>a&&(c.now[a]=Ja(c.now[a]));1!==c.start[3]||1!==c.end[3]?c.now="rgba("+c.now.join(",")+")":(c.now.slice(0,3),c.now="rgb("+c.now.join(",")+")");c.elem.nodeName?
c.elem.style[c.prop]=c.now:c.elem[c.prop]=c.now}function ya(c){void 0!==window.ontouchstart&&na[c]&&(c=na[c]);return c}function Ka(c){N.events[c]=function(b,a){var e,h;h=a.event;e="mouseover"===c||"mouseout"===c?"mousemove":c;a.events[e]||(b.bind(e+".jCanvas",function(a){h.x=a.offsetX;h.y=a.offsetY;h.type=e;h.event=a;b.drawLayers({resetFire:y});a.preventDefault()}),a.events[e]=y)}}function T(c,b,a){var e,h,f,d;a=a._args;a._event&&(c=Q(c),e=c.event,e.x!==g&&e.y!==g&&(f=e.x*c.pixelRatio,d=e.y*c.pixelRatio,
h=b.isPointInPath(f,d)||b.isPointInStroke&&b.isPointInStroke(f,d)),b=c.transforms,a.eventX=a.mouseX=e.x,a.eventY=a.mouseY=e.y,a.event=e.event,e=c.transforms.rotate,f=a.eventX,d=a.eventY,0!==e?(a._eventX=f*Z(-e)-d*ba(-e),a._eventY=d*Z(-e)+f*ba(-e)):(a._eventX=f,a._eventY=d),a._eventX/=b.scaleX,a._eventY/=b.scaleY,h&&c.intersecting.push(a),a.intersects=h)}function Da(c,b){isNaN(Number(b.fontSize))||(b.fontSize+="px");c.font=b.fontStyle+" "+b.fontSize+" "+b.fontFamily}function Ea(c,b,a,e){var h,f;if(W.text===
a.text&&W.fontStyle===a.fontStyle&&W.fontSize===a.fontSize&&W.fontFamily===a.fontFamily&&W.maxWidth===a.maxWidth&&W.lineHeight===a.lineHeight)a.width=W.width,a.height=W.height;else{a.width=b.measureText(e[0]).width;for(f=1;f<e.length;f+=1)h=b.measureText(e[f]).width,h>a.width&&(a.width=h);b=c.style.fontSize;c.style.fontSize=a.fontSize;a.height=ra(d.css(c,"fontSize"))*e.length*a.lineHeight;c.style.fontSize=b}}function Fa(c,b){var a=b.maxWidth,e=b.text.split("\n"),h=[],f,d,g,z,A;for(g=0;g<e.length;g+=
1){z=e[g];A=z.split(" ");f=[];d="";if(1===A.length||c.measureText(z).width<a)f=[z];else{for(z=0;z<A.length;z+=1)c.measureText(d+A[z]).width>a&&(""!==d&&f.push(d),d=""),d+=A[z],z!==A.length-1&&(d+=" ");f.push(d)}h=h.concat(f.join("\n").replace(/( (\n))|( $)/gi,"$2").split("\n"))}return h}var ga,V=d.extend,$=d.inArray,X=d.type,Y=d.isFunction,Ja=fa.round,L=fa.PI,ba=fa.sin,Z=fa.cos,La=d.event.fix,na,oa,ja,da={},W={},pa={},ka={rotate:0,scaleX:1,scaleY:1,translateX:0,translateY:0,masks:[]},ea,ma;d.fn.jCanvas=
N;N.events={};ga={align:"center",autosave:y,baseline:"middle",bringToFront:E,ccw:E,closed:E,compositing:"source-over",concavity:0,cornerRadius:0,count:1,cropFromCenter:y,cursor:g,cursors:g,disableEvents:E,draggable:E,dragGroups:g,group:g,groups:g,data:{},each:g,end:360,fillStyle:"transparent",fireDragGroupEvents:E,fontStyle:"normal",fontSize:"12pt",fontFamily:"sans-serif",fromCenter:y,fn:g,height:g,imageSmoothing:y,inDegrees:y,index:g,lineHeight:1,layer:E,load:g,mask:E,maxWidth:g,miterLimit:10,name:g,
opacity:1,r1:g,r2:g,radius:0,repeat:"repeat",respectAlign:E,rotate:0,rounded:E,scale:1,scaleX:1,scaleY:1,shadowBlur:0,shadowColor:"transparent",shadowStroke:!1,shadowX:0,shadowY:0,sHeight:g,sides:0,source:"",spread:0,start:0,strokeCap:"butt",strokeJoin:"miter",strokeStyle:"transparent",strokeWidth:1,sWidth:g,sx:g,sy:g,text:"",translate:0,translateX:0,translateY:0,type:g,visible:y,width:g,x:0,y:0};N();N.extend=function(c){N.defaults=V(ga,c.props);N();c.name&&(d.fn[c.name]=function a(e){var h,f,d,g;
for(f=0;f<this.length;f+=1)if(h=this[f],d=J(h))g=new K(e),O(h,g,e,a),S(h,d,g),c.fn.call(h,d,g);return this});return d.fn[c.name]};d.fn.getLayers=function(c){var b=this[0],a,e,h=[];if(b&&b.getContext)if(a=Q(b),a=a.layers,Y(c))for(e=0;e<a.length;e+=1)c.call(b,a[e])&&h.push(a[e]);else h=a;return h};d.fn.getLayer=function(c){var b=Q(this[0]),a=b.layers,e=X(c),h;if(c&&c.layer)h=c;else if("number"===e)0>c&&(c=a.length+c),h=a[c];else if("regexp"===e)for(b=0;b<a.length;b+=1){if("string"===X(a[b].name)&&a[b].name.match(c)){h=
a[b];break}}else h=b.layer.names[c];return h};d.fn.getLayerGroup=function(c){var b=X(c),a,e;if("array"===b)return c;if("regexp"===b)for(a in b=Q(this[0]),b=b.groups,b){if(a.match(c)){e=b[a];break}}else b=Q(this[0]),e=b.layer.groups[c];return e};d.fn.getLayerIndex=function(c){var b=this.getLayers();c=this.getLayer(c);return $(c,b)};d.fn.setLayer=function(c,b){var a,e,h,f;for(e=0;e<this.length;e+=1)if(a=d(this[e]),h=Q(this[e]),f=d(this[e]).getLayer(c))ia(a,h,f,b),la(a,h,f,b),b.index!==D&&a.moveLayer(f,
b.index),V(f,b),wa(a,h,f),za(a,h,f);return this};d.fn.setLayerGroup=function(c,b){var a,e,h,f;for(e=0;e<this.length;e+=1)if(a=d(this[e]),h=a.getLayerGroup(c))for(f=0;f<h.length;f+=1)a.setLayer(h[f],b);return this};d.fn.setLayers=function(c,b){var a,e,h,f;for(e=0;e<this.length;e+=1)for(a=d(this[e]),h=a.getLayers(b),f=0;f<h.length;f+=1)a.setLayer(h[f],c);return this};d.fn.moveLayer=function(c,b){var a,e,h;for(e=0;e<this.length;e+=1)if(a=d(this[e]),h=a.getLayers(),a=a.getLayer(c))a.index=$(a,h),h.splice(a.index,
1),h.splice(b,0,a),0>b&&(b=h.length+b),a.index=b;return this};d.fn.removeLayer=function(c){var b,a,e,h,f;for(a=0;a<this.length;a+=1)if(b=d(this[a]),e=Q(this[a]),h=b.getLayers(),f=b.getLayer(c))f.index=$(f,h),h.splice(f.index,1),ia(b,e,f,{name:g}),la(b,e,f,{groups:g});return this};d.fn.removeLayerGroup=function(c){var b,a,e,h,f,M,G;if(c!==D)for(a=0;a<this.length;a+=1)if(b=d(this[a]),e=Q(this[a]),h=b.getLayers(),f=b.getLayerGroup(c)){for(G=0;G<f.length;G+=1)M=f[G],M.index=$(M,h),h.splice(M.index,1),
ia(b,e,M,{name:g});delete e.layer.groups[f.name]}return this};d.fn.removeLayers=function(){var c,b;for(c=0;c<this.length;c+=1)d(this[c]),b=Q(this[c]),b.layers.length=0,b.layer.names={},b.layer.groups={};return this};d.fn.addLayerToGroup=function(c,b){var a,e,h,f=[];for(e=0;e<this.length;e+=1)a=d(this[e]),h=a.getLayer(c),h.groups&&-1===$(b,h.groups)&&(f=h.groups.slice(0),f.push(b),a.setLayer(h,{groups:f}));return this};d.fn.removeLayerFromGroup=function(c,b){var a,e,h,f=[],g;for(e=0;e<this.length;e+=
1)a=d(this[e]),h=a.getLayer(c),g=$(b,h.groups),-1!==g&&(f=h.groups.slice(0),f.splice(g,1),a.setLayer(h,{groups:f}));return this};d.fn.drawLayer=function(c){var b,a,e;for(b=0;b<this.length;b+=1)a=d(this[b]),J(this[b]),(e=a.getLayer(c))&&e.visible&&e._method&&(e._next=g,e._method.call(a,e));return this};d.fn.drawLayers=function(c){var b,a,e=V({},c),h,f,M,G,z,A,F;e.index||(e.index=0);for(c=0;c<this.length;c+=1)if(b=d(this[c]),a=J(this[c])){G=Q(this[c]);e.clear!==E&&b.clearCanvas();a=G.layers;for(M=e.index;M<
a.length&&(h=a[M],h.index=M,e.resetFire&&(h._fired=E),h._event=!h.disableEvents,A=b,z=h,f=M+1,z&&z.visible&&z._method&&(z._next=f?f:g,z._method.call(A,z)),h._masks=G.transforms.masks.slice(0),h._method!==d.fn.drawImage||!h.visible);M+=1);h=G;f=z=A=void 0;A={};for(z=h.intersecting.length-1;0<=z;z-=1)if(A=h.intersecting[z],A._masks){for(f=A._masks.length-1;0<=f;f-=1)if(!A._masks[f].intersects){A.intersects=E;break}if(A.intersects)break}h=A;z=G.event;A=z.type;h[A]||oa[A]&&(A=oa[A]);F=G.drag;f=G.lastIntersected;
f!==g&&h!==f&&f._hovered&&!f._fired&&(G.lastIntersected=g,f._fired=y,f._hovered=E,aa(b,f,"mouseout",G.cursor));h._event&&h.intersects&&(G.lastIntersected=h,!(h.mouseover||h.mouseout||h.cursor||h.cursors)||h._hovered||h._fired||(h._fired=y,h._hovered=y,aa(b,h,"mouseover")),h._fired||(h._fired=y,z.type=g,aa(b,h,A)),!h.draggable||"mousedown"!==A&&"touchstart"!==A||(F.layer=h));if(F.layer){h=G;var s=f=z=void 0,B=F=void 0,m=void 0,t=s=void 0;F=h.drag;f=F.layer;B=f.dragGroups||[];z=h.layers;if("mousemove"===
A||"touchmove"===A){if(!F.dragging){F.dragging=y;f.bringToFront&&(z.splice(f.index,1),f.index=z.push(f));for(t=0;t<B.length;t+=1)if(s=B[t],m=h.layer.groups[s],f.groups&&m)for(s=0;s<m.length;s+=1)m[s]!==f&&(m[s]._startX=m[s].x,m[s]._startY=m[s].y,m[s]._endX=f._eventX,m[s]._endY=f._eventY,m[s].bringToFront&&(m[s].index=$(m[s],z),z.splice(m[s].index,1),z.splice(-1,0,m[s]),m[s].index=z.length-2),m[s].dragstart&&f.fireDragGroupEvents&&m[s].dragstart.call(b[0],m[s]));F._startX=f._startX=f.x;F._startY=f._startY=
f.y;F._endX=f._endX=f._eventX;F._endY=f._endY=f._eventY;aa(b,f,"dragstart")}f.x=f._eventX-(F._endX-F._startX);f.y=f._eventY-(F._endY-F._startY);for(t=0;t<B.length;t+=1)if(s=B[t],m=h.layer.groups[s],f.groups&&m)for(s=0;s<m.length;s+=1)m[s]!==f&&(m[s].x=f._eventX-(m[s]._endX-m[s]._startX),m[s].y=f._eventY-(m[s]._endY-m[s]._startY),m[s].drag&&f.fireDragGroupEvents&&m[s].drag.call(b[0],m[s]));aa(b,f,"drag")}else if("mouseup"===A||"touchend"===A){F.dragging&&(aa(b,f,"dragstop"),F.dragging=E);for(t=0;t<
B.length;t+=1)if(s=B[t],m=h.layer.groups[s],f.groups&&m)for(s=0;s<m.length;s+=1)m[s]!==f&&m[s].dragstop&&f.fireDragGroupEvents&&m[s].dragstop.call(b[0],m[s]);h.drag={}}}M===a.length&&(G.intersecting.length=0,G.transforms=ha(ka),G.savedTransforms.length=0)}return this};d.fn.addLayer=function(c){var b,a;for(b=0;b<this.length;b+=1)if(a=J(this[b]))a=new K(c),a.layer=y,O(this[b],a,c);return this};ea=["width","height","opacity","lineHeight"];ma={};d.fn.animateLayer=function(){function c(a,b,c){return function(){Aa(c);
b.animating&&b.animated!==c||a.drawLayers();f[4]&&f[4].call(a[0],c);c._animating=E;b.animating=E;b.animated=g}}function b(a,b,c){return function(e,h){c._pos!==h.pos&&(c._pos=h.pos,Aa(c),c._animating||b.animating||(c._animating=y,b.animating=y,b.animated=c),b.animating&&b.animated!==c||a.drawLayers(),f[5]&&f[5].call(a[0],e,h,c))}}var a,e,h,f=[].slice.call(arguments,0),M,G;"object"===X(f[2])?(f.splice(2,0,f[2].duration||g),f.splice(3,0,f[3].easing||g),f.splice(4,0,f[4].done||f[4].complete||g),f.splice(5,
0,f[5].step||g)):(f[2]===D?(f.splice(2,0,g),f.splice(3,0,g),f.splice(4,0,g)):Y(f[2])&&(f.splice(2,0,g),f.splice(3,0,g)),f[3]===D?(f[3]=g,f.splice(4,0,g)):Y(f[3])&&f.splice(3,0,g));for(e=0;e<this.length;e+=1)if(a=d(this[e]),h=J(this[e]))h=Q(this[e]),(M=a.getLayer(f[0]))&&M._method!==d.fn.draw&&(G=V({},f[1]),G=Ha(this[e],M,G),Ba(G,y),Ba(M),M.style=ma,d(M).animate(G,{duration:f[2],easing:d.easing[f[3]]?f[3]:g,complete:c(a,h,M),step:b(a,h,M)}));return this};d.fn.animateLayerGroup=function(c){var b,a,
e=[].slice.call(arguments,0),h,f;for(a=0;a<this.length;a+=1)if(b=d(this[a]),h=b.getLayerGroup(c))for(f=0;f<h.length;f+=1)b.animateLayer.apply(b,[h[f]].concat(e.slice(1)));return this};d.fn.delayLayer=function(c,b){var a,e;b=b||0;for(a=0;a<this.length;a+=1)e=d(this[a]).getLayer(c),d(e).delay(b);return this};d.fn.delayLayerGroup=function(c,b){var a,e,h,f;b=b||0;for(e=0;e<this.length;e+=1)if(a=d(this[e]),a=a.getLayerGroup(c))for(f=0;f<a.length;f+=1)(h=a[f])&&d(h).delay(b);return this};d.fn.stopLayer=
function(c,b){var a,e;for(e=0;e<this.length;e+=1)a=d(this[e]),(a=a.getLayer(c))&&d(a).stop(b);return this};d.fn.stopLayerGroup=function(c,b){var a,e,h,f;for(e=0;e<this.length;e+=1)if(a=d(this[e]),a=a.getLayerGroup(c))for(f=0;f<a.length;f+=1)(h=a[f])&&d(h).stop(b);return this};(function(c){var b;for(b=0;b<c.length;b+=1)d.fx.step[c[b]]=Ia})("color backgroundColor borderColor borderTopColor borderRightColor borderBottomColor borderLeftColor fillStyle outlineColor strokeStyle shadowColor".split(" "));
na={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"};oa={touchstart:"mousedown",touchend:"mouseup",touchmove:"mousemove"};(function(c){var b;for(b=0;b<c.length;b+=1)Ka(c[b])})("click dblclick mousedown mouseup mousemove mouseover mouseout touchstart touchmove touchend".split(" "));d.event.fix=function(c){var b,a;c=La.call(d.event,c);if(b=c.originalEvent)if(a=b.changedTouches,c.pageX!==D&&c.offsetX===D){if(b=d(c.currentTarget).offset())c.offsetX=c.pageX-b.left,c.offsetY=c.pageY-b.top}else a&&
(b=d(c.currentTarget).offset())&&(c.offsetX=a[0].pageX-b.left,c.offsetY=a[0].pageY-b.top);return c};ja={arc:"drawArc",bezier:"drawBezier",ellipse:"drawEllipse","function":"draw",image:"drawImage",line:"drawLine",polygon:"drawPolygon",slice:"drawSlice",quadratic:"drawQuadratic",rectangle:"drawRect",text:"drawText",vector:"drawVector"};d.fn.draw=function b(a){var e,h,f=new K(a);if(ja[f.type])this[ja[f.type]](f);else for(e=0;e<this.length;e+=1)if(d(this[e]),h=J(this[e]))f=new K(a),O(this[e],f,a,b),f.visible&&
f.fn&&f.fn.call(this[e],h,f);return this};d.fn.clearCanvas=function a(e){var h,f,d=new K(e);for(h=0;h<this.length;h+=1)if(f=J(this[h]))d.width===g||d.height===g?(f.save(),f.setTransform(1,0,0,1,0,0),f.clearRect(0,0,this[h].width,this[h].height),f.restore()):(O(this[h],d,e,a),R(this[h],f,d,d.width,d.height),f.clearRect(d.x-d.width/2,d.y-d.height/2,d.width,d.height),d._transformed&&f.restore());return this};d.fn.saveCanvas=function e(h){var f,d,g,z,A;for(f=0;f<this.length;f+=1)if(d=J(this[f]))for(z=
Q(this[f]),g=new K(h),O(this[f],g,h,e),A=0;A<g.count;A+=1)ca(d,z);return this};d.fn.restoreCanvas=function h(f){var d,g,z,A,F;for(d=0;d<this.length;d+=1)if(g=J(this[d]))for(A=Q(this[d]),z=new K(f),O(this[d],z,f,h),F=0;F<z.count;F+=1){var s=g,B=A;0===B.savedTransforms.length?B.transforms=ha(ka):(s.restore(),B.transforms=B.savedTransforms.pop())}return this};d.fn.restoreCanvasOnRedraw=function(h){h=V({},h);h.layer=y;this.restoreCanvas(h);return this};d.fn.rotateCanvas=function f(d){var g,z,A,F;for(g=
0;g<this.length;g+=1)if(z=J(this[g]))F=Q(this[g]),A=new K(d),O(this[g],A,d,f),A.autosave&&ca(z,F),ta(z,A,F.transforms);return this};d.fn.scaleCanvas=function M(d){var g,A,F,s;for(g=0;g<this.length;g+=1)if(A=J(this[g]))s=Q(this[g]),F=new K(d),O(this[g],F,d,M),F.autosave&&ca(A,s),ua(A,F,s.transforms);return this};d.fn.translateCanvas=function G(d){var g,F,s,B;for(g=0;g<this.length;g+=1)if(F=J(this[g]))B=Q(this[g]),s=new K(d),O(this[g],s,d,G),s.autosave&&ca(F,B),va(F,s,B.transforms);return this};d.fn.drawRect=
function z(d){var g,s,B,m,t,C,q,x;for(g=0;g<this.length;g+=1)if(s=J(this[g]))B=new K(d),O(this[g],B,d,z),B.visible&&(S(this[g],s,B),R(this[g],s,B,B.width,B.height),s.beginPath(),m=B.x-B.width/2,t=B.y-B.height/2,(x=B.cornerRadius)?(B.closed=y,C=B.x+B.width/2,q=B.y+B.height/2,0>C-m-2*x&&(x=(C-m)/2),0>q-t-2*x&&(x=(q-t)/2),s.moveTo(m+x,t),s.lineTo(C-x,t),s.arc(C-x,t+x,x,3*L/2,2*L,E),s.lineTo(C,q-x),s.arc(C-x,q-x,x,0,L/2,E),s.lineTo(m+x,q),s.arc(m+x,q-x,x,L/2,L,E),s.lineTo(m,t+x),s.arc(m+x,t+x,x,L,3*L/
2,E)):s.rect(m,t,B.width,B.height),B._event&&T(this[g],s,B),P(this[g],s,B));return this};d.fn.drawArc=function A(d){var g,B,m;for(g=0;g<this.length;g+=1)if(B=J(this[g]))m=new K(d),O(this[g],m,d,A),m.visible&&(S(this[g],B,m),R(this[g],B,m,2*m.radius),m.inDegrees||360!==m.end||(m.end=2*L),m.start*=m._toRad,m.end*=m._toRad,m.start-=L/2,m.end-=L/2,B.beginPath(),B.arc(m.x,m.y,m.radius,m.start,m.end,m.ccw),m._event&&T(this[g],B,m),P(this[g],B,m));return this};d.fn.drawEllipse=function F(d){var g,m,t,C,
q;for(g=0;g<this.length;g+=1)if(m=J(this[g]))t=new K(d),O(this[g],t,d,F),t.visible&&(S(this[g],m,t),R(this[g],m,t,t.width,t.height),C=4/3*t.width,q=t.height,m.beginPath(),m.moveTo(t.x,t.y-q/2),m.bezierCurveTo(t.x-C/2,t.y-q/2,t.x-C/2,t.y+q/2,t.x,t.y+q/2),m.bezierCurveTo(t.x+C/2,t.y+q/2,t.x+C/2,t.y-q/2,t.x,t.y-q/2),t._event&&T(this[g],m,t),t.closed=y,P(this[g],m,t));return this};d.fn.drawPolygon=function s(d){var g,t,C,q,x,u,n,l,k,w;for(g=0;g<this.length;g+=1)if(t=J(this[g]))if(C=new K(d),O(this[g],
C,d,s),C.visible){S(this[g],t,C);R(this[g],t,C,2*C.radius);x=2*L/C.sides;u=x/2;q=u+L/2;n=C.radius*Z(u);t.beginPath();for(w=0;w<C.sides;w+=1)l=C.x+C.radius*Z(q),k=C.y+C.radius*ba(q),t.lineTo(l,k),C.concavity&&(l=C.x+(n+-n*C.concavity)*Z(q+u),k=C.y+(n+-n*C.concavity)*ba(q+u),t.lineTo(l,k)),q+=x;C._event&&T(this[g],t,C);C.closed=y;P(this[g],t,C)}return this};d.fn.drawSlice=function B(g){var t,C,q,x,u;for(t=0;t<this.length;t+=1)if(d(this[t]),C=J(this[t]))if(q=new K(g),O(this[t],q,g,B),q.visible){S(this[t],
C,q);R(this[t],C,q,2*q.radius);q.start*=q._toRad;q.end*=q._toRad;q.start-=L/2;for(q.end-=L/2;0>q.start;)q.start+=2*L;for(;0>q.end;)q.end+=2*L;q.end<q.start&&(q.end+=2*L);x=(q.start+q.end)/2;u=q.radius*q.spread*Z(x);x=q.radius*q.spread*ba(x);q.x+=u;q.y+=x;C.beginPath();C.arc(q.x,q.y,q.radius,q.start,q.end,q.ccw);C.lineTo(q.x,q.y);q._event&&T(this[t],C,q);q.closed=y;P(this[t],C,q)}return this};d.fn.drawLine=function m(d){var g,q,x,u,n,l;for(g=0;g<this.length;g+=1)if(q=J(this[g]))if(x=new K(d),O(this[g],
x,d,m),x.visible){S(this[g],q,x);R(this[g],q,x,0);u=1;for(q.beginPath();y;)if(n=x["x"+u],l=x["y"+u],n!==D&&l!==D)q.lineTo(n+x.x,l+x.y),u+=1;else break;x._event&&T(this[g],q,x);P(this[g],q,x)}return this};d.fn.drawQuadratic=function t(g){var d,x,u,n,l,k,w,v;for(d=0;d<this.length;d+=1)if(x=J(this[d]))if(u=new K(g),O(this[d],u,g,t),u.visible){S(this[d],x,u);R(this[d],x,u,0);n=2;x.beginPath();for(x.moveTo(u.x1+u.x,u.y1+u.y);y;)if(l=u["x"+n],k=u["y"+n],w=u["cx"+(n-1)],v=u["cy"+(n-1)],l!==D&&k!==D&&w!==
D&&v!==D)x.quadraticCurveTo(w+u.x,v+u.y,l+u.x,k+u.y),n+=1;else break;u._event&&T(this[d],x,u);P(this[d],x,u)}return this};d.fn.drawBezier=function C(d){var g,u,n,l,k,w,v,r,H,U,E;for(g=0;g<this.length;g+=1)if(u=J(this[g]))if(n=new K(d),O(this[g],n,d,C),n.visible){S(this[g],u,n);R(this[g],u,n,0);l=2;k=1;u.beginPath();for(u.moveTo(n.x1+n.x,n.y1+n.y);y;)if(w=n["x"+l],v=n["y"+l],r=n["cx"+k],H=n["cy"+k],U=n["cx"+(k+1)],E=n["cy"+(k+1)],w!==D&&v!==D&&r!==D&&H!==D&&U!==D&&E!==D)u.bezierCurveTo(r+n.x,H+n.y,
U+n.x,E+n.y,w+n.x,v+n.y),l+=1,k+=2;else break;n._event&&T(this[g],u,n);P(this[g],u,n)}return this};d.fn.drawVector=function q(g){var d,n,l,k,w,v,r,H;for(d=0;d<this.length;d+=1)if(n=J(this[d]))if(l=new K(g),O(this[d],l,g,q),l.visible){S(this[d],n,l);R(this[d],n,l,0);k=1;n.beginPath();r=l.x;H=l.y;for(n.moveTo(l.x,l.y);y;)if(w=l["a"+k],v=l["l"+k],w!==D&&v!==D)w*=l._toRad,w-=L/2,r+=v*Z(w),H+=v*ba(w),n.lineTo(r,H),k+=1;else break;l._event&&T(this[d],n,l);P(this[d],n,l)}return this};d.fn.drawText=function x(u){var n,
l,k,w,v,r,H;for(n=0;n<this.length;n+=1)if(d(this[n]),l=J(this[n]))if(k=new K(u),O(this[n],k,u,x),k.visible){S(this[n],l,k);l.textBaseline=k.baseline;l.textAlign=k.align;Da(l,k);w=k.maxWidth!==g?Fa(l,k):k.text.toString().split("\n");Ea(this[n],l,k,w);u&&k.layer&&(u.width=k.width,u.height=k.height);R(this[n],l,k,k.width,k.height);r=k.x;"left"===k.align?k.respectAlign?k.x+=k.width/2:r-=k.width/2:"right"===k.align&&(k.respectAlign?k.x-=k.width/2:r+=k.width/2);for(v=0;v<w.length;v+=1)l.shadowColor=k.shadowColor,
H=k.y+v*k.height/w.length-(w.length-1)*k.height/w.length/2,l.fillText(w[v],r,H),"transparent"!==k.fillStyle&&(l.shadowColor="transparent"),l.strokeText(w[v],r,H);k._event&&(l.beginPath(),l.rect(k.x-k.width/2,k.y-k.height/2,k.width,k.height),T(this[n],l,k),l.closePath());k._transformed&&l.restore()}W=k;return this};d.fn.measureText=function(d){var g,n;if(g=d&&d.layer||"string"===X(d)?this.getLayer(d):new K(d)){if(d=J(this[0]))Da(d,g),n=Fa(d,g),Ea(this[0],d,g,n)}else g={};return g};d.fn.drawImage=function u(n){function l(l,
n,u,r,p,v){return function(){S(k[n],u,p);p.width===g&&p.sWidth===g&&(p.width=p.sWidth=I.width);p.height===g&&p.sHeight===g&&(p.height=p.sHeight=I.height);v&&(v.width=p.width,v.height=p.height);p.sWidth!==g&&p.sHeight!==g&&p.sx!==g&&p.sy!==g?(p.width===g&&(p.width=p.sWidth),p.height===g&&(p.height=p.sHeight),p.cropFromCenter||(p.sx+=p.sWidth/2,p.sy+=p.sHeight/2),0>p.sy-p.sHeight/2&&(p.sy=p.sHeight/2),p.sy+p.sHeight/2>I.height&&(p.sy=I.height-p.sHeight/2),0>p.sx-p.sWidth/2&&(p.sx=p.sWidth/2),p.sx+p.sWidth/
2>I.width&&(p.sx=I.width-p.sWidth/2),R(k[n],u,p,p.width,p.height),u.drawImage(I,p.sx-p.sWidth/2,p.sy-p.sHeight/2,p.sWidth,p.sHeight,p.x-p.width/2,p.y-p.height/2,p.width,p.height)):(R(k[n],u,p,p.width,p.height),u.drawImage(I,p.x-p.width/2,p.y-p.height/2,p.width,p.height));u.beginPath();u.rect(p.x-p.width/2,p.y-p.height/2,p.width,p.height);p._event&&T(k[n],u,p);u.closePath();p._transformed&&u.restore();sa(u,r,p);p.load&&p.load.call(l,v);p.layer&&(p._args._masks=r.transforms.masks.slice(0),p._next&&
d(l).drawLayers({clear:E,resetFire:y,index:p._next}))}}var k=this,w,v,r,H,U,L,I,N,P;for(v=0;v<k.length;v+=1)if(w=k[v],r=J(k[v]))H=Q(k[v]),U=new K(n),L=O(k[v],U,n,u),U.visible&&(P=U.source,N=P.getContext,P.src||N?I=P:P&&(pa[P]!==D?I=pa[P]:(I=new qa,I.src=P,pa[P]=I)),I&&(I.complete||N?l(w,v,r,H,U,L)():(d(I).bind("load",l(w,v,r,H,U,L)),I.src=I.src)));return k};d.fn.createPattern=function(u){function n(){r=k.createPattern(v,w.repeat);w.load&&w.load.call(l[0],r)}var l=this,k,w,v,r,H;(k=J(l[0]))?(w=new K(u),
H=w.source,Y(H)?(v=d("<canvas />")[0],v.width=w.width,v.height=w.height,u=J(v),H.call(v,u),n()):(u=H.getContext,H.src||u?v=H:(v=new qa,v.src=H),v.complete||u?n():(d(v).bind("load",n),v.src=v.src))):r=g;return r};d.fn.createGradient=function(d){var n,l=[],k,w,v,r,H,y,E;d=new K(d);if(n=J(this[0])){d.x1=d.x1||0;d.y1=d.y1||0;d.x2=d.x2||0;d.y2=d.y2||0;n=d.r1!==g||d.r2!==g?n.createRadialGradient(d.x1,d.y1,d.r1,d.x2,d.y2,d.r2):n.createLinearGradient(d.x1,d.y1,d.x2,d.y2);for(r=1;d["c"+r]!==D;r+=1)d["s"+r]!==
D?l.push(d["s"+r]):l.push(g);k=l.length;l[0]===g&&(l[0]=0);l[k-1]===g&&(l[k-1]=1);for(r=0;r<k;r+=1){if(l[r]!==g){y=1;E=0;w=l[r];for(H=r+1;H<k;H+=1)if(l[H]!==g){v=l[H];break}else y+=1;w>v&&(l[H]=l[r])}else l[r]===g&&(E+=1,l[r]=w+(v-w)/y*E);n.addColorStop(l[r],d["c"+(r+1)])}}else n=g;return n};d.fn.setPixels=function n(d){var k,w,v,r,y,E,D,I,L;for(w=0;w<this.length;w+=1)if(k=this[w],v=J(k)){r=new K(d);O(k,r,d,n);R(this[w],v,r,r.width,r.height);if(r.width===g||r.height===g)r.width=k.width,r.height=k.height,
r.x=r.width/2,r.y=r.height/2;if(0!==r.width&&0!==r.height){E=v.getImageData(r.x-r.width/2,r.y-r.height/2,r.width,r.height);D=E.data;L=D.length;if(r.each)for(I=0;I<L;I+=4)y={r:D[I],g:D[I+1],b:D[I+2],a:D[I+3]},r.each.call(k,y,r),D[I]=y.r,D[I+1]=y.g,D[I+2]=y.b,D[I+3]=y.a;v.putImageData(E,r.x-r.width/2,r.y-r.height/2);v.restore()}}return this};d.fn.getCanvasImage=function(d,l){var k=this[0];l===D&&(l=1);return k&&k.toDataURL?k.toDataURL("image/"+d,l):g};d.fn.detectPixelRatio=function(g){var l,k,w,v,r,
D,E;for(k=0;k<this.length;k+=1)l=this[k],d(this[k]),w=J(l),E=Q(this[k]),E.scaled||(v=window.devicePixelRatio||1,r=w.webkitBackingStorePixelRatio||w.mozBackingStorePixelRatio||w.msBackingStorePixelRatio||w.oBackingStorePixelRatio||w.backingStorePixelRatio||1,v/=r,1!==v&&(r=l.width,D=l.height,l.width=r*v,l.height=D*v,l.style.width=r+"px",l.style.height=D+"px",w.scale(v,v)),E.pixelRatio=v,E.scaled=y,g&&g.call(l,v));return this};d.support.canvas=d("<canvas />")[0].getContext;N.defaults=ga;N.transformShape=
R;N.detectEvents=T;N.closePath=P;N.getTouchEventName=ya;d.jCanvas=N})(jQuery,document,Image,Math,parseFloat,!0,!1,null);
