/**
 * @license jCanvas Handles v15.10.03b
 * Copyright 2015 Caleb Evans
 * Released under the MIT license
 */
!function($){function e(e){var t=e._method;return t===$.fn.drawRect||t===$.fn.drawEllipse||t===$.fn.drawImage}function t(e){var t=e._method;return t===$.fn.drawLine||t===$.fn.drawQuadratic||t===$.fn.drawBezier}function n(e,t,n,a){var r=$.extend({cursors:{mouseover:"grab",mousedown:"grabbing",mouseup:"grab"}},t.handle,{layer:!0,draggable:!0,x:t[n],y:t[a],_parent:t,_xProp:n,_yProp:a,fromCenter:!0,dragstart:function(e){$(this).triggerLayerEvent(e._parent,"handlestart")},drag:function(e){var t=e._parent;t[e._xProp]=e.x-t.x,t[e._yProp]=e.y-t.y,o(t),$(this).triggerLayerEvent(t,"handlemove")},dragstop:function(e){$(this).triggerLayerEvent(e._parent,"handlestop")},dragcancel:function(e){$(this).triggerLayerEvent(e._parent,"handlecancel")}});e.draw(r),t._handles.push(e.getLayer(-1))}function a(e,t,n,a){var r,i;-1===n&&-1===a||1===n&&1===a?i="nwse-resize":0!==n||-1!==a&&1!==a?-1!==n&&1!==n||0!==a?(1===n&&-1===a||-1===n&&1===a)&&(i="nesw-resize"):i="ew-resize":i="ns-resize",r=$.extend({cursors:{mouseover:i}},t.handle,{layer:!0,draggable:!0,dragByTranslate:!0,x:t.x,y:t.y,rotate:t.rotate,scale:t.scale,translateX:n*t.width/2+(t.fromCenter?0:t.width/2),translateY:a*t.height/2+(t.fromCenter?0:t.height/2),_parent:t,_px:n,_py:a,fromCenter:!0,dragstart:function(e){$(this).triggerLayerEvent(e._parent,"handlestart")},drag:function(e){var t=e._parent;t.width+e.dx*e._px<t.minWidth&&(t.width=t.minWidth,e.dx=0),t.height+e.dy*e._py<t.minHeight&&(t.height=t.minHeight,e.dy=0),t.resizeFromCenter?(t.width+=e.dx*e._px*2,t.height+=e.dy*e._py*2,t.constrainProportions&&(0===e._py?t.height=t.width/t.aspectRatio:t.width=t.height*t.aspectRatio)):(t.fromCenter?(t.width+=e.dx*e._px,t.height+=e.dy*e._py):(t.width+=e.dx*e._px,0!==e._px&&(t.translateX+=e.dx*(1-e._px&&(1-e._px)/Math.abs(1-e._px))),t.height+=e.dy*e._py,0!==e._py&&(t.translateY+=e.dy*(1-e._py&&(1-e._py)/Math.abs(1-e._py)))),t.constrainProportions&&(0===e._py?t.height=t.width/t.aspectRatio:(t.width=t.height*t.aspectRatio,e.dx=e.dy*t.aspectRatio*e._py*e._px)),t.fromCenter&&(0!==e._px&&(t.x+=e.dx/2),0!==e._py&&(t.y+=e.dy/2))),s(t),$(this).triggerLayerEvent(t,"handlemove")},dragstop:function(e){var t=e._parent;$(this).triggerLayerEvent(t,"handlestop")},dragcancel:function(e){var t=e._parent;$(this).triggerLayerEvent(t,"handlecancel")}}),e.draw(r),t._handles.push(e.getLayer(-1))}function r(e,t){var n=t.handlePlacement;null===t.aspectRatio&&0!==t.height&&(t.aspectRatio=t.width/t.height),("corners"===n||"both"===n)&&(a(e,t,-1,-1),a(e,t,1,-1),a(e,t,1,1),a(e,t,-1,1)),("sides"===n||"both"===n)&&(a(e,t,0,-1),a(e,t,1,0),a(e,t,0,1),a(e,t,-1,0)),t.guide&&d(e,t)}function i(e){var t=e._guide;t&&(t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height,t.fromCenter=e.fromCenter)}function d(e,t){var n,a;n=$.extend({},t.guide,{layer:!0,draggable:!1,type:"rectangle",handle:null}),e.addLayer(n),a=e.getLayer(-1),t._guide=a,e.moveLayer(a,-t._handles.length-1),i(t)}function h(e,t){var a,r,i,d;for(a in t)t.hasOwnProperty(a)&&(r=t[a],null!==a.match(/c?x(\d+)/gi)&&(i=a,d=a.replace("x","y"),n(e,t,i,d)));t.guide&&l(e,t)}function o(e){var t=e._handles,n=e._guides,a,r,i,d;if(e._method===$.fn.drawQuadratic){if(t&&(i=e._guide))for(r=0;r<t.length;r+=1)a=e._handles[r],i["x"+(r+1)]=a.x,i["y"+(r+1)]=a.y}else if(e._method===$.fn.drawBezier&&n)for(d=0;d<n.length;d+=1)if(i=n[d],t=i._handles,i&&t)for(r=0;r<t.length;r+=1)a=t[r],i["x"+(r+1)]=a.x,i["y"+(r+1)]=a.y}function l(e,t){var n=t._handles,a,r,i,d,h,l,s;if(s=$.extend({},t.guide,{layer:!0,draggable:!1,type:"line"}),t._method===$.fn.drawQuadratic)e.addLayer(s),t._guide=e.getLayer(-1),e.moveLayer(t._guide,-n.length-1);else if(t._method===$.fn.drawBezier)for(t._guides=[],h=0;h<n.length;h+=1)d=n[h],r=n[h+1],a=n[h-1],i=null,void 0!==r?0===d._xProp.indexOf("x")&&0===r._xProp.indexOf("cx")&&(i=r):void 0!==a&&0===a._xProp.indexOf("cx")&&0===d._xProp.indexOf("x")&&(i=a),null!==i&&(e.addLayer(s),l=e.getLayer(-1),l._handles=[d,i],t._guides.push(l),e.moveLayer(l,-n.length-1));o(t)}function s(e){var t,n;if(e._handles)for(n=0;n<e._handles.length;n+=1)t=e._handles[n],e.dragByTranslate?(t.x=e.x+e.translateX,t.y=e.y+e.translateY):(t.x=e.x,t.y=e.y),t.rotate=e.rotate,t.scale=e.scale,t.translateX=e.width/2*t._px+(e.fromCenter?0:e.width/2),t.translateY=e.height/2*t._py+(e.fromCenter?0:e.height/2);i(e)}function g(e){var t=e._handles,n,a;if(t)for(a=0;a<t.length;a+=1)n=t[a],n.x=e[n._xProp]+e.x,n.y=e[n._yProp]+e.y;o(e)}function p(n){var a=$(n.canvas);void 0===n._handles&&(n._handles=[]),e(n)?r(a,n):t(n)&&h(a,n)}function _(e){var t=$(e.canvas),n,a;if(e._handles){for(a=0;a<e._handles.length;a+=1)n=e._handles[a],t.removeLayer(n);e._handles.length=0}}function y(e){var t;for(t in e)if(e.hasOwnProperty(t)&&t.match(/^(x|y)\d+$/))return!0;return!1}$.extend($.jCanvas.defaults,{handle:null,guide:null,aspectRatio:null,resizeFromCenter:!0,constrainProportions:!1,handlePlacement:"corners",minWidth:0,minHeight:0}),$.extend($.jCanvas.eventHooks,{add:function(e){e.handle&&p(e)},remove:function(e){var t,n,a;if(e._handles){for(t=$(this),a=0;a<e._handles.length;a+=1)n=e._handles[a],t.removeLayer(n);e._handles.length=0}},change:function(n,a){a.handle||y(a)?(_(n),p(n)):null===a.handle&&_(n),e(n)?(void 0!==a.width||void 0!==a.height||void 0!==a.x||void 0!==a.y||void 0!==a.rotate||void 0!==a.scale)&&s(n):t(n)&&g(n)},animate:function(n,a){e(n)?("width"===a.prop||"height"===a.prop||"x"===a.prop||"y"===a.prop||"rotate"===a.prop||"scale"===a.prop)&&s(n):t(n)&&null!==a.prop.match(/^c?(x|y)(\d+)/gi)&&g(n)},drag:function(n){e(n)?s(n):t(n)&&g(n)}})}(jQuery);