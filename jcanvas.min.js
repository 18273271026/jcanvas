/*!
jCanvas v4.5b
Copyright 2011, Caleb Evans
Licensed under the MIT license
*/
(function(j,w,o,u,C,c,t,m){var p,i,r,n=j.fn,l=j.extend,D=o.PI,E=o.round,a=o.sin,e=o.cos,b,d;function A(G){if(!G){i=l({},p)}else{i=l({},i,G)}return this}p={width:0,height:0,cornerRadius:0,fillStyle:"transparent",strokeStyle:"transparent",strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",rounded:false,shadowX:0,shadowY:0,shadowBlur:3,shadowColor:"transparent",opacity:1,compositing:"source-over",x:0,y:0,x1:0,y1:0,start:0,end:360,ccw:false,inDegrees:true,fromCenter:true,closed:false,sides:3,angle:0,text:"",font:"normal 12pt sans-serif",align:"center",baseline:"middle",source:"",repeat:"repeat"};i=l({},p);function z(G,H){G.fillStyle=H.fillStyle;G.strokeStyle=H.strokeStyle;G.lineWidth=H.strokeWidth;if(H.rounded){G.lineCap="round";G.lineJoin="round"}else{G.lineCap=H.strokeCap;G.lineJoin=H.strokeJoin}G.shadowOffsetX=H.shadowX;G.shadowOffsetY=H.shadowY;G.shadowBlur=H.shadowBlur;G.shadowColor=H.shadowColor;G.globalAlpha=H.opacity;G.globalCompositeOperation=H.compositing}function g(G,H){if(H.mask){G.save();G.clip()}if(H.closed){G.closePath();G.fill();G.stroke()}else{G.fill();G.stroke();G.closePath()}}function f(G){return G.inDegrees?D/180:1}function y(H,J,I,G){J.toRad=f(J);H.save();if(!J.fromCenter){J.x+=I/2;J.y+=G/2}if(J.angle){H.translate(J.x,J.y);H.rotate(J.angle*J.toRad);H.translate(-J.x,-J.y)}}function B(G){G=G||{};p=l(p,G.props||{});i=l({},p);if(G.name){j.fn[G.name]=function(I){var L=this,H,J,K=l({},i,I);for(J=0;J<L.length;J+=1){if(!L[J].getContext){continue}H=L[J].getContext("2d");z(H,K);K.toRad=f(K);G.fn.call(L[J],H,K)}return L}}return this}j.fn.jCanvas=A;j.fn.loadCanvas=function(G){if(!this[0].getContext){return null}return this[0].getContext(G||"2d")};j.fn.getCanvasData=function(G){if(!this[0].toDataURL){return null}if(G===m){G="image/png"}else{G=G.replace(/^([a-z]+)$/gi,"image/$1").replace(/jpg/gi,"jpeg")}return this[0].toDataURL(G)};j.fn.draw=function(I){var H=this,G;for(G=0;G<H.length;G+=1){if(!H[G].getContext){continue}I.call(H[G],H[G].getContext("2d"))}return this};j.fn.gradient=function(H){if(!this[0].getContext){return null}var G=this[0].getContext("2d"),M=l({},i,H),L,K,J=0,I=1;if(M.r1!==m||M.r2!==m){L=G.createRadialGradient(M.x1,M.y1,M.r1,M.x2,M.y2,M.r2)}else{L=G.createLinearGradient(M.x1,M.y1,M.x2,M.y2)}while(M["c"+I]!==m){J+=1;I+=1}for(I=1;I<=J;I+=1){K=E(100/(J-1)*(I-1))/100;if(M["s"+I]===m){M["s"+I]=K}L.addColorStop(M["s"+I],M["c"+I])}return L};j.fn.pattern=function(I){if(!this[0].getContext){return null}var G=this[0].getContext("2d"),M=l({},i,I),H=new C(),K;H.src=M.source;function J(){if(H.complete){K=G.createPattern(H,M.repeat);return true}else{return false}}function L(){J();if(M.load){M.load.call(this[0],K)}}if(M.load){H.onload=L}else{if(!J()){H.onload=L}}return K};j.fn.clearCanvas=function(H){var G,I,J=l({},i,H);for(I=0;I<this.length;I+=1){if(!this[I].getContext){continue}G=this[I].getContext("2d");y(G,J,J.width,J.height);if(!J.width&&!J.height){G.clearRect(0,0,this[I].width,this[I].height)}else{G.clearRect(J.x-J.width/2,J.y-J.height/2,J.width,J.height)}}return this};j.fn.saveCanvas=function(){var G;for(G=0;G<this.length;G+=1){if(!this[G].getContext){continue}this[G].getContext("2d").save()}return this};j.fn.restoreCanvas=function(){var G;for(G=0;G<this.length;G+=1){if(!this[G].getContext){continue}this[G].getContext("2d").restore()}return this};j.fn.scaleCanvas=function(H){var G,I,J=l({},i,H);for(I=0;I<this.length;I+=1){if(!this[I].getContext){continue}G=this[I].getContext("2d");G.save();G.translate(J.x,J.y);G.scale(J.width,J.height);G.translate(-J.x,-J.y)}return this};j.fn.translateCanvas=function(H){var G,I,J=l({},i,H);for(I=0;I<this.length;I+=1){if(!this[I].getContext){continue}G=this[I].getContext("2d");G.save();G.translate(J.x,J.y)}return this};j.fn.rotateCanvas=function(H){var G,I,J=l({},i,H);for(I=0;I<this.length;I+=1){if(!this[I].getContext){continue}G=this[I].getContext("2d");y(G,J,0,0)}return this};j.fn.drawRect=function(L){var O,K,J=l({},i,L),I,N,H,M,G;for(K=0;K<this.length;K+=1){if(!this[K].getContext){continue}O=this[K].getContext("2d");z(O,J);y(O,J,J.width,J.height);O.beginPath();if(J.cornerRadius){J.closed=true;I=J.x-J.width/2;N=J.y-J.height/2;H=J.x+J.width/2;M=J.y+J.height/2;G=J.cornerRadius;if((H-I)-(2*G)<0){G=(H-I)/2}if((M-N)-(2*G)<0){G=(M-N)/2}O.moveTo(I+G,N);O.lineTo(H-G,N);O.arc(H-G,N+G,G,3*D/2,D*2,false);O.lineTo(H,M-G);O.arc(H-G,M-G,G,0,D/2,false);O.lineTo(I+G,M);O.arc(I+G,M-G,G,D/2,D,false);O.lineTo(I,N+G);O.arc(I+G,N+G,G,D,3*D/2,false)}else{O.rect(J.x-J.width/2,J.y-J.height/2,J.width,J.height)}O.restore();g(O,J)}return this};j.fn.drawArc=function(H){var G,I,J=l({},i,H);if(!J.inDegrees&&J.end===360){J.end=D*2}for(I=0;I<this.length;I+=1){if(!this[I].getContext){continue}G=this[I].getContext("2d");z(G,J);y(G,J,J.radius*2,J.radius*2);G.beginPath();G.arc(J.x,J.y,J.radius,(J.start*J.toRad)-(D/2),(J.end*J.toRad)-(D/2),J.ccw);G.restore();g(G,J)}return this};j.fn.drawEllipse=function(H){var G,J,K=l({},i,H),I=K.width*4/3;for(J=0;J<this.length;J+=1){if(!this[J].getContext){continue}G=this[J].getContext("2d");z(G,K);y(G,K,K.width,K.height);G.beginPath();G.moveTo(K.x,K.y-K.height/2);G.bezierCurveTo(K.x-I/2,K.y-K.height/2,K.x-I/2,K.y+K.height/2,K.x,K.y+K.height/2);G.bezierCurveTo(K.x+I/2,K.y+K.height/2,K.x+I/2,K.y-K.height/2,K.x,K.y-K.height/2);G.restore();g(G,K)}return this};j.fn.drawLine=function(I){var H,L,M=l({},i,I),G=2,K=0,J=0;for(L=0;L<this.length;L+=1){if(!this[L].getContext){continue}H=this[L].getContext("2d");z(H,M);H.beginPath();H.moveTo(M.x1,M.y1);while(K!==m&&J!==m){K=M["x"+G];J=M["y"+G];H.lineTo(K,J);G+=1}g(H,M)}return this};j.fn.drawQuad=function(L){var O,K,J=l({},i,L),I=2,H=0,G=0,N=0,M=0;for(K=0;K<this.length;K+=1){if(!this[K].getContext){continue}O=this[K].getContext("2d");z(O,J);O.beginPath();O.moveTo(J.x1,J.y1);while(H!==m&&G!==m&&N!==m&&M!==m){H=J["x"+I];G=J["y"+I];N=J["cx"+(I-1)];M=J["cy"+(I-1)];O.quadraticCurveTo(N,M,H,G);I+=1}g(O,J)}return this};j.fn.drawBezier=function(Q){var R,P,M=l({},i,Q),L=2,I=1,K=0,J=0,O=0,H=0,N=0,G=0;for(P=0;P<this.length;P+=1){if(!this[P].getContext){continue}R=this[P].getContext("2d");z(R,M);R.beginPath();R.moveTo(M.x1,M.y1);while(K!==m&&J!==m&&O!==m&&H!==m&&N!==m&&G!==m){K=M["x"+L];J=M["y"+L];O=M["cx"+I];H=M["cy"+I];N=M["cx"+(I+1)];G=M["cy"+(I+1)];R.bezierCurveTo(O,H,N,G,K,J);L+=1;I+=2}g(R,M)}return this};j.fn.drawText=function(H){var G,I,J=l({},i,H);for(I=0;I<this.length;I+=1){if(!this[I].getContext){continue}G=this[I].getContext("2d");z(G,J);G.textBaseline=J.baseline;G.textAlign=J.align;G.font=J.font;G.strokeText(J.text,J.x,J.y);G.fillText(J.text,J.x,J.y)}return this};j.fn.drawImage=function(M){var O,H,L,J=l({},i,M),K=new C(),G;K.src=J.source;function N(P){if(K.complete){G=K.width/K.height;if(J.sx===m){J.sx=K.width/2}if(J.sy===m){J.sy=K.height/2}J.sWidth=J.sWidth||K.width;J.sHeight=J.sHeight||K.height;if(J.width&&!J.height){J.height=J.width/G}else{if(!J.width&&J.height){J.width=J.height*G}else{if(!J.width&&!J.height){J.width=K.width;J.height=K.height}}}y(P,J,J.width,J.height);P.drawImage(K,J.sx-J.sWidth/2,J.sy-J.sHeight/2,J.sWidth,J.sHeight,J.x-J.width/2,J.y-J.height/2,J.width,J.height);P.restore();return true}else{return false}}function I(){N(O);if(J.load){J.load.call(H)}}for(L=0;L<this.length;L+=1){H=this[L];if(!H.getContext){continue}O=H.getContext("2d");z(O,J);if(J.load){K.onload=I}else{if(!N(O)){K.onload=I}}}return this};j.fn.drawPolygon=function(M){var R,L,J=l({},i,M),S=D/J.sides,I=(D/2)+S,Q=(D*2)/J.sides,P=e(Q/2)*J.radius,H,O,G,N,K;J.closed=true;if(J.sides>2){for(L=0;L<this.length;L+=1){if(!this[L].getContext){continue}R=this[L].getContext("2d");z(R,J);y(R,J,J.radius,J.radius);R.beginPath();for(K=0;K<J.sides;K+=1){H=J.x+E(J.radius*e(I));O=J.y+E(J.radius*a(I));if(K===0){R.moveTo(H,O)}else{R.lineTo(H,O)}if(J.projection){G=J.x+E((P+P*J.projection)*e(I+S));N=J.y+E((P+P*J.projection)*a(I+S));R.lineTo(G,N)}I+=Q}R.restore();g(R,J)}}return this};j.fn.setPixels=function(N){var P,H,M,K,I=l({},i,N),G,J,L,O;for(M=0;M<this.length;M+=1){H=this[M];if(!H.getContext){continue}P=H.getContext("2d");if(!I.x&&!I.y&&!I.width&&!I.height){I.width=H.width;I.height=H.height;I.x=I.width/2;I.y=I.height/2}y(P,I,I.width,I.height);G=P.getImageData(I.x-I.width/2,I.y-I.height/2,I.width,I.height);J=G.data;L=J.length;O=[];if(I.each!==m){for(K=0;K<L;K+=4){O=I.each.call(H,J[K],J[K+1],J[K+2],J[K+3]);J[K]=O[0];J[K+1]=O[1];J[K+2]=O[2];J[K+3]=O[3]}}P.putImageData(G,I.x-I.width/2,I.y-I.height/2);P.restore()}return this};function v(H,I){var G;for(G=0;G<H.length;G+=1){I[H[G]]=I["_"+H[G]]}}function x(H,I){var G;for(G=0;G<H.length;G+=1){I["_"+H[G]]=I[H[G]]}}b=["width","height","opacity"];d=["backgroundColor","color","borderColor","borderTopColor","borderRightColor","borderBottomColor","borderLeftColor","fillStyle","strokeStyle","shadowColor"];r={aqua:"#0ff",black:"#000",blue:"#00f",fuchsia:"#f0f",gray:"#808080",green:"#008000",lime:"#0f0",maroon:"#800000",navy:"#000080",olive:"808000",purple:"#800080",red:"#f00",silver:"#c0c0c0",teal:"#008080",white:"#fff",yellow:"#ff0"};function h(H){var J,I=[],G=1,K;if(H.match(/^[a-z]+$/gi)){if(r[H]){H=r[H]}else{K=w.body.parentNode;J=K.style.color;K.style.color=H;H=j.css(K,"color");K.style.color=J}}if(H.match(/^\#/gi)){if(H.length===4){H=H.replace(/(\w)/gi,"$1$1")}I=H.match(/[0-9a-f]{2}/gi);I[0]=t(I[0],16);I[1]=t(I[1],16);I[2]=t(I[2],16)}else{if(H.match(/^rgb/gi)){I=H.match(/[0-9\.]+/gi);if(H.match(/\%/gi)){G=2.55}I[0]=c(I[0])*G;I[1]=c(I[1])*G;I[2]=c(I[2])*G}}if(H.indexOf("rgba")!==-1){I[3]=c(I[3])}else{I[3]=1}return I}function F(I,J,G,H){I.now[H]=J[H]+(G[H]-J[H])*I.pos;if(H<3){I.now[H]=E(I.now[H])}}function q(H){var I=h(H.start),G=h(H.end);if(!I||!G){H.now=H.end}else{H.now=[];F(H,I,G,0);F(H,I,G,1);F(H,I,G,2);F(H,I,G,3);H.now="rgba("+H.now.join(",")+")"}if(H.elem.style){H.elem.style[H.prop]=H.now}else{H.elem[H.prop]=H.now}}function s(G){var H;for(H=0;H<G.length;H+=1){if(!j.fx.step[G[H]]){j.fx.step[G[H]]=q}}}j.fn.getLayers=function(){var G=this[0],H;if(!G||!G.getContext){return[]}H=j.data(G,"layers");if(H===m){H=[];j.data(G,"layers",H)}return H};j.fn.addLayer=function(H){var K=this,G,J,I;for(I=0;I<K.length;I+=1){G=j(K[I]);if(!K[I].getContext){continue}J=G.getLayers();if(typeof H==="function"){H.fn="draw"}H=l({},i,H);J.push(H)}return K};j.fn.drawLayers=function(){var M=this,H,G,L,K,J,I;for(J=0;J<M.length;J+=1){H=j(M[J]);if(!H[0].getContext){continue}G=H[0].getContext("2d");K=H.getLayers();for(I=0;I<K.length;I+=1){L=K[I];if(L.fn==="draw"){L.call(H[0],G)}else{if(n[L.fn]){n[L.fn].call(H,L)}}}}return M};arr=[];k=0;j.fn.animateLayer=function(){var L=this,H=u.prototype.slice.call(arguments,0),G,K,I,J;if(typeof H[0]==="object"){H.unshift(0)}if(H[2]===m){H.splice(2,0,null);H.splice(3,0,null);H.splice(4,0,function(){})}else{if(typeof H[2]==="function"){H.splice(2,0,null);H.splice(3,0,null)}}if(H[3]===m){H[3]=null;H.splice(4,0,function(){})}else{if(typeof H[3]==="function"){H.splice(3,0,null)}}if(H[4]===m){H[4]=function(){}}for(J=0;J<L.length;J+=1){G=j(L[J]);K=G.getLayers();I=K[H[0]];if(I===m||typeof I==="function"){continue}x(b,I);x(b,H[1]);arr[k]=I;k+=1;j(I).animate(H[1],{duration:H[2],easing:H[3],complete:(function(M){return function(){M.clearCanvas().drawLayers();H[4].call(M[0])}}(G)),step:(function(M,N){return function(){v(b,N);M.clearCanvas().drawLayers()}}(G,I))})}return L};s(d);A.defaults=p;A.prefs=i;A.extend=B;j.jCanvas=A}(jQuery,document,Math,Array,Image,parseFloat,parseInt));