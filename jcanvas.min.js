/*!
jCanvas v5.4
Copyright 2012, Caleb Evans
Licensed under the MIT license
*/
(function(y,G,c,K,t,w,r,v,O,x,z){var A,Q,F=y.extend,M=t.round,d=t.PI,m=t.sin,b=t.cos,j=y.event.fix,l={},D;function E(){}function N(R){if(R){F(Q,R)}else{Q=F(E.prototype,A)}return this}y.fn.jCanvas=N;N.version="5.4";N.events={};A={angle:0,align:"center",autosave:v,baseline:"middle",ccw:O,closed:O,compositing:"source-over",cornerRadius:0,cropFromCenter:v,each:x,end:360,fillStyle:"transparent",font:"12pt sans-serif",fromCenter:v,height:x,inDegrees:v,load:x,mask:O,miterLimit:10,opacity:1,projection:0,r1:x,r2:x,radius:0,repeat:"repeat",rotate:0,rounded:O,scale:1,scaleX:1,scaleY:1,shadowBlur:0,shadowColor:"transparent",shadowX:0,shadowY:0,sHeight:x,sides:3,source:"",start:0,strokeCap:"butt",strokeJoin:"miter",strokeStyle:"transparent",strokeWidth:1,sWidth:x,sx:x,sy:x,text:"",translate:0,translateX:0,translateY:0,visible:v,width:x,x:0,y:0,};N();function I(R,S){R.fillStyle=S.fillStyle;R.strokeStyle=S.strokeStyle;R.lineWidth=S.strokeWidth;if(S.rounded){R.lineCap="round";R.lineJoin="round"}else{R.lineCap=S.strokeCap;R.lineJoin=S.strokeJoin;R.miterLimit=S.miterLimit}R.shadowOffsetX=S.shadowX;R.shadowOffsetY=S.shadowY;R.shadowBlur=S.shadowBlur;R.shadowColor=S.shadowColor;R.globalAlpha=S.opacity;R.globalCompositeOperation=S.compositing}function P(S){var R=y.data(S,"eventCache");if(!R){R=y.data(S,"eventCache",{x:[],y:[]})}return R}function C(R){N.events[R]=function(S){var T=(R==="mouseover"||R==="mouseout")?"mousemove":R;S.bind(T+".jCanvas",function(V){var U=P(S[0]);U.x[1]=U.x[0];U.y[1]=U.y[0];U.x[0]=V.offsetX;U.y[0]=V.offsetY;U.type=T;S.drawLayers()});y.data(S[0],"jCanvas-"+R,v)}}C("click");C("dblclick");C("mousedown");C("mouseup");C("mousemove");C("mouseover");C("mouseout");function e(R,S){S.mouseX=R.x[0];S.mouseY=R.y[0]}function L(W,R,U){var T=y.data(W,"eventCache"),V,Y,X,S;V=T.type;Y=U[V];X=R.isPointInPath(T.x[0],T.y[0]);S=R.isPointInPath(T.x[1],T.y[1]);if(U.mouseover||U.mouseout){if(X&&!S&&!U._fired){U._fired=v;e(T,U);if(U.mouseover){U.mouseover.call(W,U);I(R,U)}}else{if(!X&&S&&U._fired){U._fired=O;e(T,U);if(U.mouseout){U.mouseout.call(W,U);I(R,U)}}}}if(Y&&X){e(T,U);Y.call(W,U);I(R,U)}}function s(R){return(R&&R.getContext?R.getContext("2d"):x)}function n(R,S){if(S.mask){if(S.autosave){R.save()}R.clip()}if(S.closed){R.closePath();R.fill();R.stroke()}else{R.fill();R.stroke();R.closePath()}}function q(R,S){if((!S.translateX&&!S.translateY)&&(S.x||S.y)){S.translateX=S.x;S.translateY=S.y}if(S.translate){S.translateX=S.translateY=S.translate}R.translate(S.translateX,S.translateY)}function u(R,S){if(S.scale!==1){S.scaleX=S.scaleY=S.scale}R.translate(S.x,S.y);R.scale(S.scaleX,S.scaleY);R.translate(-S.x,-S.y)}function o(R,S){S.toRad=(S.inDegrees?d/180:1);S.rotate=S.rotate||S.angle;R.translate(S.x,S.y);R.rotate(S.rotate*S.toRad);R.translate(-S.x,-S.y)}function g(U,S,V,T,R){V.toRad=(V.inDegrees?d/180:1);S.save();R=R||T;if(!U&&!V.fromCenter){V.x+=T/2;V.y+=R/2}if(V.rotate||V.angle){o(S,V)}if(V.scale!==1||V.scaleX!==1||V.scaleY!==1){u(S,V)}if(V.translate||V.translateX||V.translateY){q(S,V)}}N.extend=function(R){A=F(A,R.props);N();if(R.name){y.fn[R.name]=function(T){var X=this,U,V,S,W=F(new E(),T);for(V=0;V<X.length;V+=1){U=X[V];S=s(U);if(S){I(S,W);R.fn.call(U,S,W)}}return X}}return y.fn[R.name]};y.fn.loadCanvas=function(){return s(this[0])};y.fn.getCanvasImage=function(R,T){var S=this[0];return(S&&S.toDataURL)?S.toDataURL("image/"+R,T):x};y.fn.draw=function(U){var T=this,S,R;for(S=0;S<T.length;S+=1){R=s(T[S]);if(R){U.call(T[S],R)}}return T};y.fn.gradient=function(Z){var R=this,ad,W=F(new E(),Z),ab,ac=[],Y,T,V,X,aa,U,S;ad=s(R[0]);if(ad){if(W.r1!==x||W.r2!==x){ab=ad.createRadialGradient(W.x1,W.y1,W.r1,W.x2,W.y2,W.r2)}else{ab=ad.createLinearGradient(W.x1,W.y1,W.x2,W.y2)}for(X=1;W["c"+X]!==z;X+=1){if(W["s"+X]!==z){ac.push(W["s"+X])}else{ac.push(x)}}Y=ac.length;if(ac[0]===x){ac[0]=0}if(ac[Y-1]===x){ac[Y-1]=1}for(X=0;X<Y;X+=1){if(ac[X]!==x){U=1;S=0;T=ac[X];for(aa=(X+1);aa<Y;aa+=1){if(ac[aa]!==x){V=ac[aa];break}else{U+=1}}if(T>V){ac[aa]=ac[X]}}else{if(ac[X]===x){S+=1;ac[X]=T+(S*((V-T)/U))}}ab.addColorStop(ac[X],W["c"+(X+1)])}}else{ab=x}return ab};y.fn.pattern=function(X){var R=this,Z,T=F(new E(),X),U,W,Y;function V(){W=Z.createPattern(U,T.repeat)}function S(){V();if(T.load){T.load.call(R[0],W)}}Z=s(R[0]);if(Z){if(typeof T.source==="function"){U=c.createElement("canvas");U.width=T.width;U.height=T.height;Y=s(U);T.source.call(U,Y);S()}else{Y=T.source.getContext;if(T.source.src||Y){U=T.source}else{U=new K();U.src=T.source}if(U.complete||Y){S()}else{U.onload=S}}}else{W=x}return W};y.fn.clearCanvas=function(S){var V=this,T,R,U=F(new E(),S);for(T=0;T<V.length;T+=1){R=s(V[T]);if(R){g(T,R,U,U.width,U.height);if(!U.x&&!U.y&&!U.width&&!U.height){R.clearRect(0,0,V[T].width,V[T].height)}else{R.clearRect(U.x-U.width/2,U.y-U.height/2,U.width,U.height)}}}return V};y.fn.saveCanvas=function(){var T=this,S,R;for(S=0;S<T.length;S+=1){R=s(T[S]);if(R){R.save()}}return T};y.fn.restoreCanvas=function(){var T=this,S,R;for(S=0;S<T.length;S+=1){R=s(T[S]);if(R){R.restore()}}return T};y.fn.scaleCanvas=function(S){var V=this,T,R,U=F(new E(),S);for(T=0;T<V.length;T+=1){R=s(V[T]);if(R){if(U.autosave){R.save()}u(R,U)}}return V};y.fn.translateCanvas=function(S){var V=this,T,R,U=F(new E(),S);for(T=0;T<V.length;T+=1){R=s(V[T]);if(R){if(U.autosave){R.save()}q(R,U)}}return V};y.fn.rotateCanvas=function(S){var V=this,T,R,U=F(new E(),S);for(T=0;T<V.length;T+=1){R=s(V[T]);if(R){if(U.autosave){R.save()}o(R,U)}}return V};y.fn.drawRect=function i(X){var S=this,W,aa,V=F(new E(),X),U,Z,T,Y,R;for(W=0;W<S.length;W+=1){aa=s(S[W]);if(aa){p(S[W],X,i);I(aa,V);g(W,aa,V,V.width,V.height);aa.beginPath();U=V.x-V.width/2;Z=V.y-V.height/2;R=V.cornerRadius;if(R){V.closed=v;T=V.x+V.width/2;Y=V.y+V.height/2;if((T-U)-(2*R)<0){R=(T-U)/2}if((Y-Z)-(2*R)<0){R=(Y-Z)/2}aa.moveTo(U+R,Z);aa.lineTo(T-R,Z);aa.arc(T-R,Z+R,R,3*d/2,d*2,O);aa.lineTo(T,Y-R);aa.arc(T-R,Y-R,R,0,d/2,O);aa.lineTo(U+R,Y);aa.arc(U+R,Y-R,R,d/2,d,O);aa.lineTo(U,Z+R);aa.arc(U+R,Z+R,R,d,3*d/2,O)}else{aa.rect(U,Z,V.width,V.height)}aa.restore();if(V._event){L(S[W],aa,X)}n(aa,V)}}return S};y.fn.drawArc=function i(S){var V=this,T,R,U=F(new E(),S);if(!U.inDegrees&&U.end===360){U.end=d*2}for(T=0;T<V.length;T+=1){R=s(V[T]);if(R){p(V[T],S,i);I(R,U);g(T,R,U,U.radius*2);R.beginPath();R.arc(U.x,U.y,U.radius,(U.start*U.toRad)-(d/2),(U.end*U.toRad)-(d/2),U.ccw);R.restore();if(U._event){L(V[T],R,S)}n(R,U)}}return V};y.fn.drawEllipse=function i(T){var X=this,V,S,W=F(new E(),T),U=W.width*4/3,R=W.height;for(V=0;V<X.length;V+=1){S=s(X[V]);if(S){p(X[V],T,i);I(S,W);g(V,S,W,W.width,W.height);S.beginPath();S.moveTo(W.x,W.y-R/2);S.bezierCurveTo(W.x-U/2,W.y-R/2,W.x-U/2,W.y+R/2,W.x,W.y+R/2);S.bezierCurveTo(W.x+U/2,W.y+R/2,W.x+U/2,W.y-R/2,W.x,W.y-R/2);S.restore();if(W._event){L(X[V],S,T)}n(S,W)}}return X};y.fn.drawLine=function i(T){var Y=this,W,S,X=F(new E(),T),R=1,V=0,U=0;for(W=0;W<Y.length;W+=1){S=s(Y[W]);if(S){p(Y[W],T,i);I(S,X);S.beginPath();while(v){V=X["x"+R];U=X["y"+R];if(V!==z&&U!==z){S.lineTo(V,U);R+=1}else{break}}if(X._event){L(Y[W],S,T)}n(S,X)}}return Y};y.fn.drawQuad=function i(X){var R=this,W,aa,V=F(new E(),X),U=2,T=0,S=0,Z=0,Y=0;for(W=0;W<R.length;W+=1){aa=s(R[W]);if(aa){p(R[W],X,i);I(aa,V);aa.beginPath();aa.moveTo(V.x1,V.y1);while(v){T=V["x"+U];S=V["y"+U];Z=V["cx"+(U-1)];Y=V["cy"+(U-1)];if(T!==z&&S!==z&&Z!==z&&Y!==z){aa.quadraticCurveTo(Z,Y,T,S);U+=1}else{break}}if(V._event){L(R[W],aa,X)}n(aa,V)}}return R};y.fn.drawBezier=function i(ac){var R=this,ab,ad,Y=F(new E(),ac),X=2,U=1,W=0,V=0,aa=0,T=0,Z=0,S=0;for(ab=0;ab<R.length;ab+=1){ad=s(R[ab]);if(ad){p(R[ab],ac,i);I(ad,Y);ad.beginPath();ad.moveTo(Y.x1,Y.y1);while(v){W=Y["x"+X];V=Y["y"+X];aa=Y["cx"+U];T=Y["cy"+U];Z=Y["cx"+(U+1)];S=Y["cy"+(U+1)];if(W!==z&&V!==z&&aa!==z&&T!==z&&Z!==z&&S!==z){ad.bezierCurveTo(aa,T,Z,S,W,V);X+=1;U+=2}else{break}}if(Y._event){L(R[ab],ad,ac)}n(ad,Y)}}return R};function H(V,R,W){var S,T,U=/(\d*\.?\d*)\w\w\b/gi;W.width=R.measureText(W.text).width;if(l.font===W.font&&l.text===W.text){W.height=l.height}else{S=V.style.fontSize;T=W.font.match(U);if(T){V.style.fontSize=(W.font.match(U)||y.css(V,"fontSize"))[0]}W.height=r(y.css(V,"fontSize"));V.style.fontSize=S}}y.fn.drawText=function i(T){var W=this,S,U,R,V=F(new E(),T);for(U=0;U<W.length;U+=1){S=y(W[U]);R=s(S[0]);if(R){p(W[U],T,i);I(R,V);R.textBaseline=V.baseline;R.textAlign=V.align;R.font=V.font;H(S[0],R,V);g(U,R,V,V.width,V.height);R.strokeText(V.text,V.x,V.y);R.fillText(V.text,V.x,V.y);if(V._event){R.beginPath();R.rect(V.x-V.width/2,V.y-V.height/2,V.width,V.height);R.restore();L(W[U],R,T);R.closePath()}else{R.restore()}}}l=V;return W};y.fn.drawImage=function i(Y){var R=this,T,X,aa,V=F(new E(),Y),W,S;if(V.source.src){W=V.source}else{if(V.source){W=new K();W.src=V.source}}function Z(ac,ab){if(!ac){S=W.width/W.height;if(V.width===x&&V.sWidth===x){Y.width=V.width=V.sWidth=W.width}if(V.height===x&&V.sHeight===x){Y.height=V.height=V.sHeight=W.height}if(V.width===x&&V.sWidth!==x){V.width=V.sWidth}if(V.height===x&&V.sHeight!==x){V.height=V.sHeight}if(V.sWidth===x&&V.width!==x){Y.sWidth=V.sWidth=W.width}if(V.sHeight===x&&V.height!==x){Y.sHeight=V.sHeight=W.height}if(V.sx===x){if(V.cropFromCenter){V.sx=W.width/2}else{V.sx=0}}if(V.sy===x){if(V.cropFromCenter){V.sy=W.height/2}else{V.sy=0}}if(!V.cropFromCenter){V.sx+=V.sWidth/2;V.sy+=V.sHeight/2}if((V.sx+V.sWidth/2)>W.width){V.sx=W.width-V.sWidth/2}if((V.sx-V.sWidth/2)<0){V.sx=V.sWidth/2}if((V.sy-V.sHeight/2)<0){V.sy=V.sHeight/2}if((V.sy+V.sHeight/2)>W.height){V.sy=W.height-V.sHeight/2}if(V.width!==x&&V.height===x){Y.height=V.height=V.width/S}else{if(V.width===x&&V.height!==x){Y.width=V.width=V.height*S}else{if(V.width===x&&V.height===x){Y.width=V.width=W.width;Y.height=V.height=W.height}}}}ab.drawImage(W,V.sx-V.sWidth/2,V.sy-V.sHeight/2,V.sWidth,V.sHeight,V.x-V.width/2,V.y-V.height/2,V.width,V.height);if(V._event){ab.beginPath();ab.rect(V.x-V.width/2,V.y-V.height/2,V.width,V.height);ab.restore();L(R[ac],ab,Y);ab.closePath()}else{ab.restore()}}function U(ac,ad,ab){return function(){Z(ad,ab);if(V.load){V.load.call(ac)}}}for(X=0;X<R.length;X+=1){T=R[X];aa=s(R[X]);if(aa){p(R[X],Y,i);I(aa,V);g(X,aa,V,V.width,V.height);if(W){if(W.complete){U(T,X,aa)()}else{W.onload=U(T,X,aa)}}}}return R};y.fn.drawPolygon=function i(W){var R=this,V,ac,T=F(new E(),W),ab=d/T.sides,S=(d/2)+ab,aa=(d*2)/T.sides,Z=b(aa/2)*T.radius,Y,X,U;T.closed=v;for(V=0;V<R.length;V+=1){ac=s(R[V]);if(ac){p(R[V],W,i);I(ac,T);g(V,ac,T,T.radius*2);ac.beginPath();for(U=0;U<T.sides;U+=1){Y=T.x+M(T.radius*b(S));X=T.y+M(T.radius*m(S));ac.lineTo(Y,X);if(T.projection){Y=T.x+M((Z+Z*T.projection)*b(S+ab));X=T.y+M((Z+Z*T.projection)*m(S+ab));ac.lineTo(Y,X)}S+=aa}ac.restore();if(T._event){L(R[V],ac,W)}n(ac,T)}}return R};y.fn.setPixels=function i(Z){var R=this,T,Y,ab,U=F(new E(),Z),aa={},S,W,V,X;for(Y=0;Y<R.length;Y+=1){T=R[Y];ab=s(T);if(ab){p(R[Y],Z,i);g(Y,ab,U,U.width,U.height);if(!U.x&&!U.y&&!U.width&&!U.height){U.width=T.width;U.height=T.height;U.x=U.width/2;U.y=U.height/2}S=ab.getImageData(U.x-U.width/2,U.y-U.height/2,U.width,U.height);W=S.data;X=W.length;aa=[];if(U.each!==x){for(V=0;V<X;V+=4){aa.r=W[V];aa.g=W[V+1];aa.b=W[V+2];aa.a=W[V+3];U.each.call(T,aa);W[V]=aa.r;W[V+1]=aa.g;W[V+2]=aa.b;W[V+3]=aa.a}}ab.putImageData(S,U.x-U.width/2,U.y-U.height/2);ab.restore()}}return R};y.fn.getLayers=function(){var R=this[0],S;if(!R||!R.getContext){S=[]}else{S=y.data(R,"jCanvas-layers");if(!S){S=[];y.data(R,"jCanvas-layers",S)}}return S};y.fn.getLayer=function(R){var T=this.getLayers(),S;if(typeof R==="string"){for(S=0;S<T.length;S+=1){T[S].index=S;if(T[S].name===R){R=S;break}}}R=R||0;return T[R]};function a(S,R,T){if(T&&T.visible){if(T.method===y.fn.draw){T.call(S[0],R)}else{if(T.method){T.method.call(S,T)}}}}y.fn.drawLayer=function(T){var W=this,V,R,S,U;for(V=0;V<W.length;V+=1){S=y(W[V]);R=s(S[0]);U=S.getLayer(T);a(S,R,U)}};y.fn.drawLayers=function(){var X=this,S,W,R,V,U,T;for(W=0;W<X.length;W+=1){S=y(X[W]);R=s(S[0]);if(R){R.clearRect(0,0,S[0].width,S[0].height);V=S.getLayers();for(T=0;T<V.length;T+=1){U=V[T];a(S,R,U)}}}return X};function p(U,S,X){var R,V,T,W;S=S||{};W=S;if(S.layer&&!S._layer){R=y(U);V=R.getLayers();if(typeof S==="function"){S=function(Y){return W.call(this,Y)};S.method=y.fn.draw;if(S.visible===z){S.visible=v}}else{S=F(new E(),S);S.method=y.fn[S.method]||X;if(S.method!==y.fn.drawImage){S.width=S.width||0;S.height=S.height||0}for(T in N.events){if(N.events.hasOwnProperty(T)&&S[T]){if(!y.data(R[0],"jCanvas-"+T)){N.events[T].call(G,R)}S._event=v}}}S._layer=v;S.index=V.length-1;V.push(S)}}y.fn.addLayer=function(S){var U=this,T,R;S=S||{};for(T=0;T<U.length;T+=1){R=s(U[T]);if(R){S.layer=v;p(U[T],S)}}return U};y.fn.removeLayers=function(){var T=this,S,R;for(R=0;R<T.length;R+=1){S=y(T[R]).getLayers();S.length=0}return T};y.fn.removeLayer=function(R){var V=this,U,T,S;for(U=0;U<V.length;U+=1){T=y(V[U]).getLayers();if(typeof R==="string"){for(S=0;S<T.length;S+=1){if(T[S].name===R){R=S;break}}}T.splice(R,1)}return V};D=["width","height","opacity"];function f(S){var R;for(R=0;R<D.length;R+=1){S[D[R]]=S["_"+D[R]]}}function h(S){var R;for(R=0;R<D.length;R+=1){S["_"+D[R]]=S[D[R]]}}function B(S){var V,U,T=[],R=1;if(S.match(/^#?[a-z0-9]+$/gi)){U=c.head;V=U.style.color;U.style.color=S;S=y.css(U,"color");U.style.color=V}if(S.match(/^rgb/gi)){T=S.match(/[0-9]+/gi);if(S.match(/%/gi)){R=2.55}T[0]=T[0]*R;T[1]=T[1]*R;T[2]=T[2]*R}return T}function J(S){var R;if(typeof S.start!=="object"){S.start=B(S.start);S.end=B(S.end)}S.now=[];for(R=0;R<3;R+=1){S.now[R]=M(S.start[R]+(S.end[R]-S.start[R])*S.pos)}S.now="rgb("+S.now.join(",")+")";if(S.elem.style){S.elem.style[S.prop]=S.now}else{S.elem[S.prop]=S.now}}y.fn.animateLayer=function(){var R=this,S,X,Z,Y=([]).slice.call(arguments,0),V,W;if(typeof Y[0]==="object"&&!Y[0].layer){Y.unshift(0)}if(Y[2]===z){Y.splice(2,0,x);Y.splice(3,0,x);Y.splice(4,0,x)}else{if(typeof Y[2]==="function"){Y.splice(2,0,x);Y.splice(3,0,x)}}if(Y[3]===z){Y[3]=x;Y.splice(4,0,x)}else{if(typeof Y[3]==="function"){Y.splice(3,0,x)}}if(Y[4]===z){Y[4]=x}function T(aa,ab){return function(){f(ab);aa.drawLayers();if(Y[4]){Y[4].call(aa)}}}function U(aa,ab){return function(){f(ab);aa.drawLayers()}}for(X=0;X<R.length;X+=1){S=y(R[X]);Z=s(R[X]);if(Z){if(Y[0].layer){V=Y[0]}else{V=S.getLayer(Y[0])}if(V&&V.method!==y.fn.draw){h(V);h(Y[1]);W=P(R[X]);W.x=[];W.y=[];y(V).animate(Y[1],{duration:Y[2],easing:(y.easing[Y[3]]?Y[3]:x),complete:T(S,V),step:U(S,V)})}}}return R};y.fn.stopLayer=function(R,S){if(!R.layer){R=y(this).getLayer(R)}y(R).stop(S);return this};y.event.fix=function(R){var S;R=j.call(y.event,R);if(R.pageX!==z&&R.offsetX===z){S=y(R.target).offset();if(S){R.offsetX=R.pageX-S.left;R.offsetY=R.pageY-S.top}}return R};function k(R){var S;for(S=0;S<R.length;S+=1){y.fx.step[R[S]]=J}}k(["color","backgroundColor","borderColor","borderTopColor","borderRightColor","borderBottomColor","borderLeftColor","fillStyle","outlineColor","strokeStyle","shadowColor",]);y.support.canvas=(c.createElement("canvas").getContext!==z);N.defaults=A;N.prefs=Q;y.jCanvas=N}(jQuery,window,document,Image,Math,Function,parseFloat,true,false,null));