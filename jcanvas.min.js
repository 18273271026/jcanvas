/*
 jCanvas
Copyright 2012, Caleb Evans
Licensed under the MIT license
*/
(function(d,S,W,Q,X,u,D,h,z){function A(){}function C(c){c?v(Y,c):C.prefs=Y=A.prototype=v({},N);return this}function J(c,a){c.fillStyle=a.fillStyle;c.strokeStyle=a.strokeStyle;c.lineWidth=a.strokeWidth;a.rounded?(c.lineCap="round",c.lineJoin="round"):(c.lineCap=a.strokeCap,c.lineJoin=a.strokeJoin,c.miterLimit=a.miterLimit);c.shadowOffsetX=a.shadowX;c.shadowOffsetY=a.shadowY;c.shadowBlur=a.shadowBlur;c.shadowColor=a.shadowColor;c.globalAlpha=a.opacity;c.globalCompositeOperation=a.compositing}function y(c){return c&&
c.getContext?c.getContext("2d"):h}function K(c,a,b){b._event&&T(c,a,b);b.closed&&a.closePath();a.fill();"transparent"!==b.fillStyle&&(a.shadowColor="transparent");0!==b.strokeWidth&&a.stroke();b.closed||a.closePath();a.restore();b.mask&&(b.autosave&&a.save(),a.clip())}function Z(c,a,b){a._toRad=a.inDegrees?E/180:1;c.translate(a.x,a.y);c.rotate(a.rotate*a._toRad);c.translate(-a.x,-a.y);b.rotate+=a.rotate*a._toRad}function $(c,a,b){1!==a.scale&&(a.scaleX=a.scaleY=a.scale);c.translate(a.x,a.y);c.scale(a.scaleX,
a.scaleY);c.translate(-a.x,-a.y);b.scaleX*=a.scaleX;b.scaleY*=a.scaleY}function aa(c,a,b){a.translate&&(a.translateX=a.translateY=a.translate);c.translate(a.translateX,a.translateY);b.translateX+=a.translateX;b.translateY+=a.translateY}function H(c,a,b,e,g,f){b._toRad=b.inDegrees?E/180:1;a.save();f===z&&(f=g);!c&&!b.fromCenter&&(b.x+=g/2,b.y+=f/2);b.rotate&&Z(a,b,{});(1!==b.scale||1!==b.scaleX||1!==b.scaleY)&&$(a,b,{});(b.translate||b.translateX||b.translateY)&&aa(a,b,{})}function U(c){c.draggable&&
(c.translateX+=c.x,c.translateY+=c.y)}function I(c){var a;F.elem===c?a=F.data:(a=d.data(c,"jCanvas"),a||(a={layers:[],intersects:[],drag:{},event:{},transforms:{rotate:0,scaleX:1,scaleY:1,translateX:0,translateY:0}},a.savedTransforms=v({},a.transforms),d.data(c,"jCanvas",a)),F.elem=c,F.data=a);return a}function ba(c,a,b){b&&b.visible&&(b.method===d.fn.draw?b.fn.call(c[0],a):b.method&&b.method.call(c,b))}function G(c,a,b){var e,g,f,n="function"===typeof a,B,a=a||{};if(a.layer&&!a._layer){e=d(c);g=
e.getLayers();n&&(a={method:d.fn.draw,fn:a});a=v(new A,a);if(!n){a.method=d.fn[a.method]||b;B=I(c);for(f in C.events)C.events.hasOwnProperty(f)&&a[f]&&(C.events[f](e,B),a._event=u);if(a.draggable||a.cursor){a._event=u;c=["mousedown","mousemove","mouseup"];for(b=0;b<c.length;b+=1)f=c[b],C.events[f](e,B);B.mouseout||(e.bind("mouseout.jCanvas",function(){B.drag={};e.drawLayers()}),B.mouseout=u)}}a.layer=u;a._layer=u;a.index===z&&(a.index=g.length);g.splice(a.index,0,a)}return a}function ca(c){var a;
for(a=0;a<L.length;a+=1)c[L[a]]=c["_"+L[a]]}function da(c,a){var b;for(b=0;b<L.length;b+=1)c["_"+L[b]]=c[L[b]],V[L[b]]=1,a&&delete c[L[b]]}function ea(c){var a,b,e=[],g=1;c.match(/^#?\w+$/i)&&("transparent"===c&&(c="rgba(0,0,0,0)"),b=S.head,a=b.style.color,b.style.color=c,c=d.css(b,"color"),b.style.color=a);c.match(/^rgb/i)&&(e=c.match(/\d+/gi),c.match(/%/gi)&&(g=2.55),e[0]*=g,e[1]*=g,e[2]*=g,e[3]=e[3]!==z?X(e[3]):1);return e}function ga(c){var a=3,b;"object"!==typeof c.start&&(c.start=ea(c.start),
c.end=ea(c.end));c.now=[];if(1!==c.start[3]||1!==c.end[3])a=4;for(b=0;b<a;b+=1)c.now[b]=c.start[b]+(c.end[b]-c.start[b])*c.pos,3>b&&(c.now[b]=O(c.now[b]));1!==c.start[3]||1!==c.end[3]?c.now="rgba("+c.now.join(",")+")":(c.now.slice(0,3),c.now="rgb("+c.now.join(",")+")");c.elem.nodeName?c.elem.style[c.prop]=c.now:c.elem[c.prop]=c.now}function M(c){C.events[c]=function(a,b){var e="mouseover"===c||"mouseout"===c?"mousemove":c,g=b.event;b[e]||(a.bind(e+".jCanvas",function(b){g.x=b.offsetX;g.y=b.offsetY;
g.type=e;a.drawLayers(u);b.preventDefault()}),b[e]=u)}}function T(c,a,b){var c=I(c),e=c.event,a=a.isPointInPath(e.x,e.y),g=c.transforms,f,n;b.mouseX=e.x;b.mouseY=e.y;n=c.transforms.rotate;e=b.mouseX;f=b.mouseY;b._mouseX=e*P(-n)-f*R(-n);b._mouseY=f*P(-n)+e*R(-n);b._mouseX/=g.scaleX;b._mouseY/=g.scaleY;!a&&(b._hovered&&!b._fired)&&(b._mousedout=u);a&&c.intersects.push(b)}function fa(c,a,b,e,g){var f=/\b(\d*\.?\d*)\w\w\b/gi,n;if(F.text===e.text&&F.font===e.font&&F.maxWidth===e.maxWidth&&F.lineHeight===
e.lineHeight)e.width=F.width,e.height=F.height;else if(!a){e.width=b.measureText(g[0]).width;for(a=1;a<g.length;a+=1)n=b.measureText(g[a]).width,n>e.width&&(e.width=n);b=c.style.fontSize;if(a=e.font.match(f))c.style.fontSize=e.font.match(f)[0];e.height=X(d.css(c,"fontSize"))*g.length*e.lineHeight;c.style.fontSize=b}}var N,Y,v=d.extend,O=Q.round,E=Q.PI,R=Q.sin,P=Q.cos,ha=d.event.fix,F={},L,V;d.fn.jCanvas=C;C.events={};N={align:"center",autosave:u,baseline:"middle",bringToFront:D,ccw:D,closed:D,compositing:"source-over",
cornerRadius:0,cropFromCenter:u,draggable:D,disableDrag:D,disableEvents:D,each:h,end:360,fillStyle:"transparent",font:"12pt sans-serif",fromCenter:u,height:h,inDegrees:u,lineHeight:1,load:h,mask:D,maxWidth:h,method:h,miterLimit:10,opacity:1,projection:0,r1:h,r2:h,radius:0,repeat:"repeat",rotate:0,rounded:D,scale:1,scaleX:1,scaleY:1,shadowBlur:0,shadowColor:"transparent",shadowX:0,shadowY:0,sHeight:h,sides:3,source:"",start:0,strokeCap:"butt",strokeJoin:"miter",strokeStyle:"transparent",strokeWidth:1,
sWidth:h,sx:h,sy:h,text:"",translate:0,translateX:0,translateY:0,visible:u,width:h,x:0,y:0};C();C.extend=function(c){C.defaults=N=v(N,c.props);C();c.name&&(d.fn[c.name]=function b(e){var g,f,n,d=v(new A,e);for(f=0;f<this.length;f+=1)if(g=this[f],n=y(g))e=G(g,e,b),J(n,d),c.fn.call(g,n,e);return this});return d.fn[c.name]};d.fn.getLayers=function(){var c=this[0];return!c||!c.getContext?[]:I(c).layers};d.fn.getLayer=function(c){var a=this.getLayers(),b=d.type(c),e,g;if(c&&c.layer)e=c;else if("number"===
b)e=a[c];else for(g=0;g<a.length;g+=1)if(a[g].index=g,a[g].name===c||"regexp"===b&&a[g].name.match(c)){e=a[g];break}return e};d.fn.setLayer=function(c,a){var b,e;for(b=0;b<this.length;b+=1)(e=d(this[b]).getLayer(c))&&v(e,a);return this};d.fn.moveLayer=function(c,a){var b,e,g;for(e=0;e<this.length;e+=1)if(b=d(this[e]),g=b.getLayers(),b=b.getLayer(c))g.splice(b.index,1),g.splice(a,0,b),b.index=a;return this};d.fn.removeLayer=function(c){var a,b,e;for(b=0;b<this.length;b+=1)a=d(this[b]),e=a.getLayers(),
(a=a.getLayer(c))&&e.splice(a.index,1);return this};d.fn.removeLayers=function(){var c,a;for(c=0;c<this.length;c+=1)a=d(this[c]).getLayers(),a.length=0;return this};d.fn.getLayerGroup=function(c){var a=this.getLayers(),b=d.type(c),e=[],g;if("array"===b)return c;for(g=0;g<a.length;g+=1)a[g].index=g,(a[g].group===c||"regexp"===b&&a[g].group.match(c))&&e.push(a[g]);return e};d.fn.setLayerGroup=function(c,a){var b,e,g;for(e=0;e<this.length;e+=1){b=d(this[e]);b=b.getLayerGroup(c);for(g=0;g<b.length;g+=
1)v(b[g],a)}return this};d.fn.removeLayerGroup=function(c){var a,b,e=d.type(c),g;if(c!==z)for(b=0;b<this.length;b+=1){a=d(this[b]);a=a.getLayers();for(g=0;g<a.length;g+=1)if(a[g].index=g,a[g].group===c||"regexp"===e&&a[g].group.match(c))a.splice(g,1),g-=1}return this};d.fn.drawLayer=function(c){var a,b,e,g;for(a=0;a<this.length;a+=1)e=d(this[a]),b=y(this[a]),g=e.getLayer(c),ba(e,b,g);return this};d.fn.drawLayers=function(c){var a,b,e,g,f,n,B,r;for(b=0;b<this.length;b+=1)if(a=d(this[b]),e=y(this[b])){I(this[b]);
a.clearCanvas();F.elem===this[b]?B=F.data:(B=I(this[b]),F.elem=this[b],F.data=B);g=B.layers;for(n=0;n<g.length;n+=1)if(f=g[n],f.index=n,c&&(f._fired=D),f._event=!f.disableEvents,ba(a,e,f),f._mousedout)f._mousedout=D,f._fired=u,f._hovered=D,f.mouseout&&f.mouseout.call(this[b],f),f.cursor&&f._cursor&&a.css({cursor:f._cursor});f=B.intersects[B.intersects.length-1]||{};e=B.event;e=e.type;r=f[e];n=B.drag;if(f._event){if((f.mouseover||f.mouseout||f.cursor)&&!f._hovered&&!f._fired)f._fired=u,f._hovered=
u,f.mouseover&&f.mouseover.call(this[b],f),f.cursor&&(f._cursor=a.css("cursor"),a.css({cursor:f.cursor}));r&&!f._fired&&(f._fired=u,r.call(this[b],f));f.draggable&&(!f.disableDrag&&"mousedown"===e)&&(f.bringToFront&&(g.splice(f.index,1),f.index=g.push(f)),n.layer=f,n.dragging=u,n.startX=f.x,n.startY=f.y,n.endX=f._mouseX,n.endY=f._mouseY,f.dragstart&&f.dragstart.call(this[b],f))}if(n.layer&&(n.dragging&&"mouseup"===e&&(n.layer.dragstop&&n.layer.dragstop.call(this[b],n.layer),B.drag={}),n.dragging&&
"mousemove"===e))n.layer.x=n.layer._mouseX-(n.endX-n.startX),n.layer.y=n.layer._mouseY-(n.endY-n.startY),n.layer.drag&&n.layer.drag.call(this[b],n.layer)}B.intersects=[];return this};d.fn.addLayer=function(c){var a,b,c=c||{};for(a=0;a<this.length;a+=1)if(b=y(this[a]))c.layer=u,c=G(this[a],c);return this};L=["width","height","opacity","lineHeight"];V={};d.fn.animateLayer=function(){function c(a,b){return function(){ca(b);a.drawLayers();f[4]&&f[4].call(a[0],b)}}function a(a,b){return function(c,e){ca(b);
a.drawLayers();f[5]&&f[5].call(a[0],c,e,b)}}var b,e,g,f=[].slice.call(arguments,0);"object"===typeof f[0]&&!f[0].layer&&f.unshift(0);"object"===typeof f[2]?(f.splice(2,0,f[2].duration||h),f.splice(3,0,f[3].easing||h),f.splice(4,0,f[4].complete||h),f.splice(5,0,f[5].step||h)):(f[2]===z?(f.splice(2,0,h),f.splice(3,0,h),f.splice(4,0,h)):"function"===typeof f[2]&&(f.splice(2,0,h),f.splice(3,0,h)),f[3]===z)?(f[3]=h,f.splice(4,0,h)):"function"===typeof f[3]&&f.splice(3,0,h);f[1]=v({},f[1]);for(e=0;e<this.length;e+=
1)if(b=d(this[e]),g=y(this[e]))if(I(this[e]),(g=b.getLayer(f[0]))&&g.method!==d.fn.draw)da(g),da(f[1],u),g.style=V,d(g).animate(f[1],{duration:f[2],easing:d.easing[f[3]]?f[3]:h,complete:c(b,g),step:a(b,g)});return this};d.fn.animateLayerGroup=function(c){var a,b,e=[].slice.call(arguments,0),g,f;for(b=0;b<this.length;b+=1){a=d(this[b]);g=a.getLayerGroup(c);for(f=0;f<g.length;f+=1)a.animateLayer.apply(a,[g[f]].concat(e.slice(1)))}};d.fn.delayLayer=function(c,a){var b,e,a=a||0;for(b=0;b<this.length;b+=
1)e=d(this[b]).getLayer(c),d(e).delay(a);return this};d.fn.delayLayerGroup=function(c,a){var b,e,g,f,a=a||0;for(e=0;e<this.length;e+=1){b=d(this[e]);g=b.getLayerGroup(c);for(f=0;f<g.length;f+=1)b.delayLayer.call(b,g[f],a)}};d.fn.stopLayer=function(c,a){var b,e;for(b=0;b<this.length;b+=1)e=d(this[b]).getLayer(c),d(e).stop(a);return this};d.fn.stopLayerGroup=function(c,a){var b,e,g,f;for(e=0;e<this.length;e+=1){b=d(this[e]);g=b.getLayerGroup(c);for(f=0;f<g.length;f+=1)b.stopLayer.call(b,g[f],a)}};(function(c){var a;
for(a=0;a<c.length;a+=1)d.fx.step[c[a]]=ga})("color backgroundColor borderColor borderTopColor borderRightColor borderBottomColor borderLeftColor fillStyle outlineColor strokeStyle shadowColor".split(" "));M("click");M("dblclick");M("mousedown");M("mouseup");M("mousemove");M("mouseover");M("mouseout");d.event.fix=function(c){var a,c=ha.call(d.event,c);if(c.pageX!==z&&c.offsetX===z&&(a=d(c.target).offset()))c.offsetX=c.pageX-a.left,c.offsetY=c.pageY-a.top;return c};d.fn.draw=function a(b){var e,g,
b=b||{};"function"===typeof b&&(b={fn:b});for(e=0;e<this.length;e+=1)if((g=y(this[e]))&&b.fn)b=G(this[e],b,a),b.fn.call(this[e],g);return this};d.fn.clearCanvas=function(a){var b,e,g=v(new A,a);for(b=0;b<this.length;b+=1)if(e=y(this[b]))H(b,e,g,a,g.width,g.height),e.setTransform(1,0,0,1,0,0),!g.x||!g.y||!g.width||!g.height?e.clearRect(0,0,this[b].width,this[b].height):e.clearRect(g.x-g.width/2,g.y-g.height/2,g.width,g.height),e.restore();return this};d.fn.saveCanvas=function(){var a,b,e;for(a=0;a<
this.length;a+=1)if(b=y(this[a]))e=I(this[a]),b.save(),e.savedTransforms=v({},e.transforms);return this};d.fn.restoreCanvas=function(){var a,b,e;for(a=0;a<this.length;a+=1)if(b=y(this[a]))e=I(this[a]),b.restore(),e.transforms=v({},e.savedTransforms);return this};d.fn.translateCanvas=function(a){for(var b,e=v(new A,a),g,a=0;a<this.length;a+=1)if(b=y(this[a]))g=I(this[a]),e.autosave&&b.save(),aa(b,e,g.transforms);return this};d.fn.scaleCanvas=function(a){for(var b,e=v(new A,a),g,a=0;a<this.length;a+=
1)if(b=y(this[a]))g=I(this[a]),e.autosave&&b.save(),$(b,e,g.transforms);return this};d.fn.rotateCanvas=function(a){for(var b,e=v(new A,a),g,a=0;a<this.length;a+=1)if(b=y(this[a]))g=I(this[a]),e.autosave&&b.save(),Z(b,e,g.transforms);return this};d.fn.drawRect=function b(e){var g,f,n=v(new A,e),d,r,t,q,j;for(g=0;g<this.length;g+=1)if(f=y(this[g]))e=G(this[g],e,b),J(f,n),H(g,f,n,e,n.width,n.height),f.beginPath(),d=n.x-n.width/2,r=n.y-n.height/2,(j=n.cornerRadius)?(n.closed=u,t=n.x+n.width/2,q=n.y+n.height/
2,0>t-d-2*j&&(j=(t-d)/2),0>q-r-2*j&&(j=(q-r)/2),f.moveTo(d+j,r),f.lineTo(t-j,r),f.arc(t-j,r+j,j,3*E/2,2*E,D),f.lineTo(t,q-j),f.arc(t-j,q-j,j,0,E/2,D),f.lineTo(d+j,q),f.arc(d+j,q-j,j,E/2,E,D),f.lineTo(d,r+j),f.arc(d+j,r+j,j,E,3*E/2,D)):f.rect(d,r,n.width,n.height),K(this[g],f,e);return this};d.fn.drawArc=function e(g){var f,d,h=v(new A,g),g=g||{};!h.inDegrees&&360===h.end&&(g.end=h.end=2*E);for(f=0;f<this.length;f+=1)if(d=y(this[f]))g=G(this[f],g,e),J(d,h),H(f,d,h,g,2*h.radius),d.beginPath(),d.arc(h.x,
h.y,h.radius,h.start*h._toRad-E/2,h.end*h._toRad-E/2,h.ccw),K(this[f],d,g);return this};d.fn.drawEllipse=function g(f){var d,h,r=v(new A,f),t=4*r.width/3,q=r.height;r.closed=u;for(d=0;d<this.length;d+=1)if(h=y(this[d]))f=G(this[d],f,g),J(h,r),H(d,h,r,f,r.width,r.height),h.beginPath(),h.moveTo(r.x,r.y-q/2),h.bezierCurveTo(r.x-t/2,r.y-q/2,r.x-t/2,r.y+q/2,r.x,r.y+q/2),h.bezierCurveTo(r.x+t/2,r.y+q/2,r.x+t/2,r.y-q/2,r.x,r.y-q/2),K(this[d],h,f);return this};d.fn.drawPolygon=function f(d){var h,r,t=v(new A,
d),q=2*E/t.sides,j=E/t.sides,l=j+E/2,m=t.radius*P(q/2),o,p,k;t.closed=u;for(h=0;h<this.length;h+=1)if(r=y(this[h])){d=G(this[h],d,f);J(r,t);H(h,r,t,d,2*t.radius);r.beginPath();for(k=0;k<t.sides;k+=1)o=t.x+O(t.radius*P(l)),p=t.y+O(t.radius*R(l)),r.lineTo(o,p),t.projection&&(o=t.x+O((m+m*t.projection)*P(l+j)),p=t.y+O((m+m*t.projection)*R(l+j)),r.lineTo(o,p)),l+=q;K(this[h],r,d)}return this};d.fn.drawLine=function n(d){var h,t,q=v(new A,d),j,l,m;for(h=0;h<this.length;h+=1)if(t=y(this[h])){d=G(this[h],
d,n);J(t,q);U(q);H(h,t,q,d,0);j=1;for(t.beginPath();u;)if(l=q["x"+j],m=q["y"+j],l!==z&&m!==z)t.lineTo(l,m),j+=1;else break;K(this[h],t,d)}return this};d.fn.drawQuad=function B(d){var h,q,j=v(new A,d),l,m,o,p,k;for(h=0;h<this.length;h+=1)if(q=y(this[h])){d=G(this[h],d,B);J(q,j);U(j);H(h,q,j,d,0);l=2;q.beginPath();for(q.moveTo(j.x1,j.y1);u;)if(m=j["x"+l],o=j["y"+l],p=j["cx"+(l-1)],k=j["cy"+(l-1)],m!==z&&o!==z&&p!==z&&k!==z)q.quadraticCurveTo(p,k,m,o),l+=1;else break;K(this[h],q,d)}return this};d.fn.drawBezier=
function r(d){var h,j,l=v(new A,d),m,o,p,k,i,s,w,x;for(h=0;h<this.length;h+=1)if(j=y(this[h])){d=G(this[h],d,r);J(j,l);U(l);H(h,j,l,d,0);m=2;o=1;j.beginPath();for(j.moveTo(l.x1,l.y1);u;)if(p=l["x"+m],k=l["y"+m],i=l["cx"+o],s=l["cy"+o],w=l["cx"+(o+1)],x=l["cy"+(o+1)],p!==z&&k!==z&&i!==z&&s!==z&&w!==z&&x!==z)j.bezierCurveTo(i,s,w,x,p,k),m+=1,o+=2;else break;K(this[h],j,d)}return this};d.fn.drawText=function t(q){var j,l,m=v(new A,q),o,p,k,i;for(j=0;j<this.length;j+=1)if(d(this[j]),l=y(this[j])){q=G(this[j],
q,t);J(l,m);l.textBaseline=m.baseline;l.textAlign=m.align;l.font=m.font;if(!j&&m.maxWidth!==h){o=l;p=m.text;i=m.maxWidth;var s=m.text.split(" "),w=[],x="";if(o.measureText(p).width<i||1===s.length)w=[p];else for(;0<s.length;)o.measureText(s[0]).width>i||o.measureText(x+s[0]).width<i?x+=s.shift()+" ":(w.push(x),x=""),0===s.length&&w.push(x);o=w;o=o.join("\n").replace(/( (\n))|( $)/gi,"$2").split("\n")}else j||(o=(""+m.text).split("\n"));fa(this[j],j,l,m,o);H(j,l,m,q,m.width,m.height);j||(k=m.x,"left"===
m.align?k-=m.width/2:"right"===m.align&&(k+=m.width/2));for(p=0;p<o.length;p+=1)l.shadowColor=m.shadowColor,i=m.y+p*m.height/o.length-(o.length-1)*m.height/o.length/2,l.fillText(o[p],k,i),"transparent"!==m.fillStyle&&(l.shadowColor="transparent"),l.strokeText(o[p],k,i);m._event?(l.beginPath(),l.rect(m.x-m.width/2,m.y-m.height/2,m.width,m.height),l.restore(),T(this[j],l,q),l.closePath()):l.restore()}F=m;return this};d.fn.measureText=function(d){var h;h=d!==z&&"object"!==typeof d?this.getLayer(d):v(new A,
d);(d=y(this[0]))&&h.text!==z&&fa(this[0],0,d,h,h.text.split("\n"));return h};d.fn.drawImage=function q(d){function l(l,k,q){return function(){k||((x=s.width/s.height,i.width===h&&i.sWidth===h&&(d.width=i.width=i.sWidth=s.width),i.height===h&&i.sHeight===h&&(d.height=i.height=i.sHeight=s.height),i.width===h&&i.sWidth!==h&&(i.width=i.sWidth),i.height===h&&i.sHeight!==h&&(i.height=i.sHeight),i.sWidth===h&&i.width!==h&&(d.sWidth=i.sWidth=s.width),i.sHeight===h&&i.height!==h&&(d.sHeight=i.sHeight=s.height),
i.sx===h&&(i.sx=i.cropFromCenter?s.width/2:0),i.sy===h&&(i.sy=i.cropFromCenter?s.height/2:0),i.cropFromCenter||(i.sx+=i.sWidth/2,i.sy+=i.sHeight/2),i.sx+i.sWidth/2>s.width&&(i.sx=s.width-i.sWidth/2),0>i.sx-i.sWidth/2&&(i.sx=i.sWidth/2),0>i.sy-i.sHeight/2&&(i.sy=i.sHeight/2),i.sy+i.sHeight/2>s.height&&(i.sy=s.height-i.sHeight/2),i.width!==h&&i.height===h)?d.height=i.height=i.width/x:i.width===h&&i.height!==h?d.width=i.width=i.height*x:i.width===h&&i.height===h&&(d.width=i.width=s.width,d.height=i.height=
s.height));H(k,q,i,d,i.width,i.height);q.drawImage(s,i.sx-i.sWidth/2,i.sy-i.sHeight/2,i.sWidth,i.sHeight,i.x-i.width/2,i.y-i.height/2,i.width,i.height);q.fillStyle=q.strokeStyle="transparent";q.beginPath();q.rect(i.x-i.width/2,i.y-i.height/2,i.width,i.height);K(m[k],q,d);i.load&&i.load.call(l,d)}}var m=this,o,p,k,i=v(new A,d),s,w,x;w=i.source.getContext;i.source.src||w?(s=i.source,i.width=s.width,i.height=s.height):i.source&&(s=new W,s.src=i.source);for(p=0;p<m.length;p+=1)if(o=m[p],k=y(m[p]))d=G(m[p],
d,q),J(k,i),s&&(s.complete||w?l(o,p,k)():(s.onload=l(o,p,k),s.src=s.src));return m};d.fn.createPattern=d.fn.pattern=function(d){function j(){k=m.createPattern(p,o.repeat);o.load&&o.load.call(l[0],k)}var l=this,m,o=v(new A,d),p,k;(m=y(l[0]))?"function"===typeof o.source?(p=S.createElement("canvas"),p.width=o.width,p.height=o.height,d=y(p),o.source.call(p,d),j()):(d=o.source.getContext,o.source.src||d?p=o.source:(p=new W,p.src=o.source),p.complete||d?j():p.onload=j):k=h;return k};d.fn.createGradient=
d.fn.gradient=function(d){var j,d=v(new A,d),l=[],m,o,p,k,i,s,w;if(j=y(this[0])){d.x1=d.x1||0;d.y1=d.y1||0;d.x2=d.x2||0;d.y2=d.y2||0;j=d.r1!==h||d.r2!==h?j.createRadialGradient(d.x1,d.y1,d.r1,d.x2,d.y2,d.r2):j.createLinearGradient(d.x1,d.y1,d.x2,d.y2);for(k=1;d["c"+k]!==z;k+=1)d["s"+k]!==z?l.push(d["s"+k]):l.push(h);m=l.length;l[0]===h&&(l[0]=0);l[m-1]===h&&(l[m-1]=1);for(k=0;k<m;k+=1){if(l[k]!==h){s=1;w=0;o=l[k];for(i=k+1;i<m;i+=1)if(l[i]!==h){p=l[i];break}else s+=1;o>p&&(l[i]=l[k])}else l[k]===
h&&(w+=1,l[k]=o+w*((p-o)/s));j.addColorStop(l[k],d["c"+(k+1)])}}else j=h;return j};d.fn.setPixels=function j(d){var h,o,p,k=v(new A,d),i={},s,w,x,u;for(o=0;o<this.length;o+=1)if(h=this[o],p=y(h)){d=G(this[o],d,j);H(o,p,k,d,k.width,k.height);if(!k.x||!k.y||!k.width||!k.height)k.width=h.width,k.height=h.height,k.x=k.width/2,k.y=k.height/2;s=p.getImageData(k.x-k.width/2,k.y-k.height/2,k.width,k.height);w=s.data;u=w.length;i=[];if(k.each)for(x=0;x<u;x+=4)i.r=w[x],i.g=w[x+1],i.b=w[x+2],i.a=w[x+3],k.each.call(h,
i),w[x]=i.r,w[x+1]=i.g,w[x+2]=i.b,w[x+3]=i.a;p.putImageData(s,k.x-k.width/2,k.y-k.height/2);p.restore()}return this};d.fn.getCanvasImage=function(d,l){var m=this[0];return m&&m.toDataURL?m.toDataURL("image/"+d,l):h};d.support.canvas=S.createElement("canvas").getContext!==z;C.defaults=N;C.detectEvents=T;C.closePath=K;d.jCanvas=C})(jQuery,document,Image,Math,parseFloat,!0,!1,null);
