/*!
jCanvas v4.1b
Copyright 2011, Caleb Evans
Licensed under the MIT license
*/
(function(g,n,l,s,i){var m,f,j,k=g.fn,h=g.extend,t=l.PI,u=l.round,a=l.sin,b=l.cos;function q(w){if(!w){f=h({},m)}else{f=h({},f,w)}return this}m={width:0,height:0,cornerRadius:0,fillStyle:"transparent",strokeStyle:"transparent",strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",rounded:false,shadowX:0,shadowY:0,shadowBlur:3,shadowColor:"transparent",opacity:1,compositing:"source-over",mask:false,x:0,y:0,x1:0,y1:0,radius:0,start:0,end:360,ccw:false,inDegrees:true,fromCenter:true,closed:false,sides:3,angle:0,text:"",font:"normal 12pt sans-serif",align:"center",baseline:"middle",source:"",repeat:"repeat"};f=h({},m);function p(w,x){w.fillStyle=x.fillStyle;w.strokeStyle=x.strokeStyle;w.lineWidth=x.strokeWidth;if(x.rounded){w.lineCap="round";w.lineJoin="round"}else{w.lineCap=x.strokeCap;w.lineJoin=x.strokeJoin}w.shadowOffsetX=x.shadowX;w.shadowOffsetY=x.shadowY;w.shadowBlur=x.shadowBlur;w.shadowColor=x.shadowColor;w.globalAlpha=x.opacity;w.globalCompositeOperation=x.compositing}function d(w,x){if(x.mask){w.save();w.clip()}if(x.closed){w.closePath();w.fill();w.stroke()}else{w.fill();w.stroke();w.closePath()}}function c(w){return w.inDegrees?t/180:1}function o(x,z,y,w){z.toRad=c(z);x.save();if(!z.fromCenter){z.x+=y/2;z.y+=w/2}if(z.angle){x.translate(z.x,z.y);x.rotate(z.angle*z.toRad);x.translate(-z.x,-z.y)}}function r(w){m=h(m,w.props||{});f=h({},m);g.fn[w.name]=function(y){var A=this,x,z,B=h({},f,y);for(z=0;z<A.length;z+=1){if(!this[z].getContext){continue}x=A[z].getContext("2d");p(x,B);B.toRad=c(B);w.fn.call(A[z],x,B)}return this};return g.fn[w.name]}k.jCanvas=q;k.loadCanvas=function(w){if(!this[e].getContext){return null}return this[0].getContext(w||"2d")};k.draw=function(y){var x=this,w;for(w=0;w<x.length;w+=1){if(!x[w].getContext){continue}y.call(x[w],x[w].getContext("2d"))}return this};k.gradient=function(x){if(!this[0].getContext){return null}var w=this[0].getContext("2d"),C=h({},f,x),B,A,z=0,y=1;if(C.r1!==i||C.r2!==i){B=w.createRadialGradient(C.x1,C.y1,C.r1,C.x2,C.y2,C.r2)}else{B=w.createLinearGradient(C.x1,C.y1,C.x2,C.y2)}while(C["c"+y]!==i){z+=1;y+=1}for(y=1;y<=z;y+=1){A=u(100/(z-1)*(y-1))/100;if(C["s"+y]===i){C["s"+y]=A}B.addColorStop(C["s"+y],C["c"+y])}return B};k.pattern=function(y){if(!this[0].getContext){return null}var w=this[0].getContext("2d"),C=h({},f,y),x=new s(),A;x.src=C.source;function z(){if(x.complete){A=w.createPattern(x,C.repeat);return true}else{return false}}function B(){z();if(C.load){C.load.call(this[0],A)}}if(C.load){x.onload=B}else{if(!z()){x.onload=B}}return A};k.clearCanvas=function(x){var w,y,z=h({},f,x);for(y=0;y<this.length;y+=1){if(!this[y].getContext){continue}w=this[y].getContext("2d");o(w,z,z.width,z.height);if(!x){w.clearRect(0,0,this[y].width,this[y].height)}else{w.clearRect(z.x-z.width/2,z.y-z.height/2,z.width,z.height)}}return this};k.saveCanvas=function(){var w;for(w=0;w<this.length;w+=1){if(!this[w].getContext){continue}this[w].getContext("2d").save()}return this};k.restoreCanvas=function(){var w;for(w=0;w<this.length;w+=1){if(!this[w].getContext){continue}this[w].getContext("2d").restore()}return this};k.scaleCanvas=function(x){var w,y,z=h({},f,x);for(y=0;y<this.length;y+=1){if(!this[y].getContext){continue}w=this[y].getContext("2d");w.save();w.translate(z.x,z.y);w.scale(z.width,z.height);w.translate(-z.x,-z.y)}return this};k.translateCanvas=function(x){var w,y,z=h({},f,x);for(y=0;y<this.length;y+=1){if(!this[y].getContext){continue}w=this[y].getContext("2d");w.save();w.translate(z.x,z.y)}return this};k.rotateCanvas=function(x){var w,y,z=h({},f,x);for(y=0;y<this.length;y+=1){if(!this[y].getContext){continue}w=this[y].getContext("2d");o(w,z,0,0)}return this};k.drawRect=function(B){var E,A,z=h({},f,B),y,D,x,C,w;for(A=0;A<this.length;A+=1){if(!this[A].getContext){continue}E=this[A].getContext("2d");p(E,z);o(E,z,z.width,z.height);E.beginPath();if(z.cornerRadius){y=z.x-z.width/2;D=z.y-z.height/2;x=z.x+z.width/2;C=z.y+z.height/2;w=z.cornerRadius;if((x-y)-(2*w)<0){w=(x-y)/2}if((C-D)-(2*w)<0){w=(C-D)/2}E.moveTo(y+w,D);E.lineTo(x-w,D);E.arc(x-w,D+w,w,3*t/2,t*2);E.lineTo(x,C-w);E.arc(x-w,C-w,w,0,t/2);E.lineTo(y+w,C);E.arc(y+w,C-w,w,t/2,t);E.lineTo(y,D+w);E.arc(y+w,D+w,w,t,3*t/2)}else{E.rect(z.x-z.width/2,z.y-z.height/2,z.width,z.height)}E.restore();d(E,z)}return this};k.drawArc=function(x){var w,y,z=h({},f,x);if(!z.inDegrees&&z.end===360){z.end=t*2}for(y=0;y<this.length;y+=1){if(!this[y].getContext){continue}w=this[y].getContext("2d");p(w,z);o(w,z,z.radius*2,z.radius*2);w.beginPath();w.arc(z.x,z.y,z.radius,(z.start*z.toRad)-(t/2),(z.end*z.toRad)-(t/2),z.ccw);w.restore();d(w,z)}return this};k.drawEllipse=function(x){var w,z,A=h({},f,x),y=A.width*4/3;for(z=0;z<this.length;z+=1){if(!this[z].getContext){continue}w=this[z].getContext("2d");p(w,A);o(w,A,A.width,A.height);w.beginPath();w.moveTo(A.x,A.y-A.height/2);w.bezierCurveTo(A.x-y/2,A.y-A.height/2,A.x-y/2,A.y+A.height/2,A.x,A.y+A.height/2);w.bezierCurveTo(A.x+y/2,A.y+A.height/2,A.x+y/2,A.y-A.height/2,A.x,A.y-A.height/2);w.restore();d(w,A)}return this};k.drawLine=function(y){var x,B,C=h({},f,y),w=2,A=0,z=0;for(B=0;B<this.length;B+=1){if(!this[B].getContext){continue}x=this[B].getContext("2d");p(x,C);x.beginPath();x.moveTo(C.x1,C.y1);while(A!==i&&z!==i){A=C["x"+w];z=C["y"+w];x.lineTo(A,z);w+=1}d(x,C)}return this};k.drawQuad=function(B){var E,A,z=h({},f,B),y=2,x=0,w=0,D=0,C=0;for(A=0;A<this.length;A+=1){if(!this[A].getContext){continue}E=this[A].getContext("2d");p(E,z);E.beginPath();E.moveTo(z.x1,z.y1);while(x!==i&&w!==i&&D!==i&&C!==i){x=z["x"+y];w=z["y"+y];D=z["cx"+(y-1)];C=z["cy"+(y-1)];E.quadraticCurveTo(D,C,x,w);y+=1}d(E,z)}return this};k.drawBezier=function(G){var H,F,C=h({},f,G),B=2,y=1,A=0,z=0,E=0,x=0,D=0,w=0;for(F=0;F<this.length;F+=1){if(!this[F].getContext){continue}H=this[F].getContext("2d");p(H,C);H.beginPath();H.moveTo(C.x1,C.y1);while(A!==i&&z!==i&&E!==i&&x!==i&&D!==i&&w!==i){A=C["x"+B];z=C["y"+B];E=C["cx"+y];x=C["cy"+y];D=C["cx"+(y+1)];w=C["cy"+(y+1)];H.bezierCurveTo(E,x,D,w,A,z);B+=1;y+=2}d(H,C)}return this};k.drawText=function(x){var w,y,z=h({},f,x);for(y=0;y<this.length;y+=1){if(!this[y].getContext){continue}w=this[y].getContext("2d");p(w,z);w.textBaseline=z.baseline;w.textAlign=z.align;w.font=z.font;w.strokeText(z.text,z.x,z.y);w.fillText(z.text,z.x,z.y)}return this};k.drawImage=function(C){var E,x,B,z=h({},f,C),A=new s(),w;A.src=z.source;function D(F){if(A.complete){w=A.width/A.height;if(z.sx===i){z.sx=A.width/2}if(z.sy===i){z.sy=A.height/2}z.sWidth=z.sWidth||A.width;z.sHeight=z.sHeight||A.height;if(z.width&&!z.height){z.height=z.width/w}else{if(!z.width&&z.height){z.width=z.height*w}else{if(!z.width&&!z.height){z.width=A.width;z.height=A.height}}}o(F,z,z.width,z.height);F.drawImage(A,z.sx-z.sWidth/2,z.sy-z.sHeight/2,z.sWidth,z.sHeight,z.x-z.width/2,z.y-z.height/2,z.width,z.height);F.restore();return true}else{return false}}function y(){D(E);if(z.load){z.load.call(x)}}for(B=0;B<this.length;B+=1){x=this[B];if(!x.getContext){continue}E=x.getContext("2d");p(E,z);if(z.load){A.onload=y}else{if(!D(E)){A.onload=y}}}return this};k.drawPolygon=function(C){var H,B,z=h({},f,C),I=t/z.sides,y=(t/2)+I,G=(t*2)/z.sides,F=b(G/2)*z.radius,x,E,w,D,A;z.closed=true;if(z.sides>2){for(B=0;B<this.length;B+=1){if(!this[B].getContext){continue}H=this[B].getContext("2d");p(H,z);o(H,z,z.radius,z.radius);H.beginPath();for(A=0;A<z.sides;A+=1){x=z.x+(z.radius*b(y));E=z.y+(z.radius*a(y));w=z.x+((F+F*z.projection)*b(y+I));D=z.y+((F+F*z.projection)*a(y+I));if(A===0){H.moveTo(x,E)}else{H.lineTo(x,E)}if(z.projection){H.lineTo(w,D)}y+=G}H.restore();d(H,z)}}return this};k.setPixels=function(D){var F,x,C,A,y=h({},f,D),w,z,B,E;for(C=0;C<this.length;C+=1){x=this[C];if(!x.getContext){continue}F=x.getContext("2d");if(!y.x&&!y.y&&!y.width&&!y.height){y.width=x.width;y.height=x.height;y.x=y.width/2;y.y=y.height/2}o(F,y,y.width,y.height);w=F.getImageData(y.x-y.width/2,y.y-y.height/2,y.width,y.height);z=w.data;B=z.length;E=[];if(y.each!==i){for(A=0;A<B;A+=4){E=y.each.call(x,z[A],z[A+1],z[A+2],z[A+3]);z[A]=E[0];z[A+1]=E[1];z[A+2]=E[2];z[A+3]=E[3]}}F.putImageData(w,y.x-y.width/2,y.y-y.height/2);F.restore()}return this};j=[];function v(w){j.push(w);return w}k.drawLayers=function(w){var A=this,x,B,z,y;for(z=0;z<A.length;z+=1){if(!A[z].getContext){continue}x=A[z].getContext("2d");if(w){x.clearRect(0,0,A[z].width,A[z].height)}for(y=0;y<j.length;y+=1){B=j[y];if(B.fn){k[B.fn].call(A.eq(z),B)}}}return this};q.defaults=m;q.prefs=f;q.extend=r;q.layers=j;q.addLayer=v;g.jCanvas=q}(jQuery,document,Math,Image));