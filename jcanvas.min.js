/*!
jCanvas v4.1b
Copyright 2011, Caleb Evans
Licensed under the MIT license
*/
(function(f,m,j,l,r,h){var k,e,i=f.fn,g=f.extend,s=j.PI,t=j.round,a=j.sin,b=j.cos;function p(u){if(!u){e=g({},k)}else{e=g({},e,u)}return this}k={width:0,height:0,cornerRadius:0,fillStyle:"transparent",strokeStyle:"transparent",strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",rounded:false,shadowX:0,shadowY:0,shadowBlur:3,shadowColor:"transparent",opacity:1,compositing:"source-over",x:0,y:0,x1:0,y1:0,start:0,end:360,ccw:false,inDegrees:true,fromCenter:true,closed:false,sides:3,angle:0,text:"",font:"normal 12pt sans-serif",align:"center",baseline:"middle",source:"",repeat:"repeat"};e=g({},k);function o(u,v){u.fillStyle=v.fillStyle;u.strokeStyle=v.strokeStyle;u.lineWidth=v.strokeWidth;if(v.rounded){u.lineCap="round";u.lineJoin="round"}else{u.lineCap=v.strokeCap;u.lineJoin=v.strokeJoin}u.shadowOffsetX=v.shadowX;u.shadowOffsetY=v.shadowY;u.shadowBlur=v.shadowBlur;u.shadowColor=v.shadowColor;u.globalAlpha=v.opacity;u.globalCompositeOperation=v.compositing}function d(u,v){if(v.mask){u.save();u.clip()}if(v.closed){u.closePath();u.fill();u.stroke()}else{u.fill();u.stroke();u.closePath()}}function c(u){return u.inDegrees?s/180:1}function n(v,x,w,u){x.toRad=c(x);v.save();if(!x.fromCenter){x.x+=w/2;x.y+=u/2}if(x.angle){v.translate(x.x,x.y);v.rotate(x.angle*x.toRad);v.translate(-x.x,-x.y)}}function q(u){u=u||{};k=g(k,u.props||{});e=g({},k);if(u.name){f.fn[u.name]=function(w){var z=this,v,x,y=g({},e,w);for(x=0;x<z.length;x+=1){if(!z[x].getContext){continue}v=z[x].getContext("2d");o(v,y);y.toRad=c(y);u.fn.call(z[x],v,y)}return z}}return this}f.fn.jCanvas=p;f.fn.loadCanvas=function(u){if(!this[0].getContext){return null}return this[0].getContext(u||"2d")};f.fn.getCanvasData=function(u){if(!this[0].toDataURL){return null}if(u===h){u="image/png"}else{u=u.replace(/^([a-z]+)$/gi,"image/$1").replace(/jpg/gi,"jpeg")}return this[0].toDataURL(u)};f.fn.draw=function(w){var v=this,u;for(u=0;u<v.length;u+=1){if(!v[u].getContext){continue}w.call(v[u],v[u].getContext("2d"))}return this};f.fn.gradient=function(v){if(!this[0].getContext){return null}var u=this[0].getContext("2d"),A=g({},e,v),z,y,x=0,w=1;if(A.r1!==h||A.r2!==h){z=u.createRadialGradient(A.x1,A.y1,A.r1,A.x2,A.y2,A.r2)}else{z=u.createLinearGradient(A.x1,A.y1,A.x2,A.y2)}while(A["c"+w]!==h){x+=1;w+=1}for(w=1;w<=x;w+=1){y=t(100/(x-1)*(w-1))/100;if(A["s"+w]===h){A["s"+w]=y}z.addColorStop(A["s"+w],A["c"+w])}return z};f.fn.pattern=function(w){if(!this[0].getContext){return null}var u=this[0].getContext("2d"),A=g({},e,w),v=new r(),y;v.src=A.source;function x(){if(v.complete){y=u.createPattern(v,A.repeat);return true}else{return false}}function z(){x();if(A.load){A.load.call(this[0],y)}}if(A.load){v.onload=z}else{if(!x()){v.onload=z}}return y};f.fn.clearCanvas=function(v){var u,w,x=g({},e,v);for(w=0;w<this.length;w+=1){if(!this[w].getContext){continue}u=this[w].getContext("2d");n(u,x,x.width,x.height);if(!x.width&&!x.height){u.clearRect(0,0,this[w].width,this[w].height)}else{u.clearRect(x.x-x.width/2,x.y-x.height/2,x.width,x.height)}}return this};f.fn.saveCanvas=function(){var u;for(u=0;u<this.length;u+=1){if(!this[u].getContext){continue}this[u].getContext("2d").save()}return this};f.fn.restoreCanvas=function(){var u;for(u=0;u<this.length;u+=1){if(!this[u].getContext){continue}this[u].getContext("2d").restore()}return this};f.fn.scaleCanvas=function(v){var u,w,x=g({},e,v);for(w=0;w<this.length;w+=1){if(!this[w].getContext){continue}u=this[w].getContext("2d");u.save();u.translate(x.x,x.y);u.scale(x.width,x.height);u.translate(-x.x,-x.y)}return this};f.fn.translateCanvas=function(v){var u,w,x=g({},e,v);for(w=0;w<this.length;w+=1){if(!this[w].getContext){continue}u=this[w].getContext("2d");u.save();u.translate(x.x,x.y)}return this};f.fn.rotateCanvas=function(v){var u,w,x=g({},e,v);for(w=0;w<this.length;w+=1){if(!this[w].getContext){continue}u=this[w].getContext("2d");n(u,x,0,0)}return this};f.fn.drawRect=function(z){var C,y,x=g({},e,z),w,B,v,A,u;for(y=0;y<this.length;y+=1){if(!this[y].getContext){continue}C=this[y].getContext("2d");o(C,x);n(C,x,x.width,x.height);C.beginPath();if(x.cornerRadius){w=x.x-x.width/2;B=x.y-x.height/2;v=x.x+x.width/2;A=x.y+x.height/2;u=x.cornerRadius;if((v-w)-(2*u)<0){u=(v-w)/2}if((A-B)-(2*u)<0){u=(A-B)/2}C.moveTo(w+u,B);C.lineTo(v-u,B);C.arc(v-u,B+u,u,3*s/2,s*2);C.lineTo(v,A-u);C.arc(v-u,A-u,u,0,s/2);C.lineTo(w+u,A);C.arc(w+u,A-u,u,s/2,s);C.lineTo(w,B+u);C.arc(w+u,B+u,u,s,3*s/2)}else{C.rect(x.x-x.width/2,x.y-x.height/2,x.width,x.height)}C.restore();d(C,x)}return this};f.fn.drawArc=function(v){var u,w,x=g({},e,v);if(!x.inDegrees&&x.end===360){x.end=s*2}for(w=0;w<this.length;w+=1){if(!this[w].getContext){continue}u=this[w].getContext("2d");o(u,x);n(u,x,x.radius*2,x.radius*2);u.beginPath();u.arc(x.x,x.y,x.radius,(x.start*x.toRad)-(s/2),(x.end*x.toRad)-(s/2),x.ccw);u.restore();d(u,x)}return this};f.fn.drawEllipse=function(v){var u,x,y=g({},e,v),w=y.width*4/3;for(x=0;x<this.length;x+=1){if(!this[x].getContext){continue}u=this[x].getContext("2d");o(u,y);n(u,y,y.width,y.height);u.beginPath();u.moveTo(y.x,y.y-y.height/2);u.bezierCurveTo(y.x-w/2,y.y-y.height/2,y.x-w/2,y.y+y.height/2,y.x,y.y+y.height/2);u.bezierCurveTo(y.x+w/2,y.y+y.height/2,y.x+w/2,y.y-y.height/2,y.x,y.y-y.height/2);u.restore();d(u,y)}return this};f.fn.drawLine=function(w){var v,z,A=g({},e,w),u=2,y=0,x=0;for(z=0;z<this.length;z+=1){if(!this[z].getContext){continue}v=this[z].getContext("2d");o(v,A);v.beginPath();v.moveTo(A.x1,A.y1);while(y!==h&&x!==h){y=A["x"+u];x=A["y"+u];v.lineTo(y,x);u+=1}d(v,A)}return this};f.fn.drawQuad=function(z){var C,y,x=g({},e,z),w=2,v=0,u=0,B=0,A=0;for(y=0;y<this.length;y+=1){if(!this[y].getContext){continue}C=this[y].getContext("2d");o(C,x);C.beginPath();C.moveTo(x.x1,x.y1);while(v!==h&&u!==h&&B!==h&&A!==h){v=x["x"+w];u=x["y"+w];B=x["cx"+(w-1)];A=x["cy"+(w-1)];C.quadraticCurveTo(B,A,v,u);w+=1}d(C,x)}return this};f.fn.drawBezier=function(E){var F,D,A=g({},e,E),z=2,w=1,y=0,x=0,C=0,v=0,B=0,u=0;for(D=0;D<this.length;D+=1){if(!this[D].getContext){continue}F=this[D].getContext("2d");o(F,A);F.beginPath();F.moveTo(A.x1,A.y1);while(y!==h&&x!==h&&C!==h&&v!==h&&B!==h&&u!==h){y=A["x"+z];x=A["y"+z];C=A["cx"+w];v=A["cy"+w];B=A["cx"+(w+1)];u=A["cy"+(w+1)];F.bezierCurveTo(C,v,B,u,y,x);z+=1;w+=2}d(F,A)}return this};f.fn.drawText=function(v){var u,w,x=g({},e,v);for(w=0;w<this.length;w+=1){if(!this[w].getContext){continue}u=this[w].getContext("2d");o(u,x);u.textBaseline=x.baseline;u.textAlign=x.align;u.font=x.font;u.strokeText(x.text,x.x,x.y);u.fillText(x.text,x.x,x.y)}return this};f.fn.drawImage=function(A){var C,v,z,x=g({},e,A),y=new r(),u;y.src=x.source;function B(D){if(y.complete){u=y.width/y.height;if(x.sx===h){x.sx=y.width/2}if(x.sy===h){x.sy=y.height/2}x.sWidth=x.sWidth||y.width;x.sHeight=x.sHeight||y.height;if(x.width&&!x.height){x.height=x.width/u}else{if(!x.width&&x.height){x.width=x.height*u}else{if(!x.width&&!x.height){x.width=y.width;x.height=y.height}}}n(D,x,x.width,x.height);D.drawImage(y,x.sx-x.sWidth/2,x.sy-x.sHeight/2,x.sWidth,x.sHeight,x.x-x.width/2,x.y-x.height/2,x.width,x.height);D.restore();return true}else{return false}}function w(){B(C);if(x.load){x.load.call(v)}}for(z=0;z<this.length;z+=1){v=this[z];if(!v.getContext){continue}C=v.getContext("2d");o(C,x);if(x.load){y.onload=w}else{if(!B(C)){y.onload=w}}}return this};f.fn.drawPolygon=function(A){var F,z,x=g({},e,A),G=s/x.sides,w=(s/2)+G,E=(s*2)/x.sides,D=b(E/2)*x.radius,v,C,u,B,y;x.closed=true;if(x.sides>2){for(z=0;z<this.length;z+=1){if(!this[z].getContext){continue}F=this[z].getContext("2d");o(F,x);n(F,x,x.radius,x.radius);F.beginPath();for(y=0;y<x.sides;y+=1){v=x.x+t(x.radius*b(w));C=x.y+t(x.radius*a(w));if(y===0){F.moveTo(v,C)}else{F.lineTo(v,C)}if(x.projection){u=x.x+t((D+D*x.projection)*b(w+G));B=x.y+t((D+D*x.projection)*a(w+G));F.lineTo(u,B)}w+=E}F.restore();d(F,x)}}return this};f.fn.setPixels=function(B){var D,v,A,y,w=g({},e,B),u,x,z,C;for(A=0;A<this.length;A+=1){v=this[A];if(!v.getContext){continue}D=v.getContext("2d");if(!w.x&&!w.y&&!w.width&&!w.height){w.width=v.width;w.height=v.height;w.x=w.width/2;w.y=w.height/2}n(D,w,w.width,w.height);u=D.getImageData(w.x-w.width/2,w.y-w.height/2,w.width,w.height);x=u.data;z=x.length;C=[];if(w.each!==h){for(y=0;y<z;y+=4){C=w.each.call(v,x[y],x[y+1],x[y+2],x[y+3]);x[y]=C[0];x[y+1]=C[1];x[y+2]=C[2];x[y+3]=C[3]}}D.putImageData(u,w.x-w.width/2,w.y-w.height/2);D.restore()}return this};f.fn.getLayers=function(){var u=this[0],v;if(!u||!u.getContext){return[]}v=f.data(u,"layers");if(v===h){v=[];f.data(u,"layers",v)}return v};f.fn.addLayer=function(v){var y=this,u,x,w;for(w=0;w<y.length;w+=1){u=f(y[w]);if(!y[w].getContext){continue}x=u.getLayers();if(typeof v==="function"){v.fn="draw"}x.push(v)}return y};f.fn.drawLayers=function(){var A=this,v,u,z,y,x,w;for(x=0;x<A.length;x+=1){v=f(A[x]);if(!v[0].getContext){continue}u=v[0].getContext("2d");y=v.getLayers();for(w=0;w<y.length;w+=1){z=y[w];if(z.fn==="draw"){z.call(v[0],u)}else{z.width=z._width;z.height=z._height;z.opacity=z._opacity;if(i[z.fn]){i[z.fn].call(v,z)}}}}return A};f.fn.animateLayer=function(){var z=this,v=l.prototype.slice.call(arguments,0),u,y,w,x;if(typeof v[0]==="object"){v.splice(0,0,0)}if(v[2]===h){v.splice(2,0,null);v.splice(3,0,null);v.splice(4,0,function(){})}else{if(typeof v[2]==="function"){v.splice(2,0,null);v.splice(3,0,null)}}if(v[3]===h){v[3]=null;v.splice(4,0,function(){})}else{if(typeof v[3]==="function"){v.splice(3,0,null)}}if(v[4]===h){v[4]=function(){}}for(x=0;x<z.length;x+=1){u=f(z[x]);y=u.getLayers();w=y[v[0]];if(w===h||typeof w==="function"){continue}w=g({},e,w);y[v[0]]=w;w._width=w.width;w._height=w.height;w._opacity=w.opacity;v[1]._width=v[1].width;v[1]._height=v[1].height;v[1]._opacity=v[1].opacity;f(w).animate(v[1],{duration:v[2],easing:v[3],queue:false,complete:(function(A){return function(){v[4].call(A[0])}}(u)),step:(function(A){return function(){A.clearCanvas().drawLayers()}}(u))})}return z};p.defaults=k;p.prefs=e;p.extend=q;f.jCanvas=p}(jQuery,document,Math,Array,Image));