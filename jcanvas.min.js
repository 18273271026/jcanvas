/*!
jCanvas v5.2b
Copyright 2012, Caleb Evans
Licensed under the MIT license
*/
(function(w,d,s,F,D,r,m,t,H,v,o){var x,J,u=w.fn,B=w.extend,q=s.PI,E=s.round,n=s.sin,c=s.cos,j=w.event.fix,y,z;function G(K){if(!K){J=A.prototype=B({},x)}else{B(J,K)}return this}G.version="5.2b";x={align:"center",angle:0,baseline:"middle",ccw:H,closed:H,compositing:"source-over",cornerRadius:0,cropFromCenter:t,end:360,fillStyle:"transparent",font:"12pt sans-serif",fromCenter:t,height:0,inDegrees:t,load:v,mask:H,opacity:1,projection:0,r1:v,r2:v,radius:0,repeat:"repeat",rounded:H,scaleX:1,scaleY:1,shadowBlur:3,shadowColor:"transparent",shadowX:0,shadowY:0,sHeight:0,sides:3,source:"",start:0,strokeCap:"butt",strokeJoin:"miter",strokeStyle:"transparent",strokeWidth:1,sWidth:0,sx:v,sy:v,text:"",width:0,x:0,x1:0,x2:0,y:0,y1:0,y2:0};function A(){}J=A.prototype;G();function h(K){return K.getContext?K.getContext("2d"):v}function b(K,L){K.fillStyle=L.fillStyle;K.strokeStyle=L.strokeStyle;K.lineWidth=L.strokeWidth;if(L.rounded){K.lineCap="round";K.lineJoin="round"}else{K.lineCap=L.strokeCap;K.lineJoin=L.strokeJoin}K.shadowOffsetX=L.shadowX;K.shadowOffsetY=L.shadowY;K.shadowBlur=L.shadowBlur;K.shadowColor=L.shadowColor;K.globalAlpha=L.opacity;K.globalCompositeOperation=L.compositing}function p(K,L){if(L.mask){K.save();K.clip()}if(L.closed){K.closePath();K.fill();K.stroke()}else{K.fill();K.stroke();K.closePath()}}function a(K){return K.inDegrees?q/180:1}function f(L,N,M,K){N.toRad=a(N);L.save();if(!N.fromCenter){N.x+=M/2;N.y+=K/2}if(N.angle){L.translate(N.x,N.y);L.rotate(N.angle*N.toRad);L.translate(-N.x,-N.y)}}function l(K){K=K||{};x=B(x,K.props||{});w.jCanvas();if(K.name){w.fn[K.name]=function(M){var Q=this,N,L,O,P=B(new A(),M);for(O=0;O<Q.length;O+=1){N=Q[O];if(!N.getContext){continue}L=N.getContext("2d");b(L,P);P.toRad=a(P);K.fn.call(N,L,P)}return Q}}return w.fn[K.name]}w.fn.jCanvas=G;w.fn.loadCanvas=function(K){return h(this[0])};w.fn.getCanvasImage=function(K){var L=this;if(!L[0].toDataURL){return v}if(K===o){K="image/png"}else{K=K.replace(/^([a-z]+)$/gi,"image/$1").replace(/jpg/gi,"jpeg")}return L[0].toDataURL(K)};w.fn.draw=function(N){var M=this,K,L;for(L=0;L<M.length;L+=1){if(!(K=h(M[L]))){continue}N.call(M[L],K)}return M};w.fn.gradient=function(L){var R=this,K,Q=B(new A(),L),P,O,N=0,M=1;if(!(K=h(R[0]))){return v}if(Q.r1!=v||Q.r2!=v){P=K.createRadialGradient(Q.x1,Q.y1,Q.r1,Q.x2,Q.y2,Q.r2)}else{P=K.createLinearGradient(Q.x1,Q.y1,Q.x2,Q.y2)}while(Q["c"+M]!==o){N+=1;M+=1}for(M=1;M<=N;M+=1){O=E(100/(N-1)*(M-1))/100;if(Q["s"+M]===o){Q["s"+M]=O}P.addColorStop(Q["s"+M],Q["c"+M])}return P};w.fn.pattern=function(Q){var K=this,S,M,N,P;if(!K[0].getContext){return v}S=K[0].getContext("2d");M=B(new A(),Q);N=new D();if(M.source.src){N=M.source}else{N.src=M.source}function O(){if(N.complete){P=S.createPattern(N,M.repeat);return t}else{return H}}function R(){if(M.load){M.load.call(K[0],P)}}function L(){O();R()}if(!N.complete&&M.load){N.onload=L}else{if(!O()){N.onload=L}else{R()}}return P};w.fn.clearCanvas=function(L){var O=this,K,M,N=B(new A(),L);for(M=0;M<O.length;M+=1){if(!(K=h(O[M]))){continue}f(K,N,N.width,N.height);if(!N.width&&!N.height){K.clearRect(0,0,O[M].width,O[M].height)}else{K.clearRect(N.x-N.width/2,N.y-N.height/2,N.width,N.height)}}return O};w.fn.saveCanvas=function(){var M=this,K,L;for(L=0;L<M.length;L+=1){if(!(K=h(M[L]))){continue}K.save()}return M};w.fn.restoreCanvas=function(){var M=this,K,L;for(L=0;L<M.length;L+=1){if(!(K=h(M[L]))){continue}K.restore()}return M};w.fn.scaleCanvas=function(L){var O=this,K,M,N=B(new A(),L);for(M=0;M<O.length;M+=1){if(!(K=h(O[M]))){continue}K.save();K.translate(N.x,N.y);K.scale(N.scaleX,N.scaleY);K.translate(-N.x,-N.y)}return O};w.fn.translateCanvas=function(L){var O=this,K,M,N=B(new A(),L);for(M=0;M<O.length;M+=1){if(!(K=h(O[M]))){continue}K.save();K.translate(N.x,N.y)}return O};w.fn.rotateCanvas=function(L){var O=this,K,M,N=B(new A(),L);for(M=0;M<O.length;M+=1){if(!(K=h(O[M]))){continue}f(K,N,0,0)}return O};w.fn.drawRect=function(Q){var L=this,T,P,O=B(new A(),Q),N,S,M,R,K;for(P=0;P<L.length;P+=1){if(!(T=h(L[P]))){continue}b(T,O);f(T,O,O.width,O.height);T.beginPath();if(O.cornerRadius){O.closed=t;N=O.x-O.width/2;S=O.y-O.height/2;M=O.x+O.width/2;R=O.y+O.height/2;K=O.cornerRadius;if((M-N)-(2*K)<0){K=(M-N)/2}if((R-S)-(2*K)<0){K=(R-S)/2}T.moveTo(N+K,S);T.lineTo(M-K,S);T.arc(M-K,S+K,K,3*q/2,q*2,H);T.lineTo(M,R-K);T.arc(M-K,R-K,K,0,q/2,H);T.lineTo(N+K,R);T.arc(N+K,R-K,K,q/2,q,H);T.lineTo(N,S+K);T.arc(N+K,S+K,K,q,3*q/2,H)}else{T.rect(O.x-O.width/2,O.y-O.height/2,O.width,O.height)}T.restore();p(T,O)}return L};w.fn.drawArc=function(L){var O=this,K,M,N=B(new A(),L);if(!N.inDegrees&&N.end===360){N.end=q*2}for(M=0;M<O.length;M+=1){if(!(K=h(O[M]))){continue}b(K,N);f(K,N,N.radius*2,N.radius*2);K.beginPath();K.arc(N.x,N.y,N.radius,(N.start*N.toRad)-(q/2),(N.end*N.toRad)-(q/2),N.ccw);K.restore();p(K,N)}return O};w.fn.drawEllipse=function(L){var P=this,K,N,O=B(new A(),L),M=O.width*4/3;for(N=0;N<P.length;N+=1){if(!(K=h(P[N]))){continue}b(K,O);f(K,O,O.width,O.height);K.beginPath();K.moveTo(O.x,O.y-O.height/2);K.bezierCurveTo(O.x-M/2,O.y-O.height/2,O.x-M/2,O.y+O.height/2,O.x,O.y+O.height/2);K.bezierCurveTo(O.x+M/2,O.y+O.height/2,O.x+M/2,O.y-O.height/2,O.x,O.y-O.height/2);K.restore();p(K,O)}return P};w.fn.drawLine=function(M){var R=this,L,P,Q=B(new A(),M),K=2,O=0,N=0;for(P=0;P<R.length;P+=1){if(!(L=h(R[P]))){continue}b(L,Q);L.beginPath();L.moveTo(Q.x1,Q.y1);while(t){O=Q["x"+K];N=Q["y"+K];if(O!==o&&N!==o){L.lineTo(O,N);K+=1}else{break}}p(L,Q)}return R};w.fn.drawQuad=function(Q){var K=this,T,P,O=B(new A(),Q),N=2,M=0,L=0,S=0,R=0;for(P=0;P<K.length;P+=1){if(!(T=h(K[P]))){continue}b(T,O);T.beginPath();T.moveTo(O.x1,O.y1);while(t){M=O["x"+N];L=O["y"+N];S=O["cx"+(N-1)];R=O["cy"+(N-1)];if(M!==o&&L!==o&&S!==o&&R!==o){T.quadraticCurveTo(S,R,M,L);N+=1}else{break}}p(T,O)}return K};w.fn.drawBezier=function(V){var K=this,W,U,R=B(new A(),V),Q=2,N=1,P=0,O=0,T=0,M=0,S=0,L=0;for(U=0;U<K.length;U+=1){if(!(W=h(K[U]))){continue}b(W,R);W.beginPath();W.moveTo(R.x1,R.y1);while(t){P=R["x"+Q];O=R["y"+Q];T=R["cx"+N];M=R["cy"+N];S=R["cx"+(N+1)];L=R["cy"+(N+1)];if(P!==o&&O!==o&&T!==o&&M!==o&&S!==o&&L!==o){W.bezierCurveTo(T,M,S,L,P,O);Q+=1;N+=2}else{break}}p(W,R)}return K};w.fn.drawText=function(L){var O=this,K,M,N=B(new A(),L);for(M=0;M<O.length;M+=1){if(!(K=h(O[M]))){continue}b(K,N);K.textBaseline=N.baseline;K.textAlign=N.align;K.font=N.font;K.strokeText(N.text,N.x,N.y);K.fillText(N.text,N.x,N.y)}return O};w.fn.drawImage=function(R){var K=this,U,M,Q,O=B(new A(),R),P=new D(),L;if(O.source.src){P=O.source}else{if(O.source){P.src=O.source}}function S(V){if(P.complete){L=(P.width/P.height);O.sWidth=O.sWidth||P.width;O.sHeight=O.sHeight||P.height;if(O.sWidth>P.width){O.sWidth=P.width}if(O.sHeight>P.height){O.sHeight=P.height}if(O.width===0&&O.sWidth!==P.width){O.width=O.sWidth}if(O.height===0&&O.sHeight!==P.height){O.height=O.sHeight}if(O.sx==v){if(O.cropFromCenter){O.sx=P.width/2}else{O.sx=0}}if(O.sy==v){if(O.cropFromCenter){O.sy=P.height/2}else{O.sy=0}}if(!O.cropFromCenter){O.sx+=O.sWidth/2;O.sy+=O.sHeight/2}if((O.sx-O.sWidth/2)<0){O.sx=O.sWidth/2}if((O.sx+O.sWidth/2)>P.width){O.sx=P.width-O.sWidth/2}if((O.sy-O.sHeight/2)<0){O.sy=O.sHeight/2}if((O.sy+O.sHeight/2)>P.height){O.sy=P.height-O.sHeight/2}if(O.width&&!O.height){O.height=O.width/L}else{if(!O.width&&O.height){O.width=O.height*L}else{if(!O.width&&!O.height){O.width=P.width;O.height=P.height}}}f(V,O,O.width,O.height);V.drawImage(P,O.sx-O.sWidth/2,O.sy-O.sHeight/2,O.sWidth,O.sHeight,O.x-O.width/2,O.y-O.height/2,O.width,O.height);V.restore();return t}else{return H}}function T(){if(O.load){O.load.call(M)}}function N(){S(U);T()}for(Q=0;Q<K.length;Q+=1){M=K[Q];if(!M.getContext){continue}U=M.getContext("2d");b(U,O);if(!P.complete&&O.load){P.onload=N}else{if(!S(U)){P.onload=N}else{T()}}}return K};w.fn.drawPolygon=function(R){var K=this,W,Q,O=B(new A(),R),X=q/O.sides,N=(q/2)+X,V=(q*2)/O.sides,U=c(V/2)*O.radius,M,T,L,S,P;O.closed=t;if(O.sides>2){for(Q=0;Q<K.length;Q+=1){if(!(W=h(K[Q]))){continue}b(W,O);f(W,O,O.radius,O.radius);W.beginPath();for(P=0;P<O.sides;P+=1){M=O.x+E(O.radius*c(N));T=O.y+E(O.radius*n(N));if(P===0){W.moveTo(M,T)}else{W.lineTo(M,T)}if(O.projection){L=O.x+E((U+U*O.projection)*c(N+X));S=O.y+E((U+U*O.projection)*n(N+X));W.lineTo(L,S)}N+=V}W.restore();p(W,O)}}return K};w.fn.setPixels=function(S){var K=this,U,M,R,P,N=B(new A(),S),L,O,Q,T={};for(R=0;R<K.length;R+=1){M=K[R];if(!(U=h(K[R]))){continue}if(!N.x&&!N.y&&!N.width&&!N.height){N.width=M.width;N.height=M.height;N.x=N.width/2;N.y=N.height/2}f(U,N,N.width,N.height);L=U.getImageData(N.x-N.width/2,N.y-N.height/2,N.width,N.height);O=L.data;Q=O.length;T=[];if(N.each!==o){for(P=0;P<Q;P+=4){T.index=P/4;T.r=O[P];T.g=O[P+1];T.b=O[P+2];T.a=O[P+3];N.each.call(M,T);O[P]=T.r;O[P+1]=T.g;O[P+2]=T.b;O[P+3]=T.a}}U.putImageData(L,N.x-N.width/2,N.y-N.height/2);U.restore()}return K};function e(L,M){var K;for(K=0;K<L.length;K+=1){M[L[K]]=M["_"+L[K]]}}function g(L,M){var K;for(K=0;K<L.length;K+=1){M["_"+L[K]]=M[L[K]]}}y=["width","height","opacity"];z=["backgroundColor","color","borderColor","borderTopColor","borderRightColor","borderBottomColor","borderLeftColor","fillStyle","strokeStyle","shadowColor"];function i(L){var N,O,M=[],K=1;if(typeof L==="object"){M=L}else{if(L.match(/^[a-z]+$/gi)){if(L==="transparent"){L="rgba(255,255,255,0)"}O=d.documentElement;N=O.style.color;O.style.color=L;L=w.css(O,"color");O.style.color=N}if(L.match(/^\#/gi)){if(L.length===4){L=L.replace(/([0-9a-f])/gi,"$1$1")}M=L.match(/[0-9a-f]{2}/gi);M[0]=m(M[0],16);M[1]=m(M[1],16);M[2]=m(M[2],16)}else{if(L.match(/^rgb/gi)){M=L.match(/[0-9\.]+/gi);if(L.match(/\%/gi)){K=2.55}M[0]=M[0]*K;M[1]=M[1]*K;M[2]=M[2]*K}}if(L.indexOf("rgba")!==-1){M[3]=r(M[3])}else{M[3]=1}}return M}function I(L,K){L.now[K]=L.start[K]+(L.end[K]-L.start[K])*L.pos;if(K<3){L.now[K]=E(L.now[K])}}function C(K){if(typeof K.start!=="object"){K.start=i(K.start);K.end=i(K.end)}K.now=[];I(K,0);I(K,1);I(K,2);I(K,3);K.now="rgba("+K.now.join(",")+")";if(K.elem.style){K.elem.style[K.prop]=K.now}else{K.elem[K.prop]=K.now}}function k(K){var L;for(L=0;L<K.length;L+=1){if(!w.fx.step[K[L]]){w.fx.step[K[L]]=C}}}w.fn.getLayers=function(){var K=this[0],L;if(!K||!K.getContext){return[]}L=w.data(K,"layers");if(L===o){L=[];w.data(K,"layers",L)}return L};w.fn.getLayer=function(K){K=K||0;return this.getLayers()[K]};w.fn.addLayer=function(M){var Q=this,L,O,K,N,P=B(M,new A(),w.extend({},M));P.method=P.fn||P.method;P.layer=t;for(N=0;N<Q.length;N+=1){L=w(Q[N]);if(!Q[N].getContext){continue}O=L.getLayers();if(typeof P==="function"){P.method="draw"}O.push(P)}return Q};w.fn.removeLayer=function(K){K=K||0;this.getLayers().splice(K,1);return this};w.fn.drawLayers=function(){var Q=this,L,K,P,O,N,M;for(N=0;N<Q.length;N+=1){L=w(Q[N]);if(!L[0].getContext){continue}K=L[0].getContext("2d");O=L.getLayers();K.clearRect(0,0,L[0].width,L[0].height);for(M=0;M<O.length;M+=1){P=O[M];if(P.method==="draw"){P.call(L[0],K)}else{if(u[P.method]){u[P.method].call(L,P)}}}}return Q};w.fn.animateLayer=function(){var P=this,L=F.prototype.slice.call(arguments,0),K,O,M,N;if(typeof L[0]==="object"&&!L[0].method){L.unshift(0)}if(L[2]===o){L.splice(2,0,v);L.splice(3,0,v);L.splice(4,0,function(){})}else{if(typeof L[2]==="function"){L.splice(2,0,v);L.splice(3,0,v)}}if(L[3]===o){L[3]=v;L.splice(4,0,function(){})}else{if(typeof L[3]==="function"){L.splice(3,0,v)}}if(L[4]===o){L[4]=function(){}}for(N=0;N<P.length;N+=1){K=w(P[N]);if(L[0].layer){M=L[0]}else{M=K.getLayers()[L[0]]}if(!M||M.method==="draw"){continue}if(M.method==="drawImage"){L[1].width=L[1].width||1e-10;L[1].height=L[1].height||1e-10;M.width=M.width||1e-10;M.height=M.height||1e-10}M=B(M,J,w.extend({},M));g(y,M);g(y,L[1]);w(M).animate(L[1],{duration:L[2],easing:(w.easing[L[3]]?L[3]:v),complete:(function(Q){return function(){e(y,M);Q.drawLayers(t);L[4].call(Q[0])}}(K)),step:(function(Q,R){return function(){e(y,R);Q.drawLayers(t)}}(K,M))})}return P};w.event.fix=function(K){K=j.call(w.event,K);if(K.pageX!=v&&K.offsetX==v){var L=w(K.target).offset();K.offsetX=K.pageX-L.left;K.offsetY=K.pageY-L.top}return K};w.support.canvas=(d.createElement("canvas").getContext!=v);k(z);G.defaults=x;G.prefs=J;G.extend=l;w.jCanvas=G}(jQuery,document,Math,Array,Image,parseFloat,parseInt,true,false,null));