/*!
jCanvas v5.1b
Copyright 2011, Caleb Evans
Licensed under the MIT license
*/
(function(k,v,o,t,B,c,s,m){var p,j,n=k.fn,l=k.extend,C=o.PI,D=o.round,a=o.sin,e=o.cos,h=fix=k.event.fix,b,d;function z(F){if(!F){j=l({},p)}else{j=l({},j,F)}return this}p={width:0,height:0,cornerRadius:0,fillStyle:"transparent",strokeStyle:"transparent",strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",rounded:false,shadowX:0,shadowY:0,shadowBlur:3,shadowColor:"transparent",opacity:1,compositing:"source-over",x:0,y:0,x1:0,y1:0,scaleX:1,scaleY:1,start:0,end:360,ccw:false,inDegrees:true,fromCenter:true,sourceFromCenter:true,closed:false,sides:3,angle:0,text:"",font:"normal 12pt sans-serif",align:"center",baseline:"middle",source:"",repeat:"repeat"};j=l({},p);function x(F,G){F.fillStyle=G.fillStyle;F.strokeStyle=G.strokeStyle;F.lineWidth=G.strokeWidth;if(G.rounded){F.lineCap="round";F.lineJoin="round"}else{F.lineCap=G.strokeCap;F.lineJoin=G.strokeJoin}F.shadowOffsetX=G.shadowX;F.shadowOffsetY=G.shadowY;F.shadowBlur=G.shadowBlur;F.shadowColor=G.shadowColor;F.globalAlpha=G.opacity;F.globalCompositeOperation=G.compositing}function g(F,G){if(G.mask){F.save();F.clip()}if(G.closed){F.closePath();F.fill();F.stroke()}else{F.fill();F.stroke();F.closePath()}}function f(F){return F.inDegrees?C/180:1}function y(G,I,H,F){I.toRad=f(I);G.save();if(!I.fromCenter){I.x+=H/2;I.y+=F/2}if(I.angle){G.translate(I.x,I.y);G.rotate(I.angle*I.toRad);G.translate(-I.x,-I.y)}}function A(F){F=F||{};p=l(p,F.props||{});j=l({},p);if(F.name){k.fn[F.name]=function(H){var L=this,I,G,J,K=l({},j,H);for(J=0;J<L.length;J+=1){I=L[J];if(!I.getContext){continue}G=I.getContext("2d");x(G,K);K.toRad=f(K);F.fn.call(I,G,K)}return L}}return k.fn[F.name]}k.fn.jCanvas=z;k.fn.loadCanvas=function(F){if(!this[0].getContext){return null}return this[0].getContext(F||"2d")};k.fn.getCanvasImage=function(F){if(!this[0].toDataURL){return null}if(F===m){F="image/png"}else{F=F.replace(/^([a-z]+)$/gi,"image/$1").replace(/jpg/gi,"jpeg")}return this[0].toDataURL(F)};k.fn.draw=function(H){var G=this,F;for(F=0;F<G.length;F+=1){if(!G[F].getContext){continue}H.call(G[F],G[F].getContext("2d"))}return this};k.fn.gradient=function(G){if(!this[0].getContext){return null}var F=this[0].getContext("2d"),L=l({},j,G),K,J,I=0,H=1;if(L.r1!==m||L.r2!==m){K=F.createRadialGradient(L.x1,L.y1,L.r1,L.x2,L.y2,L.r2)}else{K=F.createLinearGradient(L.x1,L.y1,L.x2,L.y2)}while(L["c"+H]!==m){I+=1;H+=1}for(H=1;H<=I;H+=1){J=D(100/(I-1)*(H-1))/100;if(L["s"+H]===m){L["s"+H]=J}K.addColorStop(L["s"+H],L["c"+H])}return K};k.fn.pattern=function(H){if(!this[0].getContext){return null}var F=this[0].getContext("2d"),L=l({},j,H),G=new B(),J;G.src=L.source;function I(){if(G.complete){J=F.createPattern(G,L.repeat);return true}else{return false}}function K(){I();if(L.load){L.load.call(this[0],J)}}if(L.load){G.onload=K}else{if(!I()){G.onload=K}}return J};k.fn.clearCanvas=function(G){var F,H,I=l({},j,G);for(H=0;H<this.length;H+=1){if(!this[H].getContext){continue}F=this[H].getContext("2d");y(F,I,I.width,I.height);if(!I.width&&!I.height){F.clearRect(0,0,this[H].width,this[H].height)}else{F.clearRect(I.x-I.width/2,I.y-I.height/2,I.width,I.height)}}return this};k.fn.saveCanvas=function(){var F;for(F=0;F<this.length;F+=1){if(!this[F].getContext){continue}this[F].getContext("2d").save()}return this};k.fn.restoreCanvas=function(){var F;for(F=0;F<this.length;F+=1){if(!this[F].getContext){continue}this[F].getContext("2d").restore()}return this};k.fn.scaleCanvas=function(G){var F,H,I=l({},j,G);I.width=I.width||1;I.height=I.height||1;for(H=0;H<this.length;H+=1){if(!this[H].getContext){continue}F=this[H].getContext("2d");F.save();F.translate(I.x,I.y);F.scale(I.scaleX,I.scaleY);F.translate(-I.x,-I.y)}return this};k.fn.translateCanvas=function(G){var F,H,I=l({},j,G);for(H=0;H<this.length;H+=1){if(!this[H].getContext){continue}F=this[H].getContext("2d");F.save();F.translate(I.x,I.y)}return this};k.fn.rotateCanvas=function(G){var F,H,I=l({},j,G);for(H=0;H<this.length;H+=1){if(!this[H].getContext){continue}F=this[H].getContext("2d");y(F,I,0,0)}return this};k.fn.drawRect=function(K){var N,J,I=l({},j,K),H,M,G,L,F;for(J=0;J<this.length;J+=1){if(!this[J].getContext){continue}N=this[J].getContext("2d");x(N,I);y(N,I,I.width,I.height);N.beginPath();if(I.cornerRadius){I.closed=true;H=I.x-I.width/2;M=I.y-I.height/2;G=I.x+I.width/2;L=I.y+I.height/2;F=I.cornerRadius;if((G-H)-(2*F)<0){F=(G-H)/2}if((L-M)-(2*F)<0){F=(L-M)/2}N.moveTo(H+F,M);N.lineTo(G-F,M);N.arc(G-F,M+F,F,3*C/2,C*2,false);N.lineTo(G,L-F);N.arc(G-F,L-F,F,0,C/2,false);N.lineTo(H+F,L);N.arc(H+F,L-F,F,C/2,C,false);N.lineTo(H,M+F);N.arc(H+F,M+F,F,C,3*C/2,false)}else{N.rect(I.x-I.width/2,I.y-I.height/2,I.width,I.height)}N.restore();g(N,I)}return this};k.fn.drawArc=function(G){var F,H,I=l({},j,G);if(!I.inDegrees&&I.end===360){I.end=C*2}for(H=0;H<this.length;H+=1){if(!this[H].getContext){continue}F=this[H].getContext("2d");x(F,I);y(F,I,I.radius*2,I.radius*2);F.beginPath();F.arc(I.x,I.y,I.radius,(I.start*I.toRad)-(C/2),(I.end*I.toRad)-(C/2),I.ccw);F.restore();g(F,I)}return this};k.fn.drawEllipse=function(G){var F,I,J=l({},j,G),H=J.width*4/3;for(I=0;I<this.length;I+=1){if(!this[I].getContext){continue}F=this[I].getContext("2d");x(F,J);y(F,J,J.width,J.height);F.beginPath();F.moveTo(J.x,J.y-J.height/2);F.bezierCurveTo(J.x-H/2,J.y-J.height/2,J.x-H/2,J.y+J.height/2,J.x,J.y+J.height/2);F.bezierCurveTo(J.x+H/2,J.y+J.height/2,J.x+H/2,J.y-J.height/2,J.x,J.y-J.height/2);F.restore();g(F,J)}return this};k.fn.drawLine=function(H){var G,K,L=l({},j,H),F=2,J=0,I=0;for(K=0;K<this.length;K+=1){if(!this[K].getContext){continue}G=this[K].getContext("2d");x(G,L);G.beginPath();G.moveTo(L.x1,L.y1);while(J!==m&&I!==m){J=L["x"+F];I=L["y"+F];G.lineTo(J,I);F+=1}g(G,L)}return this};k.fn.drawQuad=function(K){var N,J,I=l({},j,K),H=2,G=0,F=0,M=0,L=0;for(J=0;J<this.length;J+=1){if(!this[J].getContext){continue}N=this[J].getContext("2d");x(N,I);N.beginPath();N.moveTo(I.x1,I.y1);while(G!==m&&F!==m&&M!==m&&L!==m){G=I["x"+H];F=I["y"+H];M=I["cx"+(H-1)];L=I["cy"+(H-1)];N.quadraticCurveTo(M,L,G,F);H+=1}g(N,I)}return this};k.fn.drawBezier=function(P){var Q,O,L=l({},j,P),K=2,H=1,J=0,I=0,N=0,G=0,M=0,F=0;for(O=0;O<this.length;O+=1){if(!this[O].getContext){continue}Q=this[O].getContext("2d");x(Q,L);Q.beginPath();Q.moveTo(L.x1,L.y1);while(J!==m&&I!==m&&N!==m&&G!==m&&M!==m&&F!==m){J=L["x"+K];I=L["y"+K];N=L["cx"+H];G=L["cy"+H];M=L["cx"+(H+1)];F=L["cy"+(H+1)];Q.bezierCurveTo(N,G,M,F,J,I);K+=1;H+=2}g(Q,L)}return this};k.fn.drawText=function(G){var F,H,I=l({},j,G);for(H=0;H<this.length;H+=1){if(!this[H].getContext){continue}F=this[H].getContext("2d");x(F,I);F.textBaseline=I.baseline;F.textAlign=I.align;F.font=I.font;F.strokeText(I.text,I.x,I.y);F.fillText(I.text,I.x,I.y)}return this};k.fn.drawImage=function(L){var N,G,K,I=l({},j,L),J=new B(),F;J.src=I.source;function M(O){if(J.complete){F=(J.width/J.height);I.sWidth=I.sWidth||J.width;I.sHeight=I.sHeight||J.height;if(I.sWidth>J.width){I.sWidth=J.width}else{if(I.sWidth>J.width){I.sWidth=J.width}}I.width=I.width||I.sWidth;I.height=I.height||I.sHeight;if(I.sx===m){I.sx=J.width/2}if(I.sy===m){I.sy=J.height/2}if((I.sx-I.sWidth/2)<0){I.sx=I.sWidth/2}if((I.sx+I.sWidth/2)>J.width){I.sx=J.width-I.sWidth/2}if((I.sy-I.sHeight/2)<0){I.sy=I.sHeight/2}if((I.sy+I.sHeight/2)>J.height){I.sy=J.height-I.sHeight/2}if(I.width&&!I.height){I.height=I.width/F}else{if(!I.width&&I.height){I.width=I.height*F}else{if(!I.width&&!I.height){I.width=J.width;I.height=J.height}}}y(O,I,I.width,I.height);O.drawImage(J,I.sx-I.sWidth/2,I.sy-I.sHeight/2,I.sWidth,I.sHeight,I.x-I.width/2,I.y-I.height/2,I.width,I.height);O.restore();return true}else{return false}}function H(){M(N);if(I.load){I.load.call(G)}}for(K=0;K<this.length;K+=1){G=this[K];if(!G.getContext){continue}N=G.getContext("2d");x(N,I);if(I.load){J.onload=H}else{if(!M(N)){J.onload=H}}}return this};k.fn.drawPolygon=function(L){var Q,K,I=l({},j,L),R=C/I.sides,H=(C/2)+R,P=(C*2)/I.sides,O=e(P/2)*I.radius,G,N,F,M,J;I.closed=true;if(I.sides>2){for(K=0;K<this.length;K+=1){if(!this[K].getContext){continue}Q=this[K].getContext("2d");x(Q,I);y(Q,I,I.radius,I.radius);Q.beginPath();for(J=0;J<I.sides;J+=1){G=I.x+D(I.radius*e(H));N=I.y+D(I.radius*a(H));if(J===0){Q.moveTo(G,N)}else{Q.lineTo(G,N)}if(I.projection){F=I.x+D((O+O*I.projection)*e(H+R));M=I.y+D((O+O*I.projection)*a(H+R));Q.lineTo(F,M)}H+=P}Q.restore();g(Q,I)}}return this};k.fn.setPixels=function(M){var O,G,L,J,H=l({},j,M),F,I,K,N;for(L=0;L<this.length;L+=1){G=this[L];if(!G.getContext){continue}O=G.getContext("2d");if(!H.x&&!H.y&&!H.width&&!H.height){H.width=G.width;H.height=G.height;H.x=H.width/2;H.y=H.height/2}y(O,H,H.width,H.height);F=O.getImageData(H.x-H.width/2,H.y-H.height/2,H.width,H.height);I=F.data;K=I.length;N=[];if(H.each!==m){for(J=0;J<K;J+=4){N=H.each.call(G,I[J],I[J+1],I[J+2],I[J+3]);I[J]=N[0];I[J+1]=N[1];I[J+2]=N[2];I[J+3]=N[3]}}O.putImageData(F,H.x-H.width/2,H.y-H.height/2);O.restore()}return this};function u(G,H){var F;for(F=0;F<G.length;F+=1){H[G[F]]=H["_"+G[F]]}}function w(G,H){var F;for(F=0;F<G.length;F+=1){H["_"+G[F]]=H[G[F]]}}b=["width","height","opacity"];d=["backgroundColor","color","borderColor","borderTopColor","borderRightColor","borderBottomColor","borderLeftColor","fillStyle","strokeStyle","shadowColor"];function i(G){var I,J,H=[],F=1;if(typeof G==="object"){H=G}else{if(G.match(/^[a-z]+$/gi)){if(G==="transparent"){G="rgba(255, 255, 255, 0)"}J=v.documentElement;I=J.style.color;J.style.color=G;G=k.css(J,"color");J.style.color=I}if(G.match(/^\#/gi)){if(G.length===4){G=G.replace(/([0-9a-f])/gi,"$1$1")}H=G.match(/[0-9a-f]{2}/gi);H[0]=s(H[0],16);H[1]=s(H[1],16);H[2]=s(H[2],16)}else{if(G.match(/^rgb/gi)){H=G.match(/[0-9\.]+/gi);if(G.match(/\%/gi)){F=2.55}H[0]=c(H[0])*F;H[1]=c(H[1])*F;H[2]=c(H[2])*F}}if(G.indexOf("rgba")!==-1){H[3]=c(H[3])}else{H[3]=1}}return H}function E(G,F){G.now[F]=G.start[F]+(G.end[F]-G.start[F])*G.pos;if(F<3){G.now[F]=D(G.now[F])}}function q(F){if(F.pos===0){F.start=i(F.start),F.end=i(F.end)}F.now=[];E(F,0);E(F,1);E(F,2);E(F,3);F.now="rgba("+F.now.join(",")+")";if(F.elem.style){F.elem.style[F.prop]=F.now}else{F.elem[F.prop]=F.now}}function r(F){var G;for(G=0;G<F.length;G+=1){if(!k.fx.step[F[G]]){k.fx.step[F[G]]=q}}}k.fn.getLayers=function(){var F=this[0],G;if(!F||!F.getContext){return[]}G=k.data(F,"layers");if(G===m){G=[];k.data(F,"layers",G)}return G};k.fn.getLayer=function(F){F=F||0;return this.getLayers()[F]};k.fn.addLayer=function(H){var K=this,G,J,F,I;H=l(H,j,k.extend({},H));H.method=H.fn||H.method;for(I=0;I<K.length;I+=1){G=k(K[I]);if(!K[I].getContext){continue}J=G.getLayers();if(typeof H==="function"){H.method="draw"}J.push(H)}return K};k.fn.removeLayer=function(F){F=F||0;this.getLayers().splice(F,1);return this};k.fn.drawLayers=function(){var L=this,G,F,K,J,I,H;for(I=0;I<L.length;I+=1){G=k(L[I]);if(!G[0].getContext){continue}F=G[0].getContext("2d");J=G.getLayers();F.clearRect(0,0,G[0].width,G[0].height);for(H=0;H<J.length;H+=1){K=J[H];if(K.method==="draw"){K.call(G[0],F)}else{if(n[K.method]){n[K.method].call(G,K)}}}}return L};k.fn.animateLayer=function(){var K=this,G=t.prototype.slice.call(arguments,0),F,J,H,I;if(typeof G[0]==="object"){G.unshift(0)}if(G[2]===m){G.splice(2,0,null);G.splice(3,0,null);G.splice(4,0,function(){})}else{if(typeof G[2]==="function"){G.splice(2,0,null);G.splice(3,0,null)}}if(G[3]===m){G[3]=null;G.splice(4,0,function(){})}else{if(typeof G[3]==="function"){G.splice(3,0,null)}}if(G[4]===m){G[4]=function(){}}for(I=0;I<K.length;I+=1){F=k(K[I]);J=F.getLayers();H=J[G[0]];if(!H||H.method==="draw"){continue}H=l(H,j,k.extend({},H));w(b,H);w(b,G[1]);k(H).animate(G[1],{duration:G[2],easing:(k.easing[G[3]]?G[3]:null),complete:(function(L){return function(){u(b,H);L.drawLayers(true);G[4].call(L[0])}}(F)),step:(function(L,M){return function(){u(b,M);L.drawLayers(true)}}(F,H))})}return K};k.event.fix=function(F){F=fix.call(k.event,F);if(F.offsetX==m&&F.offsetY==m){var G=k(F.target).offset();F.offsetX=F.pageX-G.left;F.offsetY=F.pageY-G.top}return F};k.support.canvas=(v.createElement("canvas").getContext!=m);r(d);z.defaults=p;z.prefs=j;z.extend=A;k.jCanvas=z}(jQuery,document,Math,Array,Image,parseFloat,parseInt));