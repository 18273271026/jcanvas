/**
 * jCanvas v13.07.08
 * Copyright 2013 Caleb Evans
 * Released under the MIT license
 */(function(e,t,n,r,i,s,o,u,a){function Tn(e){var t=this;an(t,e);return t}function Nn(e){e?an(Tn.prototype,e):Nn.prefs=Tn.prototype=an({},un);return this}function Cn(e){return ln(e)==="string"}function kn(e){return e&&e[A]?e[A]("2d"):u}function Ln(e){e=an({},e);e.masks=e.masks[ht](0);return e}function An(e,t){e.save();t[O].push(Ln(t[d]))}function On(e,t){if(t[O][f]===0)t[d]=Ln(En);else{e[at]();t[d]=t[O].pop()}}function Mn(e,t,n){cn(n[w])?t[w]=n[w][y](e,n):t[w]=n[w];cn(n[N])?t[N]=n[N][y](e,n):t[N]=n[N];t.lineWidth=n[pt];if(n.rounded)t.lineCap=t.lineJoin="round";else{t.lineCap=n.strokeCap;t.lineJoin=n.strokeJoin;t.miterLimit=n.miterLimit}t.shadowOffsetX=n.shadowX;t.shadowOffsetY=n.shadowY;t[wt]=n[wt];t[v]=n[v];t.globalAlpha=n.opacity;t.globalCompositeOperation=n.compositing;n[Ht]&&(t.webkitImageSmoothingEnabled=t.mozImageSmoothingEnabled=n[Ht])}function _n(e,t,n){if(n.mask){n[mt]&&An(e,t);e.clip();t[d].masks.push(n._args)}}function Dn(e,t){t._transformed&&e[at]()}function Pn(e,t,n){var r;n[yt]&&t[U]();if(n.shadowStroke&&n[pt]!==0){t.stroke();t.fill();t[v]=p;t[wt]=0;t.stroke()}else{t.fill();n[w]!==p&&(t[v]=p);n[pt]!==0&&t.stroke()}n[yt]||t[U]();Dn(t,n);if(n.mask){r=In(e);_n(t,r,n)}}function Hn(e,t,n){t[Q]=t[Ct]?pn/180:1;e[x](t.x,t.y);e[ut](t[ut]*t[Q]);e[x](-t.x,-t.y);n[ut]+=t[ut]*t[Q]}function Bn(e,t,n){t.scale!==1&&(t[st]=t[ot]=t.scale);e[x](t.x,t.y);e.scale(t[st],t[ot]);e[x](-t.x,-t.y);n[st]*=t[st];n[ot]*=t[ot]}function jn(e,t,n){t[x]&&(t[I]=t[j]=t[x]);e[x](t[I],t[j]);n[I]+=t[I];n[j]+=t[j]}function Fn(e,t,n,r){t[Q]=t[Ct]?pn/180:1;t._transformed=s;e.save();r===a&&(r=n);if(!t.fromCenter&&!t._centered){t.x+=n/2;t.y+=r/2;t._centered=s}t[ut]&&Hn(e,t,{});(t.scale!==1||t[st]!==1||t[ot]!==1)&&Bn(e,t,{});(t[x]||t[I]||t[j])&&jn(e,t,{})}function In(t){var n;if(wn._canvas===t&&wn._data)n=wn._data;else{n=e.data(t,it);if(!n){n={canvas:t,layers:[],layer:{names:{},groups:{}},intersecting:[],drag:{},event:{type:u,x:u,y:u},events:{},transforms:Ln(En),savedTransforms:[],animating:o,animated:u,pixelRatio:1,scaled:!1};e.data(t,it,n)}wn._canvas=t;wn._data=n}return n}function qn(e,t,n){var r;for(r in Nn[D])Nn[D][Dt](r)&&Rn(e,t,n,r)}function Rn(e,t,n,r){if(n[r]){r=Zn(r);Nn[D][r](e,t);n[m]=s}}function Un(e,t,n){var r,i,o;if(n[Xt]||n[L]||n[Et]){r=[R,_,et];for(o=0;o<r[f];o+=1){i=Zn(r[o]);Nn[D][i](e,t)}if(!t[D].mouseoutdrag){e.bind("mouseout.jCanvas",function(){var n=t.drag[c];if(n){t.drag={};n.dragcancel&&n.dragcancel[y](e[0],n);e[B]()}});t[D].mouseoutdrag=s}n[m]=s}}function zn(e,t,n,r){var i=t[c].names;r?r[Z]!==a&&Cn(n[Z])&&n[F]!==r[F]&&delete i[n[Z]]:r=n;Cn(r[Z])&&(i[r[Z]]=n)}function Wn(e,t,n,r){var i=t[c][ft],s,o,u;if(!r)r=n;else if(r[F]!==a&&Cn(n[F])&&n[F]!==r[F]){s=i[n[F]];if(s){for(u=0;u<s[f];u+=1)if(s[u]===n){o=u;s[g](u,1);break}s[f]===0&&delete i[n[F]]}}if(Cn(r[F])){s=i[r[F]];if(!s){s=i[r[F]]=[];s[Z]=r[F]}o===a&&(o=s[f]);s[g](o,0,n)}}function Xn(e,t,n,r){if(n&&n[C]&&n[H]){r?n._next=r:n._next=u;n[H][y](e,n)}}function Vn(t,n,r,i){var o,u,l=r,h;n._args=r;n.canvas=t;n[Xt]&&(n[c]=s);i?n[H]=i:n.method?n[H]=e.fn[n.method]:n.type?n[H]=e.fn[bn[n.type]]:n[H]=function(){};if(n[c]&&!n._layer){o=e(t);u=o[S]();h=In(t);l=new Tn(n);zn(o,h,l);Wn(o,h,l);qn(o,h,l);Un(o,h,l);n[m]=l[m];l[c]=s;l._layer=s;l[P]===a&&(l[P]=u[f]);u[g](l[P],0,l)}return l}function $n(e){var t;for(t=0;t<Sn[f];t+=1)e[Sn[t]]=e["_"+Sn[t]]}function Jn(e,t){var n;for(n=0;n<Sn[f];n+=1){e["_"+Sn[n]]=e[Sn[n]];xn[Sn[n]]=1;t&&delete e[Sn[n]]}}function Kn(e,t,n){var r;for(r in n)n[Dt](r)&&cn(n[r])&&(n[r]=n[r][y](e,t,r));return n}function Qn(n){var r,s,o=[],u=1;if(n[Rt](/^#?\w+$/gi)){n===p&&(n="rgba(0,0,0,0)");s=t.head;r=s[dt][Ut];s[dt][Ut]=n;n=e.css(s,Ut);s[dt][Ut]=r}if(n[Rt](/^rgb/gi)){o=n[Rt](/\d+/gi);n[Rt](/%/gi)&&(u=2.55);o[0]*=u;o[1]*=u;o[2]*=u;o[3]!==a?o[3]=i(o[3]):o[3]=1}return o}function Gn(e){var t=3,n;if(ln(e[jt])!=="array"){e[jt]=Qn(e[jt]);e.end=Qn(e.end)}e.now=[];if(e[jt][3]!==1||e.end[3]!==1)t=4;for(n=0;n<t;n+=1){e.now[n]=e[jt][n]+(e.end[n]-e[jt][n])*e.pos;n<3&&(e.now[n]=hn(e.now[n]))}if(e[jt][3]!==1||e.end[3]!==1)e.now="rgba("+e.now.join(",")+")";else{e.now[ht](0,3);e.now="rgb("+e.now.join(",")+")"}e.elem.nodeName?e.elem[dt][e.prop]=e.now:e.elem[e.prop]=e.now}function Yn(t){var n;for(n=0;n<t[f];n+=1)e.fx.step[t[n]]=Gn}function Zn(e){"ontouchstart"in window&&gn[e]&&(e=gn[e]);return e}function er(e){yn[e]&&(e=yn[e]);return e}function tr(e){Nn[D][e]=function(t,n){var r,i;e=Zn(e);i=n[J];r=e===z||e===K?_:e;if(!n[D][r]){t.bind(r+".jCanvas",function(e){i.x=e[Kt];i.y=e.offsetY;i.type=r;i[J]=e;t[B]({resetFire:s});e.preventDefault()});n[D][r]=s}}}function nr(e){var t;for(t=0;t<e[f];t+=1)tr(e[t])}function rr(e,t,n){var r,i,o,a,f,l,c,h;r=n._args;if(r[m]){i=In(e);o=i[J];if(o.x!==u&&o.y!==u){l=o.x*i[Pt];c=o.y*i[Pt];a=t.isPointInPath(l,c)||t[Vt]&&t[Vt](l,c)}f=i[d];r.eventX=r.mouseX=o.x;r.eventY=r.mouseY=o.y;r[J]=o[J];h=i[d][ut];l=r.eventX;c=r.eventY;if(h!==0){r[G]=l*vn(-h)-c*dn(-h);r[nt]=c*vn(-h)+l*dn(-h)}else{r[G]=l;r[nt]=c}r[G]/=f[st];r[nt]/=f[ot];!a&&r[Ot]&&!r[bt]&&(r[qt]=s);a&&i[$].push(r);r[X]=a}}function ir(e,t){if(t.font)e.font=t.font;else{isNaN(Number(t[E]))||(t[E]+="px");e.font=t[Jt]+" "+t[E]+" "+t[Bt]}}function sr(t,n,r,s){var o,u,a=/\b(\d*\.?\d*)\w\w\b/gi,c,p;if(wn.text===r.text&&wn.font===r.font&&wn[Jt]===r[Jt]&&wn[E]===r[E]&&wn[Bt]===r[Bt]&&wn[Lt]===r[Lt]&&wn[tt]===r[tt]){r[h]=wn[h];r[l]=wn[l]}else{r[h]=n[q](s[0])[h];for(c=1;c<s[f];c+=1){p=n[q](s[c])[h];p>r[h]&&(r[h]=p)}o=t[dt][E];if(r.font){u=r.font[Rt](a);u&&(t[dt][E]=r.font[Rt](a)[0])}else t[dt][E]=r[E];r[l]=i(e.css(t,E))*s[f]*r[tt];t[dt][E]=o}}function or(e,t){var n=t.text,r=t[Lt],i=n.split(" "),s,o=[],u="";if(e[q](n)[h]<r||i[f]===1)o=[n];else{for(s=0;s<i[f];s+=1){if(e[q](u+i[s])[h]>r){u!==""&&o.push(u);u=""}u+=i[s];s!==i[f]-1&&(u+=" ")}o.push(u)}o=o.join("\n").replace(/( (\n))|( $)/gi,"$2").split("\n");return o}var f="length",l="height",c="layer",h="width",p="transparent",d="transforms",v="shadowColor",m="_event",g="splice",y="call",b="beginPath",w="fillStyle",E="fontSize",S="getLayers",x="translate",T="getLayerGroup",N="strokeStyle",C="visible",k="getLayer",L="dragGroupWithLayer",A="getContext",O="savedTransforms",M="sHeight",_="mousemove",D="events",P="index",H="_method",B="drawLayers",j="translateY",F="group",I="translateX",q="measureText",R="mousedown",U="closePath",z="mouseover",W="sWidth",X="intersects",V="drawImage",$="intersecting",J="event",K="mouseout",Q="_toRad",G="_eventX",Y="animating",Z="name",et="mouseup",tt="lineHeight",nt="_eventY",rt="touchstart",it="jCanvas",st="scaleX",ot="scaleY",ut="rotate",at="restore",ft="groups",lt="lineTo",ct="touchmove",ht="slice",pt="strokeWidth",dt="style",vt="bezierCurveTo",mt="autosave",gt="touchend",yt="closed",bt="_fired",wt="shadowBlur",Et="cursor",St="dragstart",xt="concavity",Tt="_startX",Nt="_startY",Ct="inDegrees",kt="dragging",Lt="maxWidth",At="dragstop",Ot="_hovered",Mt="radius",_t="animated",Dt="hasOwnProperty",Pt="pixelRatio",Ht="imageSmoothing",Bt="fontFamily",jt="start",Ft="drawArc",It="_animating",qt="_mousedout",Rt="match",Ut="color",zt="<canvas />",Wt="drawQuadratic",Xt="draggable",Vt="isPointInStroke",$t="moveTo",Jt="fontStyle",Kt="offsetX",Qt="_masks",Gt="drawPolygon",Yt="drawEllipse",Zt="load",en="drawVector",tn="drawBezier",nn="createPattern",rn="setLayer",sn="restoreCanvas",on="complete",un,an=e.extend,fn=e.inArray,ln=e.type,cn=e.isFunction,hn=r.round,pn=r.PI,dn=r.sin,vn=r.cos,mn=e[J].fix,gn,yn,bn,wn={},En={rotate:0,scaleX:1,scaleY:1,translateX:0,translateY:0,masks:[]},Sn,xn;e.fn[it]=Nn;Nn[D]={};un={align:"center",autosave:s,baseline:"middle",bringToFront:o,ccw:o,closed:o,compositing:"source-over",concavity:0,cornerRadius:0,count:1,cropFromCenter:s,disableDrag:o,disableEvents:o,domain:u,draggable:o,group:u,data:{},each:u,end:360,fillStyle:p,font:"",fontStyle:"normal",fontSize:"12pt",fontFamily:"sans-serif",fromCenter:s,fn:u,graph:"y",height:u,imageSmoothing:s,inDegrees:s,lineHeight:1,layer:o,load:u,mask:o,maxWidth:u,miterLimit:10,name:u,opacity:1,projection:0,r1:u,r2:u,radius:0,range:u,repeat:"repeat",respectAlign:o,rotate:0,rounded:o,scale:1,scaleX:1,scaleY:1,shadowBlur:0,shadowColor:p,shadowStroke:!1,shadowX:0,shadowY:0,sHeight:u,sides:0,source:"",start:0,strokeCap:"butt",strokeJoin:"miter",strokeStyle:p,strokeWidth:1,sWidth:u,sx:u,sy:u,text:"",translate:0,translateX:0,translateY:0,type:u,visible:s,width:u,x:0,y:0};Nn();Nn.extend=function(n){Nn.defaults=an(un,n.props);Nn();n[Z]&&(e.fn[n[Z]]=function r(e){var t=this,i,s,o,u=new Tn(e);for(s=0;s<t[f];s+=1){i=t[s];o=kn(i);if(o){e=Vn(i,u,e,r);Mn(i,o,u);n.fn[y](i,o,u)}}return t});return e.fn[n[Z]]};e.fn[S]=function(t){var n=this[0],r,i,s=[];if(n&&n[A]){r=In(n).layers;if(cn(t))for(i=0;i<r[f];i+=1)t[y](n,r[i])&&s.push(r[i]);else s=r}return s};e.fn[k]=function(t){var n=this[S](),r=ln(t),i=In(this[0]),s,o;if(t&&t[c])s=t;else if(r==="number"){t<0&&(t=n[f]+t);s=n[t]}else if(r==="regexp"){for(o=0;o<n[f];o+=1)if(Cn(n[o][Z])&&n[o][Z][Rt](t)){s=n[o];break}}else{i=In(this[0]);s=i[c].names[t]}return s};e.fn[T]=function(t){var n=ln(t),r,i,s,o;if(n==="array")return t;if(n==="regexp"){o=In(this[0]);r=o[ft];for(i in r)if(i[Rt](t)){s=r[i];break}}else{o=In(this[0]);s=o[c][ft][t]}return s};e.fn.getLayerIndex=function(t){var n=this[S](),r=this[k](t);return fn(r,n)};e.fn[rn]=function(n,r){var i=this,s,o,u,a;for(o=0;o<i[f];o+=1){s=e(i[o]);u=In(i[o]);a=e(i[o])[k](n);if(a){zn(s,u,a,r);Wn(s,u,a,r);an(a,r);qn(s,u,a);Un(s,u,a)}}return i};e.fn.setLayerGroup=function(n,r){var i=this,s,o,u,a;for(o=0;o<i[f];o+=1){s=e(i[o]);u=s[T](n);if(u)for(a=0;a<u[f];a+=1)s[rn](u[a],r)}return i};e.fn.setLayers=function(n){var r=this,i,s,o,u;for(s=0;s<r[f];s+=1){i=e(r[s]);o=e(r[s])[S]();for(u=0;u<o[f];u+=1)i[rn](o[u],n)}return r};e.fn.moveLayer=function(n,r){var i=this,s,o,u,a;for(o=0;o<i[f];o+=1){s=e(i[o]);u=s[S]();a=s[k](n);if(a){a[P]=fn(a,u);u[g](a[P],1);u[g](r,0,a);r<0&&(r=u[f]+r);a[P]=r}}return i};e.fn.removeLayer=function(n){var r=this,i,s,o,a,l;for(s=0;s<r[f];s+=1){i=e(r[s]);o=In(r[s]);a=i[S]();l=i[k](n);if(l){l[P]=fn(l,a);a[g](l[P],1);zn(i,o,l,{name:u});Wn(i,o,l,{group:u})}}return r};e.fn.removeLayerGroup=function(n){var r=this,i,s,o,l,h,p,d;if(n!==a)for(s=0;s<r[f];s+=1){i=e(r[s]);o=In(r[s]);l=i[S]();h=i[T](n);if(h){for(d=0;d<h[f];d+=1){p=h[d];p[P]=fn(p,l);l[g](p[P],1);zn(i,o,p,{name:u})}delete o[c][ft][h[Z]]}}return r};e.fn.removeLayers=function(){var n=this,r,i,s;for(i=0;i<n[f];i+=1){r=e(n[i]);s=In(n[i]);s.layers[f]=0;s[c].names={};s[c][ft]={}}return n};e.fn.drawLayer=function(n){var r=this,i,s,o,u;for(i=0;i<r[f];i+=1){o=e(r[i]);s=kn(r[i]);u=o[k](n);Xn(o,s,u)}return r};e.fn[B]=function(n){var r=this,i,a,l,h=an({},n),p,v,b,w,E,S,x,T,N,k,A,M;h[P]||(h[P]=0);for(a=0;a<r[f];a+=1){i=e(r[a]);l=kn(r[a]);if(l){x=In(r[a]);h.clear!==o&&i.clearCanvas();p=x.layers;for(b=h[P];b<p[f];b+=1){v=p[b];v[P]=b;h.resetFire&&(v[bt]=o);v[m]=!v.disableEvents;Xn(i,l,v,b+1);v[Qt]=x[d].masks[ht](0);if(v[qt]){v[qt]=o;v[bt]=s;v[Ot]=o;v[K]&&v[K][y](r[a],v);v[Et]&&v._cursor&&i.css({cursor:v._cursor})}if(v[H]===e.fn[V]&&v[C])break}w=b;v={};for(E=x[$][f]-1;E>=0;E-=1){v=x[$][E];if(v[Qt]){for(S=v[Qt][f]-1;S>=0;S-=1)if(!v[Qt][S][X]){v[X]=o;break}if(v[X])break}}T=x[J];N=T.type;v[N]||(N=er(N));M=v[N];k=x.drag;if(v[m]&&v[X]){if(v[z]||v[K]||v[Et])if(!v[Ot]&&!v[bt]){v[bt]=s;v[Ot]=s;v[z]&&v[z][y](r[a],v);if(v[Et]){v._cursor=i.css(Et);i.css({cursor:v[Et]})}}if(M&&!v[bt]){v[bt]=s;T.type=u;M[y](r[a],v)}v[Xt]&&!v.disableDrag&&(N===R||N===rt)&&(k[c]=v)}if(k[c])if(N===_||N===ct){if(!k[kt]){k[kt]=s;if(k[c].bringToFront){p[g](k[c][P],1);k[c][P]=p.push(k[c])}A=x[c][ft][k[c][F]];if(k[c][F]&&k[c][L]&&A)for(b=0;b<A[f];b+=1)if(A[b]!==k[c]){A[b][Tt]=A[b].x;A[b][Nt]=A[b].y;A[b]._endX=k[c][G];A[b]._endY=k[c][nt];if(A[b].bringToFront){A[b][P]=fn(A[b],p);p[g](A[b][P],1);p[g](-1,0,A[b]);A[b][P]=p[f]-2}A[b][St]&&A[b][St][y](r[a],A[b])}k[Tt]=k[c][Tt]=k[c].x;k[Nt]=k[c][Nt]=k[c].y;k._endX=k[c]._endX=k[c][G];k._endY=k[c]._endY=k[c][nt];k[c][St]&&k[c][St][y](i[0],k[c])}k[c].x=k[c][G]-(k._endX-k[Tt]);k[c].y=k[c][nt]-(k._endY-k[Nt]);A=x[c][ft][k[c][F]];if(k[c][F]&&k[c][L]&&A)for(b=0;b<A[f];b+=1)if(A[b]!==k[c]){A[b].x=k[c][G]-(A[b]._endX-A[b][Tt]);A[b].y=k[c][nt]-(A[b]._endY-A[b][Nt]);A[b].drag&&A[b].drag[y](r[a],A[b])}k[c].drag&&k[c].drag[y](r[a],k[c])}else if(N===et||N===gt){if(k[c][At]&&k[kt]){k[c][At][y](r[a],k[c]);k[kt]=o}A=x[c][ft][k[c][F]];if(k[c][F]&&k[c][L]&&A)for(b=0;b<A[f];b+=1)A[b]!==k[c]&&A[b][At]&&A[b][At][y](r[a],A[b]);x.drag={}}if(w===p[f]){x[$][f]=0;x[d]=Ln(En);x[O][f]=0}}}return r};e.fn.addLayer=function(t){var n=this,r,i,o=an({},t);for(r=0;r<n[f];r+=1){i=kn(n[r]);if(i){o[c]=s;t=Vn(n[r],o,t)}}return n};Sn=[h,l,"opacity",tt];xn={};e.fn.animateLayer=function(){function v(e,t,n){return function(){$n(n);(!t[Y]||t[_t]===n)&&e[B]();c[4]&&c[4][y](e[0],n);n[It]=o;t[Y]=o;t[_t]=u}}function m(e,t,n){return function(r,i){$n(n);if(!n[It]&&!t[Y]){n[It]=s;t[Y]=s;t[_t]=n}(!t[Y]||t[_t]===n)&&e[B]();c[5]&&c[5][y](e[0],r,i,n)}}var n=this,r,i,l,c=[][ht][y](arguments,0),h,p,d;if(ln(c[2])==="object"){c[g](2,0,c[2].duration||u);c[g](3,0,c[3].easing||u);c[g](4,0,c[4][on]||u);c[g](5,0,c[5].step||u)}else{if(c[2]===a){c[g](2,0,u);c[g](3,0,u);c[g](4,0,u)}else if(cn(c[2])){c[g](2,0,u);c[g](3,0,u)}if(c[3]===a){c[3]=u;c[g](4,0,u)}else cn(c[3])&&c[g](3,0,u)}for(i=0;i<n[f];i+=1){r=e(n[i]);l=kn(n[i]);if(l){h=In(n[i]);p=r[k](c[0]);if(p&&p[H]!==e.fn.draw){d=an({},c[1]);d=Kn(n[i],p,d);Jn(d,s);Jn(p);p[dt]=xn;e(p).animate(d,{duration:c[2],easing:e.easing[c[3]]?c[3]:u,complete:v(r,h,p),step:m(r,h,p)})}}}return n};e.fn.animateLayerGroup=function(n){var r=this,i,s,o=[][ht][y](arguments,0),u,a;for(s=0;s<r[f];s+=1){i=e(r[s]);u=i[T](n);for(a=0;a<u[f];a+=1)i.animateLayer.apply(i,[u[a]].concat(o[ht](1)))}return r};e.fn.delayLayer=function(n,r){var i=this,s,o;r=r||0;for(s=0;s<i[f];s+=1){o=e(i[s])[k](n);e(o).delay(r)}return i};e.fn.delayLayerGroup=function(n,r){var i=this,s,o,u,a,l;r=r||0;for(o=0;o<i[f];o+=1){s=e(i[o]);u=s[T](n);if(u)for(l=0;l<u[f];l+=1){a=u[l];a&&e(a).delay(r)}}return i};e.fn.stopLayer=function(n,r){var i=this,s,o,u;for(o=0;o<i[f];o+=1){s=e(i[o]);u=s[k](n);u&&e(u).stop(r)}return i};e.fn.stopLayerGroup=function(n,r){var i=this,s,o,u,a,l;for(o=0;o<i[f];o+=1){s=e(i[o]);u=s[T](n);if(u)for(l=0;l<u[f];l+=1){a=u[l];a&&e(a).stop(r)}}return i};Yn([Ut,"backgroundColor","borderColor","borderTopColor","borderRightColor","borderBottomColor","borderLeftColor",w,"outlineColor",N,v]);gn={mousedown:rt,mouseup:gt,mousemove:ct};yn={touchstart:R,touchend:et,touchmove:_};nr(["click","dblclick",R,et,_,z,K,rt,ct,gt]);e[J].fix=function(t){var n,r,i;t=mn[y](e[J],t);r=t.originalEvent;if(r){i=r.changedTouches;if(t.pageX!==a&&t[Kt]===a){n=e(t.target).offset();if(n){t[Kt]=t.pageX-n.left;t.offsetY=t.pageY-n.top}}else if(i){n=e(r.target).offset();if(n){t[Kt]=i[0].pageX-n.left;t.offsetY=i[0].pageY-n.top}}}return t};bn={arc:Ft,bezier:tn,circle:Ft,ellipse:Yt,"function":"draw",image:V,line:"drawLine",polygon:Gt,quadratic:Wt,rectangle:"drawRect",text:"drawText",vector:en};e.fn.draw=function ur(t){var n=this,r,i,s,o;o=new Tn(t);for(i=0;i<n[f];i+=1){r=e(n[i]);s=kn(n[i]);if(s){t=Vn(n[i],o,t,ur);o[C]&&(o.fn?o.fn[y](n[i],s,o):o[H]!==ur&&o[H][y](r,t))}}return n};e.fn.clearCanvas=function(t){var n=this,r,i,s=new Tn(t);for(r=0;r<n[f];r+=1){i=kn(n[r]);if(i)if(s[h]===u||s[l]===u){i.save();i.setTransform(1,0,0,1,0,0);i.clearRect(0,0,n[r][h],n[r][l]);i[at]()}else{Fn(i,s,s[h],s[l]);i.clearRect(s.x-s[h]/2,s.y-s[l]/2,s[h],s[l]);i[at]()}}return n};e.fn.saveCanvas=function ar(e){var t=this,n,r,i=new Tn(e),s,o;for(n=0;n<t[f];n+=1){r=kn(t[n]);if(r){s=In(t[n]);e=Vn(t[n],i,e,ar);for(o=0;o<i.count;o+=1)An(r,s)}}return t};e.fn[sn]=function fr(e){var t=this,n,r,i=new Tn(e),s,o;for(n=0;n<t[f];n+=1){r=kn(t[n]);if(r){s=In(t[n]);e=Vn(t[n],i,e,fr);for(o=0;o<i.count;o+=1)On(r,s)}}return t};e.fn.restoreCanvasOnRedraw=function(t){var n=this,r=an({},t);r[c]=s;n[sn](r);return n};e.fn.rotateCanvas=function lr(e){var t=this,n,r,i=new Tn(e),s;for(n=0;n<t[f];n+=1){r=kn(t[n]);if(r){s=In(t[n]);e=Vn(t[n],i,e,lr);i[mt]&&An(r,s);Hn(r,i,s[d])}}return t};e.fn.scaleCanvas=function cr(e){var t=this,n,r,i=new Tn(e),s;for(n=0;n<t[f];n+=1){r=kn(t[n]);if(r){s=In(t[n]);e=Vn(t[n],i,e,cr);i[mt]&&An(r,s);Bn(r,i,s[d])}}return t};e.fn.translateCanvas=function hr(e){var t=this,n,r,i=new Tn(e),s;for(n=0;n<t[f];n+=1){r=kn(t[n]);if(r){s=In(t[n]);e=Vn(t[n],i,e,hr);i[mt]&&An(r,s);jn(r,i,s[d])}}return t};e.fn.drawRect=function pr(e){var t=this,n,r,i=new Tn(e),u,a,c,p,d;for(n=0;n<t[f];n+=1){r=kn(t[n]);if(r){e=Vn(t[n],i,e,pr);if(i[C]){Mn(t[n],r,i);Fn(r,i,i[h],i[l]);r[b]();u=i.x-i[h]/2;a=i.y-i[l]/2;d=i.cornerRadius;if(d){i[yt]=s;c=i.x+i[h]/2;p=i.y+i[l]/2;c-u-2*d<0&&(d=(c-u)/2);p-a-2*d<0&&(d=(p-a)/2);r[$t](u+d,a);r[lt](c-d,a);r.arc(c-d,a+d,d,3*pn/2,pn*2,o);r[lt](c,p-d);r.arc(c-d,p-d,d,0,pn/2,o);r[lt](u+d,p);r.arc(u+d,p-d,d,pn/2,pn,o);r[lt](u,a+d);r.arc(u+d,a+d,d,pn,3*pn/2,o)}else r.rect(u,a,i[h],i[l]);i[m]&&rr(t[n],r,i);Pn(t[n],r,i)}}}return t};e.fn[Ft]=function dr(e){var t=this,n,r,i=new Tn(e);e=e||{};i[c]&&!i[Ct]&&i.end===360&&(e.end=i.end=pn*2);for(n=0;n<t[f];n+=1){r=kn(t[n]);if(r){e=Vn(t[n],i,e,dr);if(i[C]){Mn(t[n],r,i);Fn(r,i,i[Mt]*2);r[b]();r.arc(i.x,i.y,i[Mt],i[jt]*i[Q]-pn/2,i.end*i[Q]-pn/2,i.ccw);i[m]&&rr(t[n],r,i);Pn(t[n],r,i)}}}return t};e.fn[Yt]=function vr(e){var t=this,n,r,i=new Tn(e),o=i[h]*(4/3),u=i[l];i[yt]=s;for(n=0;n<t[f];n+=1){r=kn(t[n]);if(r){e=Vn(t[n],i,e,vr);if(i[C]){Mn(t[n],r,i);Fn(r,i,i[h],i[l]);r[b]();r[$t](i.x,i.y-u/2);r[vt](i.x-o/2,i.y-u/2,i.x-o/2,i.y+u/2,i.x,i.y+u/2);r[vt](i.x+o/2,i.y+u/2,i.x+o/2,i.y-u/2,i.x,i.y-u/2);i[m]&&rr(t[n],r,i);Pn(t[n],r,i)}}}return t};e.fn[Gt]=function mr(e){var t=this,n,r,i=new Tn(e),o=2*pn/i.sides,u=o/2,a=u+pn/2,l=i[Mt]*vn(u),c,h,p;i.projection&&(i[xt]=-i.projection);for(n=0;n<t[f];n+=1){r=kn(t[n]);if(r){e=Vn(t[n],i,e,mr);if(i[C]){Mn(t[n],r,i);Fn(r,i,i[Mt]*2);r[b]();for(p=0;p<i.sides;p+=1){c=i.x+i[Mt]*vn(a);h=i.y+i[Mt]*dn(a);r[lt](c,h);if(i[xt]){c=i.x+(l+ -l*i[xt])*vn(a+u);h=i.y+(l+ -l*i[xt])*dn(a+u);r[lt](c,h)}a+=o}i[m]&&rr(t[n],r,i);i[yt]=s;Pn(t[n],r,i)}}}return t};e.fn.drawLine=function gr(e){var t=this,n,r,i=new Tn(e),o,u,l;for(n=0;n<t[f];n+=1){r=kn(t[n]);if(r){e=Vn(t[n],i,e,gr);if(i[C]){Mn(t[n],r,i);Fn(r,i,0);o=1;r[b]();while(s){u=i["x"+o];l=i["y"+o];if(u===a||l===a)break;r[lt](u+i.x,l+i.y);o+=1}i[m]&&rr(t[n],r,i);Pn(t[n],r,i)}}}return t};e.fn[Wt]=e.fn.drawQuad=function yr(e){var t=this,n,r,i=new Tn(e),o,u,l,c,h;for(n=0;n<t[f];n+=1){r=kn(t[n]);if(r){e=Vn(t[n],i,e,yr);if(i[C]){Mn(t[n],r,i);Fn(r,i,0);o=2;r[b]();r[$t](i.x1+i.x,i.y1+i.y);while(s){u=i["x"+o];l=i["y"+o];c=i["cx"+(o-1)];h=i["cy"+(o-1)];if(u===a||l===a||c===a||h===a)break;r.quadraticCurveTo(c+i.x,h+i.y,u+i.x,l+i.y);o+=1}i[m]&&rr(t[n],r,i);Pn(t[n],r,i)}}}return t};e.fn[tn]=function br(e){var t=this,n,r,i=new Tn(e),o,u,l,c,h,p,d,v;for(n=0;n<t[f];n+=1){r=kn(t[n]);if(r){e=Vn(t[n],i,e,br);if(i[C]){Mn(t[n],r,i);Fn(r,i,0);o=2;u=1;r[b]();r[$t](i.x1+i.x,i.y1+i.y);while(s){l=i["x"+o];c=i["y"+o];h=i["cx"+u];p=i["cy"+u];d=i["cx"+(u+1)];v=i["cy"+(u+1)];if(l===a||c===a||h===a||p===a||d===a||v===a)break;r[vt](h+i.x,p+i.y,d+i.x,v+i.y,l+i.x,c+i.y);o+=1;u+=2}i[m]&&rr(t[n],r,i);Pn(t[n],r,i)}}}return t};e.fn[en]=function wr(e){var t=this,n,i,o=new Tn(e),u,l,c,h,p;for(n=0;n<t[f];n+=1){i=kn(t[n]);if(i){e=Vn(t[n],o,e,wr);if(o[C]){Mn(t[n],i,o);Fn(i,o,0);u=1;i[b]();h=o.x;p=o.y;i[$t](o.x,o.y);while(s){l=o["a"+u];c=o["l"+u];if(l===a||c===a)break;l=l*o[Q]-pn/2;h+=c*r.cos(l);p+=c*r.sin(l);i[lt](h,p);u+=1}o[m]&&rr(t[n],i,o);Pn(t[n],i,o)}}}return t};e.fn.drawText=function Er(t){var n=this,r,i,s,o=new Tn(t),a,d,g,y;for(i=0;i<n[f];i+=1){r=e(n[i]);s=kn(n[i]);if(s){t=Vn(n[i],o,t,Er);if(o[C]){Mn(n[i],s,o);s.textBaseline=o.baseline;s.textAlign=o.align;ir(s,o);!i&&o[Lt]!==u?a=or(s,o):i||(a=String(o.text).split("\n"));if(!i){sr(n[i],s,o,a);if(t&&o[c]){t[h]=o[h];t[l]=o[l]}g=o.x;o.align==="left"?o.respectAlign?o.x+=o[h]/2:g-=o[h]/2:o.align==="right"&&(o.respectAlign?o.x-=o[h]/2:g+=o[h]/2)}Fn(s,o,o[h],o[l]);for(d=0;d<a[f];d+=1){s[v]=o[v];y=o.y+d*o[l]/a[f]-(a[f]-1)*o[l]/a[f]/2;s.fillText(a[d],g,y);o[w]!==p&&(s[v]=p);s.strokeText(a[d],g,y)}if(o[m]){s[b]();s.rect(o.x-o[h]/2,o.y-o[l]/2,o[h],o[l]);rr(n[i],s,o);s[U]()}Dn(s,o)}}}wn=o;return n};e.fn[q]=function Sr(e){var t=this,n,r,i;e===a||ln(e)==="object"&&!e[c]?r=new Tn(e):r=t[k](e);n=kn(t[0]);if(n){ir(n,r);i=or(n,r);Sr(t[0],n,r,i)}return r};e.fn[V]=function xr(t){function x(e,n,i){if(e===0){g[h]===u&&g[W]===u&&(g[h]=g[W]=w[h]);g[l]===u&&g[M]===u&&(g[l]=g[M]=w[l]);if(t&&g[c]){t[h]=g[h];t[l]=g[l]}}if(g[W]!==u&&g[M]!==u&&g.sx!==u&&g.sy!==u){if(e===0){g[h]===u&&(g[h]=g[W]);g[l]===u&&(g[l]=g[M]);if(!g.cropFromCenter){g.sx+=g[W]/2;g.sy+=g[M]/2}g.sx+g[W]/2>w[h]&&(g.sx=w[h]-g[W]/2);g.sx-g[W]/2<0&&(g.sx=g[W]/2);g.sy-g[M]/2<0&&(g.sy=g[M]/2);g.sy+g[M]/2>w[l]&&(g.sy=w[l]-g[M]/2)}Fn(n,g,g[h],g[l]);n[V](w,g.sx-g[W]/2,g.sy-g[M]/2,g[W],g[M],g.x-g[h]/2,g.y-g[l]/2,g[h],g[l])}else{Fn(n,g,g[h],g[l]);n[V](w,g.x-g[h]/2,g.y-g[l]/2,g[h],g[l])}Mn(r[e],n,g);n[b]();n.rect(g.x-g[h]/2,g.y-g[l]/2,g[h],g[l]);g[m]&&rr(r[e],n,g);n[U]();n.stroke();Dn(n,g);_n(n,i,g)}function T(n,r,i,u){return function(){x(r,i);g[Zt]&&g[Zt][y](n,t);if(g[c]){g._args[Qt]=u[d].masks[ht](0);g._next&&e(n)[B]({clear:o,resetFire:s,index:g._next})}}}var r=this,i,a,p,v,g=new Tn(t),w,E,S;S=g.source;E=S[A];if(S.src||E)w=S;else if(S)if(wn.source===S)w=wn._source;else{w=new n;w.src=S;wn.source=S;wn._source=w}for(a=0;a<r[f];a+=1){i=r[a];p=kn(r[a]);if(p){v=In(r[a]);t=Vn(r[a],g,t,xr);if(g[C]&&w)if(w[on]||E)T(i,a,p,v)();else{e(w).bind(Zt,T(i,a,p,v));w.src=w.src}}}return r};e.fn[nn]=e.fn.pattern=function(r){function d(){f=s[nn](a,o.repeat);o[Zt]&&o[Zt][y](i[0],f)}var i=this,s,o=new Tn(r),a,f,c,p;s=kn(i[0]);if(s){p=o.source;if(cn(p)){a=e(zt)[0];a[h]=o[h];a[l]=o[l];c=kn(a);p[y](a,c);d()}else{c=p[A];if(p.src||c)a=p;else{a=new n;a.src=p}if(a[on]||c)d();else{e(a).bind(Zt,d);a.src=a.src}}}else f=u;return f};e.fn.createGradient=e.fn.gradient=function(t){var n=this,r,i=new Tn(t),s,o=[],l,c,h,p,d,v,m;r=kn(n[0]);if(r){i.x1=i.x1||0;i.y1=i.y1||0;i.x2=i.x2||0;i.y2=i.y2||0;i.r1!==u||i.r2!==u?s=r.createRadialGradient(i.x1,i.y1,i.r1,i.x2,i.y2,i.r2):s=r.createLinearGradient(i.x1,i.y1,i.x2,i.y2);for(p=1;i["c"+p]!==a;p+=1)i["s"+p]!==a?o.push(i["s"+p]):o.push(u);l=o[f];o[0]===u&&(o[0]=0);o[l-1]===u&&(o[l-1]=1);for(p=0;p<l;p+=1){if(o[p]!==u){v=1;m=0;c=o[p];for(d=p+1;d<l;d+=1){if(o[d]!==u){h=o[d];break}v+=1}c>h&&(o[d]=o[p])}else if(o[p]===u){m+=1;o[p]=c+m*((h-c)/v)}s.addColorStop(o[p],i["c"+(p+1)])}}else s=u;return s};e.fn.setPixels=function Tr(e){var t=this,n,r,i,s=new Tn(e),o={},a,c,p,d;for(r=0;r<t[f];r+=1){n=t[r];i=kn(n);if(i){e=Vn(n,s,e,Tr);Fn(i,s,s[h],s[l]);if(s[h]===u||s[l]===u){s[h]=n[h];s[l]=n[l];s.x=s[h]/2;s.y=s[l]/2}if(s[h]!==0&&s[l]!==0){a=i.getImageData(s.x-s[h]/2,s.y-s[l]/2,s[h],s[l]);c=a.data;d=c[f];o=[];if(s.each)for(p=0;p<d;p+=4){o.r=c[p];o.g=c[p+1];o.b=c[p+2];o.a=c[p+3];s.each[y](n,o);c[p]=o.r;c[p+1]=o.g;c[p+2]=o.b;c[p+3]=o.a}i.putImageData(a,s.x-s[h]/2,s.y-s[l]/2);i[at]()}}}return t};e.fn.getCanvasImage=function(t,n){var r=this[0];n===a&&(n=1);return r&&r.toDataURL?r.toDataURL("image/"+t,n):u};e.fn.detectPixelRatio=function(n){var r=this,i,o,u,a,c,p,d,v,m,g;for(u=0;u<r[f];u+=1){o=r[u];i=e(r[u]);a=kn(o);g=In(r[u]);if(!g.scaled){c=window.devicePixelRatio||1;p=a.webkitBackingStorePixelRatio||a.mozBackingStorePixelRatio||a.msBackingStorePixelRatio||a.oBackingStorePixelRatio||a.backingStorePixelRatio||1;d=c/p;if(d!==1){v=o[h];m=o[l];o[h]=v*d;o[l]=m*d;o[dt][h]=v+"px";o[dt][l]=m+"px";a.scale(d,d)}g[Pt]=d;g.scaled=s;n&&n[y](o,d)}}return r};e.support.canvas=e(zt)[0][A]!==a;Nn.defaults=un;Nn.detectEvents=rr;Nn[U]=Pn;e[it]=Nn})(jQuery,document,Image,Math,parseFloat,!0,!1,null);