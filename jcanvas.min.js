/*
 jCanvas
Copyright 2012, Caleb Evans
Licensed under the MIT license
*/
(function(d,S,W,Q,X,u,D,g,z){function A(){}function C(c){c?w(Y,c):C.prefs=Y=A.prototype=w({},N);return this}function J(c,a){c.fillStyle=a.fillStyle;c.strokeStyle=a.strokeStyle;c.lineWidth=a.strokeWidth;a.rounded?(c.lineCap="round",c.lineJoin="round"):(c.lineCap=a.strokeCap,c.lineJoin=a.strokeJoin,c.miterLimit=a.miterLimit);c.shadowOffsetX=a.shadowX;c.shadowOffsetY=a.shadowY;c.shadowBlur=a.shadowBlur;c.shadowColor=a.shadowColor;c.globalAlpha=a.opacity;c.globalCompositeOperation=a.compositing}function y(c){return c&&
c.getContext?c.getContext("2d"):g}function K(c,a,b){b._event&&T(c,a,b);b.closed&&a.closePath();a.fill();"transparent"!==b.fillStyle&&(a.shadowColor="transparent");0!==b.strokeWidth&&a.stroke();b.closed||a.closePath();b._toRad&&a.restore();b.mask&&(b.autosave&&a.save(),a.clip())}function Z(c,a,b){a._toRad=a.inDegrees?E/180:1;c.translate(a.x,a.y);c.rotate(a.rotate*a._toRad);c.translate(-a.x,-a.y);b.rotate+=a.rotate*a._toRad}function $(c,a,b){1!==a.scale&&(a.scaleX=a.scaleY=a.scale);c.translate(a.x,
a.y);c.scale(a.scaleX,a.scaleY);c.translate(-a.x,-a.y);b.scaleX*=a.scaleX;b.scaleY*=a.scaleY}function aa(c,a,b){a.translate&&(a.translateX=a.translateY=a.translate);c.translate(a.translateX,a.translateY);b.translateX+=a.translateX;b.translateY+=a.translateY}function H(c,a,b,e,h){b._toRad=b.inDegrees?E/180:1;a.save();h===z&&(h=e);!c&&!b.fromCenter&&(b.x+=e/2,b.y+=h/2);b.rotate&&Z(a,b,{});(1!==b.scale||1!==b.scaleX||1!==b.scaleY)&&$(a,b,{});(b.translate||b.translateX||b.translateY)&&aa(a,b,{})}function U(c){c.draggable&&
(c.translateX+=c.x,c.translateY+=c.y)}function I(c){var a;F.elem===c?a=F.data:(a=d.data(c,"jCanvas"),a||(a={layers:[],intersects:[],drag:{},event:{},transforms:{rotate:0,scaleX:1,scaleY:1,translateX:0,translateY:0}},a.savedTransforms=w({},a.transforms),d.data(c,"jCanvas",a)),F.elem=c,F.data=a);return a}function ba(c,a,b){b&&b.visible&&(b.method===d.fn.draw?b.fn.call(c[0],a):b.method&&b.method.call(c,b))}function G(c,a,b){var e,h,f,n="function"===typeof a,B,a=a||{};if(a.layer&&!a._layer){e=d(c);h=
e.getLayers();n&&(a={method:d.fn.draw,fn:a});a=w(new A,a);if(!n){a.method=d.fn[a.method]||b;B=I(c);for(f in C.events)C.events.hasOwnProperty(f)&&a[f]&&(C.events[f](e,B),a._event=u);if(a.draggable||a.cursor){a._event=u;c=["mousedown","mousemove","mouseup"];for(b=0;b<c.length;b+=1)f=c[b],C.events[f](e,B);B.mouseout||(e.bind("mouseout.jCanvas",function(){B.drag={};e.drawLayers()}),B.mouseout=u)}}a.layer=u;a._layer=u;a.index===z&&(a.index=h.length);h.splice(a.index,0,a)}}function ca(c){var a;for(a=0;a<
L.length;a+=1)c[L[a]]=c["_"+L[a]]}function da(c,a){var b;for(b=0;b<L.length;b+=1)c["_"+L[b]]=c[L[b]],V[L[b]]=1,a&&delete c[L[b]]}function ea(c){var a,b,e=[],h=1;c.match(/^#?\w+$/i)&&("transparent"===c&&(c="rgba(0,0,0,0)"),b=S.head,a=b.style.color,b.style.color=c,c=d.css(b,"color"),b.style.color=a);c.match(/^rgb/i)&&(e=c.match(/\d+/gi),c.match(/%/gi)&&(h=2.55),e[0]*=h,e[1]*=h,e[2]*=h,e[3]=e[3]!==z?X(e[3]):1);return e}function ga(c){var a=3,b;"object"!==typeof c.start&&(c.start=ea(c.start),c.end=ea(c.end));
c.now=[];if(1!==c.start[3]||1!==c.end[3])a=4;for(b=0;b<a;b+=1)c.now[b]=c.start[b]+(c.end[b]-c.start[b])*c.pos,3>b&&(c.now[b]=O(c.now[b]));1!==c.start[3]||1!==c.end[3]?c.now="rgba("+c.now.join(",")+")":(c.now.slice(0,3),c.now="rgb("+c.now.join(",")+")");c.elem.nodeName?c.elem.style[c.prop]=c.now:c.elem[c.prop]=c.now}function M(c){C.events[c]=function(a,b){var e="mouseover"===c||"mouseout"===c?"mousemove":c,h=b.event;b[e]||(a.bind(e+".jCanvas",function(b){h.x=b.offsetX;h.y=b.offsetY;h.type=e;a.drawLayers(u);
b.preventDefault()}),b[e]=u)}}function T(c,a,b){var c=I(c),e=c.event,a=a.isPointInPath(e.x,e.y),h=c.transforms,f,n;b.mouseX=e.x;b.mouseY=e.y;n=c.transforms.rotate;e=b.mouseX;f=b.mouseY;b._mouseX=e*P(-n)-f*R(-n);b._mouseY=f*P(-n)+e*R(-n);b._mouseX/=h.scaleX;b._mouseY/=h.scaleY;!a&&(b._hovered&&!b._fired)&&(b._mousedout=u);a&&c.intersects.push(b)}function fa(c,a,b,e,h){var f=/\b(\d*\.?\d*)\w\w\b/gi,n;if(F.text===e.text&&F.font===e.font&&F.maxWidth===e.maxWidth&&F.lineHeight===e.lineHeight)e.width=F.width,
e.height=F.height;else if(!a){e.width=b.measureText(h[0]).width;for(a=1;a<h.length;a+=1)n=b.measureText(h[a]).width,n>e.width&&(e.width=n);b=c.style.fontSize;if(a=e.font.match(f))c.style.fontSize=e.font.match(f)[0];e.height=X(d.css(c,"fontSize"))*h.length*e.lineHeight;c.style.fontSize=b}}var N,Y,w=d.extend,O=Q.round,E=Q.PI,R=Q.sin,P=Q.cos,ha=d.event.fix,F={},L,V;d.fn.jCanvas=C;C.events={};N={align:"center",autosave:u,baseline:"middle",bringToFront:D,ccw:D,closed:D,compositing:"source-over",cornerRadius:0,
cropFromCenter:u,draggable:D,disableDrag:D,disableEvents:D,each:g,end:360,fillStyle:"transparent",font:"12pt sans-serif",fromCenter:u,height:g,inDegrees:u,lineHeight:1,load:g,mask:D,maxWidth:g,method:g,miterLimit:10,opacity:1,projection:0,r1:g,r2:g,radius:0,repeat:"repeat",rotate:0,rounded:D,scale:1,scaleX:1,scaleY:1,shadowBlur:0,shadowColor:"transparent",shadowX:0,shadowY:0,sHeight:g,sides:3,source:"",start:0,strokeCap:"butt",strokeJoin:"miter",strokeStyle:"transparent",strokeWidth:1,sWidth:g,sx:g,
sy:g,text:"",translate:0,translateX:0,translateY:0,visible:u,width:g,x:0,y:0};C();C.extend=function(c){C.defaults=N=w(N,c.props);C();c.name&&(d.fn[c.name]=function b(e){var h,f,n,d=w(new A,e);for(f=0;f<this.length;f+=1)if(h=this[f],n=y(h))G(h,e,b),J(n,d),c.fn.call(h,n,e);return this});return d.fn[c.name]};d.fn.getLayers=function(){var c=this[0];return!c||!c.getContext?[]:I(c).layers};d.fn.getLayer=function(c){var a=this.getLayers(),b=d.type(c),e,h;if(c&&c.layer)e=c;else if("number"===b)e=a[c];else for(h=
0;h<a.length;h+=1)if(a[h].index=h,a[h].name===c||"regexp"===b&&a[h].name.match(c)){e=a[h];break}return e};d.fn.setLayer=function(c,a){var b,e;for(b=0;b<this.length;b+=1)(e=d(this[b]).getLayer(c))&&w(e,a);return this};d.fn.moveLayer=function(c,a){var b,e,h;for(e=0;e<this.length;e+=1)if(b=d(this[e]),h=b.getLayers(),b=b.getLayer(c))h.splice(b.index,1),h.splice(a,0,b),b.index=a;return this};d.fn.removeLayer=function(c){var a,b,e;for(b=0;b<this.length;b+=1)a=d(this[b]),e=a.getLayers(),(a=a.getLayer(c))&&
e.splice(a.index,1);return this};d.fn.removeLayers=function(){var c,a;for(c=0;c<this.length;c+=1)a=d(this[c]).getLayers(),a.length=0;return this};d.fn.getLayerGroup=function(c){var a=this.getLayers(),b=d.type(c),e=[],h;if("array"===b)return c;for(h=0;h<a.length;h+=1)a[h].index=h,(a[h].group===c||"regexp"===b&&a[h].group.match(c))&&e.push(a[h]);return e};d.fn.setLayerGroup=function(c,a){var b,e,h;for(e=0;e<this.length;e+=1){b=d(this[e]);b=b.getLayerGroup(c);for(h=0;h<b.length;h+=1)w(b[h],a)}return this};
d.fn.removeLayerGroup=function(c){var a,b,e=d.type(c),h;if(c!==z)for(b=0;b<this.length;b+=1){a=d(this[b]);a=a.getLayers();for(h=0;h<a.length;h+=1)if(a[h].index=h,a[h].group===c||"regexp"===e&&a[h].group.match(c))a.splice(h,1),h-=1}return this};d.fn.drawLayer=function(c){var a,b,e,h;for(a=0;a<this.length;a+=1)e=d(this[a]),b=y(this[a]),h=e.getLayer(c),ba(e,b,h);return this};d.fn.drawLayers=function(c){var a,b,e,h,f,n,B,t;for(b=0;b<this.length;b+=1)if(a=d(this[b]),e=y(this[b])){I(this[b]);a.clearCanvas();
F.elem===this[b]?B=F.data:(B=I(this[b]),F.elem=this[b],F.data=B);h=B.layers;for(n=0;n<h.length;n+=1)if(f=h[n],f.index=n,c&&(f._fired=D),f._event=!f.disableEvents,ba(a,e,f),f._mousedout)f._mousedout=D,f._fired=u,f._hovered=D,f.mouseout&&f.mouseout.call(this[b],f),f.cursor&&f._cursor&&a.css({cursor:f._cursor});f=B.intersects[B.intersects.length-1]||{};e=B.event;e=e.type;t=f[e];n=B.drag;if(f._event){if((f.mouseover||f.mouseout||f.cursor)&&!f._hovered&&!f._fired)f._fired=u,f._hovered=u,f.mouseover&&f.mouseover.call(this[b],
f),f.cursor&&(f._cursor=a.css("cursor"),a.css({cursor:f.cursor}));t&&!f._fired&&(f._fired=u,t.call(this[b],f));f.draggable&&(!f.disableDrag&&"mousedown"===e)&&(f.bringToFront&&(h.splice(f.index,1),f.index=h.push(f)),n.layer=f,n.dragging=u,n.startX=f.x,n.startY=f.y,n.endX=f._mouseX,n.endY=f._mouseY,f.dragstart&&f.dragstart.call(this[b],f))}if(n.layer&&(n.dragging&&"mouseup"===e&&(n.layer.dragstop&&n.layer.dragstop.call(this[b],n.layer),B.drag={}),n.dragging&&"mousemove"===e))n.layer.x=n.layer._mouseX-
(n.endX-n.startX),n.layer.y=n.layer._mouseY-(n.endY-n.startY),n.layer.drag&&n.layer.drag.call(this[b],n.layer)}B.intersects=[];return this};d.fn.addLayer=function(c){var a,b,c=c||{};for(a=0;a<this.length;a+=1)if(b=y(this[a]))c.layer=u,G(this[a],c);return this};L=["width","height","opacity","lineHeight"];V={};d.fn.animateLayer=function(){function c(a,b){return function(){ca(b);a.drawLayers();f[4]&&f[4].call(a[0],b)}}function a(a,b){return function(c,e){ca(b);a.drawLayers();f[5]&&f[5].call(a[0],c,e,
b)}}var b,e,h,f=[].slice.call(arguments,0);"object"===typeof f[0]&&!f[0].layer&&f.unshift(0);"object"===typeof f[2]?(f.splice(2,0,f[2].duration||g),f.splice(3,0,f[3].easing||g),f.splice(4,0,f[4].complete||g),f.splice(5,0,f[5].step||g)):(f[2]===z?(f.splice(2,0,g),f.splice(3,0,g),f.splice(4,0,g)):"function"===typeof f[2]&&(f.splice(2,0,g),f.splice(3,0,g)),f[3]===z)?(f[3]=g,f.splice(4,0,g)):"function"===typeof f[3]&&f.splice(3,0,g);f[1]=w({},f[1]);for(e=0;e<this.length;e+=1)if(b=d(this[e]),h=y(this[e]))if(I(this[e]),
(h=b.getLayer(f[0]))&&h.method!==d.fn.draw)da(h),da(f[1],u),h.style=V,d(h).animate(f[1],{duration:f[2],easing:d.easing[f[3]]?f[3]:g,complete:c(b,h),step:a(b,h)});return this};d.fn.animateLayerGroup=function(c){var a,b,e=[].slice.call(arguments,0),h,f;for(b=0;b<this.length;b+=1){a=d(this[b]);h=a.getLayerGroup(c);for(f=0;f<h.length;f+=1)a.animateLayer.apply(a,[h[f]].concat(e.slice(1)))}};d.fn.delayLayer=function(c,a){var b,e,a=a||0;for(b=0;b<this.length;b+=1)e=d(this[b]).getLayer(c),d(e).delay(a);return this};
d.fn.delayLayerGroup=function(c,a){var b,e,h,f,a=a||0;for(e=0;e<this.length;e+=1){b=d(this[e]);h=b.getLayerGroup(c);for(f=0;f<h.length;f+=1)b.delayLayer.call(b,h[f],a)}};d.fn.stopLayer=function(c,a){var b,e;for(b=0;b<this.length;b+=1)e=d(this[b]).getLayer(c),d(e).stop(a);return this};d.fn.stopLayerGroup=function(c,a){var b,e,h,f;for(e=0;e<this.length;e+=1){b=d(this[e]);h=b.getLayerGroup(c);for(f=0;f<h.length;f+=1)b.stopLayer.call(b,h[f],a)}};(function(c){var a;for(a=0;a<c.length;a+=1)d.fx.step[c[a]]=
ga})("color backgroundColor borderColor borderTopColor borderRightColor borderBottomColor borderLeftColor fillStyle outlineColor strokeStyle shadowColor".split(" "));M("click");M("dblclick");M("mousedown");M("mouseup");M("mousemove");M("mouseover");M("mouseout");d.event.fix=function(c){var a,c=ha.call(d.event,c);if(c.pageX!==z&&c.offsetX===z&&(a=d(c.target).offset()))c.offsetX=c.pageX-a.left,c.offsetY=c.pageY-a.top;return c};d.fn.draw=function a(b){var e,h,b=b||{};"function"===typeof b&&(b={fn:b});
for(e=0;e<this.length;e+=1)if((h=y(this[e]))&&b.fn)G(this[e],b,a),b.fn.call(this[e],h);return this};d.fn.clearCanvas=function(a){for(var b,e=w(new A,a),a=0;a<this.length;a+=1)if(b=y(this[a]))H(a,b,e,e.width,e.height),b.setTransform(1,0,0,1,0,0),!e.x||!e.y||!e.width||!e.height?b.clearRect(0,0,this[a].width,this[a].height):b.clearRect(e.x-e.width/2,e.y-e.height/2,e.width,e.height),b.restore();return this};d.fn.saveCanvas=function(){var a,b,e;for(a=0;a<this.length;a+=1)if(b=y(this[a]))e=I(this[a]),b.save(),
e.savedTransforms=w({},e.transforms);return this};d.fn.restoreCanvas=function(){var a,b,e;for(a=0;a<this.length;a+=1)if(b=y(this[a]))e=I(this[a]),b.restore(),e.transforms=e.savedTransforms;return this};d.fn.translateCanvas=function(a){for(var b,e=w(new A,a),h,a=0;a<this.length;a+=1)if(b=y(this[a]))h=I(this[a]),e.autosave&&b.save(),aa(b,e,h.transforms);return this};d.fn.scaleCanvas=function(a){for(var b,e=w(new A,a),h,a=0;a<this.length;a+=1)if(b=y(this[a]))h=I(this[a]),e.autosave&&b.save(),$(b,e,h.transforms);
return this};d.fn.rotateCanvas=function(a){for(var b,e=w(new A,a),h,a=0;a<this.length;a+=1)if(b=y(this[a]))h=I(this[a]),e.autosave&&b.save(),Z(b,e,h.transforms);return this};d.fn.drawRect=function b(e){var h,f,n=w(new A,e),d,g,s,q,j;for(h=0;h<this.length;h+=1)if(f=y(this[h]))G(this[h],e,b),J(f,n),H(h,f,n,n.width,n.height),f.beginPath(),d=n.x-n.width/2,g=n.y-n.height/2,(j=n.cornerRadius)?(n.closed=u,s=n.x+n.width/2,q=n.y+n.height/2,0>s-d-2*j&&(j=(s-d)/2),0>q-g-2*j&&(j=(q-g)/2),f.moveTo(d+j,g),f.lineTo(s-
j,g),f.arc(s-j,g+j,j,3*E/2,2*E,D),f.lineTo(s,q-j),f.arc(s-j,q-j,j,0,E/2,D),f.lineTo(d+j,q),f.arc(d+j,q-j,j,E/2,E,D),f.lineTo(d,g+j),f.arc(d+j,g+j,j,E,3*E/2,D)):f.rect(d,g,n.width,n.height),K(this[h],f,e);return this};d.fn.drawArc=function e(h){var f,d,g=w(new A,h),h=h||{};!g.inDegrees&&360===g.end&&(h.end=g.end=2*E);for(f=0;f<this.length;f+=1)if(d=y(this[f]))G(this[f],h,e),J(d,g),H(f,d,g,2*g.radius),d.beginPath(),d.arc(g.x,g.y,g.radius,g.start*g._toRad-E/2,g.end*g._toRad-E/2,g.ccw),K(this[f],d,h);
return this};d.fn.drawEllipse=function h(f){var d,g,t=w(new A,f),s=4*t.width/3,q=t.height;t.closed=u;for(d=0;d<this.length;d+=1)if(g=y(this[d]))G(this[d],f,h),J(g,t),H(d,g,t,t.width,t.height),g.beginPath(),g.moveTo(t.x,t.y-q/2),g.bezierCurveTo(t.x-s/2,t.y-q/2,t.x-s/2,t.y+q/2,t.x,t.y+q/2),g.bezierCurveTo(t.x+s/2,t.y+q/2,t.x+s/2,t.y-q/2,t.x,t.y-q/2),K(this[d],g,f);return this};d.fn.drawPolygon=function f(d){var g,t,s=w(new A,d),q=2*E/s.sides,j=E/s.sides,l=j+E/2,m=s.radius*P(q/2),o,p,k;s.closed=u;for(g=
0;g<this.length;g+=1)if(t=y(this[g])){G(this[g],d,f);J(t,s);H(g,t,s,2*s.radius);t.beginPath();for(k=0;k<s.sides;k+=1)o=s.x+O(s.radius*P(l)),p=s.y+O(s.radius*R(l)),t.lineTo(o,p),s.projection&&(o=s.x+O((m+m*s.projection)*P(l+j)),p=s.y+O((m+m*s.projection)*R(l+j)),t.lineTo(o,p)),l+=q;K(this[g],t,d)}return this};d.fn.drawLine=function n(d){var g,s,q=w(new A,d),j,l,m;for(g=0;g<this.length;g+=1)if(s=y(this[g])){G(this[g],d,n);J(s,q);U(q);H(g,s,q,0);j=1;for(s.beginPath();u;)if(l=q["x"+j],m=q["y"+j],l!==
z&&m!==z)s.lineTo(l,m),j+=1;else break;K(this[g],s,d)}return this};d.fn.drawQuad=function B(d){var g,q,j=w(new A,d),l,m,o,p,k;for(g=0;g<this.length;g+=1)if(q=y(this[g])){G(this[g],d,B);J(q,j);U(j);H(g,q,j,0);l=2;q.beginPath();for(q.moveTo(j.x1,j.y1);u;)if(m=j["x"+l],o=j["y"+l],p=j["cx"+(l-1)],k=j["cy"+(l-1)],m!==z&&o!==z&&p!==z&&k!==z)q.quadraticCurveTo(p,k,m,o),l+=1;else break;K(this[g],q,d)}return this};d.fn.drawBezier=function t(d){var g,j,l=w(new A,d),m,o,p,k,i,r,v,x;for(g=0;g<this.length;g+=
1)if(j=y(this[g])){G(this[g],d,t);J(j,l);U(l);H(g,j,l,0);m=2;o=1;j.beginPath();for(j.moveTo(l.x1,l.y1);u;)if(p=l["x"+m],k=l["y"+m],i=l["cx"+o],r=l["cy"+o],v=l["cx"+(o+1)],x=l["cy"+(o+1)],p!==z&&k!==z&&i!==z&&r!==z&&v!==z&&x!==z)j.bezierCurveTo(i,r,v,x,p,k),m+=1,o+=2;else break;K(this[g],j,d)}return this};d.fn.drawText=function s(q){var j,l,m=w(new A,q),o,p,k,i;for(j=0;j<this.length;j+=1)if(d(this[j]),l=y(this[j])){G(this[j],q,s);J(l,m);l.textBaseline=m.baseline;l.textAlign=m.align;l.font=m.font;if(!j&&
m.maxWidth!==g){o=l;p=m.text;i=m.maxWidth;var r=m.text.split(" "),v=[],x="";if(o.measureText(p).width<i||1===r.length)v=[p];else for(;0<r.length;)o.measureText(r[0]).width>i||o.measureText(x+r[0]).width<i?x+=r.shift()+" ":(v.push(x),x=""),0===r.length&&v.push(x);o=v;o=o.join("\n").replace(/( (\n))|( $)/gi,"$2").split("\n")}else j||(o=(""+m.text).split("\n"));fa(this[j],j,l,m,o);H(j,l,m,m.width,m.height);j||(k=m.x,"left"===m.align?k-=m.width/2:"right"===m.align&&(k+=m.width/2));for(p=0;p<o.length;p+=
1)l.shadowColor=m.shadowColor,i=m.y+p*m.height/o.length-(o.length-1)*m.height/o.length/2,l.fillText(o[p],k,i),"transparent"!==m.fillStyle&&(l.shadowColor="transparent"),l.strokeText(o[p],k,i);m._event?(l.beginPath(),l.rect(m.x-m.width/2,m.y-m.height/2,m.width,m.height),l.restore(),T(this[j],l,q),l.closePath()):l.restore()}F=m;return this};d.fn.measureText=function(g){var d;d=g!==z&&"object"!==typeof g?this.getLayer(g):w(new A,g);(g=y(this[0]))&&d.text!==z&&fa(this[0],0,g,d,d.text.split("\n"));return d};
d.fn.drawImage=function q(d){function l(l,k,q){return function(){k||((x=r.width/r.height,i.width===g&&i.sWidth===g&&(d.width=i.width=i.sWidth=r.width),i.height===g&&i.sHeight===g&&(d.height=i.height=i.sHeight=r.height),i.width===g&&i.sWidth!==g&&(i.width=i.sWidth),i.height===g&&i.sHeight!==g&&(i.height=i.sHeight),i.sWidth===g&&i.width!==g&&(d.sWidth=i.sWidth=r.width),i.sHeight===g&&i.height!==g&&(d.sHeight=i.sHeight=r.height),i.sx===g&&(i.sx=i.cropFromCenter?r.width/2:0),i.sy===g&&(i.sy=i.cropFromCenter?
r.height/2:0),i.cropFromCenter||(i.sx+=i.sWidth/2,i.sy+=i.sHeight/2),i.sx+i.sWidth/2>r.width&&(i.sx=r.width-i.sWidth/2),0>i.sx-i.sWidth/2&&(i.sx=i.sWidth/2),0>i.sy-i.sHeight/2&&(i.sy=i.sHeight/2),i.sy+i.sHeight/2>r.height&&(i.sy=r.height-i.sHeight/2),i.width!==g&&i.height===g)?d.height=i.height=i.width/x:i.width===g&&i.height!==g?d.width=i.width=i.height*x:i.width===g&&i.height===g&&(d.width=i.width=r.width,d.height=i.height=r.height));H(k,q,i,i.width,i.height);q.drawImage(r,i.sx-i.sWidth/2,i.sy-
i.sHeight/2,i.sWidth,i.sHeight,i.x-i.width/2,i.y-i.height/2,i.width,i.height);q.fillStyle=q.strokeStyle="transparent";q.beginPath();q.rect(i.x-i.width/2,i.y-i.height/2,i.width,i.height);K(m[k],q,d);i.load&&i.load.call(l,d)}}var m=this,o,p,k,i=w(new A,d),r,v,x;v=i.source.getContext;i.source.src||v?(r=i.source,i.width=r.width,i.height=r.height):i.source&&(r=new W,r.src=i.source);for(p=0;p<m.length;p+=1)if(o=m[p],k=y(m[p]))G(m[p],d,q),J(k,i),r&&(r.complete||v?l(o,p,k)():(r.onload=l(o,p,k),r.src=r.src));
return m};d.fn.createPattern=d.fn.pattern=function(d){function j(){k=m.createPattern(p,o.repeat);o.load&&o.load.call(l[0],k)}var l=this,m,o=w(new A,d),p,k;(m=y(l[0]))?"function"===typeof o.source?(p=S.createElement("canvas"),p.width=o.width,p.height=o.height,d=y(p),o.source.call(p,d),j()):(d=o.source.getContext,o.source.src||d?p=o.source:(p=new W,p.src=o.source),p.complete||d?j():p.onload=j):k=g;return k};d.fn.createGradient=d.fn.gradient=function(d){var j,d=w(new A,d),l=[],m,o,p,k,i,r,v;if(j=y(this[0])){d.x1=
d.x1||0;d.y1=d.y1||0;d.x2=d.x2||0;d.y2=d.y2||0;j=d.r1!==g||d.r2!==g?j.createRadialGradient(d.x1,d.y1,d.r1,d.x2,d.y2,d.r2):j.createLinearGradient(d.x1,d.y1,d.x2,d.y2);for(k=1;d["c"+k]!==z;k+=1)d["s"+k]!==z?l.push(d["s"+k]):l.push(g);m=l.length;l[0]===g&&(l[0]=0);l[m-1]===g&&(l[m-1]=1);for(k=0;k<m;k+=1){if(l[k]!==g){r=1;v=0;o=l[k];for(i=k+1;i<m;i+=1)if(l[i]!==g){p=l[i];break}else r+=1;o>p&&(l[i]=l[k])}else l[k]===g&&(v+=1,l[k]=o+v*((p-o)/r));j.addColorStop(l[k],d["c"+(k+1)])}}else j=g;return j};d.fn.setPixels=
function j(d){var g,o,p,k=w(new A,d),i={},r,v,x,u;for(o=0;o<this.length;o+=1)if(g=this[o],p=y(g)){G(this[o],d,j);H(o,p,k,k.width,k.height);if(!k.x||!k.y||!k.width||!k.height)k.width=g.width,k.height=g.height,k.x=k.width/2,k.y=k.height/2;r=p.getImageData(k.x-k.width/2,k.y-k.height/2,k.width,k.height);v=r.data;u=v.length;i=[];if(k.each)for(x=0;x<u;x+=4)i.r=v[x],i.g=v[x+1],i.b=v[x+2],i.a=v[x+3],k.each.call(g,i),v[x]=i.r,v[x+1]=i.g,v[x+2]=i.b,v[x+3]=i.a;p.putImageData(r,k.x-k.width/2,k.y-k.height/2);
p.restore()}return this};d.fn.getCanvasImage=function(d,l){var m=this[0];return m&&m.toDataURL?m.toDataURL("image/"+d,l):g};d.support.canvas=S.createElement("canvas").getContext!==z;C.defaults=N;C.detectEvents=T;C.closePath=K;d.jCanvas=C})(jQuery,document,Image,Math,parseFloat,!0,!1,null);
